<div class="notification-bell-container" (document:click)="onClickOutside($event)">
  <!-- Bell Button -->
  <button
    type="button"
    class="btn btn-link notification-bell-btn"
    (click)="toggleDropdown()"
    [attr.aria-label]="i18n.t('notifications.title')"
    [attr.aria-expanded]="isDropdownOpen">
    <i class="bi bi-bell fs-5"></i>
    @if (hasUnread()) {
      <span class="notification-badge">{{ unreadCount() > 99 ? '99+' : unreadCount() }}</span>
    }
  </button>

  <!-- Dropdown -->
  @if (isDropdownOpen) {
    <div class="notification-dropdown" [class.dropdown-rtl]="currentLang() === 'ar'">
      <!-- Header -->
      <div class="dropdown-header d-flex justify-content-between align-items-center">
        <span class="fw-bold">{{ i18n.t('notifications.title') }}</span>
        @if (hasUnread()) {
          <button
            type="button"
            class="btn btn-link btn-sm p-0 text-decoration-none"
            (click)="markAllAsRead()">
            {{ i18n.t('notifications.markAllRead') }}
          </button>
        }
      </div>

      <!-- Notifications List -->
      <div class="notification-list">
        @if (isLoading()) {
          <div class="text-center py-4">
            <div class="spinner-border spinner-border-sm text-primary" role="status">
              <span class="visually-hidden">{{ i18n.t('common.loading') }}</span>
            </div>
          </div>
        } @else if (notifications().length === 0) {
          <div class="text-center py-4 text-muted">
            <i class="bi bi-bell-slash fs-2 d-block mb-2"></i>
            {{ i18n.t('notifications.empty') }}
          </div>
        } @else {
          @for (notification of notifications(); track notification.id) {
            <div
              class="notification-item"
              [class.unread]="!notification.isRead"
              (click)="onNotificationClick(notification)"
              role="button"
              tabindex="0"
              (keypress.enter)="onNotificationClick(notification)">
              <div class="notification-icon">
                <i [class]="'bi ' + getIconClass(notification.type)"></i>
              </div>
              <div class="notification-content">
                <div class="notification-title">{{ getTitle(notification) }}</div>
                <div class="notification-message">{{ getMessage(notification) }}</div>
                <div class="notification-time">{{ getTimeAgo(notification.createdAtUtc) }}</div>
              </div>
              @if (!notification.isRead) {
                <div class="unread-indicator"></div>
              }
            </div>
          }
        }
      </div>

      <!-- Footer -->
      @if (notifications().length > 0) {
        <div class="dropdown-footer text-center">
          <a routerLink="/notifications" class="text-decoration-none" (click)="closeDropdown()">
            {{ i18n.t('notifications.viewAll') }}
          </a>
        </div>
      }
    </div>
  }
</div>
