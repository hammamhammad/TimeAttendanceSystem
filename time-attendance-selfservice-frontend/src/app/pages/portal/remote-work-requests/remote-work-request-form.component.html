<!-- Loading State -->
@if (loading()) {
  <app-loading-spinner [message]="i18n.t('common.loading')"></app-loading-spinner>
}

<!-- Form -->
@if (!loading()) {
  <div class="remote-work-request-form">
    <app-page-header
      [title]="isEditMode() ? i18n.t('portal.edit_remote_work') : i18n.t('portal.new_remote_work')">
      <div header-actions>
        <button
          type="button"
          class="btn btn-outline-secondary btn-sm"
          (click)="onCancel()">
          <i class="bi bi-arrow-left me-1"></i>
          {{ i18n.t('common.back') }}
        </button>
      </div>
    </app-page-header>

    <!-- Main Form Card -->
    <div class="card mt-4">
      <div class="card-header">
        <h5>
          <span class="header-icon">
            <i class="bi bi-house-door"></i>
          </span>
          {{ i18n.t('portal.remote_work_details') }}
        </h5>
      </div>
      <div class="card-body">
        <!-- Working Days Summary -->
        <div class="duration-summary">
          <div class="summary-icon">
            <i class="bi bi-calendar-week"></i>
          </div>
          <div class="summary-content">
            <div class="summary-value">{{ calculatedDays() }}</div>
            <p class="summary-label">{{ i18n.t('portal.working_days_unit') }}</p>
          </div>
        </div>

        <form [formGroup]="form" (ngSubmit)="onSubmit()">
          <div class="row">
            <!-- Start Date -->
            <div class="col-md-6 mb-4">
              <label for="startDate" class="form-label">
                <i class="bi bi-calendar-event me-1 text-success"></i>
                {{ i18n.t('portal.start_date') }}
                <span class="text-danger">*</span>
              </label>
              <input
                type="date"
                id="startDate"
                formControlName="startDate"
                class="form-control"
                [class.is-invalid]="hasError('startDate', 'required')">
              @if (hasError('startDate', 'required')) {
                <div class="invalid-feedback">
                  {{ getErrorMessage('startDate') }}
                </div>
              }
            </div>

            <!-- End Date -->
            <div class="col-md-6 mb-4">
              <label for="endDate" class="form-label">
                <i class="bi bi-calendar-event me-1 text-danger"></i>
                {{ i18n.t('portal.end_date') }}
                <span class="text-danger">*</span>
              </label>
              <input
                type="date"
                id="endDate"
                formControlName="endDate"
                class="form-control"
                [class.is-invalid]="hasError('endDate', 'required')">
              @if (hasError('endDate', 'required')) {
                <div class="invalid-feedback">
                  {{ getErrorMessage('endDate') }}
                </div>
              }
            </div>

            <!-- Reason -->
            <div class="col-12 mb-3">
              <label for="reason" class="form-label">
                <i class="bi bi-pencil-square me-1 text-secondary"></i>
                {{ i18n.t('portal.reason') }}
                <span class="text-muted">({{ i18n.t('common.optional') }})</span>
              </label>
              <textarea
                id="reason"
                formControlName="reason"
                class="form-control"
                rows="4"
                maxlength="500"
                [class.is-invalid]="hasError('reason', 'maxlength')"
                [placeholder]="i18n.t('portal.remote_work_reason_placeholder')">
              </textarea>
              <div class="char-count" [class.warning]="(form.get('reason')?.value?.length || 0) > 400" [class.danger]="(form.get('reason')?.value?.length || 0) > 480">
                {{ form.get('reason')?.value?.length || 0 }} / 500 {{ i18n.t('common.characters') }}
              </div>
              @if (hasError('reason', 'maxlength')) {
                <div class="invalid-feedback d-block">
                  {{ getErrorMessage('reason') }}
                </div>
              }
            </div>
          </div>

          <!-- Info Alert -->
          <div class="remote-work-info-alert">
            <i class="bi bi-info-circle alert-icon"></i>
            <p>{{ i18n.t('portal.remote_work_form_info') }}</p>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="saving() || form.invalid">
              @if (saving()) {
                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
              } @else {
                <i class="bi bi-check-lg me-1"></i>
              }
              {{ isEditMode() ? i18n.t('common.update') : i18n.t('common.submit') }}
            </button>
            <button
              type="button"
              class="btn btn-outline-secondary"
              (click)="onCancel()"
              [disabled]="saving()">
              <i class="bi bi-x-lg me-1"></i>
              {{ i18n.t('common.cancel') }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
}
