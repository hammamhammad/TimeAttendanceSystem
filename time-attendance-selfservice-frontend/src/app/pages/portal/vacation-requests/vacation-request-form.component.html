<!-- Loading State -->
@if (loading()) {
  <app-loading-spinner [message]="i18n.t('common.loading')"></app-loading-spinner>
}

<!-- Form -->
@if (!loading()) {
  <div class="vacation-request-form">
    <app-page-header
      [title]="isEditMode() ? i18n.t('portal.edit_vacation') : i18n.t('portal.new_vacation')">
      <div header-actions>
        <button
          type="button"
          class="btn btn-outline-secondary btn-sm"
          (click)="onCancel()">
          <i class="bi bi-arrow-left me-1"></i>
          {{ i18n.t('common.back') }}
        </button>
      </div>
    </app-page-header>

    <!-- Main Form Card -->
    <div class="card mt-4">
      <div class="card-header">
        <h5>
          <span class="header-icon">
            <i class="bi bi-calendar-plus"></i>
          </span>
          {{ i18n.t('portal.vacation_details') }}
        </h5>
      </div>
      <div class="card-body">
        <!-- Total Days Summary -->
        <div class="total-days-summary">
          <div class="summary-icon">
            <i class="bi bi-calendar-week"></i>
          </div>
          <div class="summary-content">
            <div class="summary-value">{{ totalDays }}</div>
            <p class="summary-label">{{ i18n.t('common.days_unit') }}</p>
          </div>
        </div>

        <form [formGroup]="form" (ngSubmit)="onSubmit()">
          <div class="row">
            <!-- Vacation Type -->
            <div class="col-12 mb-4">
              <label for="vacationTypeId" class="form-label">
                <i class="bi bi-tag me-1 text-primary"></i>
                {{ i18n.t('portal.vacation_type') }}
                <span class="text-danger">*</span>
              </label>
              <select
                id="vacationTypeId"
                formControlName="vacationTypeId"
                class="form-select"
                [class.is-invalid]="hasError('vacationTypeId', 'required')">
                <option [ngValue]="null">{{ i18n.t('common.select') }}...</option>
                @for (type of vacationTypes(); track type.id) {
                  <option [value]="type.id">{{ type.name }}</option>
                }
              </select>
              @if (hasError('vacationTypeId', 'required')) {
                <div class="invalid-feedback">
                  {{ getErrorMessage('vacationTypeId') }}
                </div>
              }
            </div>

            <!-- Date Range Row -->
            <div class="col-md-6 mb-4">
              <label for="startDate" class="form-label">
                <i class="bi bi-calendar-event me-1 text-success"></i>
                {{ i18n.t('portal.start_date') }}
                <span class="text-danger">*</span>
              </label>
              <input
                type="date"
                id="startDate"
                formControlName="startDate"
                class="form-control"
                [class.is-invalid]="hasError('startDate', 'required')">
              @if (hasError('startDate', 'required')) {
                <div class="invalid-feedback">
                  {{ getErrorMessage('startDate') }}
                </div>
              }
            </div>

            <div class="col-md-6 mb-4">
              <label for="endDate" class="form-label">
                <i class="bi bi-calendar-event me-1 text-danger"></i>
                {{ i18n.t('portal.end_date') }}
                <span class="text-danger">*</span>
              </label>
              <input
                type="date"
                id="endDate"
                formControlName="endDate"
                class="form-control"
                [class.is-invalid]="hasError('endDate', 'required')">
              @if (hasError('endDate', 'required')) {
                <div class="invalid-feedback">
                  {{ getErrorMessage('endDate') }}
                </div>
              }
            </div>

            <!-- Notes -->
            <div class="col-12 mb-3">
              <label for="notes" class="form-label">
                <i class="bi bi-pencil-square me-1 text-secondary"></i>
                {{ i18n.t('portal.notes') }}
                <span class="text-muted">({{ i18n.t('common.optional') }})</span>
              </label>
              <textarea
                id="notes"
                formControlName="notes"
                class="form-control"
                rows="4"
                maxlength="500"
                [class.is-invalid]="hasError('notes', 'maxlength')"
                [placeholder]="i18n.t('portal.vacation_notes_placeholder')">
              </textarea>
              <div class="char-count" [class.warning]="(form.get('notes')?.value?.length || 0) > 400" [class.danger]="(form.get('notes')?.value?.length || 0) > 480">
                {{ form.get('notes')?.value?.length || 0 }} / 500 {{ i18n.t('common.characters') }}
              </div>
              @if (hasError('notes', 'maxlength')) {
                <div class="invalid-feedback d-block">
                  {{ getErrorMessage('notes') }}
                </div>
              }
            </div>
          </div>

          <!-- Info Alert -->
          <div class="vacation-info-alert">
            <i class="bi bi-info-circle alert-icon"></i>
            <p>{{ i18n.t('portal.vacation_form_info') }}</p>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="saving() || form.invalid">
              @if (saving()) {
                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
              } @else {
                <i class="bi bi-check-lg me-1"></i>
              }
              {{ isEditMode() ? i18n.t('common.update') : i18n.t('common.submit') }}
            </button>
            <button
              type="button"
              class="btn btn-outline-secondary"
              (click)="onCancel()"
              [disabled]="saving()">
              <i class="bi bi-x-lg me-1"></i>
              {{ i18n.t('common.cancel') }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
}
