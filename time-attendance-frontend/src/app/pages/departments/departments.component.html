<div class="departments-page">
  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>{{ i18n.t('department.departments') }}</h2>
  </div>

  <!-- Filters Component -->
  <app-department-filters
    [viewMode]="viewMode()"
    [selectedBranch]="selectedBranch()"
    [branchesLoading]="branchesLoading()"
    (viewModeChange)="onViewModeChange($event)"
    (branchSelectionChange)="onBranchSelectionChange($event)"
    (departmentAdd)="onDepartmentAdd()"
  ></app-department-filters>

  <!-- Departments Content Card -->
  <div class="card">
    <div class="card-body">
      <!-- Info message when no branch is selected -->
      <div class="alert alert-info" *ngIf="!selectedBranch() && !branchesLoading()">
        <div class="d-flex align-items-center">
          <i class="fas fa-info-circle me-3"></i>
          <div>
            <strong>{{ i18n.t('department.allDepartments') || 'All Departments' }}</strong><br>
            <small>{{ i18n.t('department.showingAllDepartments') || 'Showing departments from all branches. Select a specific branch to filter.' }}</small>
          </div>
        </div>
      </div>

      <!-- Table View -->
      <app-department-table
        *ngIf="viewMode() === 'table'"
        [selectedBranchId]="selectedBranch()?.id"
        [allowSelection]="true"
        [allowEdit]="true"
        [allowDelete]="true"
        [showControls]="true"
        (departmentSelected)="onDepartmentSelected($event)"
        (departmentView)="onDepartmentView($event)"
        (departmentEdit)="onDepartmentEdit($event)"
        (departmentDelete)="onDepartmentDelete($event)"
        (departmentAdd)="onDepartmentAdd()"
      ></app-department-table>

      <!-- Tree View -->
      <app-department-tree
        *ngIf="viewMode() === 'tree'"
        [selectedBranchId]="selectedBranch()?.id"
        [allowSelection]="true"
        [allowEdit]="true"
        [allowDelete]="true"
        [showControls]="true"
        (departmentSelected)="onDepartmentSelected($event)"
        (departmentView)="onDepartmentView($event)"
        (departmentEdit)="onDepartmentEdit($event)"
        (departmentDelete)="onDepartmentDelete($event)"
        (departmentAdd)="onDepartmentAdd($event)"
      ></app-department-tree>
    </div>
  </div>

  <!-- Department Info Panel Component -->
  <app-department-info-panel
    [selectedDepartment]="selectedDepartment()"
    (departmentView)="onDepartmentView($event)"
    (departmentEdit)="onDepartmentEdit($event)"
    (departmentDelete)="onDepartmentDelete($event)"
    (closePanel)="onCloseInfoPanel()"
  ></app-department-info-panel>
</div>

