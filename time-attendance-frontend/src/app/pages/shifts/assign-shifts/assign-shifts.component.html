<div class="container-fluid">
  <!-- Page Header -->
  <app-page-header
    [title]="i18n.t('shifts.assignments.title')">
  </app-page-header>

  <!-- Unified Filter Component -->
  <app-unified-filter
    moduleName="shift-assignments"
    [refreshing]="loading()"
    (searchChange)="onSearchTermChange($event)"
    (filtersChange)="onFiltersChange($event)"
    (add)="openCreateModal()"
    (refresh)="onRefreshData()">
  </app-unified-filter>

  <!-- Assignments Table -->
  <app-data-table
    [data]="tableData() || []"
    [columns]="tableColumns()"
    [actions]="tableActions()"
    [currentPage]="currentPage"
    [totalPages]="totalPages"
    [totalItems]="totalCount"
    [pageSize]="pageSize"
    [loading]="loading"
    [emptyTitle]="i18n.t('shifts.assignments.noAssignments')"
    [emptyMessage]="i18n.t('shifts.assignments.noAssignmentsDescription')"
    [responsiveMode]="'auto'"
    (actionClick)="onTableActionClick($event)"
    (pageChange)="onTablePageChange($event)"
    (pageSizeChange)="onTablePageSizeChange($event)">
  </app-data-table>
</div>

<!-- Create Assignment Modal -->
<app-modal-wrapper
  [show]="showCreateModal()"
  [title]="i18n.t('shifts.assignments.createTitle')"
  [size]="'lg'"
  [centered]="true"
  (close)="closeCreateModal()">

  <div class="modal-body">
    <form>
          <div class="row g-3">
            <!-- Shift Selection -->
            <div class="col-md-6">
              <label class="form-label">{{ i18n.t('shifts.shift') }} <span class="text-danger">*</span></label>
              <app-searchable-select
                [options]="shiftSelectOptions"
                [ngModel]="createForm().shiftId.toString()"
                [ngModelOptions]="{standalone: true}"
                (selectionChange)="onShiftSelectionChange($event)"
                [placeholder]="i18n.t('common.select')"
                [searchable]="true"
                [clearable]="false"
              ></app-searchable-select>
            </div>

            <!-- Assignment Type -->
            <div class="col-md-6">
              <label class="form-label">{{ i18n.t('shifts.assignments.assignmentType') }} <span class="text-danger">*</span></label>
              <app-searchable-select
                [options]="assignmentTypeSelectOptions"
                [ngModel]="createForm().assignmentType.toString()"
                [ngModelOptions]="{standalone: true}"
                (selectionChange)="onAssignmentTypeSelectionChange($event)"
                [searchable]="false"
                [clearable]="false"
              ></app-searchable-select>
            </div>

            <!-- Employee Selection (if Employee type) -->
            @if (createForm().assignmentType === ShiftAssignmentType.Employee) {
            <div class="col-md-6">
              <label class="form-label">{{ i18n.t('employees.employee') }} <span class="text-danger">*</span></label>
              <app-searchable-select
                [options]="employeeSelectOptions"
                [ngModel]="createForm().employeeId?.toString() || ''"
                [ngModelOptions]="{standalone: true}"
                (selectionChange)="onEmployeeSelectionChange($event)"
                [placeholder]="i18n.t('common.select')"
                [searchable]="true"
                [clearable]="false"
              ></app-searchable-select>
            </div>
            }

            <!-- Department Selection (if Department type) -->
            @if (createForm().assignmentType === ShiftAssignmentType.Department) {
            <div class="col-md-6">
              <label class="form-label">{{ i18n.t('departments.department') }} <span class="text-danger">*</span></label>
              <app-searchable-select
                [options]="departmentSelectOptions"
                [ngModel]="createForm().departmentId?.toString() || ''"
                [ngModelOptions]="{standalone: true}"
                (selectionChange)="onDepartmentSelectionChange($event)"
                [placeholder]="i18n.t('common.select')"
                [searchable]="true"
                [clearable]="false"
              ></app-searchable-select>
            </div>
            }

            <!-- Branch Selection (if Branch type) -->
            @if (createForm().assignmentType === ShiftAssignmentType.Branch) {
            <div class="col-md-6">
              <label class="form-label">{{ i18n.t('branches.branch') }} <span class="text-danger">*</span></label>
              <app-searchable-select
                [options]="branchSelectOptions"
                [ngModel]="createForm().branchId?.toString() || ''"
                [ngModelOptions]="{standalone: true}"
                (selectionChange)="onBranchSelectionChange($event)"
                [placeholder]="i18n.t('common.select')"
                [searchable]="true"
                [clearable]="false"
              ></app-searchable-select>
            </div>
            }

            <!-- Effective Date -->
            <div class="col-md-6">
              <label class="form-label">{{ i18n.t('shifts.assignments.effectiveDate') }} <span class="text-danger">*</span></label>
              <input
                type="date"
                class="form-control"
                name="effectiveDate"
                [ngModel]="createForm().effectiveDate"
                [ngModelOptions]="{standalone: true}"
                (ngModelChange)="updateCreateForm('effectiveDate', $event)"
                required>
            </div>

            <!-- End Date -->
            <div class="col-md-6">
              <label class="form-label">{{ i18n.t('shifts.assignments.endDate') }}</label>
              <input
                type="date"
                class="form-control"
                name="endDate"
                [ngModel]="createForm().endDate"
                [ngModelOptions]="{standalone: true}"
                (ngModelChange)="updateCreateForm('endDate', $event)">
            </div>

            <!-- Status -->
            <div class="col-md-6">
              <label class="form-label">{{ i18n.t('common.status') }}</label>
              <app-searchable-select
                [options]="statusSelectOptions"
                [ngModel]="createForm().status?.toString() || ''"
                [ngModelOptions]="{standalone: true}"
                (selectionChange)="onStatusSelectionChange($event)"
                [searchable]="false"
                [clearable]="false"
              ></app-searchable-select>
            </div>

            <!-- Priority -->
            <div class="col-md-6">
              <label class="form-label">{{ i18n.t('shifts.assignments.priority') }}</label>
              <input
                type="number"
                class="form-control"
                name="priority"
                min="0"
                max="100"
                [ngModel]="createForm().priority"
                [ngModelOptions]="{standalone: true}"
                (ngModelChange)="updateCreateForm('priority', +$event)">
            </div>

            <!-- Notes -->
            <div class="col-12">
              <label class="form-label">{{ i18n.t('common.notes') }}</label>
              <textarea
                class="form-control"
                name="notes"
                rows="3"
                [ngModel]="createForm().notes"
                [ngModelOptions]="{standalone: true}"
                (ngModelChange)="updateCreateForm('notes', $event)"
                [placeholder]="i18n.t('shifts.assignments.notesPlaceholder')"></textarea>
            </div>
          </div>
    </form>
  </div>

  <div modal-footer class="d-flex gap-2 justify-content-end">
    <button type="button" class="btn btn-secondary" (click)="closeCreateModal()">
      {{ i18n.t('common.cancel') }}
    </button>
    <button
      type="button"
      class="btn btn-primary"
      (click)="createAssignment()"
      [disabled]="!isCreateFormValid()">
      {{ i18n.t('common.create') }}
    </button>
  </div>

</app-modal-wrapper>