<app-modal-wrapper
  [show]="isVisible()"
  [title]="i18n.t('employee_vacations.bulk_assignment')"
  [size]="'lg'"
  [centered]="true"
  [loading]="submitting()"
  (close)="closeModal()">

  <div class="modal-body">
    <form [formGroup]="bulkVacationForm" (ngSubmit)="onSubmit()">

            <!-- Assignment Type Selection -->
            <div class="row mb-3">
              <div class="col-12">
                <label class="form-label">{{ i18n.t('employee_vacations.assignment_type') }} *</label>
                <div class="btn-group w-100" role="group">
                  <input
                    type="radio"
                    class="btn-check"
                    id="assignmentType-branch"
                    [value]="BulkAssignmentType.Branch"
                    formControlName="assignmentType"
                    (change)="onAssignmentTypeChange()">
                  <label class="btn btn-outline-primary" for="assignmentType-branch">
                    <i class="fas fa-building me-2"></i>
                    {{ i18n.t('employee_vacations.branch') }}
                  </label>

                  <input
                    type="radio"
                    class="btn-check"
                    id="assignmentType-department"
                    [value]="BulkAssignmentType.Department"
                    formControlName="assignmentType"
                    (change)="onAssignmentTypeChange()">
                  <label class="btn btn-outline-primary" for="assignmentType-department">
                    <i class="fas fa-sitemap me-2"></i>
                    {{ i18n.t('employee_vacations.department') }}
                  </label>
                </div>
              </div>
            </div>

            <!-- Target Selection -->
            <div class="row mb-3">
              <!-- Branch Selection -->
              @if (bulkVacationForm.get('assignmentType')?.value === BulkAssignmentType.Branch) {
                <div class="col-12">
                  <label class="form-label">{{ i18n.t('employee_vacations.select_branch') }} *</label>
                  <select
                    class="form-select"
                    formControlName="branchId"
                    [class.is-invalid]="hasError('branchId')"
                    (change)="onTargetChange()">
                    <option value="">{{ i18n.t('employee_vacations.select_branch_placeholder') }}</option>
                    @for (branch of branches(); track branch.id) {
                      <option [value]="branch.id">{{ branch.name }}</option>
                    }
                  </select>
                  @if (hasError('branchId')) {
                    <div class="invalid-feedback">
                      {{ getErrorMessage('branchId') }}
                    </div>
                  }
                </div>
              }

              <!-- Department Selection -->
              @if (bulkVacationForm.get('assignmentType')?.value === BulkAssignmentType.Department) {
                <div class="col-12">
                  <label class="form-label">{{ i18n.t('employee_vacations.select_department') }} *</label>
                  <select
                    class="form-select"
                    formControlName="departmentId"
                    [class.is-invalid]="hasError('departmentId')"
                    (change)="onTargetChange()">
                    <option value="">{{ i18n.t('employee_vacations.select_department_placeholder') }}</option>
                    @for (department of departments(); track department.id) {
                      <option [value]="department.id">{{ department.name }}</option>
                    }
                  </select>
                  @if (hasError('departmentId')) {
                    <div class="invalid-feedback">
                      {{ getErrorMessage('departmentId') }}
                    </div>
                  }
                </div>
              }
            </div>

            <!-- Employee Count Preview -->
            @if (previewEmployeeCount() !== null || loadingPreview()) {
              <div class="alert alert-info mb-3">
                <div class="d-flex align-items-center">
                  @if (loadingPreview()) {
                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                    <span>{{ i18n.t('employee_vacations.loading_preview') }}</span>
                  } @else {
                    <i class="fas fa-info-circle me-2"></i>
                    <span>
                      {{ i18n.t('employee_vacations.employees_affected').replace('{{count}}', (previewEmployeeCount() || 0).toString()) }}
                    </span>
                  }
                </div>
              </div>
            }

            <!-- Vacation Details -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">{{ i18n.t('employee_vacations.vacation_type') }} *</label>
                <select
                  class="form-select"
                  formControlName="vacationTypeId"
                  [class.is-invalid]="hasError('vacationTypeId')">
                  <option value="">{{ i18n.t('employee_vacations.select_vacation_type') }}</option>
                  @for (vacationType of vacationTypes(); track vacationType.id) {
                    <option [value]="vacationType.id">{{ vacationType.name }}</option>
                  }
                </select>
                @if (hasError('vacationTypeId')) {
                  <div class="invalid-feedback">
                    {{ getErrorMessage('vacationTypeId') }}
                  </div>
                }
              </div>

              <div class="col-md-6">
                <label class="form-label">{{ i18n.t('employee_vacations.approval_status') }}</label>
                <div class="form-check form-switch mt-2">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="isApproved"
                    formControlName="isApproved">
                  <label class="form-check-label" for="isApproved">
                    {{ i18n.t('employee_vacations.auto_approve') }}
                  </label>
                </div>
              </div>
            </div>

            <!-- Date Range -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">{{ i18n.t('employee_vacations.start_date') }} *</label>
                <input
                  type="date"
                  class="form-control"
                  formControlName="startDate"
                  [class.is-invalid]="hasError('startDate')">
                @if (hasError('startDate')) {
                  <div class="invalid-feedback">
                    {{ getErrorMessage('startDate') }}
                  </div>
                }
              </div>

              <div class="col-md-6">
                <label class="form-label">{{ i18n.t('employee_vacations.end_date') }} *</label>
                <input
                  type="date"
                  class="form-control"
                  formControlName="endDate"
                  [class.is-invalid]="hasError('endDate')">
                @if (hasError('endDate')) {
                  <div class="invalid-feedback">
                    {{ getErrorMessage('endDate') }}
                  </div>
                }
              </div>
            </div>

            <!-- Notes -->
            <div class="row mb-3">
              <div class="col-12">
                <label class="form-label">{{ i18n.t('employee_vacations.notes') }}</label>
                <textarea
                  class="form-control"
                  rows="3"
                  formControlName="notes"
                  [placeholder]="i18n.t('employee_vacations.notes_placeholder')">
                </textarea>
              </div>
            </div>

            <!-- Warning Message -->
            <div class="alert alert-warning">
              <div class="d-flex align-items-start">
                <i class="fas fa-exclamation-triangle me-2 mt-1"></i>
                <div>
                  <strong>{{ i18n.t('employee_vacations.bulk_warning_title') }}</strong>
                  <p class="mb-0 mt-1">{{ i18n.t('employee_vacations.bulk_warning_message') }}</p>
                </div>
              </div>
            </div>

    </form>
  </div>

  <div modal-footer class="d-flex gap-2 justify-content-end">
    <button
      type="button"
      class="btn btn-secondary"
      [disabled]="submitting()"
      (click)="closeModal()">
      {{ i18n.t('common.cancel') }}
    </button>

    <button
      type="submit"
      class="btn btn-primary"
      [disabled]="bulkVacationForm.invalid || submitting()"
      (click)="onSubmit()">
      @if (submitting()) {
        <span class="spinner-border spinner-border-sm me-2" role="status"></span>
      }
      <i class="fas fa-plus-circle me-2" [class.d-none]="submitting()"></i>
      {{ i18n.t('employee_vacations.create_bulk_vacations') }}
    </button>
  </div>

</app-modal-wrapper>