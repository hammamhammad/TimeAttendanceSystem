<div class="app-list-page">
  <!-- Page Header -->
  <app-page-header
    [title]="t('roles.title')">
  </app-page-header>

  <!-- Standardized Filters Component -->
  <app-unified-filter
    moduleName="roles"
    [refreshing]="loading()"
    (searchChange)="onSearchTermChange($event)"
    (filtersChange)="onFiltersChange($event)"
    (add)="onCreateRole()"
    (refresh)="onRefreshData()">
  </app-unified-filter>

  <!-- Roles Table Card -->
      <!-- Unified Data Table -->
      <app-data-table
        [data]="tableData() || []"
        [columns]="tableColumns()"
        [actions]="tableActions()"
        [loading]="loading"
        [emptyTitle]="t('roles.no_roles_found')"
        [emptyMessage]="hasActiveFilters() ? t('common.try_different_filters') : t('roles.no_roles_description')"
        [paginated]="true"
        [responsiveMode]="'auto'"
        (actionClick)="onActionClick($event)"
        class="table-hover">
      </app-data-table>
    </div>

<!-- Permission Management Modal -->
<app-modal-wrapper
  [show]="showPermissionsModal()"
  [title]="t('roles.manage_permissions_for') + ': ' + (selectedRole()?.name || '')"
  [size]="'xl'"
  [centered]="true"
  [loading]="managingPermissions()"
  (close)="closePermissionsModal()">

  <div class="modal-body">
          @if (selectedRole()) {
            <!-- Role Info -->
            <div class="role-info mb-4">
              <div class="d-flex align-items-center">
                <div class="avatar-md me-3">
                  <div class="avatar-title bg-info-subtle text-info rounded-circle">
                    <i class="fa-solid fa-user-shield"></i>
                  </div>
                </div>
                <div>
                  <h6 class="mb-1">{{ selectedRole()!.name }}</h6>
                  <p class="text-muted mb-0">
                    {{ selectedRole()!.permissions.length }} {{ t('roles.permissions_assigned') }}
                  </p>
                </div>
              </div>
            </div>

            <!-- All Permissions List -->
            <div class="permissions-list border rounded p-3" style="max-height: 400px; overflow-y: auto;">
              <div class="row g-2">
                @for (permission of allPermissions(); track permission.id) {
                  <div class="col-md-6 col-lg-4">
                    <div class="permission-item border rounded p-2" 
                         [class.bg-light]="isPermissionAssigned(permission.id)"
                         [class.loading]="managingPermissions()">
                      <div class="form-check d-flex align-items-start">
                        <input
                          class="form-check-input mt-1"
                          type="checkbox"
                          [id]="'permission-' + permission.id"
                          [checked]="isPermissionAssigned(permission.id)"
                          [disabled]="managingPermissions()"
                          (change)="onTogglePermission(permission)"
                        />
                        <div class="form-check-content ms-2 flex-grow-1">
                          <div class="d-flex align-items-center mb-1">
                            <i class="fas me-1 text-muted" [ngClass]="getPermissionIcon(permission.key)" style="font-size: 0.75rem;"></i>
                            <label class="form-check-label fw-medium me-2" [for]="'permission-' + permission.id">
                              <small>{{ getPermissionResource(permission.key) }}</small>
                            </label>
                            <app-status-badge
                              [status]="getPermissionBadgeStatus(permission.key)"
                              [label]="getPermissionAction(permission.key)"
                              [size]="'sm'">
                            </app-status-badge>
                          </div>
                          <p class="text-muted small mb-0" style="font-size: 0.7rem; margin-left: 1.25rem;">
                            {{ getPermissionDescription(permission) }}
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                }
              </div>
              
              @if (allPermissions().length === 0) {
                <app-empty-state
                  [icon]="'fa-solid fa-key'"
                  [message]="t('roles.no_permissions_available')"
                  [size]="'sm'">
                </app-empty-state>
              }
            </div>

            @if (managingPermissions()) {
              <div class="text-center py-3">
                <app-loading-spinner
                  [message]="t('roles.updating_permissions')"
                  [variant]="'primary'"
                  [size]="'sm'"
                  [centered]="true">
                </app-loading-spinner>
              </div>
            }
          }
  </div>

  <div modal-footer class="d-flex gap-2 justify-content-end">
    <button type="button" class="btn btn-secondary" (click)="closePermissionsModal()">
      {{ t('common.close') }}
    </button>
  </div>

</app-modal-wrapper>

