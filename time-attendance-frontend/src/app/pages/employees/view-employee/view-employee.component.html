<div class="container-fluid">
  <!-- Header -->
  <app-form-header
    mode="view"
    [title]="t('employees.view_details')"
    moduleName="employees"
    moduleRoute="employees"
    [entityId]="employeeId"
    [loading]="loading()">
  </app-form-header>

  @if (loading()) {
    <div class="d-flex justify-content-center py-5">
      <app-loading-spinner
        [message]="t('common.loading')"
        [centered]="true">
      </app-loading-spinner>
    </div>
  } @else if (employee()) {
    <!-- Employee Details -->
    <div class="row">
      <!-- Main Information Card -->
      <div class="col-lg-8">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <div class="d-flex align-items-center">
                <div class="avatar-sm me-3">
                  <div class="avatar-title bg-primary-subtle text-primary rounded-circle">
                    {{ (employee()?.firstName?.charAt(0) || '')?.toUpperCase() }}{{ (employee()?.lastName?.charAt(0) || '')?.toUpperCase() }}
                  </div>
                </div>
                <div>
                  <div class="fw-medium">{{ employee()?.fullName }}</div>
                  <small class="text-muted">{{ employee()?.employeeNumber }}</small>
                </div>
              </div>
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <!-- Basic Information -->
              <div class="col-md-6">
                <app-definition-list
                  [items]="basicInfoItems()"
                  [labelWidth]="'5'"
                  [valueWidth]="'7'">
                </app-definition-list>
              </div>

              <!-- Employment Information -->
              <div class="col-md-6">
                <app-definition-list
                  [items]="employmentInfoItems()"
                  [labelWidth]="'5'"
                  [valueWidth]="'7'">
                </app-definition-list>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Status and Details Card -->
      <div class="col-lg-4">
        <div class="card">
          <div class="card-header">
            <h6 class="card-title mb-0">{{ t('employees.employment_details') }}</h6>
          </div>
          <div class="card-body">
            <!-- Status -->
            <div class="mb-3">
              <h6 class="fw-semibold">{{ t('common.status') }}</h6>
              <app-status-badge
                [status]="employee()?.isActive ? 'active' : 'inactive'">
              </app-status-badge>
            </div>
            
            <!-- Employment Status -->
            <div class="mb-3">
              <h6 class="fw-semibold">{{ t('employees.employment_status.title') }}</h6>
              <app-status-badge
                [label]="getEmploymentStatusLabel(employee()!.employmentStatus)"
                [variant]="'info'"
                [icon]="'fas fa-briefcase'">
              </app-status-badge>
            </div>

            <!-- Work Location -->
            <div class="mb-3">
              <h6 class="fw-semibold">{{ t('employees.work_location.title') }}</h6>
              <app-status-badge
                [label]="getWorkLocationTypeLabel(employee()!.workLocationType)"
                [variant]="'light'"
                [icon]="'fas fa-map-marker-alt'">
              </app-status-badge>
            </div>

            <!-- Current Shift -->
            <div class="mb-3">
              <h6 class="fw-semibold">{{ t('employees.current_shift') }}</h6>
              @if (employee()?.currentShiftName) {
                <app-status-badge
                  [label]="employee()!.currentShiftName"
                  [variant]="'primary'"
                  [icon]="'fas fa-clock'">
                </app-status-badge>
              } @else {
                <span class="text-muted">{{ t('employees.no_shift_assigned') }}</span>
              }
            </div>

            <!-- Gender -->
            @if (employee()?.gender) {
              <div class="mb-3">
                <h6 class="fw-semibold">{{ t('employees.gender.title') }}</h6>
                <app-status-badge
                  [label]="getGenderLabel(employee()!.gender!)"
                  [variant]="'light'"
                  [showIcon]="false">
                </app-status-badge>
              </div>
            }

            <!-- Created Date -->
            <div>
              <h6 class="fw-semibold">{{ t('employees.created_at') }}</h6>
              <small class="text-muted">{{ formatDate(employee()!.createdAtUtc) }}</small>
            </div>
          </div>
        </div>

        <!-- Arabic Names Card (if available) -->
        @if (employee()?.firstNameAr || employee()?.lastNameAr || employee()?.jobTitleAr) {
          <div class="card mt-3">
            <div class="card-header">
              <h6 class="card-title mb-0">{{ t('employees.arabic_names') }}</h6>
            </div>
            <div class="card-body">
              @if (employee()?.firstNameAr) {
                <div class="mb-2">
                  <small class="text-muted">{{ t('employees.first_name_ar') }}</small><br>
                  <span>{{ employee()?.firstNameAr }}</span>
                </div>
              }
              @if (employee()?.lastNameAr) {
                <div class="mb-2">
                  <small class="text-muted">{{ t('employees.last_name_ar') }}</small><br>
                  <span>{{ employee()?.lastNameAr }}</span>
                </div>
              }
              @if (employee()?.jobTitleAr) {
                <div>
                  <small class="text-muted">{{ t('employees.job_title_ar') }}</small><br>
                  <span>{{ employee()?.jobTitleAr }}</span>
                </div>
              }
            </div>
          </div>
        }

        <!-- Quick Actions Card -->
        <div class="card mt-3">
          <div class="card-header">
            <h6 class="card-title mb-0">{{ t('common.actions') }}</h6>
          </div>
          <div class="card-body">
            <div class="d-grid gap-2">
              @if (employee()?.isActive) {
                <button 
                  type="button" 
                  class="btn btn-outline-warning">
                  <i class="fa-solid fa-user-slash me-2"></i>
                  {{ t('employees.deactivate') }}
                </button>
              } @else {
                <button 
                  type="button" 
                  class="btn btn-outline-success">
                  <i class="fa-solid fa-user-check me-2"></i>
                  {{ t('employees.activate') }}
                </button>
              }
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Attendance Information Section -->
    <div class="row mt-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="card-title mb-0">
                <i class="fa-solid fa-calendar-check me-2"></i>
                {{ t('attendance.employee_detail') }}
              </h5>
              <div class="d-flex gap-2">
                <input
                  type="date"
                  class="form-control form-control-sm"
                  [value]="selectedDateRange().start"
                  (change)="onDateRangeChange($event.target.value, selectedDateRange().end)"
                  style="width: auto;">
                <span class="align-self-center">{{ t('common.to') }}</span>
                <input
                  type="date"
                  class="form-control form-control-sm"
                  [value]="selectedDateRange().end"
                  (change)="onDateRangeChange(selectedDateRange().start, $event.target.value)"
                  style="width: auto;">
                <button
                  type="button"
                  class="btn btn-success btn-sm"
                  (click)="exportAttendanceData()"
                  [disabled]="attendanceRecords().length === 0">
                  <i class="fa-solid fa-download"></i>
                  {{ t('attendance.actions.export_data') }}
                </button>
              </div>
            </div>
          </div>
          <div class="card-body">
            <!-- Attendance Summary Cards -->
            <app-stats-grid
              [stats]="attendanceStats()"
              [columns]="4"
              [loading]="attendanceLoading()"
              class="mb-4">
            </app-stats-grid>

            <!-- Performance Indicator -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-body text-center">
                    <h6 class="card-title">{{ t('attendance.stats.attendance_rate') }}</h6>
                    <div class="performance-circle mb-3">
                      <div class="circle-progress" [style.--progress]="attendanceRate() + '%'">
                        <span class="percentage">{{ attendanceRate() }}%</span>
                      </div>
                    </div>
                    <app-status-badge
                      [label]="getPerformanceLabel(attendanceRate())"
                      [variant]="getPerformanceColor(attendanceRate())"
                      [icon]="attendanceRate() >= 95 ? 'fas fa-star' : attendanceRate() >= 90 ? 'fas fa-thumbs-up' : attendanceRate() >= 80 ? 'fas fa-exclamation-triangle' : 'fas fa-times-circle'">
                    </app-status-badge>
                  </div>
                </div>
              </div>
            </div>

            <!-- Attendance Tabs -->
            <ul class="nav nav-tabs mb-3" role="tablist">
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  [class.active]="activeTab() === 'overview'"
                  (click)="setActiveTab('overview')"
                  type="button">
                  <i class="fa-solid fa-chart-pie me-2"></i>
                  {{ t('attendance.statistics.overview') }}
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  [class.active]="activeTab() === 'records'"
                  (click)="setActiveTab('records')"
                  type="button">
                  <i class="fa-solid fa-table me-2"></i>
                  {{ t('attendance.statistics.records') }}
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  [class.active]="activeTab() === 'transactions'"
                  (click)="setActiveTab('transactions')"
                  type="button">
                  <i class="fa-solid fa-list me-2"></i>
                  {{ t('attendance.statistics.transactions') }}
                </button>
              </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content">
              <!-- Overview Tab -->
              @if (activeTab() === 'overview') {
                <div class="tab-pane fade show active">
                @if (attendanceLoading()) {
                  <div class="text-center py-4">
                    <app-loading-spinner
                      [message]="t('attendance.messages.loading_data')"
                      [variant]="'primary'"
                      [centered]="true">
                    </app-loading-spinner>
                  </div>
                } @else {
                  <div class="row">
                    <div class="col-md-6">
                      <h6 class="fw-semibold mb-3">{{ t('attendance.statistics.attendance_breakdown') }}</h6>
                      <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                          <span>
                            <i class="fa-solid fa-user-check text-success me-2"></i>
                            {{ t('attendance.status.present') }}
                          </span>
                          <span class="badge bg-success rounded-pill">{{ presentDays() }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                          <span>
                            <i class="fa-solid fa-user-times text-danger me-2"></i>
                            {{ t('attendance.status.absent') }}
                          </span>
                          <span class="badge bg-danger rounded-pill">{{ absentDays() }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                          <span>
                            <i class="fa-solid fa-clock text-warning me-2"></i>
                            {{ t('attendance.status.late') }}
                          </span>
                          <span class="badge bg-warning rounded-pill">{{ lateDays() }}</span>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <h6 class="fw-semibold mb-3">{{ t('attendance.statistics.time_summary') }}</h6>
                      <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                          <span>{{ t('attendance.stats.average_working_hours') }}</span>
                          <span class="fw-medium">{{ averageWorkingHours() }}h</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                          <span>{{ t('attendance.stats.total_overtime_hours') }}</span>
                          <span class="fw-medium">{{ totalOvertimeHours() }}h</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                          <span>{{ t('attendance.statistics.total_working_days') }}</span>
                          <span class="fw-medium">{{ totalWorkingDays() }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                }
                </div>
              }

              <!-- Records Tab -->
              @if (activeTab() === 'records') {
                <div class="tab-pane fade show active">
                @if (attendanceLoading()) {
                  <div class="text-center py-4">
                    <app-loading-spinner
                      [variant]="'primary'"
                      [centered]="true">
                    </app-loading-spinner>
                  </div>
                } @else if (attendanceRecords().length > 0) {
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead class="table-light">
                        <tr>
                          <th>{{ t('attendance.fields.attendance_date') }}</th>
                          <th>{{ t('attendance.fields.check_in_time') }}</th>
                          <th>{{ t('attendance.fields.check_out_time') }}</th>
                          <th>{{ t('attendance.fields.work_duration') }}</th>
                          <th>{{ t('attendance.fields.status') }}</th>
                          <th>{{ t('attendance.fields.notes') }}</th>
                        </tr>
                      </thead>
                      <tbody>
                        @for (record of attendanceRecords(); track record.attendanceDate) {
                          <tr>
                            <td>
                            <span class="fw-medium">{{ formatDate(record.attendanceDate) }}</span>
                          </td>
                          <td>
                            <span [class]="record.actualCheckInTime ? 'text-success fw-medium' : 'text-muted'">
                              {{ formatTime(record.actualCheckInTime) }}
                            </span>
                          </td>
                          <td>
                            <span [class]="record.actualCheckOutTime ? 'text-info fw-medium' : 'text-muted'">
                              {{ formatTime(record.actualCheckOutTime) }}
                            </span>
                          </td>
                          <td>
                            <span class="fw-medium">
                              {{ calculateWorkDuration(record.actualCheckInTime, record.actualCheckOutTime) }}
                            </span>
                          </td>
                          <td>
                            <span [class]="getStatusBadgeClass(record.status)">
                              {{ t('attendance.status.' + record.status.toString().toLowerCase()) }}
                            </span>
                          </td>
                          <td>
                            <span class="text-muted">{{ record.notes || '--' }}</span>
                          </td>
                          </tr>
                        }
                      </tbody>
                    </table>
                  </div>
                } @else {
                  <app-empty-state
                    [icon]="'fa-solid fa-calendar-xmark'"
                    [title]="t('attendance.no_records')"
                    [message]="t('attendance.no_records_description')">
                  </app-empty-state>
                }
                </div>
              }

              <!-- Transactions Tab -->
              @if (activeTab() === 'transactions') {
                <div class="tab-pane fade show active">
                @if (recentTransactions().length > 0) {
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead class="table-light">
                        <tr>
                          <th>{{ t('attendance.fields.datetime') }}</th>
                          <th>{{ t('attendance.fields.transaction_type') }}</th>
                          <th>{{ t('attendance.fields.location') }}</th>
                          <th>{{ t('attendance.fields.manual') }}</th>
                          <th>{{ t('attendance.fields.notes') }}</th>
                        </tr>
                      </thead>
                      <tbody>
                        @for (transaction of recentTransactions(); track transaction.transactionTimeLocal) {
                          <tr>
                            <td>
                            <div class="fw-medium">{{ formatDate(transaction.transactionTimeLocal) }}</div>
                            <small class="text-muted">{{ formatTime(transaction.transactionTimeLocal) }}</small>
                          </td>
                          <td>
                            <span [class]="getTransactionTypeBadgeClass(transaction.transactionType)">
                              {{ transaction.transactionTypeText }}
                            </span>
                          </td>
                          <td>
                            <span class="text-muted">{{ transaction.location || '--' }}</span>
                          </td>
                          <td>
                            <app-status-badge
                              [label]="transaction.isManual ? t('app.yes') : t('app.no')"
                              [variant]="transaction.isManual ? 'warning' : 'success'"
                              [icon]="transaction.isManual ? 'fas fa-hand-paper' : 'fas fa-fingerprint'"
                              [size]="'sm'">
                            </app-status-badge>
                          </td>
                          <td>
                            <span class="text-muted">{{ transaction.notes || '--' }}</span>
                          </td>
                          </tr>
                        }
                      </tbody>
                    </table>
                  </div>
                } @else {
                  <app-empty-state
                    [icon]="'fa-solid fa-list'"
                    [title]="t('attendance.no_transactions')"
                    [message]="t('attendance.no_transactions_description')">
                  </app-empty-state>
                }
                </div>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  } @else {
    <div class="alert alert-danger">
      <i class="fa-solid fa-exclamation-triangle me-2"></i>
      {{ error() || t('employees.employee_not_found') }}
    </div>
  }
</div>