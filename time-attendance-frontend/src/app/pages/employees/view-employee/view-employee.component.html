<div class="container-fluid">
  <!-- Header -->
  <app-form-header
    mode="view"
    [title]="t('employees.view_details')"
    moduleName="employees"
    moduleRoute="employees"
    [entityId]="employeeId"
    [loading]="loading()">
  </app-form-header>

  @if (loading()) {
    <div class="d-flex justify-content-center py-5">
      <app-loading-spinner
        [message]="t('common.loading')"
        [centered]="true">
      </app-loading-spinner>
    </div>
  } @else if (employee()) {
    <!-- Employee Header Card -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="avatar-lg me-3">
            <div class="avatar-title bg-primary-subtle text-primary rounded-circle fs-4">
              {{ (employee()?.firstName?.charAt(0) || '')?.toUpperCase() }}{{ (employee()?.lastName?.charAt(0) || '')?.toUpperCase() }}
            </div>
          </div>
          <div class="flex-grow-1">
            <h4 class="mb-1">{{ employee()?.fullName }}</h4>
            <p class="text-muted mb-0">
              {{ employee()?.employeeNumber }}
              <span class="mx-2">|</span>
              {{ employee()?.jobTitle }}
              <span class="mx-2">|</span>
              {{ employee()?.departmentName || '-' }}
            </p>
          </div>
          <div>
            <app-status-badge
              [status]="employee()?.isActive ? 'active' : 'inactive'">
            </app-status-badge>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Navigation -->
    <ul class="nav nav-tabs mb-4">
      <li class="nav-item">
        <button
          type="button"
          class="nav-link"
          [class.active]="activeTab() === 'info'"
          (click)="activeTab.set('info')">
          <i class="fa-solid fa-user me-2"></i>
          {{ t('employees.personal_info') }}
        </button>
      </li>
      @if (permissionService.has(PERMISSIONS.LEAVE_BALANCE_READ)) {
        <li class="nav-item">
          <button
            type="button"
            class="nav-link"
            [class.active]="activeTab() === 'leave-balance'"
            (click)="activeTab.set('leave-balance')">
            <i class="fa-solid fa-calendar-check me-2"></i>
            {{ t('leaveBalance.balanceSummary') }}
          </button>
        </li>
      }
    </ul>

    <!-- Tab Content -->
    @if (activeTab() === 'info') {
      <!-- Employee Details -->
      <div class="row">
        <!-- Main Information Card -->
        <div class="col-lg-8">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">{{ t('employees.basic_information') }}</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <!-- Basic Information -->
                <div class="col-md-6">
                  <app-definition-list
                    [items]="basicInfoItems()"
                    [labelWidth]="'5'"
                    [valueWidth]="'7'">
                  </app-definition-list>
                </div>

                <!-- Employment Information -->
                <div class="col-md-6">
                  <app-definition-list
                    [items]="employmentInfoItems()"
                    [labelWidth]="'5'"
                    [valueWidth]="'7'">
                  </app-definition-list>
                </div>
              </div>
            </div>
          </div>
        </div>

      <!-- Status and Details Card -->
      <div class="col-lg-4">
        <div class="card">
          <div class="card-header">
            <h6 class="card-title mb-0">{{ t('employees.employment_details') }}</h6>
          </div>
          <div class="card-body">
            <!-- Status -->
            <div class="mb-3">
              <h6 class="fw-semibold">{{ t('common.status') }}</h6>
              <app-status-badge
                [status]="employee()?.isActive ? 'active' : 'inactive'">
              </app-status-badge>
            </div>
            
            <!-- Employment Status -->
            <div class="mb-3">
              <h6 class="fw-semibold">{{ t('employees.employment_status.title') }}</h6>
              <app-status-badge
                [label]="getEmploymentStatusLabel(employee()!.employmentStatus)"
                [variant]="'info'"
                [icon]="'fas fa-briefcase'">
              </app-status-badge>
            </div>

            <!-- Work Location -->
            <div class="mb-3">
              <h6 class="fw-semibold">{{ t('employees.work_location.title') }}</h6>
              <app-status-badge
                [label]="getWorkLocationTypeLabel(employee()!.workLocationType)"
                [variant]="'light'"
                [icon]="'fas fa-map-marker-alt'">
              </app-status-badge>
            </div>

            <!-- Current Shift -->
            <div class="mb-3">
              <h6 class="fw-semibold">{{ t('employees.current_shift') }}</h6>
              @if (employee()?.currentShiftName) {
                <app-status-badge
                  [label]="employee()!.currentShiftName"
                  [variant]="'primary'"
                  [icon]="'fas fa-clock'">
                </app-status-badge>
              } @else {
                <span class="text-muted">{{ t('employees.no_shift_assigned') }}</span>
              }
            </div>

            <!-- Gender -->
            @if (employee()?.gender) {
              <div class="mb-3">
                <h6 class="fw-semibold">{{ t('employees.gender.title') }}</h6>
                <app-status-badge
                  [label]="getGenderLabel(employee()!.gender!)"
                  [variant]="'light'"
                  [showIcon]="false">
                </app-status-badge>
              </div>
            }

            <!-- Created Date -->
            <div>
              <h6 class="fw-semibold">{{ t('employees.created_at') }}</h6>
              <small class="text-muted">{{ formatDate(employee()!.createdAtUtc) }}</small>
            </div>
          </div>
        </div>

        <!-- Arabic Names Card (if available) -->
        @if (employee()?.firstNameAr || employee()?.lastNameAr || employee()?.jobTitleAr) {
          <div class="card mt-3">
            <div class="card-header">
              <h6 class="card-title mb-0">{{ t('employees.arabic_names') }}</h6>
            </div>
            <div class="card-body">
              @if (employee()?.firstNameAr) {
                <div class="mb-2">
                  <small class="text-muted">{{ t('employees.first_name_ar') }}</small><br>
                  <span>{{ employee()?.firstNameAr }}</span>
                </div>
              }
              @if (employee()?.lastNameAr) {
                <div class="mb-2">
                  <small class="text-muted">{{ t('employees.last_name_ar') }}</small><br>
                  <span>{{ employee()?.lastNameAr }}</span>
                </div>
              }
              @if (employee()?.jobTitleAr) {
                <div>
                  <small class="text-muted">{{ t('employees.job_title_ar') }}</small><br>
                  <span>{{ employee()?.jobTitleAr }}</span>
                </div>
              }
            </div>
          </div>
        }

        <!-- Quick Actions Card -->
        <div class="card mt-3">
          <div class="card-header">
            <h6 class="card-title mb-0">{{ t('common.actions') }}</h6>
          </div>
          <div class="card-body">
            <div class="d-grid gap-2">
              @if (permissionService.has(PERMISSIONS.EMPLOYEE_MANAGE)) {
                @if (employee()?.isActive) {
                  <button
                    type="button"
                    class="btn btn-outline-warning"
                    (click)="toggleEmployeeStatus()">
                    <i class="fa-solid fa-user-slash me-2"></i>
                    {{ t('employees.deactivate') }}
                  </button>
                } @else {
                  <button
                    type="button"
                    class="btn btn-outline-success"
                    (click)="toggleEmployeeStatus()">
                    <i class="fa-solid fa-user-check me-2"></i>
                    {{ t('employees.activate') }}
                  </button>
                }
              }

              @if (permissionService.has(PERMISSIONS.EMPLOYEE_DELETE)) {
                <button
                  type="button"
                  class="btn btn-outline-danger"
                  (click)="deleteEmployee()">
                  <i class="fa-solid fa-trash me-2"></i>
                  {{ t('employees.delete') }}
                </button>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
    }

    <!-- Leave Balance Tab -->
    @if (activeTab() === 'leave-balance') {
      <div class="row">
        <div class="col-12">
          <!-- Leave Balance Summary -->
          <div class="card mb-4">
            <div class="card-body p-0">
              <app-leave-balance-summary
                [employeeId]="employeeId"
                [showHeader]="true"
                [showYearSelector]="true"
                [compact]="false">
              </app-leave-balance-summary>
            </div>
          </div>

          <!-- Leave Transaction History -->
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">{{ t('leaveBalance.transactionHistory') }}</h5>
            </div>
            <div class="card-body p-0">
              <app-leave-transaction-history
                [employeeId]="employeeId"
                [showHeader]="false"
                [showFilters]="true"
                [compact]="false"
                [itemsPerPage]="10">
              </app-leave-transaction-history>
            </div>
          </div>
        </div>
      </div>
    }
  } @else {
    <div class="alert alert-danger">
      <i class="fa-solid fa-exclamation-triangle me-2"></i>
      {{ error() || t('employees.employee_not_found') }}
    </div>
  }
</div>