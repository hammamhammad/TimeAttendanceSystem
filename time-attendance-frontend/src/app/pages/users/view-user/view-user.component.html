<div class="container-fluid">
  <!-- Header -->
  <app-form-header
    mode="view"
    [title]="t('users.view_details')"
    moduleName="users"
    moduleRoute="users"
    [entityId]="userId"
    [loading]="loading()">
  </app-form-header>

  @if (loading()) {
    <div class="d-flex justify-content-center py-5">
      <app-loading-spinner
        [message]="t('common.loading')"
        [centered]="true">
      </app-loading-spinner>
    </div>
  } @else if (user()) {
    <!-- User Details -->
    <div class="row">
      <!-- Main Information Card -->
      <div class="col-lg-8">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <div class="d-flex align-items-center">
                <div class="avatar-sm me-3">
                  <div class="avatar-title bg-primary-subtle text-primary rounded-circle">
                    {{ (user()?.username?.charAt(0) || '')?.toUpperCase() }}
                  </div>
                </div>
                <div>
                  <div class="fw-medium">
                    {{ user()?.username }}
                    @if (user()?.mustChangePassword) {
                      <i class="fa-solid fa-exclamation-triangle text-warning ms-2" [title]="t('users.must_change_password')"></i>
                    }
                  </div>
                  <small class="text-muted">{{ user()?.email }}</small>
                </div>
              </div>
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <!-- Basic Information -->
              <div class="col-md-6">
                <app-definition-list
                  [items]="basicInfoItems()"
                  [labelWidth]="'4'"
                  [valueWidth]="'8'">
                </app-definition-list>
              </div>

              <!-- Status Information -->
              <div class="col-md-6">
                <app-definition-list
                  [items]="statusInfoItems()"
                  [labelWidth]="'4'"
                  [valueWidth]="'8'">
                </app-definition-list>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Roles and Branches Card -->
      <div class="col-lg-4">
        <div class="card">
          <div class="card-header">
            <h6 class="card-title mb-0">{{ t('users.roles_and_access') }}</h6>
          </div>
          <div class="card-body">
            <!-- Roles -->
            <div class="mb-3">
              <h6 class="fw-semibold">{{ t('users.roles') }}</h6>
              <app-badge-list
                [items]="roleBadges()"
                [gap]="'sm'"
                [emptyMessage]="t('users.no_roles')">
              </app-badge-list>
            </div>

            <!-- Branches -->
            <div>
              <h6 class="fw-semibold">{{ t('users.branches') }}</h6>
              <app-badge-list
                [items]="branchBadges()"
                [gap]="'sm'"
                [emptyMessage]="t('users.all_branches')">
              </app-badge-list>
            </div>
          </div>
        </div>

        <!-- Quick Actions Card -->
        <div class="card mt-3">
          <div class="card-header">
            <h6 class="card-title mb-0">{{ t('common.actions') }}</h6>
          </div>
          <div class="card-body">
            <div class="d-grid gap-2">
              <button 
                *appHasPermission="PERMISSIONS.USER_ASSIGN_ROLE"
                type="button" 
                class="btn btn-outline-info"
                (click)="onManageRoles()">
                <i class="fa-solid fa-user-tag me-2"></i>
                {{ t('users.manage_roles') }}
              </button>
              @if (user()?.isActive) {
                <button 
                  *appHasPermission="PERMISSIONS.USER_LOCK"
                  type="button" 
                  class="btn btn-outline-warning">
                  <i class="fa-solid fa-lock me-2"></i>
                  {{ t('users.lock_account') }}
                </button>
              } @else {
                <button 
                  *appHasPermission="PERMISSIONS.USER_UNLOCK"
                  type="button" 
                  class="btn btn-outline-success">
                  <i class="fa-solid fa-unlock me-2"></i>
                  {{ t('users.unlock_account') }}
                </button>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  } @else {
    <div class="alert alert-danger">
      <i class="fa-solid fa-exclamation-triangle me-2"></i>
      {{ error() || t('users.user_not_found') }}
    </div>
  }
</div>