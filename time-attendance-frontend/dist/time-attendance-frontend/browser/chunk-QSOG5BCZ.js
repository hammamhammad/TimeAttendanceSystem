import{a as oe}from"./chunk-GZOHMKGJ.js";import"./chunk-ZKUEJZLQ.js";import{a as se}from"./chunk-GWHM7BJD.js";import{a as ae}from"./chunk-RM7DPSQZ.js";import{a as re}from"./chunk-3IQ53VGU.js";import{a as E}from"./chunk-LCQOFV6P.js";import{a as h,b}from"./chunk-5BLMYARA.js";import{a as ie}from"./chunk-CYQTDKAB.js";import"./chunk-SZUF4QIO.js";import{a as A}from"./chunk-TSIHMY7T.js";import"./chunk-7QCK55IR.js";import{b as R}from"./chunk-AS5QRUY4.js";import{$ as a,$a as ee,A as j,E as r,J as P,N as x,O as _,Pa as X,Sa as D,U as y,V as O,X as q,Y as L,Z as V,Za as Y,_ as d,_a as Z,aa as o,ab as te,ba as U,fa as J,fb as w,ga as K,ia as k,ka as f,ma as c,qb as ne,t as p,ta as I,u as v,v as S,va as Q,wa as m,xa as u,ya as C,z as g,za as W}from"./chunk-LDUBOZPL.js";import{a as T,b as z,d as H}from"./chunk-DGAILPFQ.js";var ce=(n,e)=>e.id;function me(n,e){if(n&1&&(a(0,"div",8),U(1,"i",23),m(2),o()),n&2){let t=c(2);r(2),C(" ",t.error()," ")}}function de(n,e){if(n&1&&(a(0,"span",24),m(1),o()),n&2){let t=e.$implicit;r(),u(t)}}function ge(n,e){if(n&1&&(a(0,"div",17),L(1,de,2,1,"span",24,q),o()),n&2){let t=c(2);r(),V(t.user.roles)}}function pe(n,e){if(n&1&&(a(0,"p",14),m(1),o()),n&2){let t=c(2);r(),u(t.t("users.no_roles"))}}function _e(n,e){if(n&1&&(a(0,"div",27)(1,"div",29)(2,"span",30),m(3),o()(),a(4,"p",31),m(5),o()()),n&2){let t=c(3);r(3),u(t.t("common.loading")),r(2),u(t.t("users.updating_roles"))}}function ue(n,e){if(n&1){let t=k();a(0,"input",40),f("change",function(){v(t);let l=c().$implicit,s=c(4);return S(s.onToggleRole(l))}),o()}if(n&2){let t=c().$implicit,i=c(4);d("id","role-"+t.id)("checked",i.isRoleAssigned(t.id))("disabled",i.loading())}}function he(n,e){if(n&1&&(a(0,"p",39),m(1),o()),n&2){let t=c().$implicit,i=c(4);r(),C(" ",i.getRoleDescription(t)," ")}}function be(n,e){if(n&1&&(a(0,"div",33)(1,"div",34),x(2,ue,1,3,"input",35),a(3,"div",36)(4,"label",37)(5,"span",38),m(6),o()(),y(7,he,2,1,"p",39),o()()()),n&2){let t=e.$implicit,i=c(4);I("loading",i.loading()),r(2),d("appHasPermission",i.PERMISSIONS.USER_ASSIGN_ROLE),r(2),d("for","role-"+t.id),r(),Q(i.getRoleBadgeClass(t)),r(),C(" ",t.name," "),r(),O(i.getRoleDescription(t)?7:-1)}}function Ce(n,e){if(n&1&&(a(0,"div",28),L(1,be,8,8,"div",32,ce),o()),n&2){let t=c(3);r(),V(t.availableRoles())}}function fe(n,e){if(n&1&&(a(0,"div",25)(1,"h6",26),m(2),o(),y(3,_e,6,2,"div",27)(4,Ce,3,0,"div",28),o()),n&2){let t=c(2);r(2),u(t.t("users.available_roles")),r(),O(t.loading()?3:4)}}function ve(n,e){if(n&1&&(a(0,"div",41),U(1,"i",42),a(2,"small"),m(3),o()()),n&2){let t=c(2);r(3),u(t.t("users.role_management_help"))}}function Se(n,e){if(n&1&&(a(0,"div",20),U(1,"i",43),a(2,"small"),m(3),o()()),n&2){let t=c(2);r(3),u(t.t("users.no_role_assignment_permission"))}}function xe(n,e){if(n&1){let t=k();a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h5",4),U(5,"i",5),m(6),o(),a(7,"button",6),f("click",function(){v(t);let l=c();return S(l.closeModal())}),o()(),a(8,"div",7),y(9,me,3,1,"div",8),a(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12),m(14),o()(),a(15,"div")(16,"h6",13),m(17),o(),a(18,"p",14),m(19),o()()()(),a(20,"div",15)(21,"h6",16),m(22),o(),y(23,ge,3,0,"div",17)(24,pe,2,1,"p",14),o(),x(25,fe,5,2,"div",18)(26,ve,4,1,"div",19),y(27,Se,4,1,"div",20),o(),a(28,"div",21)(29,"button",22),f("click",function(){v(t);let l=c();return S(l.closeModal())}),m(30),o()()()()()}if(n&2){let t=c();r(6),C(" ",t.t("users.manage_roles")," "),r(3),O(t.error()?9:-1),r(5),C(" ",t.user.username.charAt(0).toUpperCase()," "),r(3),u(t.user.username),r(2),u(t.user.email),r(3),u(t.t("users.current_roles")),r(),O(t.user.roles.length>0?23:24),r(2),d("appHasPermission",t.PERMISSIONS.USER_ASSIGN_ROLE),r(),d("appHasPermission",t.PERMISSIONS.USER_ASSIGN_ROLE),r(),O(t.permissionService.has(t.PERMISSIONS.USER_ASSIGN_ROLE)?-1:27),r(3),C(" ",t.t("common.close")," ")}}var N=class n{user=null;show=!1;showChange=new _;rolesUpdated=new _;usersService=p(A);i18n=p(R);permissionService=p(E);PERMISSIONS={USER_ASSIGN_ROLE:`${b.USER}.${h.ASSIGN_ROLE}`,USER_MANAGE:`${b.USER}.${h.MANAGE}`};loading=g(!1);error=g("");availableRoles=g([{id:1,name:"SystemAdmin",description:"Full system access with all permissions"},{id:2,name:"Admin",description:"Administrative access to employee and role management"},{id:3,name:"HROperation",description:"HR operations with employee management access"},{id:4,name:"User",description:"Basic user access with read-only permissions"}]);userRoleIds=D(()=>this.user?this.user.roles.map(e=>this.availableRoles().find(i=>i.name===e)?.id||0).filter(e=>e>0):[]);ngOnInit(){}t(e){return this.i18n.t(e)}isRoleAssigned(e){return this.userRoleIds().includes(e)}onToggleRole(e){if(!this.user)return;this.loading.set(!0),this.error.set(""),this.isRoleAssigned(e.id)?this.removeRole(e.id):this.assignRole(e.id)}assignRole(e){if(!this.user)return;let t={roleId:e};this.usersService.assignRole(this.user.id,t).subscribe({next:()=>{this.refreshUserData()},error:i=>{this.loading.set(!1),this.error.set(this.getErrorMessage(i))}})}removeRole(e){this.user&&this.usersService.removeRole(this.user.id,e).subscribe({next:()=>{this.refreshUserData()},error:t=>{this.loading.set(!1),this.error.set(this.getErrorMessage(t))}})}refreshUserData(){this.user&&this.usersService.getUserById(this.user.id).subscribe({next:e=>{this.loading.set(!1),this.rolesUpdated.emit(e)},error:e=>{this.loading.set(!1),this.error.set(this.getErrorMessage(e))}})}closeModal(){this.show=!1,this.showChange.emit(!1),this.error.set("")}getErrorMessage(e){return e?.error?.error?e.error.error:this.t("errors.unknown")}getRoleDescription(e){return e.description||""}getRoleBadgeClass(e){return{SystemAdmin:"bg-danger",Admin:"bg-warning",HROperation:"bg-info",User:"bg-secondary"}[e.name]||"bg-primary"}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-role-management"]],inputs:{user:"user",show:"show"},outputs:{showChange:"showChange",rolesUpdated:"rolesUpdated"},decls:1,vars:1,consts:[["tabindex","-1",1,"modal","fade","show","d-block",2,"background-color","rgba(0,0,0,0.5)"],[1,"modal-dialog","modal-md"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"fa-solid","fa-user-tag","me-2"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["role","alert",1,"alert","alert-danger"],[1,"user-info","mb-4"],[1,"d-flex","align-items-center"],[1,"avatar-md","me-3"],[1,"avatar-title","bg-primary-subtle","text-primary","rounded-circle"],[1,"mb-1"],[1,"text-muted","mb-0"],[1,"current-roles","mb-4"],[1,"mb-2"],[1,"d-flex","flex-wrap","gap-2"],["class","available-roles",4,"appHasPermission"],["class","alert alert-info mt-3","role","alert",4,"appHasPermission"],["role","alert",1,"alert","alert-warning","mt-3"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fa-solid","fa-exclamation-triangle","me-2"],[1,"badge","bg-primary"],[1,"available-roles"],[1,"mb-3"],[1,"text-center","py-3"],[1,"roles-list"],["role","status",1,"spinner-border","spinner-border-sm","text-primary"],[1,"visually-hidden"],[1,"text-muted","mt-2","mb-0"],[1,"role-item",3,"loading"],[1,"role-item"],[1,"form-check","d-flex","align-items-start"],["class","form-check-input mt-1","type","checkbox",3,"id","checked","disabled","change",4,"appHasPermission"],[1,"form-check-content","ms-2","flex-grow-1"],[1,"form-check-label","fw-medium",3,"for"],[1,"badge","me-2"],[1,"text-muted","small","mb-0"],["type","checkbox",1,"form-check-input","mt-1",3,"change","id","checked","disabled"],["role","alert",1,"alert","alert-info","mt-3"],[1,"fa-solid","fa-info-circle","me-2"],[1,"fa-solid","fa-lock","me-2"]],template:function(t,i){t&1&&y(0,xe,31,11,"div",0),t&2&&O(i.show&&i.user?0:-1)},dependencies:[w,ae],styles:[".modal.show[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .15s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.modal-content[_ngcontent-%COMP%]{border:none;box-shadow:0 .5rem 1rem #00000026;border-radius:.5rem}.modal-header[_ngcontent-%COMP%]{background-color:var(--bs-light);border-bottom:1px solid var(--bs-border-color);border-radius:.5rem .5rem 0 0}.modal-title[_ngcontent-%COMP%]{font-weight:600;color:var(--bs-primary)}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-footer[_ngcontent-%COMP%]{background-color:var(--bs-light);border-top:1px solid var(--bs-border-color);border-radius:0 0 .5rem .5rem}.avatar-md[_ngcontent-%COMP%]{width:48px;height:48px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.avatar-title[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.25rem;font-weight:600}.user-info[_ngcontent-%COMP%]{padding:1rem;background-color:var(--bs-light);border-radius:.5rem;border:1px solid var(--bs-border-color)}.current-roles[_ngcontent-%COMP%]{padding:1rem;background-color:var(--bs-primary-bg-subtle);border-radius:.5rem;border:1px solid var(--bs-primary-border-subtle)}.roles-list[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.role-item[_ngcontent-%COMP%]{padding:1rem;border:1px solid var(--bs-border-color);border-radius:.5rem;margin-bottom:.5rem;background-color:var(--bs-white);transition:all .2s ease}.role-item[_ngcontent-%COMP%]:hover{background-color:var(--bs-light);border-color:var(--bs-primary-border-subtle)}.role-item.loading[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.form-check[_ngcontent-%COMP%]{margin-bottom:0}.form-check-input[_ngcontent-%COMP%]{margin-top:.125rem}.form-check-input[_ngcontent-%COMP%]:checked{background-color:var(--bs-primary);border-color:var(--bs-primary)}.form-check-content[_ngcontent-%COMP%]{min-width:0}.form-check-label[_ngcontent-%COMP%]{margin-bottom:.25rem;cursor:pointer;line-height:1.2}.badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.375rem .75rem}.alert[_ngcontent-%COMP%]{border:none;border-radius:.5rem}.alert-danger[_ngcontent-%COMP%]{background-color:var(--bs-danger-bg-subtle);color:var(--bs-danger-text);border-left:4px solid var(--bs-danger)}.alert-info[_ngcontent-%COMP%]{background-color:var(--bs-info-bg-subtle);color:var(--bs-info-text);border-left:4px solid var(--bs-info)}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}h6[_ngcontent-%COMP%]{font-weight:600;color:var(--bs-primary)}.text-muted[_ngcontent-%COMP%]{color:var(--bs-secondary)!important}.small[_ngcontent-%COMP%]{font-size:.875rem}.bg-danger[_ngcontent-%COMP%]{background-color:var(--bs-danger)!important}.bg-warning[_ngcontent-%COMP%]{background-color:var(--bs-warning)!important;color:var(--bs-primary)!important}.bg-info[_ngcontent-%COMP%]{background-color:var(--bs-info)!important}.bg-secondary[_ngcontent-%COMP%]{background-color:var(--bs-secondary)!important}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--bs-light);border-radius:3px}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--bs-secondary);border-radius:3px}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--bs-primary)}[dir=rtl][_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{margin-left:0;margin-right:-1.5em}[dir=rtl][_ngcontent-%COMP%]   .form-check-content[_ngcontent-%COMP%]{margin-right:.5rem;margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .avatar-md[_ngcontent-%COMP%]{margin-right:0;margin-left:.75rem}@media (max-width: 768px){.modal-dialog[_ngcontent-%COMP%]{margin:1rem;max-width:none}.modal-body[_ngcontent-%COMP%]{padding:1rem}.user-info[_ngcontent-%COMP%], .current-roles[_ngcontent-%COMP%], .role-item[_ngcontent-%COMP%]{padding:.75rem}.avatar-md[_ngcontent-%COMP%]{width:40px;height:40px}.avatar-title[_ngcontent-%COMP%]{font-size:1rem}}.form-check-input[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem rgba(var(--bs-primary-rgb),.25)}@keyframes _ngcontent-%COMP%_pulse{0%{opacity:1}50%{opacity:.5}to{opacity:1}}.loading[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s ease-in-out infinite}"]})};var F=class n{i18n=p(R);showAddButton=!0;addButtonText="Add User";availableRoles=g([]);searchChange=new _;filtersChange=new _;addUser=new _;filterFields=g([]);ngOnInit(){this.setupFilterFields()}ngOnChanges(){this.setupFilterFields()}setupFilterFields(){let e=[{value:"",label:this.i18n.t("common.all")},...this.availableRoles().map(i=>({value:i.id.toString(),label:i.name}))],t=[{value:"",label:this.i18n.t("common.all")},{value:"true",label:this.i18n.t("common.active")},{value:"false",label:this.i18n.t("common.inactive")}];this.filterFields.set([{key:"roleId",label:"Role",type:"select",options:e},{key:"isActive",label:"Status",type:"select",options:t}])}onSearch(e){this.searchChange.emit(e)}onFilterChange(e){this.filtersChange.emit(e)}onAdd(){this.addUser.emit()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-user-filters"]],inputs:{showAddButton:"showAddButton",addButtonText:"addButtonText",availableRoles:"availableRoles"},outputs:{searchChange:"searchChange",filtersChange:"filtersChange",addUser:"addUser"},features:[j],decls:1,vars:4,consts:[[3,"search","filterChange","add","filterFields","showAddButton","addButtonText","searchPlaceholder"]],template:function(t,i){t&1&&(a(0,"app-search-filter",0),f("search",function(s){return i.onSearch(s)})("filterChange",function(s){return i.onFilterChange(s)})("add",function(){return i.onAdd()}),o()),t&2&&d("filterFields",i.filterFields())("showAddButton",i.showAddButton)("addButtonText",i.addButtonText)("searchPlaceholder","Search users...")},dependencies:[w,oe],encapsulation:2})};function Ue(n,e){if(n&1&&(a(0,"div",7)(1,"div",8)(2,"div",9),m(3),o()(),a(4,"div")(5,"div",10),m(6),o(),a(7,"small",11),m(8),o()()()),n&2){let t=c().$implicit,i=c();r(3),C(" ",i.getInitials(t.firstName,t.lastName)," "),r(3),W("",t.firstName," ",t.lastName),r(2),u(t.email)}}function Me(n,e){n&1&&(a(0,"span",13),U(1,"i",14),o())}function Pe(n,e){if(n&1&&(a(0,"span",10),m(1),x(2,Me,2,0,"span",12),o()),n&2){let t=c().$implicit,i=c();r(),C(" ",t.username," "),r(),d("ngIf",i.isSystemAdmin(t))}}function we(n,e){if(n&1&&(a(0,"span",17),m(1),o()),n&2){let t=e.$implicit;r(),C(" ",t," ")}}function Re(n,e){n&1&&(a(0,"span",11),m(1,"No roles assigned"),o())}function ye(n,e){if(n&1&&(a(0,"div"),x(1,we,2,1,"span",15)(2,Re,2,0,"span",16),o()),n&2){let t=c().$implicit;r(),d("ngForOf",t.roles),r(),d("ngIf",t.roles.length===0)}}function Oe(n,e){if(n&1&&(a(0,"span",18),U(1,"i",19),m(2),o()),n&2){let t=c().$implicit;I("bg-success",t.isActive)("bg-danger",!t.isActive),r(),I("fa-check-circle",t.isActive)("fa-times-circle",!t.isActive),r(),C(" ",t.isActive?"Active":"Inactive"," ")}}function Ee(n,e){n&1&&(a(0,"span",22),U(1,"i",23),m(2," Locked "),o())}function Te(n,e){n&1&&(a(0,"span",24),U(1,"i",25),m(2," Unlocked "),o())}function ke(n,e){if(n&1&&(a(0,"span"),x(1,Ee,3,0,"span",20)(2,Te,3,0,"span",21),o()),n&2){let t=c().$implicit,i=c();r(),d("ngIf",i.isUserLocked(t.lockoutEndUtc)),r(),d("ngIf",!i.isUserLocked(t.lockoutEndUtc))}}function Ie(n,e){if(n&1&&(a(0,"span"),m(1),o()),n&2){let t=c().$implicit,i=c();r(),C(" ",i.formatDate(t.createdAt)," ")}}function De(n,e){if(n&1&&(a(0,"span"),m(1),o()),n&2){let t=c(2).$implicit,i=c();r(),u(i.formatDate(t.lastLoginAt))}}function Ae(n,e){n&1&&(a(0,"span",11),m(1,"Never"),o())}function Ne(n,e){if(n&1&&(a(0,"span"),x(1,De,2,1,"span",26)(2,Ae,2,0,"span",16),o()),n&2){let t=c().$implicit;r(),d("ngIf",t.lastLoginAt),r(),d("ngIf",!t.lastLoginAt)}}function Fe(n,e){if(n&1&&(J(0,2),x(1,Ue,9,4,"div",3)(2,Pe,3,2,"span",4)(3,ye,3,2,"div",5)(4,Oe,3,9,"span",6)(5,ke,3,2,"span",5)(6,Ie,2,1,"span",5)(7,Ne,3,2,"span",5),K()),n&2){let t=e.column;d("ngSwitch",t.key),r(),d("ngSwitchCase","user"),r(),d("ngSwitchCase","username"),r(),d("ngSwitchCase","roles"),r(),d("ngSwitchCase","status"),r(),d("ngSwitchCase","lockStatus"),r(),d("ngSwitchCase","created"),r(),d("ngSwitchCase","lastLogin")}}var $=class n{i18n=p(R);permissionService=p(E);users=[];loading=g(!1);currentPage=g(1);totalPages=g(1);totalItems=g(0);pageSize=g(10);viewUser=new _;editUser=new _;deleteUser=new _;manageRoles=new _;pageChange=new _;pageSizeChange=new _;selectionChange=new _;sortChange=new _;columns=[{key:"user",label:"User",width:"250px",sortable:!0},{key:"username",label:"Username",width:"150px",sortable:!0},{key:"roles",label:"Roles",width:"200px"},{key:"status",label:"Status",width:"100px",align:"center",sortable:!0},{key:"lockStatus",label:"Access",width:"100px",align:"center"},{key:"created",label:"Created",width:"120px",sortable:!0},{key:"lastLogin",label:"Last Login",width:"120px",sortable:!0}];get actions(){let e=[];return this.permissionService.has(`${b.USER}.${h.READ}`)&&e.push({key:"view",label:"View",icon:"fa-eye",color:"info"}),this.permissionService.has(`${b.USER}.${h.UPDATE}`)&&(e.push({key:"edit",label:"Edit",icon:"fa-edit",color:"primary",condition:t=>this.canEditUser(t)}),e.push({key:"manageRoles",label:"Manage Roles",icon:"fa-user-tag",color:"warning",condition:t=>this.canEditUser(t)})),this.permissionService.has(`${b.USER}.${h.DELETE}`)&&e.push({key:"delete",label:"Delete",icon:"fa-trash",color:"danger",condition:t=>this.canDeleteUser(t)}),e}onActionClick(e){let{action:t,item:i}=e;switch(t){case"view":this.viewUser.emit(i);break;case"edit":this.editUser.emit(i);break;case"delete":this.deleteUser.emit(i);break;case"manageRoles":this.manageRoles.emit(i);break}}onPageChange(e){this.pageChange.emit(e)}onPageSizeChange(e){this.pageSizeChange.emit(e)}onSelectionChange(e){this.selectionChange.emit(e)}onSortChange(e){this.sortChange.emit(e)}getInitials(e,t){let i=e?e.charAt(0).toUpperCase():"",l=t?t.charAt(0).toUpperCase():"";return i+l}isSystemAdmin(e){return e.username.toLowerCase()==="systemadmin"}canEditUser(e){return!this.isSystemAdmin(e)}canDeleteUser(e){return!this.isSystemAdmin(e)}isUserLocked(e){return e?new Date(e)>new Date:!1}formatDate(e){return new Date(e).toLocaleDateString(this.i18n.getCurrentLocale(),{year:"numeric",month:"short",day:"numeric"})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-user-table"]],inputs:{users:"users",loading:"loading",currentPage:"currentPage",totalPages:"totalPages",totalItems:"totalItems",pageSize:"pageSize"},outputs:{viewUser:"viewUser",editUser:"editUser",deleteUser:"deleteUser",manageRoles:"manageRoles",pageChange:"pageChange",pageSizeChange:"pageSizeChange",selectionChange:"selectionChange",sortChange:"sortChange"},decls:3,vars:11,consts:[["cellTemplate",""],[3,"actionClick","pageChange","pageSizeChange","selectionChange","sortChange","data","columns","actions","loading","currentPage","totalPages","totalItems","pageSize","allowSelection","emptyMessage","emptyTitle"],[3,"ngSwitch"],["class","d-flex align-items-center",4,"ngSwitchCase"],["class","fw-medium",4,"ngSwitchCase"],[4,"ngSwitchCase"],["class","badge",3,"bg-success","bg-danger",4,"ngSwitchCase"],[1,"d-flex","align-items-center"],[1,"avatar-sm","me-2"],[1,"avatar-initial","bg-primary","text-white","rounded-circle"],[1,"fw-medium"],[1,"text-muted"],["class","badge bg-warning text-dark ms-1","title","System Administrator",4,"ngIf"],["title","System Administrator",1,"badge","bg-warning","text-dark","ms-1"],[1,"fas","fa-crown"],["class","badge bg-light text-dark border me-1",4,"ngFor","ngForOf"],["class","text-muted",4,"ngIf"],[1,"badge","bg-light","text-dark","border","me-1"],[1,"badge"],[1,"fas"],["class","badge bg-warning",4,"ngIf"],["class","text-success",4,"ngIf"],[1,"badge","bg-warning"],[1,"fas","fa-lock"],[1,"text-success"],[1,"fas","fa-unlock"],[4,"ngIf"]],template:function(t,i){if(t&1){let l=k();a(0,"app-data-table",1),f("actionClick",function(M){return v(l),S(i.onActionClick(M))})("pageChange",function(M){return v(l),S(i.onPageChange(M))})("pageSizeChange",function(M){return v(l),S(i.onPageSizeChange(M))})("selectionChange",function(M){return v(l),S(i.onSelectionChange(M))})("sortChange",function(M){return v(l),S(i.onSortChange(M))}),x(1,Fe,8,8,"ng-template",null,0,X),o()}t&2&&d("data",i.users)("columns",i.columns)("actions",i.actions)("loading",i.loading)("currentPage",i.currentPage)("totalPages",i.totalPages)("totalItems",i.totalItems)("pageSize",i.pageSize)("allowSelection",!0)("emptyMessage","No users found")("emptyTitle","No Users")},dependencies:[w,Y,Z,ee,te,se],styles:[".avatar-sm[_ngcontent-%COMP%]{width:2rem;height:2rem}.avatar-initial[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:.875rem;font-weight:600}"]})};var le=class n{usersService=p(A);notificationService=p(ie);confirmationService=p(re);router=p(ne);i18n=p(R);permissionService=p(E);loading=g(!1);users=g([]);pagedResult=g(null);currentPage=g(1);pageSize=g(10);currentFilter={};showRoleManagement=g(!1);selectedUser=g(null);availableRoles=g([{id:1,name:"SystemAdmin"},{id:2,name:"Admin"},{id:3,name:"HROperation"},{id:4,name:"User"}]);totalPages=D(()=>this.pagedResult()?.totalPages||1);totalItems=D(()=>this.pagedResult()?.totalItems||0);totalPagesSignal=g(1);totalItemsSignal=g(0);PERMISSIONS={USER_CREATE:`${b.USER}.${h.CREATE}`,USER_READ:`${b.USER}.${h.READ}`,USER_UPDATE:`${b.USER}.${h.UPDATE}`,USER_DELETE:`${b.USER}.${h.DELETE}`,USER_ASSIGN_ROLE:`${b.USER}.${h.ASSIGN_ROLE}`,USER_REMOVE_ROLE:`${b.USER}.${h.REMOVE_ROLE}`,USER_MANAGE:`${b.USER}.${h.MANAGE}`};ngOnInit(){this.loadUsers()}loadUsers(){this.loading.set(!0);let e=T({page:this.currentPage(),pageSize:this.pageSize()},this.currentFilter);this.usersService.getUsers(e).subscribe({next:t=>{this.pagedResult.set(t),this.users.set(t.items),this.totalPagesSignal.set(t.totalPages),this.totalItemsSignal.set(t.totalItems),this.loading.set(!1)},error:t=>{console.error("Failed to load users:",t),this.loading.set(!1),this.notificationService.error(this.i18n.t("errors.server"),this.i18n.t("errors.network"))}})}onSearchChange(e){this.currentFilter=z(T({},this.currentFilter),{search:e}),this.currentPage.set(1),this.loadUsers()}onFiltersChange(e){this.currentFilter=T({},e),this.currentPage.set(1),this.loadUsers()}onAddUser(){this.router.navigate(["/users/create"])}onViewUser(e){this.router.navigate(["/users",e.id,"view"])}onEditUser(e){this.router.navigate(["/users",e.id,"edit"])}onDeleteUser(e){return H(this,null,function*(){let t=this.i18n.t("users.confirm_delete_user").replace("{{username}}",e.username);(yield this.confirmationService.confirm({title:this.i18n.t("users.delete_user"),message:t,confirmText:this.i18n.t("common.delete"),cancelText:this.i18n.t("common.cancel"),confirmButtonClass:"btn-danger",icon:"fa-trash",iconClass:"text-danger"})).confirmed&&this.usersService.deleteUser(e.id).subscribe({next:()=>{this.loadUsers(),this.notificationService.success(this.i18n.t("app.success"),this.i18n.t("users.user_deleted"))},error:l=>{let s=this.i18n.t("errors.server");l.error&&l.error.error&&(s=l.error.error),this.notificationService.error(this.i18n.t("app.error"),s)}})})}onManageRoles(e){this.selectedUser.set(e),this.showRoleManagement.set(!0)}onPageChange(e){this.currentPage.set(e),this.loadUsers()}onPageSizeChange(e){this.pageSize.set(e),this.currentPage.set(1),this.loadUsers()}onSelectionChange(e){console.log("Selected users:",e)}onSortChange(e){this.currentFilter=z(T({},this.currentFilter),{sortBy:e.column,sortDirection:e.direction}),this.currentPage.set(1),this.loadUsers()}onRolesUpdated(e){this.loadUsers(),this.notificationService.success(this.i18n.t("app.success"),"User roles updated successfully")}onCloseRoleManagement(){this.showRoleManagement.set(!1),this.selectedUser.set(null)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-users"]],decls:7,vars:12,consts:[[1,"users-page"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[3,"searchChange","filtersChange","addUser","showAddButton","addButtonText","availableRoles"],[3,"viewUser","editUser","deleteUser","manageRoles","pageChange","pageSizeChange","selectionChange","sortChange","users","loading","currentPage","totalPages","totalItems","pageSize"],[3,"showChange","rolesUpdated","user","show"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"div",1)(2,"h2"),m(3),o()(),a(4,"app-user-filters",2),f("searchChange",function(s){return i.onSearchChange(s)})("filtersChange",function(s){return i.onFiltersChange(s)})("addUser",function(){return i.onAddUser()}),o(),a(5,"app-user-table",3),f("viewUser",function(s){return i.onViewUser(s)})("editUser",function(s){return i.onEditUser(s)})("deleteUser",function(s){return i.onDeleteUser(s)})("manageRoles",function(s){return i.onManageRoles(s)})("pageChange",function(s){return i.onPageChange(s)})("pageSizeChange",function(s){return i.onPageSizeChange(s)})("selectionChange",function(s){return i.onSelectionChange(s)})("sortChange",function(s){return i.onSortChange(s)}),o(),a(6,"app-role-management",4),f("showChange",function(){return i.onCloseRoleManagement()})("rolesUpdated",function(s){return i.onRolesUpdated(s)}),o()()),t&2&&(r(3),u(i.i18n.t("users.title")),r(),d("showAddButton",i.permissionService.has(i.PERMISSIONS.USER_CREATE))("addButtonText",i.i18n.t("users.create_user"))("availableRoles",i.availableRoles),r(),d("users",i.users())("loading",i.loading)("currentPage",i.currentPage)("totalPages",i.totalPagesSignal)("totalItems",i.totalItemsSignal)("pageSize",i.pageSize),r(),d("user",i.selectedUser())("show",i.showRoleManagement()))},dependencies:[w,N,F,$],styles:[".users-page[_ngcontent-%COMP%]{padding:0}.avatar-sm[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.avatar-title[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:600}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.badge[_ngcontent-%COMP%]{font-size:.75rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:.25rem!important;margin-right:2px}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}.modal.show[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .15s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.table-responsive[_ngcontent-%COMP%]{border-radius:.375rem}.pagination[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{color:var(--bs-primary);border-color:var(--bs-border-color)}.pagination[_ngcontent-%COMP%]   .page-item.active[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{background-color:var(--bs-primary);border-color:var(--bs-primary)}.form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.input-group-text[_ngcontent-%COMP%]{background-color:var(--bs-light);border-color:var(--bs-border-color)}.card[_ngcontent-%COMP%]{box-shadow:0 .125rem .25rem #00000013;border:1px solid var(--bs-border-color)}.card-body[_ngcontent-%COMP%]{padding:1.5rem}.spinner-border[_ngcontent-%COMP%]{width:2rem;height:2rem}[dir=rtl][_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:0;margin-left:2px}[dir=rtl][_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .avatar-sm[_ngcontent-%COMP%]{margin-right:0;margin-left:.5rem}@media (max-width: 768px){.btn-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:0;width:100%}.table-responsive[_ngcontent-%COMP%]{font-size:.875rem}.badge[_ngcontent-%COMP%]{font-size:.7rem}}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar{height:8px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--bs-light);border-radius:4px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--bs-secondary);border-radius:4px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--bs-primary)}"]})};export{le as UsersComponent};
