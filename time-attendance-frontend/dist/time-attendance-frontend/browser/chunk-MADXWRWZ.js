import{a as J}from"./chunk-PEVKBW7N.js";import{a as z}from"./chunk-46YUKDEL.js";import{a as W}from"./chunk-IE5XUEO5.js";import{a as H}from"./chunk-C3GHRZ52.js";import{A as O,b as A,c as w,d as _,e as B,f as D,i as V,m as U,p as G,q as P,r as R,t as q,y as L}from"./chunk-YQIE4CGE.js";import{a as j}from"./chunk-JNFDDMIM.js";import{a as $}from"./chunk-GEGVYT7O.js";import"./chunk-A6EM5NV6.js";import{A as b,Cb as E,Da as h,E as u,Fb as y,Ga as c,Gb as M,Ha as l,Ia as s,L as i,Lb as k,Q as C,aa as f,ba as v,ea as S,fa as I,fb as N,ga as m,ha as o,ia as r,ja as d,qa as T,sa as F,ua as p,y as g,z as x}from"./chunk-5OFYUWMA.js";import"./chunk-YMDWBF3A.js";var X=(a,n)=>n.id;function Y(a,n){if(a&1&&(o(0,"div",2),d(1,"app-loading-spinner",4),r()),a&2){let e=p();i(),m("message",e.i18n.t("common.loading"))("centered",!0)}}function Z(a,n){if(a&1&&(o(0,"div",12),d(1,"i",35),c(2),r()),a&2){let e=p(2);i(2),s(" ",e.error()," ")}}function ee(a,n){if(a&1&&(o(0,"div",17),c(1),r()),a&2){let e=p(2);i(),l(e.getFieldError("tagUid"))}}function te(a,n){if(a&1&&(o(0,"option",21),c(1),r()),a&2){let e=n.$implicit;m("value",e.id),i(),l(e.name)}}function ie(a,n){if(a&1&&(o(0,"div",17),c(1),r()),a&2){let e=p(2);i(),l(e.getFieldError("branchId"))}}function ne(a,n){if(a&1&&(o(0,"div",13)(1,"div",36),d(2,"input",37),o(3,"label",38),c(4),r()(),o(5,"div",18),c(6),r()()),a&2){let e=p(2);i(4),s(" ",e.i18n.t("common.active")," "),i(2),l(e.i18n.t("nfc_tags.active_hint"))}}function ae(a,n){if(a&1&&(o(0,"div",23),d(1,"i",39),c(2),r()),a&2){let e=p(2);i(2),s(" ",e.i18n.t("nfc_tags.tag_is_locked")," ")}}function oe(a,n){a&1&&d(0,"span",28)}function re(a,n){a&1&&d(0,"i",29)}function ce(a,n){if(a&1){let e=T();o(0,"div",3)(1,"div",5)(2,"div",6)(3,"div",7)(4,"h5",8),d(5,"i",9),c(6),r()(),o(7,"div",10)(8,"form",11),F("ngSubmit",function(){x(e);let Q=p();return b(Q.onSubmit())}),f(9,Z,3,1,"div",12),o(10,"div",13)(11,"label",14),c(12),o(13,"span",15),c(14,"*"),r()(),d(15,"input",16),f(16,ee,2,1,"div",17),o(17,"div",18),c(18),r()(),o(19,"div",13)(20,"label",14),c(21),o(22,"span",15),c(23,"*"),r()(),o(24,"select",19)(25,"option",20),c(26),r(),S(27,te,2,2,"option",21,X),r(),f(29,ie,2,1,"div",17),o(30,"div",18),c(31),r()(),o(32,"div",13)(33,"label",14),c(34),r(),d(35,"input",22),o(36,"div",18),c(37),r()(),f(38,ne,7,2,"div",13),f(39,ae,3,1,"div",23),o(40,"div",24)(41,"button",25),d(42,"i",26),c(43),r(),o(44,"button",27),f(45,oe,1,0,"span",28)(46,re,1,0,"i",29),c(47),r()()()()()(),o(48,"div",30)(49,"div",6)(50,"div",7)(51,"h6",8),d(52,"i",31),c(53),r()(),o(54,"div",10)(55,"p",32),c(56),r(),o(57,"p",32),c(58),r(),o(59,"p",33),d(60,"i",34),c(61),r()()()()()}if(a&2){let e,t=p();i(6),s(" ",t.i18n.t("nfc_tags.tag_information")," "),i(2),m("formGroup",t.tagForm),i(),v(t.error()?9:-1),i(3),s(" ",t.i18n.t("nfc_tags.tag_uid")," "),i(3),h("is-invalid",t.isFieldInvalid("tagUid")),m("placeholder",t.i18n.t("nfc_tags.tag_uid_placeholder"))("readonly",t.isEditMode()),i(),v(t.isFieldInvalid("tagUid")?16:-1),i(2),l(t.i18n.t("nfc_tags.tag_uid_hint")),i(3),s(" ",t.i18n.t("common.branch")," "),i(3),h("is-invalid",t.isFieldInvalid("branchId")),i(2),l(t.i18n.t("nfc_tags.select_branch")),i(),I(t.branches()),i(2),v(t.isFieldInvalid("branchId")?29:-1),i(2),l(t.i18n.t("nfc_tags.branch_hint")),i(3),l(t.i18n.t("common.description")),i(),m("placeholder",t.i18n.t("nfc_tags.description_placeholder")),i(2),l(t.i18n.t("nfc_tags.description_hint")),i(),v(t.isEditMode()?38:-1),i(),v(t.isEditMode()&&((e=t.existingTag())!=null&&e.isWriteProtected)?39:-1),i(2),m("disabled",t.saving()),i(2),s(" ",t.i18n.t("common.cancel")," "),i(),m("disabled",t.tagForm.invalid||t.saving()),i(),v(t.saving()?45:46),i(2),s(" ",t.saving()?t.i18n.t("common.saving"):t.i18n.t("common.save")," "),i(6),s(" ",t.i18n.t("nfc_tags.help_title")," "),i(3),l(t.i18n.t("nfc_tags.help_text_1")),i(2),l(t.i18n.t("nfc_tags.help_text_2")),i(3),s(" ",t.i18n.t("nfc_tags.help_text_3")," ")}}var K=class a{route=g(E);router=g(y);fb=g(L);nfcTagsService=g(J);branchesService=g(z);notificationService=g(j);i18n=g($);loading=u(!0);saving=u(!1);error=u("");branches=u([]);existingTag=u(null);tagForm;isEditMode=N(()=>!!this.existingTag());tagId=null;ngOnInit(){this.initForm(),this.loadBranches();let n=this.route.snapshot.paramMap.get("id");n?(this.tagId=parseInt(n),this.loadTag(this.tagId)):this.loading.set(!1)}initForm(){this.tagForm=this.fb.group({tagUid:["",[_.required,_.minLength(4)]],branchId:["",_.required],description:[""],isActive:[!0]})}loadBranches(){this.branchesService.getBranchesForDropdown().subscribe({next:n=>this.branches.set(n),error:()=>this.notificationService.error(this.i18n.t("errors.loading_branches"))})}loadTag(n){this.nfcTagsService.getNfcTagById(n).subscribe({next:e=>{this.existingTag.set(e),this.tagForm.patchValue({tagUid:e.tagUid,branchId:e.branchId.toString(),description:e.description||"",isActive:e.isActive}),this.loading.set(!1)},error:e=>{this.error.set(this.i18n.t("nfc_tags.tag_not_found")),this.loading.set(!1)}})}onSubmit(){if(this.tagForm.invalid){this.tagForm.markAllAsTouched();return}this.saving.set(!0),this.error.set("");let n=this.tagForm.value;this.isEditMode()?this.nfcTagsService.updateNfcTag(this.tagId,{branchId:parseInt(n.branchId),description:n.description||void 0,isActive:n.isActive}).subscribe({next:()=>{this.notificationService.success(this.i18n.t("nfc_tags.update_success")),this.router.navigate(["/nfc-tags",this.tagId,"view"])},error:e=>{this.saving.set(!1),this.error.set(e.error?.error||this.i18n.t("nfc_tags.update_error"))}}):this.nfcTagsService.createNfcTag({tagUid:n.tagUid,branchId:parseInt(n.branchId),description:n.description||void 0}).subscribe({next:e=>{this.notificationService.success(this.i18n.t("nfc_tags.create_success")),this.router.navigate(["/nfc-tags",e.id,"view"])},error:e=>{this.saving.set(!1),this.error.set(e.error?.error||this.i18n.t("nfc_tags.create_error"))}})}isFieldInvalid(n){let e=this.tagForm.get(n);return!!(e?.invalid&&e.touched)}getFieldError(n){let e=this.tagForm.get(n);if(e?.errors){if(e.errors.required)return this.i18n.t("validation.required");if(e.errors.minlength)return this.i18n.t("validation.minlength",{min:e.errors.minlength.requiredLength})}return""}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=C({type:a,selectors:[["app-nfc-tag-form"]],decls:4,vars:3,consts:[[1,"container-fluid"],["backRoute","/nfc-tags",3,"title","showBackButton"],[1,"d-flex","justify-content-center","py-5"],[1,"row"],[3,"message","centered"],[1,"col-lg-8"],[1,"card"],[1,"card-header"],[1,"card-title","mb-0"],[1,"fa-solid","fa-tag","me-2"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"alert","alert-danger"],[1,"mb-3"],[1,"form-label"],[1,"text-danger"],["type","text","formControlName","tagUid",1,"form-control",3,"placeholder","readonly"],[1,"invalid-feedback"],[1,"form-text"],["formControlName","branchId",1,"form-select"],["value",""],[3,"value"],["type","text","formControlName","description",1,"form-control",3,"placeholder"],[1,"alert","alert-warning"],[1,"d-flex","justify-content-end","gap-2","mt-4"],["type","button","routerLink","/nfc-tags",1,"btn","btn-outline-secondary",3,"disabled"],[1,"fa-solid","fa-times","me-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"fa-solid","fa-save","me-2"],[1,"col-lg-4"],[1,"fa-solid","fa-info-circle","me-2"],[1,"text-muted","small"],[1,"text-muted","small","mb-0"],[1,"fa-solid","fa-exclamation-triangle","text-warning","me-1"],[1,"fa-solid","fa-exclamation-triangle","me-2"],[1,"form-check","form-switch"],["type","checkbox","id","isActive","formControlName","isActive",1,"form-check-input"],["for","isActive",1,"form-check-label"],[1,"fa-solid","fa-lock","me-2"]],template:function(e,t){e&1&&(o(0,"div",0),d(1,"app-page-header",1),f(2,Y,2,2,"div",2)(3,ce,62,30,"div",3),r()),e&2&&(i(),m("title",t.isEditMode()?t.i18n.t("nfc_tags.edit_tag"):t.i18n.t("nfc_tags.register_tag"))("showBackButton",!0),i(),v(t.loading()?2:3))},dependencies:[k,M,O,V,R,q,w,A,P,B,D,U,G,H,W],encapsulation:2})};export{K as NfcTagFormComponent};
