import{a as Q}from"./chunk-6GOUAYRY.js";import{a as K}from"./chunk-QHBTYDS6.js";import{a as J}from"./chunk-HCDX4O2L.js";import{c as $,e as z,h as B,q as R,r as L,t as j,z as q}from"./chunk-HF7V7ZC6.js";import{a as W}from"./chunk-RUOWTK24.js";import{g as N,h as V}from"./chunk-O3U3HUCY.js";import{a as G}from"./chunk-77FC2LKR.js";import"./chunk-A6EM5NV6.js";import{$a as h,Ac as D,Bb as T,Bc as O,Db as M,Eb as l,Fb as s,Gb as _,Ha as P,Kb as I,T as u,Tb as A,Y as x,Yb as k,Z as S,_a as y,_b as H,ab as E,cb as C,db as b,dc as w,eb as c,fa as m,fb as a,gb as o,hb as f,ob as F,qb as v,sb as d,wa as i}from"./chunk-IGEIB4M6.js";import"./chunk-YMDWBF3A.js";var Y=()=>[],U=(n,t)=>t.value,Z=(n,t)=>t.workflowInstanceId;function ee(n,t){if(n&1&&(a(0,"option",11),l(1),o()),n&2){let e=t.$implicit;c("value",e.value),i(),s(e.label)}}function te(n,t){if(n&1&&(a(0,"option",11),l(1),o()),n&2){let e=t.$implicit;c("value",e.value),i(),s(e.label)}}function ie(n,t){if(n&1&&(a(0,"div",17)(1,"div",18),f(2,"app-loading-spinner"),a(3,"p",19),l(4),o()()()),n&2){let e=d();i(4),s(e.t("app.loading"))}}function ne(n,t){if(n&1&&(a(0,"span",24),l(1),k(2,"slice"),o()),n&2){let e=d().$implicit;c("title",e.comments),i(),_(" ",e.comments.length>50?H(2,2,e.comments,0,50)+"...":e.comments," ")}}function oe(n,t){n&1&&(a(0,"span",25),l(1,"-"),o())}function ae(n,t){if(n&1&&(a(0,"tr")(1,"td")(2,"span"),l(3),o()(),a(4,"td"),l(5),o(),a(6,"td"),l(7),o(),a(8,"td")(9,"span"),l(10),o()(),a(11,"td"),l(12),o(),a(13,"td"),y(14,ne,3,6,"span",24)(15,oe,2,0,"span",25),o()()),n&2){let e=t.$implicit,r=d(3);i(2),M(r.getEntityTypeBadgeClass(e.entityType)),i(),_(" ",r.t("approvals.entity_type_"+e.entityType.toLowerCase())," "),i(2),s(e.requestedByName),i(2),s(e.stepName),i(2),M(r.getActionBadgeClass(e.action)),i(),_(" ",r.t("approvals.action_"+e.action.toLowerCase())," "),i(2),s(r.formatDate(e.actionTakenAt)),i(2),h(e.comments?14:15)}}function re(n,t){if(n&1){let e=F();a(0,"li",27)(1,"button",30),v("click",function(){let p=x(e).$index,g=d(4);return S(g.onPageChange(p+1))}),l(2),o()()}if(n&2){let e=t.$index,r=d(4);T("active",r.currentPage()===e+1),i(2),s(e+1)}}function le(n,t){if(n&1){let e=F();a(0,"div",23)(1,"div",25),l(2),o(),a(3,"nav")(4,"ul",26)(5,"li",27)(6,"button",28),v("click",function(){x(e);let p=d(3);return S(p.onPageChange(p.currentPage()-1))}),l(7),o()(),C(8,re,3,3,"li",29,E),a(10,"li",27)(11,"button",28),v("click",function(){x(e);let p=d(3);return S(p.onPageChange(p.currentPage()+1))}),l(12),o()()()()()}if(n&2){let e=d(3);i(2),I(" ",e.t("common.showing")," ",(e.currentPage()-1)*e.pageSize()+1," - ",e.getMaxShowingCount()," ",e.t("common.of")," ",e.totalCount()," "),i(3),T("disabled",e.currentPage()===1),i(),c("disabled",e.currentPage()===1),i(),_(" ",e.t("common.previous")," "),i(),b(A(13,Y).constructor(e.totalPages())),i(2),T("disabled",e.currentPage()===e.totalPages()),i(),c("disabled",e.currentPage()===e.totalPages()),i(),_(" ",e.t("common.next")," ")}}function se(n,t){if(n&1&&(a(0,"div",17)(1,"div",6)(2,"div",21)(3,"table",22)(4,"thead")(5,"tr")(6,"th"),l(7),o(),a(8,"th"),l(9),o(),a(10,"th"),l(11),o(),a(12,"th"),l(13),o(),a(14,"th"),l(15),o(),a(16,"th"),l(17),o()()(),a(18,"tbody"),C(19,ae,16,10,"tr",null,Z),o()()(),y(21,le,13,14,"div",23),o()()),n&2){let e=d(2);i(7),s(e.t("approvals.entity_type")),i(2),s(e.t("approvals.requester")),i(2),s(e.t("approvals.step")),i(2),s(e.t("approvals.action")),i(2),s(e.t("approvals.action_date")),i(2),s(e.t("approvals.comments")),i(2),b(e.historyItems()),i(2),h(e.totalPages()>1?21:-1)}}function pe(n,t){if(n&1&&f(0,"app-empty-state",20),n&2){let e=d(2);c("title",e.t("approvals.no_history"))("message",e.t("approvals.no_history_message"))}}function de(n,t){if(n&1&&y(0,se,22,7,"div",17)(1,pe,1,2,"app-empty-state",20),n&2){let e=d();h(e.historyItems().length>0?0:1)}}var X=class n{approvalsService=u(Q);notificationService=u(W);router=u(N);i18n=u(G);loading=m(!1);historyItems=m([]);totalCount=m(0);currentPage=m(1);pageSize=m(10);entityTypeFilter=m("");actionFilter=m("");dateFromFilter=m("");dateToFilter=m("");entityTypes=[{value:"",label:this.t("common.all")},{value:"Vacation",label:this.t("approvals.entity_type_vacation")},{value:"Excuse",label:this.t("approvals.entity_type_excuse")},{value:"RemoteWork",label:this.t("approvals.entity_type_remote_work")},{value:"Overtime",label:this.t("approvals.entity_type_overtime")},{value:"Timesheet",label:this.t("approvals.entity_type_timesheet")}];actionOptions=[{value:"",label:this.t("common.all")},{value:"Approved",label:this.t("approvals.action_approved")},{value:"Rejected",label:this.t("approvals.action_rejected")},{value:"Delegated",label:this.t("approvals.action_delegated")}];columns=[{key:"entityType",label:this.t("approvals.entity_type"),sortable:!0,template:"entityType"},{key:"requesterName",label:this.t("approvals.requester"),sortable:!0},{key:"stepName",label:this.t("approvals.step"),sortable:!0},{key:"action",label:this.t("approvals.action"),sortable:!0,template:"action"},{key:"actionTakenAt",label:this.t("approvals.action_date"),sortable:!0,template:"date"},{key:"comments",label:this.t("approvals.comments"),sortable:!1}];totalPages=w(()=>Math.ceil(this.totalCount()/this.pageSize()));ngOnInit(){this.loadHistory()}t(t){return this.i18n.t(t)}loadHistory(){this.loading.set(!0);let t={page:this.currentPage(),pageSize:this.pageSize()};this.entityTypeFilter()&&(t.entityType=this.entityTypeFilter()),this.actionFilter()&&(t.action=this.actionFilter()),this.dateFromFilter()&&(t.dateFrom=this.dateFromFilter()),this.dateToFilter()&&(t.dateTo=this.dateToFilter()),this.approvalsService.getApprovalHistory(t).subscribe({next:e=>{e&&e.items?(this.historyItems.set(e.items),this.totalCount.set(e.totalCount||0)):(this.historyItems.set([]),this.totalCount.set(0)),this.loading.set(!1)},error:e=>{console.error("Error loading approval history:",e),this.notificationService.error(this.t("app.error"),this.t("approvals.load_error")),this.loading.set(!1)}})}onEntityTypeFilterChange(t){this.entityTypeFilter.set(t),this.currentPage.set(1),this.loadHistory()}onActionFilterChange(t){this.actionFilter.set(t),this.currentPage.set(1),this.loadHistory()}onDateFromChange(t){this.dateFromFilter.set(t),this.currentPage.set(1),this.loadHistory()}onDateToChange(t){this.dateToFilter.set(t),this.currentPage.set(1),this.loadHistory()}clearFilters(){this.entityTypeFilter.set(""),this.actionFilter.set(""),this.dateFromFilter.set(""),this.dateToFilter.set(""),this.currentPage.set(1),this.loadHistory()}onPageChange(t){this.currentPage.set(t),this.loadHistory()}onPageSizeChange(t){this.pageSize.set(t),this.currentPage.set(1),this.loadHistory()}getEntityTypeBadgeClass(t){return`badge ${{Vacation:"bg-success",Excuse:"bg-info",RemoteWork:"bg-primary",Overtime:"bg-warning",Timesheet:"bg-secondary"}[t]||"bg-secondary"}`}getActionBadgeClass(t){return`badge ${{Approved:"bg-success",Rejected:"bg-danger",Delegated:"bg-info",Skipped:"bg-secondary",TimedOut:"bg-warning"}[t]||"bg-secondary"}`}formatDate(t){return t?new Date(t).toLocaleDateString(this.i18n.getCurrentLocale(),{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}getMaxShowingCount(){let t=this.currentPage()*this.pageSize();return Math.min(t,this.totalCount())}goBack(){this.router.navigate(["/approvals"])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-approval-history"]],decls:36,vars:12,consts:[[1,"container-fluid","py-4"],[1,"d-flex","align-items-center","mb-4"],["type","button","routerLink","/approvals",1,"btn","btn-outline-secondary","me-3"],[1,"fa-solid","fa-arrow-left","me-1"],[1,"h3","mb-0"],[1,"card","mb-4"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-3"],[1,"form-label"],[1,"form-select",3,"ngModelChange","ngModel"],[3,"value"],[1,"col-md-2"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-2","d-flex","align-items-end"],["type","button",1,"btn","btn-outline-secondary","w-100",3,"click"],[1,"fa-solid","fa-times","me-1"],[1,"card"],[1,"card-body","text-center","py-5"],[1,"mt-3","text-muted"],["icon","fa-solid fa-history",3,"title","message"],[1,"table-responsive"],[1,"table","table-hover"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],[1,"text-muted",3,"title"],[1,"text-muted"],[1,"pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click","disabled"],[1,"page-item",3,"active"],[1,"page-link",3,"click"]],template:function(e,r){e&1&&(a(0,"div",0)(1,"div",1)(2,"button",2),f(3,"i",3),l(4),o(),a(5,"h1",4),l(6),o()(),a(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8)(11,"label",9),l(12),o(),a(13,"select",10),v("ngModelChange",function(g){return r.onEntityTypeFilterChange(g)}),C(14,ee,2,2,"option",11,U),o()(),a(16,"div",8)(17,"label",9),l(18),o(),a(19,"select",10),v("ngModelChange",function(g){return r.onActionFilterChange(g)}),C(20,te,2,2,"option",11,U),o()(),a(22,"div",12)(23,"label",9),l(24),o(),a(25,"input",13),v("ngModelChange",function(g){return r.onDateFromChange(g)}),o()(),a(26,"div",12)(27,"label",9),l(28),o(),a(29,"input",13),v("ngModelChange",function(g){return r.onDateToChange(g)}),o()(),a(30,"div",14)(31,"button",15),v("click",function(){return r.clearFilters()}),f(32,"i",16),l(33),o()()()()(),y(34,ie,5,1,"div",17)(35,de,2,1),o()),e&2&&(i(4),_(" ",r.t("common.back")," "),i(2),s(r.t("approvals.history_title")),i(6),s(r.t("approvals.filter_entity_type")),i(),c("ngModel",r.entityTypeFilter()),i(),b(r.entityTypes),i(4),s(r.t("approvals.filter_action")),i(),c("ngModel",r.actionFilter()),i(),b(r.actionOptions),i(4),s(r.t("approvals.filter_date_from")),i(),c("ngModel",r.dateFromFilter()),i(3),s(r.t("approvals.filter_date_to")),i(),c("ngModel",r.dateToFilter()),i(4),_(" ",r.t("common.clear_filters")," "),i(),h(r.loading()?34:35))},dependencies:[O,q,L,j,$,R,z,B,V,K,J,D],styles:[".badge[_ngcontent-%COMP%]{font-weight:500}.card[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;white-space:nowrap}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.text-muted[title][_ngcontent-%COMP%]{cursor:help}.pagination[_ngcontent-%COMP%]{margin-bottom:0}.page-link[_ngcontent-%COMP%]{padding:.375rem .75rem}@media (max-width: 768px){.row.g-3[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:.5rem}.table-responsive[_ngcontent-%COMP%]{font-size:.875rem}}"]})};export{X as ApprovalHistoryComponent};
