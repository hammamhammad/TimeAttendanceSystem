import{a as B}from"./chunk-YAS2WZSA.js";import{a as Y}from"./chunk-CXFFM2PW.js";import{a as le}from"./chunk-JWR47IJL.js";import{a as G}from"./chunk-32LY3B2D.js";import"./chunk-BSEKTODI.js";import"./chunk-HUSARQNL.js";import"./chunk-QXVLGI72.js";import{a as ae}from"./chunk-7TWIWOLV.js";import{a as R}from"./chunk-4335LQ3A.js";import{a as E,b as S}from"./chunk-LDWMK676.js";import{a as U}from"./chunk-HCDX4O2L.js";import{a as re}from"./chunk-6B6T6MZ3.js";import{r as ie,t as oe,z as $}from"./chunk-HF7V7ZC6.js";import"./chunk-HZR4WXEY.js";import{g as ne}from"./chunk-O3U3HUCY.js";import{a as V}from"./chunk-77FC2LKR.js";import"./chunk-A6EM5NV6.js";import{$a as u,Bb as I,Cb as ee,Db as k,Eb as s,Fb as D,Gb as b,Ha as y,Hb as j,Kb as te,La as O,Na as P,T,Y as p,Z as _,Za as z,_a as C,ab as Q,cb as A,db as F,eb as f,fa as v,fb as l,gb as c,ha as Z,hb as m,ob as x,qb as g,sb as r,wa as i}from"./chunk-IGEIB4M6.js";import{a as N,b as L,e as H}from"./chunk-YMDWBF3A.js";function me(n,t){if(n&1){let e=x();l(0,"button",23),g("click",function(){p(e);let a=r(3);return _(a.onAddDepartment())}),m(1,"i",24),c()}if(n&2){let e=r(3);f("title",e.i18n.t("department.addDepartment"))}}function se(n,t){if(n&1&&O(0,me,2,1,"button",22),n&2){let e=r(2);f("appHasPermission",e.PERMISSIONS.DEPARTMENT_CREATE)}}function pe(n,t){if(n&1){let e=x();l(0,"button",33),g("click",function(){p(e);let a=r(4);return _(a.onBulkDelete())}),m(1,"i",34),s(2),c()}if(n&2){let e=r(4);i(2),b(" ",e.i18n.t("common.deleteSelected")," ")}}function _e(n,t){if(n&1&&O(0,pe,3,1,"button",32),n&2){let e=r(3);f("appHasPermission",e.PERMISSIONS.DEPARTMENT_DELETE)}}function Ce(n,t){if(n&1){let e=x();l(0,"div",21)(1,"div",25)(2,"div",26)(3,"span",27),m(4,"i",28),s(5),c(),l(6,"div",17),C(7,_e,1,1,"button",29),l(8,"button",30),g("click",function(){p(e);let a=r(2);return _(a.clearSelection())}),m(9,"i",31),s(10),c()()()()()}if(n&2){let e=r(2);i(5),j(" ",e.selectedDepartments().size," ",e.i18n.t("common.selected")," "),i(2),u(e.allowDelete?7:-1),i(3),b(" ",e.i18n.t("common.clearSelection")," ")}}function ue(n,t){if(n&1){let e=x();l(0,"div",1)(1,"div",4)(2,"div",5)(3,"div",6)(4,"span",7),m(5,"i",8),c(),l(6,"input",9),g("input",function(a){p(e);let d=r();return _(d.onSearchChange(a.target.value))}),c()()(),l(7,"div",10)(8,"div",11)(9,"input",12),g("change",function(a){p(e);let d=r();return _(d.onShowInactiveChange(a.target.checked))}),c(),l(10,"label",13),s(11),c()()(),l(12,"div",10)(13,"div",11)(14,"input",14),g("change",function(a){p(e);let d=r();return _(d.showHierarchy.set(a.target.checked))}),c(),l(15,"label",15),s(16),c()()(),l(17,"div",16)(18,"div",17)(19,"button",18),g("click",function(){p(e);let a=r();return _(a.refresh())}),m(20,"i",19),c(),C(21,se,1,1,"button",20),c()()(),C(22,Ce,11,4,"div",21),c()}if(n&2){let e=r();i(6),f("placeholder",e.i18n.t("common.search")+"...")("value",e.searchTerm()),i(3),f("checked",e.showInactive()),i(2),b(" ",e.i18n.t("common.showInactive")," "),i(3),f("checked",e.showHierarchy()),i(2),b(" ",e.i18n.t("department.showHierarchy")," "),i(3),f("title",e.i18n.t("common.refresh")),i(2),u(e.allowEdit?21:-1),i(),u(e.selectedDepartments().size>0&&e.allowSelection?22:-1)}}function ge(n,t){if(n&1&&(l(0,"div",2),m(1,"app-loading-spinner",35),c()),n&2){let e=r();i(),f("message",e.i18n.t("common.loading"))("centered",!0)}}function fe(n,t){if(n&1){let e=x();l(0,"th",39)(1,"div",11)(2,"input",49),g("change",function(){p(e);let a=r(2);return _(a.toggleAllSelection())}),c()()()}if(n&2){let e=r(2);i(2),f("checked",e.isAllPageSelected())("indeterminate",e.isSomePageSelected())}}function xe(n,t){if(n&1&&(l(0,"th"),s(1),c()),n&2){let e=r(2);i(),D(e.i18n.t("department.path"))}}function be(n,t){if(n&1&&(l(0,"th",45),s(1),c()),n&2){let e=r(2);i(),D(e.i18n.t("common.actions"))}}function he(n,t){if(n&1){let e=x();l(0,"td",39)(1,"div",11)(2,"input",59),g("change",function(a){p(e);let d=r().$implicit;return r(2).toggleSelection(d.id),_(a.stopPropagation())}),c()()()}if(n&2){let e=r().$implicit,o=r(2);i(2),f("checked",o.isSelected(e.id))}}function De(n,t){if(n&1&&m(0,"div"),n&2){let e=r().$implicit,o=r(2);k(o.getIndentClass(e.level))}}function ve(n,t){if(n&1&&(l(0,"div",54),s(1),c()),n&2){let e=r().$implicit;i(),D(e.nameAr)}}function we(n,t){if(n&1&&(l(0,"div",54),s(1),c()),n&2){let e=r().$implicit;i(),D(e.description)}}function Pe(n,t){if(n&1&&(l(0,"td")(1,"small",56),s(2),c()()),n&2){let e=r().$implicit;i(2),D(e.path)}}function Te(n,t){if(n&1&&(l(0,"div",41),m(1,"i",60),s(2),c()),n&2){let e=r().$implicit;i(2),b(" ",e.managerName," ")}}function Ee(n,t){n&1&&(l(0,"span",56),s(1,"-"),c())}function Se(n,t){if(n&1&&(l(0,"div",41),m(1,"i",61),s(2),c()),n&2){let e=r().$implicit;i(2),b(" ",e.location," ")}}function Me(n,t){n&1&&(l(0,"span",56),s(1,"-"),c())}function ye(n,t){if(n&1){let e=x();l(0,"button",65),g("click",function(a){p(e);let d=r(2).$implicit;return r(2).onViewDepartment(d),_(a.stopPropagation())}),m(1,"i",66),c()}if(n&2){let e=r(4);f("title",e.i18n.t("common.view"))}}function Oe(n,t){if(n&1){let e=x();l(0,"button",18),g("click",function(a){p(e);let d=r(3).$implicit;return r(2).onEditDepartment(d),_(a.stopPropagation())}),m(1,"i",68),c()}if(n&2){let e=r(5);f("title",e.i18n.t("common.edit"))}}function Ie(n,t){if(n&1&&O(0,Oe,2,1,"button",67),n&2){let e=r(4);f("appHasPermission",e.PERMISSIONS.DEPARTMENT_UPDATE)}}function ke(n,t){if(n&1){let e=x();l(0,"button",70),g("click",function(a){p(e);let d=r(3).$implicit;return r(2).onDeleteDepartment(d),_(a.stopPropagation())}),m(1,"i",71),c()}if(n&2){let e=r(5);f("title",e.i18n.t("common.delete"))}}function Ve(n,t){if(n&1&&O(0,ke,2,1,"button",69),n&2){let e=r(4);f("appHasPermission",e.PERMISSIONS.DEPARTMENT_DELETE)}}function Ne(n,t){if(n&1&&(l(0,"td",45)(1,"div",17),O(2,ye,2,1,"button",62),C(3,Ie,1,1,"button",63),C(4,Ve,1,1,"button",64),c()()),n&2){let e=r().$implicit,o=r(2);i(2),f("appHasPermission",o.PERMISSIONS.DEPARTMENT_READ),i(),u(o.allowEdit?3:-1),i(),u(o.allowDelete&&e.employeeCount===0?4:-1)}}function Ae(n,t){if(n&1){let e=x();l(0,"tr",50),g("click",function(){let a=p(e).$implicit,d=r(2);return _(d.selectDepartment(a))}),C(1,he,3,1,"td",39),l(2,"td")(3,"div",41),C(4,De,1,2,"div",51),m(5,"i",52),l(6,"div")(7,"div",53),s(8),c(),C(9,ve,2,1,"div",54),C(10,we,2,1,"div",54),c()()(),l(11,"td"),m(12,"app-status-badge",55),c(),C(13,Pe,3,1,"td"),l(14,"td"),C(15,Te,3,1,"div",41),C(16,Ee,2,0,"span",56),c(),l(17,"td",57),m(18,"app-status-badge",55),c(),l(19,"td"),C(20,Se,3,1,"div",41),C(21,Me,2,0,"span",56),c(),l(22,"td",57),m(23,"app-status-badge",58),c(),C(24,Ne,5,3,"td",45),c()}if(n&2){let e=t.$implicit,o=r(2);I("table-warning",!e.isActive)("selected-row",o.isSelected(e.id)),i(),u(o.allowSelection?1:-1),i(3),u(o.showHierarchy()?4:-1),i(4),D(e.name),i(),u(e.nameAr?9:-1),i(),u(e.description?10:-1),i(2),f("status","secondary")("label",e.code),i(),u(o.showHierarchy()?13:-1),i(2),u(e.managerName?15:-1),i(),u(e.managerName?-1:16),i(2),f("status",e.employeeCount>0?"success":"secondary")("label",e.employeeCount.toString()),i(2),u(e.location?20:-1),i(),u(e.location?-1:21),i(2),f("status",e.isActive?"active":"inactive")("label",e.isActive?o.i18n.t("common.active"):o.i18n.t("common.inactive"))("showIcon",!0),i(),u(o.showControls?24:-1)}}function Fe(n,t){if(n&1){let e=x();l(0,"button",74),g("click",function(){p(e);let a=r(3);return _(a.onAddDepartment())}),m(1,"i",75),s(2),c()}if(n&2){let e=r(3);i(2),b(" ",e.i18n.t("department.addFirstDepartment")," ")}}function Re(n,t){if(n&1&&(l(0,"div",47),m(1,"i",72),l(2,"h5"),s(3),c(),l(4,"p"),s(5),c(),C(6,Fe,3,1,"button",73),c()),n&2){let e=r(2);i(3),D(e.i18n.t("department.noDepartments")),i(2),D(e.i18n.t("department.noDepartmentsDescription")),i(),u(e.allowEdit?6:-1)}}function $e(n,t){if(n&1&&(l(0,"option",80),s(1),c()),n&2){let e=t.$implicit;f("value",e),i(),D(e)}}function Be(n,t){if(n&1){let e=x();l(0,"button",89),g("click",function(){p(e);let a=r().$implicit,d=r(3);return _(d.onPageChange(a))}),s(1),c()}if(n&2){let e=r().$implicit;i(),b(" ",e," ")}}function Le(n,t){n&1&&(l(0,"span",88),s(1,"..."),c())}function He(n,t){if(n&1&&(l(0,"li",83),C(1,Be,2,1,"button",88),C(2,Le,2,0,"span",88),c()),n&2){let e=t.$implicit,o=r(3);I("active",e===o.currentPage())("disabled",e===-1),i(),u(e!==-1?1:-1),i(),u(e===-1?2:-1)}}function ze(n,t){if(n&1){let e=x();l(0,"nav",48)(1,"div",76)(2,"div",77)(3,"div",41)(4,"label",78),s(5),c(),l(6,"select",79),g("change",function(a){p(e);let d=r(2);return _(d.onPageSizeChange(+a.target.value))}),A(7,$e,2,2,"option",80,Q),c(),l(9,"span",81),s(10),c()()(),l(11,"div",77)(12,"ul",82)(13,"li",83)(14,"button",84),g("click",function(){p(e);let a=r(2);return _(a.onPageChange(a.currentPage()-1))}),m(15,"i",85),c()(),A(16,He,3,6,"li",86,Q),l(18,"li",83)(19,"button",84),g("click",function(){p(e);let a=r(2);return _(a.onPageChange(a.currentPage()+1))}),m(20,"i",87),c()()()()()()}if(n&2){let e=r(2);i(5),b("",e.i18n.t("common.pageSize"),":"),i(),f("value",e.pageSize()),i(),F(e.pageSizeOptions),i(3),te(" ",e.i18n.t("common.showing")," ",(e.currentPage()-1)*e.pageSize()+1,"-",e.Math.min(e.currentPage()*e.pageSize(),e.filteredDepartments().length)," ",e.i18n.t("common.of")," ",e.filteredDepartments().length," "),i(3),I("disabled",e.currentPage()===1),i(),f("disabled",e.currentPage()===1),i(2),F(e.getPageNumbers()),i(2),I("disabled",e.currentPage()===e.totalPages()),i(),f("disabled",e.currentPage()===e.totalPages())}}function je(n,t){if(n&1){let e=x();l(0,"div",3)(1,"div",36)(2,"table",37)(3,"thead",38)(4,"tr"),C(5,fe,3,2,"th",39),l(6,"th",40),g("click",function(){p(e);let a=r();return _(a.onSort("name"))}),l(7,"div",41),s(8),m(9,"i",42),c()(),l(10,"th",40),g("click",function(){p(e);let a=r();return _(a.onSort("code"))}),l(11,"div",41),s(12),m(13,"i",42),c()(),C(14,xe,2,1,"th"),l(15,"th",40),g("click",function(){p(e);let a=r();return _(a.onSort("managerName"))}),l(16,"div",41),s(17),m(18,"i",42),c()(),l(19,"th",43),g("click",function(){p(e);let a=r();return _(a.onSort("employeeCount"))}),l(20,"div",44),s(21),m(22,"i",42),c()(),l(23,"th",40),g("click",function(){p(e);let a=r();return _(a.onSort("location"))}),l(24,"div",41),s(25),m(26,"i",42),c()(),l(27,"th",43),g("click",function(){p(e);let a=r();return _(a.onSort("isActive"))}),l(28,"div",44),s(29),m(30,"i",42),c()(),C(31,be,2,1,"th",45),c()(),l(32,"tbody"),A(33,Ae,25,22,"tr",46,z().trackByDeptId,!0),c()()(),C(35,Re,7,3,"div",47),C(36,ze,21,13,"nav",48),c()}if(n&2){let e=r();i(5),u(e.allowSelection?5:-1),i(3),b(" ",e.i18n.t("department.name")," "),i(),k(e.getSortIcon("name")),i(3),b(" ",e.i18n.t("department.code")," "),i(),k(e.getSortIcon("code")),i(),u(e.showHierarchy()?14:-1),i(3),b(" ",e.i18n.t("department.manager")," "),i(),k(e.getSortIcon("managerName")),i(3),b(" ",e.i18n.t("common.employees")," "),i(),k(e.getSortIcon("employeeCount")),i(3),b(" ",e.i18n.t("department.location")," "),i(),k(e.getSortIcon("location")),i(3),b(" ",e.i18n.t("common.status")," "),i(),k(e.getSortIcon("isActive")),i(),u(e.showControls?31:-1),i(2),F(e.getPaginatedDepartments()),i(2),u(e.getPaginatedDepartments().length===0?35:-1),i(),u(e.totalPages()>1?36:-1)}}var q=class n{selectedBranchId;allowSelection=!0;allowEdit=!0;allowDelete=!0;showControls=!0;departmentSelected=new P;departmentView=new P;departmentEdit=new P;departmentDelete=new P;departmentAdd=new P;i18n=T(V);departmentsService=T(B);permissionService=T(R);PERMISSIONS={DEPARTMENT_CREATE:`${S.DEPARTMENT}.${E.CREATE}`,DEPARTMENT_READ:`${S.DEPARTMENT}.${E.READ}`,DEPARTMENT_UPDATE:`${S.DEPARTMENT}.${E.UPDATE}`,DEPARTMENT_DELETE:`${S.DEPARTMENT}.${E.DELETE}`};loading=v(!1);departments=v([]);filteredDepartments=v([]);selectedDepartments=v(new Set);sortConfig=v({column:"name",direction:"asc"});searchTerm=v("");showInactive=v(!1);currentPage=v(1);pageSize=v(10);totalPages=v(0);showHierarchy=v(!1);pageSizeOptions=[5,10,25,50,100];ngOnInit(){console.log("DepartmentTableComponent ngOnInit - selectedBranchId:",this.selectedBranchId),this.loadDepartments()}ngOnChanges(t){console.log("DepartmentTableComponent ngOnChanges:",t),t.selectedBranchId&&(console.log("selectedBranchId changed from",t.selectedBranchId.previousValue,"to",t.selectedBranchId.currentValue),this.loadDepartments())}loadDepartments(){console.log("loadDepartments called - selectedBranchId:",this.selectedBranchId),this.loading.set(!0),console.log("Making departments API call with params:",{branchId:this.selectedBranchId,includeTree:!1,includeInactive:this.showInactive()}),this.departmentsService.getDepartments({branchId:this.selectedBranchId,includeTree:!1,includeInactive:this.showInactive()}).subscribe({next:t=>{console.log("Departments API response:",t),t&&(this.departments.set(t),this.applyFiltersAndSort()),this.loading.set(!1)},error:t=>{console.error("Failed to load departments:",t),this.loading.set(!1)}})}applyFiltersAndSort(){let t=[...this.departments()],e=this.searchTerm().toLowerCase();e&&(t=t.filter(a=>a.name.toLowerCase().includes(e)||a.code.toLowerCase().includes(e)||a.nameAr&&a.nameAr.toLowerCase().includes(e)||a.description&&a.description.toLowerCase().includes(e)||a.costCenter&&a.costCenter.toLowerCase().includes(e)||a.path.toLowerCase().includes(e))),this.showInactive()||(t=t.filter(a=>a.isActive));let o=this.sortConfig();t.sort((a,d)=>{let h=a[o.column],w=d[o.column];if(h==null&&w==null)return 0;if(h==null)return o.direction==="asc"?1:-1;if(w==null)return o.direction==="asc"?-1:1;let M=0;return typeof h=="string"&&typeof w=="string"?M=h.localeCompare(w):typeof h=="number"&&typeof w=="number"?M=h-w:M=String(h).localeCompare(String(w)),o.direction==="asc"?M:-M}),this.filteredDepartments.set(t),this.updatePagination()}updatePagination(){let t=this.filteredDepartments().length,e=Math.ceil(t/this.pageSize());this.totalPages.set(e),this.currentPage()>e&&e>0&&this.currentPage.set(e)}getPaginatedDepartments(){let t=(this.currentPage()-1)*this.pageSize(),e=t+this.pageSize();return this.filteredDepartments().slice(t,e)}onSort(t){let e=this.sortConfig(),o=e.column===t&&e.direction==="asc"?"desc":"asc";this.sortConfig.set({column:t,direction:o}),this.applyFiltersAndSort()}getSortIcon(t){let e=this.sortConfig();return e.column!==t?"fas fa-sort":e.direction==="asc"?"fas fa-sort-up":"fas fa-sort-down"}onSearchChange(t){this.searchTerm.set(t),this.currentPage.set(1),this.applyFiltersAndSort()}onShowInactiveChange(t){this.showInactive.set(t),this.currentPage.set(1),this.loadDepartments()}onPageSizeChange(t){this.pageSize.set(t),this.currentPage.set(1),this.updatePagination()}onPageChange(t){this.currentPage.set(t)}getPageNumbers(){let t=this.totalPages(),e=this.currentPage(),o=[];if(t<=7)for(let a=1;a<=t;a++)o.push(a);else e<=4?o.push(1,2,3,4,5,-1,t):e>=t-3?o.push(1,-1,t-4,t-3,t-2,t-1,t):o.push(1,-1,e-1,e,e+1,-1,t);return o}selectDepartment(t){this.allowSelection&&this.departmentSelected.emit(t)}toggleSelection(t){let e=this.selectedDepartments();e.has(t)?e.delete(t):e.add(t),this.selectedDepartments.set(new Set(e))}toggleAllSelection(){let t=this.selectedDepartments(),e=this.getPaginatedDepartments();this.isAllPageSelected()?e.forEach(o=>t.delete(o.id)):e.forEach(o=>t.add(o.id)),this.selectedDepartments.set(new Set(t))}isSelected(t){return this.selectedDepartments().has(t)}isAllPageSelected(){let t=this.getPaginatedDepartments();return t.length>0&&t.every(e=>this.isSelected(e.id))}isSomePageSelected(){return this.getPaginatedDepartments().some(e=>this.isSelected(e.id))&&!this.isAllPageSelected()}onAddDepartment(){this.departmentAdd.emit()}onViewDepartment(t){this.departmentView.emit(t)}onEditDepartment(t){this.departmentEdit.emit(t)}onDeleteDepartment(t){this.departmentDelete.emit(t)}onBulkDelete(){let t=this.selectedDepartments();this.departments().filter(o=>t.has(o.id)).forEach(o=>this.departmentDelete.emit(o))}clearSelection(){this.selectedDepartments.set(new Set)}refresh(){this.loadDepartments()}getIndentClass(t){return`indent-${Math.min(t,5)}`}trackByDeptId(t,e){return e.id}Math=Math;static \u0275fac=function(e){return new(e||n)};static \u0275cmp=y({type:n,selectors:[["app-department-table"]],inputs:{selectedBranchId:"selectedBranchId",allowSelection:"allowSelection",allowEdit:"allowEdit",allowDelete:"allowDelete",showControls:"showControls"},outputs:{departmentSelected:"departmentSelected",departmentView:"departmentView",departmentEdit:"departmentEdit",departmentDelete:"departmentDelete",departmentAdd:"departmentAdd"},features:[Z],decls:4,vars:3,consts:[[1,"department-table"],[1,"table-controls","mb-3"],[1,"text-center","p-4"],[1,"table-container"],[1,"row","g-2","align-items-center"],[1,"col-md-4"],[1,"input-group"],[1,"input-group-text"],[1,"fas","fa-search"],["type","text",1,"form-control",3,"input","placeholder","value"],[1,"col-md-3"],[1,"form-check"],["type","checkbox","id","showInactiveTable",1,"form-check-input",3,"change","checked"],["for","showInactiveTable",1,"form-check-label"],["type","checkbox","id","showHierarchy",1,"form-check-input",3,"change","checked"],["for","showHierarchy",1,"form-check-label"],[1,"col-md-2"],[1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary",3,"click","title"],[1,"fas","fa-sync"],["type","button",1,"btn","btn-primary",3,"title"],[1,"row","mt-2"],["type","button","class","btn btn-primary",3,"title","click",4,"appHasPermission"],["type","button",1,"btn","btn-primary",3,"click","title"],[1,"fas","fa-plus"],[1,"col-12"],[1,"alert","alert-info","d-flex","align-items-center"],[1,"flex-grow-1"],[1,"fas","fa-info-circle","me-2"],["type","button",1,"btn","btn-outline-danger"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-times","me-1"],["type","button","class","btn btn-outline-danger",3,"click",4,"appHasPermission"],["type","button",1,"btn","btn-outline-danger",3,"click"],[1,"fas","fa-trash","me-1"],[3,"message","centered"],[1,"table-responsive"],[1,"table","table-hover"],[1,"table-light","sticky-top"],[1,"selection-column"],[1,"sortable",3,"click"],[1,"d-flex","align-items-center"],[1,"ms-2"],[1,"sortable","text-center",3,"click"],[1,"d-flex","align-items-center","justify-content-center"],[1,"actions-column"],[3,"table-warning","selected-row"],[1,"text-center","p-4","text-muted"],["aria-label","Department pagination",1,"mt-3"],["type","checkbox",1,"form-check-input",3,"change","checked","indeterminate"],[3,"click"],[3,"class"],[1,"fas","fa-building","text-primary","me-2"],[1,"fw-medium"],[1,"text-muted","small"],[3,"status","label"],[1,"text-muted"],[1,"text-center"],[3,"status","label","showIcon"],["type","checkbox",1,"form-check-input",3,"change","checked"],[1,"fas","fa-user-tie","text-secondary","me-2"],[1,"fas","fa-map-marker-alt","text-secondary","me-2"],["type","button","class","btn btn-outline-primary",3,"title","click",4,"appHasPermission"],["type","button",1,"btn","btn-outline-secondary",3,"title"],["type","button",1,"btn","btn-outline-danger",3,"title"],["type","button",1,"btn","btn-outline-primary",3,"click","title"],[1,"fas","fa-eye"],["type","button","class","btn btn-outline-secondary",3,"title","click",4,"appHasPermission"],[1,"fas","fa-edit"],["type","button","class","btn btn-outline-danger",3,"title","click",4,"appHasPermission"],["type","button",1,"btn","btn-outline-danger",3,"click","title"],[1,"fas","fa-trash"],[1,"fas","fa-building","fa-3x","mb-3"],["type","button",1,"btn","btn-primary"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus","me-2"],[1,"row","align-items-center"],[1,"col-md-6"],[1,"form-label","me-2","mb-0"],[1,"form-select","form-select-sm",2,"width","auto",3,"change","value"],[3,"value"],[1,"text-muted","ms-3"],[1,"pagination","pagination-sm","justify-content-end","mb-0"],[1,"page-item"],[1,"page-link",3,"click","disabled"],[1,"fas","fa-chevron-left"],[1,"page-item",3,"active","disabled"],[1,"fas","fa-chevron-right"],[1,"page-link"],[1,"page-link",3,"click"]],template:function(e,o){e&1&&(l(0,"div",0),C(1,ue,23,9,"div",1),C(2,ge,2,2,"div",2),C(3,je,37,23,"div",3),c()),e&2&&(i(),u(o.showControls?1:-1),i(),u(o.loading()?2:-1),i(),u(o.loading()?-1:3))},dependencies:[$,ie,oe,Y,G,U],styles:[".department-table[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a}.table-controls[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #e9ecef;background-color:#f8f9fa;border-radius:8px 8px 0 0}.table-container[_ngcontent-%COMP%]{max-height:70vh;overflow-y:auto}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.selected-row[_ngcontent-%COMP%]{background-color:#e3f2fd;border-left:4px solid #2196f3}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.table-warning[_ngcontent-%COMP%]{background-color:#fff3cd}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.table-warning[_ngcontent-%COMP%]:hover{background-color:#ffeaa7}.selection-column[_ngcontent-%COMP%]{width:50px;text-align:center}.actions-column[_ngcontent-%COMP%]{width:100px;text-align:center}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;transition:color .2s ease}.sortable[_ngcontent-%COMP%]:hover{color:#2196f3;background-color:#f0f7ff}.sortable[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%]{font-size:.75rem;opacity:.6;transition:opacity .2s ease}.sortable[_ngcontent-%COMP%]:hover   .fas[_ngcontent-%COMP%]{opacity:1}.indent-0[_ngcontent-%COMP%]{margin-left:0}.indent-1[_ngcontent-%COMP%]{margin-left:20px}.indent-2[_ngcontent-%COMP%]{margin-left:40px}.indent-3[_ngcontent-%COMP%]{margin-left:60px}.indent-4[_ngcontent-%COMP%]{margin-left:80px}.indent-5[_ngcontent-%COMP%]{margin-left:100px}.form-check-input[_ngcontent-%COMP%]:checked{background-color:#2196f3;border-color:#2196f3}.form-check-input[_ngcontent-%COMP%]:indeterminate{background-color:#ffc107;border-color:#ffc107}.form-select[_ngcontent-%COMP%]:focus{border-color:#2196f3;box-shadow:0 0 0 .2rem #2196f340}.page-link[_ngcontent-%COMP%]:hover{color:#2196f3;background-color:#f8f9fa;border-color:#dee2e6}.page-item.active[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{background-color:#2196f3;border-color:#2196f3;color:#fff}.alert-info[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#0277bd;border-left:4px solid #2196f3}.spinner-border[_ngcontent-%COMP%]{color:#2196f3;width:3rem;height:3rem}.text-muted[_ngcontent-%COMP%]   i.fa-3x[_ngcontent-%COMP%]{color:#adb5bd!important;margin-bottom:1rem}[dir=rtl][_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.selected-row[_ngcontent-%COMP%]{border-left:none;border-right:4px solid #2196f3}[dir=rtl][_ngcontent-%COMP%]   .indent-1[_ngcontent-%COMP%]{margin-right:20px;margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .indent-2[_ngcontent-%COMP%]{margin-right:40px;margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .indent-3[_ngcontent-%COMP%]{margin-right:60px;margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .indent-4[_ngcontent-%COMP%]{margin-right:80px;margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .indent-5[_ngcontent-%COMP%]{margin-right:100px;margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .alert-info[_ngcontent-%COMP%]{border-left:none;border-right:4px solid #2196f3}@media (max-width: 768px){.table-controls[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:.5rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.75rem}.pagination[_ngcontent-%COMP%]{justify-content:center;margin-top:1rem}.d-flex.align-items-center[_ngcontent-%COMP%]   span.text-muted[_ngcontent-%COMP%]{display:none}}@media (max-width: 576px){.table-container[_ngcontent-%COMP%]{max-height:60vh}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:.75rem;padding:.5rem .25rem}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem .25rem}.btn-group[_ngcontent-%COMP%]{flex-direction:column}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-bottom:2px;border-radius:4px!important}.actions-column[_ngcontent-%COMP%]{width:80px}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.sortable[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transition:transform .2s ease}.sortable[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transform:scale(1.1)}.btn[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transition:transform .2s ease}.btn-outline-primary[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%], .btn-outline-danger[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%], .btn-outline-secondary[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transform:scale(1.1)}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:focus-within{outline:2px solid #2196f3;outline-offset:-2px}.btn[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #2196f340}@media print{.table-controls[_ngcontent-%COMP%], .actions-column[_ngcontent-%COMP%], .pagination[_ngcontent-%COMP%]{display:none!important}.table[_ngcontent-%COMP%]{font-size:.8rem}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.selected-row[_ngcontent-%COMP%]{background-color:transparent!important;border-left:none!important}}"]})};function Ue(n,t){if(n&1){let e=x();l(0,"button",21),g("click",function(){p(e);let a=r(2);return _(a.onAddDepartment())}),m(1,"i",22),c()}if(n&2){let e=r(2);f("title",e.i18n.t("department.addDepartment"))}}function Ye(n,t){if(n&1){let e=x();l(0,"div",1)(1,"div",4)(2,"div",5)(3,"div",6)(4,"span",7),m(5,"i",8),c(),l(6,"input",9),g("input",function(a){p(e);let d=r();return _(d.onSearchChange(a.target.value))}),c()()(),l(7,"div",10)(8,"div",11)(9,"input",12),g("change",function(a){p(e);let d=r();return _(d.onShowInactiveChange(a.target.checked))}),c(),l(10,"label",13),s(11),c()()(),l(12,"div",14)(13,"div",15)(14,"button",16),g("click",function(){p(e);let a=r();return _(a.expandAll())}),m(15,"i",17),c(),l(16,"button",16),g("click",function(){p(e);let a=r();return _(a.collapseAll())}),m(17,"i",18),c(),l(18,"button",16),g("click",function(){p(e);let a=r();return _(a.refresh())}),m(19,"i",19),c(),C(20,Ue,2,1,"button",20),c()()()()}if(n&2){let e=r();i(6),f("placeholder",e.i18n.t("common.search")+"...")("value",e.searchTerm()),i(3),f("checked",e.showInactive()),i(2),b(" ",e.i18n.t("common.showInactive")," "),i(3),f("title",e.i18n.t("common.expandAll")),i(2),f("title",e.i18n.t("common.collapseAll")),i(2),f("title",e.i18n.t("common.refresh")),i(2),u(e.allowEdit?20:-1)}}function Ge(n,t){if(n&1&&(l(0,"div",2),m(1,"app-loading-spinner",23),c()),n&2){let e=r();i(),f("message",e.i18n.t("common.loading"))("centered",!0)}}function qe(n,t){if(n&1){let e=x();l(0,"button",39),g("click",function(a){p(e);let d=r().$implicit;return r(2).toggleNode(d.id),_(a.stopPropagation())}),m(1,"i",40),c()}if(n&2){let e=r().$implicit,o=r(2);i(),I("fa-chevron-right",!o.isExpanded(e.id))("fa-chevron-down",o.isExpanded(e.id))}}function Je(n,t){n&1&&m(0,"div",29)}function Ke(n,t){if(n&1&&(l(0,"span",34),s(1),c()),n&2){let e=r(3);i(),b(" ",e.i18n.t("common.inactive")," ")}}function Qe(n,t){if(n&1&&(l(0,"div",35),s(1),c()),n&2){let e=r().$implicit;i(),b(" ",e.description," ")}}function We(n,t){if(n&1&&(l(0,"span"),m(1,"i",41),s(2),c()),n&2){let e=r().$implicit;i(2),b(" ",e.managerName," ")}}function Xe(n,t){if(n&1&&(l(0,"span",37),m(1,"i",42),s(2),c()),n&2){let e=r().$implicit,o=r(2);i(2),j(" ",e.employeeCount," ",o.i18n.t("common.employees")," ")}}function Ze(n,t){if(n&1&&(l(0,"span",37),m(1,"i",43),s(2),c()),n&2){let e=r().$implicit;i(2),b(" ",e.location," ")}}function et(n,t){if(n&1){let e=x();l(0,"button",49),g("click",function(a){p(e);let d=r(2).$implicit;return r(2).onAddDepartment(d),_(a.stopPropagation())}),m(1,"i",22),c()}if(n&2){let e=r(4);f("title",e.i18n.t("department.addSubDepartment"))}}function tt(n,t){if(n&1){let e=x();l(0,"button",16),g("click",function(a){p(e);let d=r(2).$implicit;return r(2).onEditDepartment(d),_(a.stopPropagation())}),m(1,"i",50),c()}if(n&2){let e=r(4);f("title",e.i18n.t("common.edit"))}}function nt(n,t){if(n&1){let e=x();l(0,"button",51),g("click",function(a){p(e);let d=r(2).$implicit;return r(2).onDeleteDepartment(d),_(a.stopPropagation())}),m(1,"i",52),c()}if(n&2){let e=r(4);f("title",e.i18n.t("common.delete"))}}function it(n,t){if(n&1){let e=x();l(0,"div",38)(1,"div",15)(2,"button",44),g("click",function(a){p(e);let d=r().$implicit;return r(2).onViewDepartment(d),_(a.stopPropagation())}),m(3,"i",45),c(),C(4,et,2,1,"button",46),C(5,tt,2,1,"button",47),C(6,nt,2,1,"button",48),c()()}if(n&2){let e=r().$implicit,o=r(2);i(2),f("title",o.i18n.t("common.view")),i(2),u(o.allowEdit?4:-1),i(),u(o.allowEdit?5:-1),i(),u(o.allowDelete&&e.employeeCount===0?6:-1)}}function ot(n,t){if(n&1){let e=x();l(0,"div",26)(1,"div",27),g("click",function(){let a=p(e).$implicit,d=r(2);return _(d.selectNode(a))}),C(2,qe,2,4,"button",28),C(3,Je,1,0,"div",29),m(4,"i",30),l(5,"div",31)(6,"div",32)(7,"strong"),s(8),c(),l(9,"span",33),s(10),c(),C(11,Ke,2,1,"span",34),c(),C(12,Qe,2,1,"div",35),l(13,"div",36),C(14,We,3,1,"span"),C(15,Xe,3,2,"span",37),C(16,Ze,3,1,"span",37),c()(),C(17,it,7,4,"div",38),c()()}if(n&2){let e=t.$implicit,o=r(2);I("selected",o.isSelected(e.id))("inactive",!e.isActive),i(),ee(o.getIndentStyle(e.indentLevel)),i(),u(e.hasChildren?2:-1),i(),u(e.hasChildren?-1:3),i(5),D(e.name),i(2),b("(",e.code,")"),i(),u(e.isActive?-1:11),i(),u(e.description?12:-1),i(2),u(e.managerName?14:-1),i(),u(e.employeeCount>0?15:-1),i(),u(e.location?16:-1),i(),u(o.showControls?17:-1)}}function at(n,t){if(n&1){let e=x();l(0,"button",55),g("click",function(){p(e);let a=r(3);return _(a.onAddDepartment())}),m(1,"i",56),s(2),c()}if(n&2){let e=r(3);i(2),b(" ",e.i18n.t("department.addFirstDepartment")," ")}}function rt(n,t){if(n&1&&(l(0,"div",25),m(1,"i",53),l(2,"h5"),s(3),c(),l(4,"p"),s(5),c(),C(6,at,3,1,"button",54),c()),n&2){let e=r(2);i(3),D(e.i18n.t("department.noDepartments")),i(2),D(e.i18n.t("department.noDepartmentsDescription")),i(),u(e.allowEdit?6:-1)}}function lt(n,t){if(n&1&&(l(0,"div",3),A(1,ot,18,16,"div",24,z().trackByNodeId,!0),C(3,rt,7,3,"div",25),c()),n&2){let e=r();i(),F(e.getVisibleNodes()),i(2),u(e.getVisibleNodes().length===0?3:-1)}}var J=class n{selectedBranchId;allowSelection=!0;allowEdit=!0;allowDelete=!0;showControls=!0;departmentSelected=new P;departmentView=new P;departmentEdit=new P;departmentDelete=new P;departmentAdd=new P;i18n=T(V);departmentsService=T(B);loading=v(!1);departments=v([]);expandedNodes=v(new Set);selectedNode=v(null);searchTerm=v("");showInactive=v(!1);ngOnInit(){this.loadDepartments()}loadDepartments(){return H(this,null,function*(){this.loading.set(!0);try{let t=yield this.departmentsService.getDepartmentTree(this.selectedBranchId).toPromise();t&&this.departments.set(this.convertToTreeNodes(t))}catch(t){console.error("Failed to load departments:",t)}finally{this.loading.set(!1)}})}convertToTreeNodes(t){return t.map(e=>L(N({},e),{expanded:!1,selected:!1,indentLevel:e.level,children:e.children?this.convertToTreeNodes(e.children):[]}))}toggleNode(t){let e=this.expandedNodes();e.has(t)?e.delete(t):e.add(t),this.expandedNodes.set(new Set(e))}selectNode(t){this.allowSelection&&(this.selectedNode.set(t.id),this.departmentSelected.emit(t))}isExpanded(t){return this.expandedNodes().has(t)}isSelected(t){return this.selectedNode()===t}getVisibleNodes(){let t=[],e=this.searchTerm().toLowerCase(),o=this.showInactive(),a=(d,h=0)=>{for(let w of d){let M=!e||w.name.toLowerCase().includes(e)||w.code.toLowerCase().includes(e)||w.nameAr&&w.nameAr.toLowerCase().includes(e),de=o||w.isActive;M&&de&&t.push(L(N({},w),{indentLevel:h})),w.children&&this.isExpanded(w.id)&&a(w.children,h+1)}};return a(this.departments()),t}expandAll(){let t=this.getAllNodeIds(this.departments());this.expandedNodes.set(new Set(t))}collapseAll(){this.expandedNodes.set(new Set)}getAllNodeIds(t){let e=[];for(let o of t)e.push(o.id),o.children&&e.push(...this.getAllNodeIds(o.children));return e}onAddDepartment(t){this.departmentAdd.emit({parentId:t?.id})}onViewDepartment(t){this.departmentView.emit(t)}onEditDepartment(t){this.departmentEdit.emit(t)}onDeleteDepartment(t){this.departmentDelete.emit(t)}getIndentStyle(t){return`margin-left: ${(t||0)*20}px`}onSearchChange(t){this.searchTerm.set(t),t&&this.expandMatchingNodes()}expandMatchingNodes(){let t=this.searchTerm().toLowerCase(),e=new Set,o=(a,d=[])=>{for(let h of a)(h.name.toLowerCase().includes(t)||h.code.toLowerCase().includes(t)||h.nameAr&&h.nameAr.toLowerCase().includes(t))&&d.forEach(M=>e.add(M)),h.children&&o(h.children,[...d,h.id])};o(this.departments()),this.expandedNodes.set(e)}onShowInactiveChange(t){this.showInactive.set(t)}refresh(){this.loadDepartments()}trackByNodeId(t,e){return e.id}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=y({type:n,selectors:[["app-department-tree"]],inputs:{selectedBranchId:"selectedBranchId",allowSelection:"allowSelection",allowEdit:"allowEdit",allowDelete:"allowDelete",showControls:"showControls"},outputs:{departmentSelected:"departmentSelected",departmentView:"departmentView",departmentEdit:"departmentEdit",departmentDelete:"departmentDelete",departmentAdd:"departmentAdd"},decls:4,vars:3,consts:[[1,"department-tree"],[1,"tree-controls","mb-3"],[1,"text-center","p-4"],[1,"tree-container"],[1,"row","g-2","align-items-center"],[1,"col-md-4"],[1,"input-group"],[1,"input-group-text"],[1,"fas","fa-search"],["type","text",1,"form-control",3,"input","placeholder","value"],[1,"col-md-3"],[1,"form-check"],["type","checkbox","id","showInactive",1,"form-check-input",3,"change","checked"],["for","showInactive",1,"form-check-label"],[1,"col-md-5"],[1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary",3,"click","title"],[1,"fas","fa-expand-arrows-alt"],[1,"fas","fa-compress-arrows-alt"],[1,"fas","fa-sync"],["type","button",1,"btn","btn-primary",3,"title"],["type","button",1,"btn","btn-primary",3,"click","title"],[1,"fas","fa-plus"],[3,"message","centered"],[1,"tree-node",3,"selected","inactive"],[1,"text-center","p-4","text-muted"],[1,"tree-node"],[1,"node-content","d-flex","align-items-center","p-2",3,"click"],["type","button",1,"btn","btn-sm","btn-link","expand-btn","p-0","me-2"],[1,"expand-spacer","me-2"],[1,"fas","fa-building","me-2","text-primary"],[1,"node-info","flex-grow-1"],[1,"node-title"],[1,"text-muted","ms-1"],[1,"badge","bg-light","text-dark","border","ms-2"],[1,"node-subtitle","text-muted","small"],[1,"node-meta","text-muted","small"],[1,"ms-2"],[1,"node-actions"],["type","button",1,"btn","btn-sm","btn-link","expand-btn","p-0","me-2",3,"click"],[1,"fas"],[1,"fas","fa-user-tie","me-1"],[1,"fas","fa-users","me-1"],[1,"fas","fa-map-marker-alt","me-1"],["type","button",1,"btn","btn-outline-primary",3,"click","title"],[1,"fas","fa-eye"],["type","button",1,"btn","btn-outline-success",3,"title"],["type","button",1,"btn","btn-outline-secondary",3,"title"],["type","button",1,"btn","btn-outline-danger",3,"title"],["type","button",1,"btn","btn-outline-success",3,"click","title"],[1,"fas","fa-edit"],["type","button",1,"btn","btn-outline-danger",3,"click","title"],[1,"fas","fa-trash"],[1,"fas","fa-building","fa-3x","mb-3"],["type","button",1,"btn","btn-primary"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus","me-2"]],template:function(e,o){e&1&&(l(0,"div",0),C(1,Ye,21,8,"div",1),C(2,Ge,2,2,"div",2),C(3,lt,4,1,"div",3),c()),e&2&&(i(),u(o.showControls?1:-1),i(),u(o.loading()?2:-1),i(),u(o.loading()?-1:3))},dependencies:[$,U],styles:[".department-tree[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a}.tree-controls[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #e9ecef;background-color:#f8f9fa;border-radius:8px 8px 0 0}.tree-container[_ngcontent-%COMP%]{max-height:600px;overflow-y:auto}.tree-node[_ngcontent-%COMP%]{border-bottom:1px solid #f8f9fa;transition:all .2s ease}.tree-node[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.tree-node.selected[_ngcontent-%COMP%]{background-color:#e3f2fd;border-left:4px solid #2196f3}.tree-node.inactive[_ngcontent-%COMP%]{opacity:.6}.node-content[_ngcontent-%COMP%]{cursor:pointer;position:relative;min-height:48px}.expand-btn[_ngcontent-%COMP%]{width:24px;height:24px;border:none!important;color:#6c757d;display:flex;align-items:center;justify-content:center}.expand-btn[_ngcontent-%COMP%]:hover{color:#495057;background-color:#e9ecef;border-radius:4px}.expand-spacer[_ngcontent-%COMP%]{width:24px;height:24px}.node-info[_ngcontent-%COMP%]{min-height:36px;display:flex;flex-direction:column;justify-content:center}.node-title[_ngcontent-%COMP%]{font-weight:500;color:#212529;line-height:1.2}.node-subtitle[_ngcontent-%COMP%]{margin-top:2px;font-size:.875rem;line-height:1.2}.node-meta[_ngcontent-%COMP%]{margin-top:2px;font-size:.75rem;line-height:1.2}.node-meta[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline-flex;align-items:center}.node-actions[_ngcontent-%COMP%]{opacity:0;transition:opacity .2s ease}.tree-node[_ngcontent-%COMP%]:hover   .node-actions[_ngcontent-%COMP%]{opacity:1}.node-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border:none;box-shadow:0 1px 3px #0000001a}.node-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 2px 6px #00000026}[dir=rtl][_ngcontent-%COMP%]   .tree-node.selected[_ngcontent-%COMP%]{border-left:none;border-right:4px solid #2196f3}[dir=rtl][_ngcontent-%COMP%]   .node-content[_ngcontent-%COMP%]{flex-direction:row-reverse}@media (max-width: 768px){.tree-controls[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:.5rem}.node-actions[_ngcontent-%COMP%]{opacity:1}.node-actions[_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]{flex-direction:column}.node-meta[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;margin-left:0!important;margin-top:2px}}.tree-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.tree-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px}.tree-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:4px}.tree-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.tree-node[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.spinner-border[_ngcontent-%COMP%]{color:#2196f3}.text-muted[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#adb5bd!important}.badge[_ngcontent-%COMP%]{font-size:.65rem;padding:.25rem .5rem}.btn-outline-success[_ngcontent-%COMP%]:hover, .btn-outline-primary[_ngcontent-%COMP%]:hover, .btn-outline-danger[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}"]})};function ct(n,t){if(n&1&&(l(0,"p",12),s(1),c()),n&2){let e=r(2);i(),b(" ",e.selectedDepartment.description," ")}}function dt(n,t){if(n&1&&(l(0,"div",14)(1,"small",15),s(2),c(),m(3,"br"),l(4,"strong"),s(5),c()()),n&2){let e=r(2);i(2),D(e.i18n.t("department.manager")),i(3),D(e.selectedDepartment.managerName)}}function mt(n,t){if(n&1&&(l(0,"div",14)(1,"small",15),s(2),c(),m(3,"br"),l(4,"strong"),s(5),c()()),n&2){let e=r(2);i(2),D(e.i18n.t("department.location")),i(3),D(e.selectedDepartment.location)}}function st(n,t){if(n&1){let e=x();l(0,"button",22),g("click",function(){p(e);let a=r(2);return _(a.onDepartmentView())}),m(1,"i",23),s(2),c()}if(n&2){let e=r(2);i(2),b(" ",e.i18n.t("common.view")," ")}}function pt(n,t){if(n&1){let e=x();l(0,"button",24),g("click",function(){p(e);let a=r(2);return _(a.onDepartmentEdit())}),m(1,"i",25),s(2),c()}if(n&2){let e=r(2);i(2),b(" ",e.i18n.t("common.edit")," ")}}function _t(n,t){if(n&1){let e=x();l(0,"button",26),g("click",function(){p(e);let a=r(2);return _(a.onDepartmentDelete())}),m(1,"i",27),s(2),c()}if(n&2){let e=r(2);f("disabled",e.selectedDepartment.employeeCount>0),i(2),b(" ",e.i18n.t("common.delete")," ")}}function Ct(n,t){if(n&1){let e=x();l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div"),m(5,"i",4),s(6),c(),l(7,"button",5),g("click",function(){p(e);let a=r();return _(a.onClosePanel())}),m(8,"i",6),c()()(),l(9,"div",7)(10,"div",8)(11,"div",9)(12,"h6",10),s(13),c(),l(14,"p",11),s(15),c(),C(16,ct,2,1,"p",12),c(),l(17,"div",9)(18,"div",13),C(19,dt,6,2,"div",14),l(20,"div",14)(21,"small",15),s(22),c(),m(23,"br"),l(24,"strong"),s(25),c()(),C(26,mt,6,2,"div",14),l(27,"div",14)(28,"small",15),s(29),c(),m(30,"br")(31,"app-status-badge",16),c()()()(),l(32,"div",17)(33,"div",18),O(34,st,3,1,"button",19)(35,pt,3,1,"button",20)(36,_t,3,2,"button",21),c()()()()()}if(n&2){let e=r();i(6),b(" ",e.i18n.t("department.selectedDepartment")," "),i(7),D(e.selectedDepartment.name),i(2),D(e.selectedDepartment.code),i(),u(e.selectedDepartment.description?16:-1),i(3),u(e.selectedDepartment.managerName?19:-1),i(3),D(e.i18n.t("common.employees")),i(3),D(e.selectedDepartment.employeeCount||0),i(),u(e.selectedDepartment.location?26:-1),i(3),D(e.i18n.t("common.status")),i(2),f("status",e.selectedDepartment.isActive?"active":"inactive")("label",e.selectedDepartment.isActive?e.i18n.t("common.active"):e.i18n.t("common.inactive"))("showIcon",!0),i(3),f("appHasPermission",e.PERMISSIONS.DEPARTMENT_READ),i(),f("appHasPermission",e.PERMISSIONS.DEPARTMENT_UPDATE),i(),f("appHasPermission",e.PERMISSIONS.DEPARTMENT_DELETE)}}var K=class n{i18n=T(V);permissionService=T(R);selectedDepartment=null;departmentView=new P;departmentEdit=new P;departmentDelete=new P;closePanel=new P;PERMISSIONS={DEPARTMENT_READ:`${S.DEPARTMENT}.${E.READ}`,DEPARTMENT_UPDATE:`${S.DEPARTMENT}.${E.UPDATE}`,DEPARTMENT_DELETE:`${S.DEPARTMENT}.${E.DELETE}`};onDepartmentView(){this.selectedDepartment&&this.departmentView.emit(this.selectedDepartment)}onDepartmentEdit(){this.selectedDepartment&&this.departmentEdit.emit(this.selectedDepartment)}onDepartmentDelete(){this.selectedDepartment&&this.departmentDelete.emit(this.selectedDepartment)}onClosePanel(){this.closePanel.emit()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=y({type:n,selectors:[["app-department-info-panel"]],inputs:{selectedDepartment:"selectedDepartment"},outputs:{departmentView:"departmentView",departmentEdit:"departmentEdit",departmentDelete:"departmentDelete",closePanel:"closePanel"},decls:1,vars:1,consts:[[1,"selected-info"],[1,"card","border-primary"],[1,"card-header","bg-primary","text-white"],[1,"d-flex","align-items-center","justify-content-between"],[1,"fas","fa-info-circle","me-2"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],[1,"fas","fa-times"],[1,"card-body"],[1,"row"],[1,"col-md-6"],[1,"fw-bold"],[1,"text-muted","mb-2"],[1,"small","mb-2"],[1,"row","g-2"],[1,"col-6"],[1,"text-muted"],[3,"status","label","showIcon"],[1,"mt-3"],[1,"btn-group","btn-group-sm"],["type","button","class","btn btn-outline-primary",3,"click",4,"appHasPermission"],["type","button","class","btn btn-outline-secondary",3,"click",4,"appHasPermission"],["type","button","class","btn btn-outline-danger",3,"disabled","click",4,"appHasPermission"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"fas","fa-eye","me-1"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-edit","me-1"],["type","button",1,"btn","btn-outline-danger",3,"click","disabled"],[1,"fas","fa-trash","me-1"]],template:function(e,o){e&1&&C(0,Ct,37,15,"div",0),e&2&&u(o.selectedDepartment?0:-1)},dependencies:[Y,G],styles:[".selected-info[_ngcontent-%COMP%]{margin-top:1.5rem}.card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 4px 6px #0000001a;overflow:hidden}.card-header[_ngcontent-%COMP%]{border-bottom:1px solid rgba(255,255,255,.2);padding:1rem 1.25rem}.card-body[_ngcontent-%COMP%]{padding:1.5rem}.fw-bold[_ngcontent-%COMP%]{font-weight:600;color:#333;margin-bottom:.5rem}.text-muted[_ngcontent-%COMP%]{color:#6c757d!important}.small[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.4}.badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.375rem .75rem;border-radius:.375rem}.badge.bg-success[_ngcontent-%COMP%]{background-color:#198754!important}.badge.bg-secondary[_ngcontent-%COMP%]{background-color:#6c757d!important}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.875rem;border-radius:.25rem}.btn-outline-primary[_ngcontent-%COMP%]{color:#0d6efd;border-color:#0d6efd}.btn-outline-primary[_ngcontent-%COMP%]:hover{background-color:#0d6efd;border-color:#0d6efd;color:#fff}.btn-outline-secondary[_ngcontent-%COMP%]{color:#6c757d;border-color:#6c757d}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background-color:#6c757d;border-color:#6c757d;color:#fff}.btn-outline-danger[_ngcontent-%COMP%]{color:#dc3545;border-color:#dc3545}.btn-outline-danger[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#dc3545;border-color:#dc3545;color:#fff}.btn-outline-danger[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-outline-light[_ngcontent-%COMP%]{border:1px solid rgba(255,255,255,.5);color:#fff}.btn-outline-light[_ngcontent-%COMP%]:hover{background-color:#ffffff1a;border-color:#fff;color:#fff}@media (max-width: 768px){.card-body[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .col-md-6[_ngcontent-%COMP%]{margin-bottom:1rem}.btn-group-sm[_ngcontent-%COMP%]{flex-direction:column;width:100%}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:.375rem!important;margin-bottom:.25rem;width:100%}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-bottom:0}}"]})};function ut(n,t){if(n&1&&(l(0,"div",11)(1,"div",14),m(2,"i",15),l(3,"div")(4,"strong"),s(5),c(),m(6,"br"),l(7,"small"),s(8),c()()()()),n&2){let e=r();i(5),D(e.i18n.t("department.allDepartments")||"All Departments"),i(3),D(e.i18n.t("department.showingAllDepartments")||"Showing departments from all branches. Select a specific branch to filter.")}}function gt(n,t){if(n&1){let e=x();l(0,"app-department-table",16),g("departmentSelected",function(a){p(e);let d=r();return _(d.onDepartmentSelected(a))})("departmentView",function(a){p(e);let d=r();return _(d.onDepartmentView(a))})("departmentEdit",function(a){p(e);let d=r();return _(d.onDepartmentEdit(a))})("departmentDelete",function(a){p(e);let d=r();return _(d.onDepartmentDelete(a))})("departmentAdd",function(){p(e);let a=r();return _(a.onDepartmentAdd())}),c()}if(n&2){let e,o=r();f("selectedBranchId",(e=o.selectedBranch())==null?null:e.id)("allowSelection",!0)("allowEdit",!0)("allowDelete",!0)("showControls",!0)}}function ft(n,t){if(n&1){let e=x();l(0,"app-department-tree",16),g("departmentSelected",function(a){p(e);let d=r();return _(d.onDepartmentSelected(a))})("departmentView",function(a){p(e);let d=r();return _(d.onDepartmentView(a))})("departmentEdit",function(a){p(e);let d=r();return _(d.onDepartmentEdit(a))})("departmentDelete",function(a){p(e);let d=r();return _(d.onDepartmentDelete(a))})("departmentAdd",function(a){p(e);let d=r();return _(d.onDepartmentAdd(a))}),c()}if(n&2){let e,o=r();f("selectedBranchId",(e=o.selectedBranch())==null?null:e.id)("allowSelection",!0)("allowEdit",!0)("allowDelete",!0)("showControls",!0)}}var ce=class n{i18n=T(V);departmentsService=T(B);confirmationService=T(ae);permissionService=T(R);router=T(ne);PERMISSIONS={DEPARTMENT_CREATE:`${S.DEPARTMENT}.${E.CREATE}`,DEPARTMENT_READ:`${S.DEPARTMENT}.${E.READ}`,DEPARTMENT_UPDATE:`${S.DEPARTMENT}.${E.UPDATE}`,DEPARTMENT_DELETE:`${S.DEPARTMENT}.${E.DELETE}`,DEPARTMENT_MANAGE:`${S.DEPARTMENT}.${E.MANAGE}`};viewMode=v("table");selectedBranch=v(null);selectedDepartment=v(null);branchesLoading=v(!1);branches=v([]);currentFilter={};ngOnInit(){}onViewModeChange(t){this.viewMode.set(t)}onBranchChange(t){if(!t||t===0){this.selectedBranch.set(null);return}let e=this.branches().find(o=>o.id===t);this.selectedBranch.set(e||null)}onBranchSelectionChange(t){let e=t?parseInt(t):0;this.onBranchChange(e)}onCloseInfoPanel(){this.selectedDepartment.set(null)}onDepartmentSelected(t){this.selectedDepartment.set(t)}onDepartmentView(t){this.router.navigate(["/departments",t.id,"view"])}onDepartmentEdit(t){this.router.navigate(["/departments",t.id,"edit"])}onDepartmentDelete(t){return H(this,null,function*(){(yield this.confirmationService.confirm({title:"Delete Department",message:`Are you sure you want to delete "${t.name}"? This action cannot be undone.`,confirmText:this.i18n.t("common.delete"),cancelText:this.i18n.t("common.cancel"),confirmButtonClass:"btn-danger",icon:"fa-trash",iconClass:"text-danger"})).confirmed&&this.deleteDepartment(t.id)})}onDepartmentAdd(t){t?.parentId?this.router.navigate(["/departments/create"],{queryParams:{parentId:t.parentId}}):this.router.navigate(["/departments/create"])}onSearchChange(t){this.currentFilter=L(N({},this.currentFilter),{search:t})}onFiltersChange(t){this.currentFilter=N({},t),t.branchId?this.onBranchChange(parseInt(t.branchId)):this.selectedBranch.set(null)}onRefreshData(){this.currentFilter={},this.selectedBranch.set(null),this.refreshData()}deleteDepartment(t){return H(this,null,function*(){try{yield this.departmentsService.deleteDepartment(t).toPromise(),this.refreshData()}catch(e){console.error("Failed to delete department:",e)}})}refreshData(){window.location.reload()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=y({type:n,selectors:[["app-departments"]],decls:17,vars:10,consts:[[1,"app-list-page"],[3,"title"],["moduleName","departments",3,"searchChange","filtersChange","add","refresh","refreshing"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],["role","group",1,"btn-group"],["type","radio","name","viewMode","id","tableMode",1,"btn-check",3,"change","checked"],["for","tableMode",1,"btn","btn-outline-primary"],[1,"fas","fa-table","me-2"],["type","radio","name","viewMode","id","treeMode",1,"btn-check",3,"change","checked"],["for","treeMode",1,"btn","btn-outline-primary"],[1,"fas","fa-sitemap","me-2"],[1,"alert","alert-info"],[3,"selectedBranchId","allowSelection","allowEdit","allowDelete","showControls"],[3,"departmentView","departmentEdit","departmentDelete","closePanel","selectedDepartment"],[1,"d-flex","align-items-center"],[1,"fas","fa-info-circle","me-3"],[3,"departmentSelected","departmentView","departmentEdit","departmentDelete","departmentAdd","selectedBranchId","allowSelection","allowEdit","allowDelete","showControls"]],template:function(e,o){e&1&&(l(0,"div",0),m(1,"app-page-header",1),l(2,"app-unified-filter",2),g("searchChange",function(d){return o.onSearchChange(d)})("filtersChange",function(d){return o.onFiltersChange(d)})("add",function(){return o.onDepartmentAdd()})("refresh",function(){return o.onRefreshData()}),c(),l(3,"div",3)(4,"div",4)(5,"input",5),g("change",function(){return o.onViewModeChange("table")}),c(),l(6,"label",6),m(7,"i",7),s(8),c(),l(9,"input",8),g("change",function(){return o.onViewModeChange("tree")}),c(),l(10,"label",9),m(11,"i",10),s(12),c()()(),C(13,ut,9,2,"div",11),C(14,gt,1,5,"app-department-table",12),C(15,ft,1,5,"app-department-tree",12),l(16,"app-department-info-panel",13),g("departmentView",function(d){return o.onDepartmentView(d)})("departmentEdit",function(d){return o.onDepartmentEdit(d)})("departmentDelete",function(d){return o.onDepartmentDelete(d)})("closePanel",function(){return o.onCloseInfoPanel()}),c()()),e&2&&(i(),f("title",o.i18n.t("department.departments")),i(),f("refreshing",o.branchesLoading()),i(3),f("checked",o.viewMode()==="table"),i(3),b("",o.i18n.t("common.table")||"Table"," "),i(),f("checked",o.viewMode()==="tree"),i(3),b("",o.i18n.t("common.tree")||"Tree"," "),i(),u(!o.selectedBranch()&&!o.branchesLoading()?13:-1),i(),u(o.viewMode()==="table"?14:-1),i(),u(o.viewMode()==="tree"?15:-1),i(),f("selectedDepartment",o.selectedDepartment()))},dependencies:[$,q,J,le,K,re],styles:[".selected-info[_ngcontent-%COMP%]{position:fixed;top:50%;right:2rem;transform:translateY(-50%);width:350px;z-index:1000}@media (max-width: 1200px){.selected-info[_ngcontent-%COMP%]{position:relative;top:auto;right:auto;transform:none;width:100%;margin-top:2rem}}"]})};export{ce as DepartmentsComponent};
