import{a as $}from"./chunk-FF4V4KY3.js";import{a as I}from"./chunk-NPDCAEA6.js";import"./chunk-QW24EDIR.js";import"./chunk-QXVLGI72.js";import"./chunk-HUSARQNL.js";import{a as N}from"./chunk-H5EPUHY6.js";import"./chunk-Y62N6K5S.js";import"./chunk-VRETN7JA.js";import"./chunk-GRQ6RO47.js";import{a as O}from"./chunk-UBCI4X5Q.js";import"./chunk-EYAJMHM7.js";import{a as D}from"./chunk-HHXRLUSQ.js";import{a as k,b as M}from"./chunk-3VZ5QHEY.js";import{Bb as _,Cc as A,Db as w,Ea as C,Lb as y,M as S,Pb as U,R as n,Yb as f,bb as l,cb as c,da as a,db as d,eb as h,n as v,nb as p,ta as o,wc as T}from"./chunk-JSQL33QG.js";import{a as g,b}from"./chunk-DGAILPFQ.js";var u=class r{http=n(A);apiUrl=`${k.apiUrl}/api/v1`;getUserSessions(){return this.http.get(`${this.apiUrl}/sessions`).pipe(v(e=>e.sessions||[]))}terminateSession(e){return this.http.delete(`${this.apiUrl}/sessions/${e}`)}terminateAllOtherSessions(){return this.http.delete(`${this.apiUrl}/sessions/terminate-all`)}static \u0275fac=function(s){return new(s||r)};static \u0275prov=S({token:r,factory:r.\u0275fac,providedIn:"root"})};var F=()=>[],L=class r{sessionsService=n(u);notificationService=n(D);confirmationService=n(N);i18n=n(M);sessions=a([]);loading=a(!1);error=a(null);searchTerm=a("");tableColumns=f(()=>[{key:"user",label:this.i18n.t("sessions.user"),sortable:!0,width:"20%",priority:"high",renderHtml:!0},{key:"deviceInfo",label:this.i18n.t("sessions.device"),sortable:!1,width:"20%",priority:"high",renderHtml:!0},{key:"ipAddress",label:this.i18n.t("sessions.ip_address"),sortable:!0,width:"12%",priority:"medium"},{key:"loginTime",label:this.i18n.t("sessions.login_time"),sortable:!0,width:"15%",priority:"medium"},{key:"lastActivity",label:this.i18n.t("sessions.last_activity"),sortable:!0,width:"15%",priority:"low"},{key:"status",label:this.i18n.t("sessions.status"),sortable:!1,width:"10%",align:"center",priority:"high",renderHtml:!0}]);tableActions=f(()=>[{key:"terminate",label:this.i18n.t("sessions.terminate"),icon:"fa-power-off",color:"danger",condition:e=>!e.isCurrentSession}]);tableData=f(()=>{let e=this.sessions();if(!Array.isArray(e))return[];let s=this.searchTerm().toLowerCase();return(s?e.filter(t=>t.username?.toLowerCase().includes(s)||t.email?.toLowerCase().includes(s)||t.ipAddress?.toLowerCase().includes(s)||t.deviceName?.toLowerCase().includes(s)||t.browser?.toLowerCase().includes(s)||t.platform?.toLowerCase().includes(s)):e).map(t=>b(g({},t),{user:this.formatUser(t),deviceInfo:this.formatDevice(t),loginTime:this.formatDateTime(t.createdAtUtc),lastActivity:this.formatDateTime(t.lastAccessedAtUtc),status:this.formatStatus(t)}))});ngOnInit(){this.loadSessions()}loadSessions(){this.loading.set(!0),this.error.set(null),this.sessionsService.getUserSessions().subscribe({next:e=>{this.sessions.set(e),this.loading.set(!1)},error:e=>{console.error("Failed to load sessions:",e),this.error.set(this.i18n.t("sessions.errors.load_failed")),this.notificationService.error(this.i18n.t("sessions.errors.load_failed")),this.loading.set(!1)}})}onTerminateSession(e){if(e.isCurrentSession){this.notificationService.warning(this.i18n.t("sessions.errors.cannot_terminate_current"));return}this.confirmationService.confirm({title:this.i18n.t("sessions.terminate_session"),message:this.i18n.t("sessions.confirm_terminate").replace("{{device}}",e.deviceName||"Unknown Device"),confirmText:this.i18n.t("sessions.terminate"),cancelText:this.i18n.t("common.cancel"),confirmButtonClass:"btn-danger"}).then(s=>{s.confirmed&&this.sessionsService.terminateSession(e.sessionId).subscribe({next:()=>{this.notificationService.success(this.i18n.t("sessions.success.terminated")),this.loadSessions()},error:i=>{console.error("Failed to terminate session:",i),this.notificationService.error(this.i18n.t("sessions.errors.terminate_failed"))}})})}onTerminateAllOtherSessions(){this.confirmationService.confirm({title:this.i18n.t("sessions.terminate_all"),message:this.i18n.t("sessions.confirm_terminate_all"),confirmText:this.i18n.t("sessions.terminate_all"),cancelText:this.i18n.t("common.cancel"),confirmButtonClass:"btn-danger"}).then(e=>{e.confirmed&&this.sessionsService.terminateAllOtherSessions().subscribe({next:()=>{this.notificationService.success(this.i18n.t("sessions.success.all_terminated")),this.loadSessions()},error:s=>{console.error("Failed to terminate all sessions:",s),this.notificationService.error(this.i18n.t("sessions.errors.terminate_all_failed"))}})})}onActionClick(e){let{action:s,item:i}=e;switch(s){case"terminate":this.onTerminateSession(i);break;default:console.warn("Unknown action:",s)}}onRefresh(){this.loadSessions()}onSearchChange(e){this.searchTerm.set(e)}formatUser(e){return`
      <div>
        <div class="fw-medium">${e.username||"Unknown"}</div>
        <small class="text-muted">${e.email||"No email"}</small>
      </div>
    `}formatDevice(e){let s=e.platform?.trim()||"Unknown",i=e.browser?.trim()||"Unknown",t=e.deviceName?.trim()||`${i} on ${s}`;return`
      <div class="d-flex align-items-center">
        <i class="fas ${s.toLowerCase().includes("mobile")||s.toLowerCase().includes("android")||s.toLowerCase().includes("ios")?"fa-mobile-alt":"fa-desktop"} me-2 text-primary"></i>
        <div>
          <div class="fw-medium">${t}</div>
          <small class="text-muted">${i} on ${s}</small>
        </div>
      </div>
    `}formatDateTime(e){return e?new Date(e).toLocaleString():"-"}formatStatus(e){return e.isCurrentSession?`<span class="badge bg-success-subtle text-success">${this.i18n.t("sessions.current_session")}</span>`:`<span class="badge bg-info-subtle text-info">${this.i18n.t("sessions.active")}</span>`}static \u0275fac=function(s){return new(s||r)};static \u0275cmp=C({type:r,selectors:[["app-sessions"]],decls:8,vars:15,consts:[[1,"app-list-page"],[3,"title"],[3,"searchChange","refresh","searchPlaceholder","showAddButton","refreshing"],[1,"mb-3"],["type","button",1,"btn","btn-outline-danger",3,"click","disabled"],[1,"fas","fa-power-off","me-2"],[3,"actionClick","data","columns","actions","loading","emptyTitle","emptyMessage","responsiveMode"]],template:function(s,i){s&1&&(c(0,"div",0),h(1,"app-page-header",1),c(2,"app-unified-filter",2),p("searchChange",function(m){return i.onSearchChange(m)})("refresh",function(){return i.onRefresh()}),d(),c(3,"div",3)(4,"button",4),p("click",function(){return i.onTerminateAllOtherSessions()}),h(5,"i",5),_(6),d()(),c(7,"app-data-table",6),p("actionClick",function(m){return i.onActionClick(m)}),d()()),s&2&&(o(),l("title",i.i18n.t("sessions.title")),o(),l("searchPlaceholder",y(i.i18n.t("sessions.search_placeholder")))("showAddButton",!1)("refreshing",i.loading()),o(2),l("disabled",i.loading()),o(2),w(" ",i.i18n.t("sessions.terminate_all")," "),o(),l("data",i.tableData()||U(14,F))("columns",i.tableColumns())("actions",i.tableActions())("loading",i.loading)("emptyTitle",i.i18n.t("sessions.no_sessions"))("emptyMessage",i.i18n.t("sessions.no_sessions_message"))("responsiveMode","auto"))},dependencies:[T,O,I,$],styles:[".app-list-page[_ngcontent-%COMP%]{padding:1.5rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:.25rem!important;margin-left:.5rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:first-child{margin-left:0}"]})};export{L as SessionsComponent};
