import{a as b}from"./chunk-HHXRLUSQ.js";import{a as c}from"./chunk-TJ2U7DWW.js";import{Bc as m,Cc as y,J as l,M as h,Q as p,Yb as f,da as n,k as s,n as a,x as o}from"./chunk-JSQL33QG.js";import{a as d,b as u}from"./chunk-DGAILPFQ.js";var R=class g{constructor(e,t){this.http=e;this.notificationService=t}portalApiUrl=`${c.apiUrl}/api/v1/portal`;fingerprintApiUrl=`${c.apiUrl}/api/v1/fingerprint-requests`;_dashboard=n(null);_dashboardLoading=n(!1);_dashboardError=n(null);dashboard=this._dashboard.asReadonly();dashboardLoading=this._dashboardLoading.asReadonly();dashboardError=this._dashboardError.asReadonly();statsCards=f(()=>{let e=this._dashboard();return e?[{id:"attendance",title:"Attendance Rate",value:`${e.attendanceRate.toFixed(1)}%`,subtitle:e.attendanceTrend>=0?`+${e.attendanceTrend.toFixed(1)}% from last month`:`${e.attendanceTrend.toFixed(1)}% from last month`,icon:"fa-calendar-check",iconColor:"text-primary",trend:e.attendanceTrend,trendLabel:"vs last month",route:"/portal/my-attendance"},{id:"working-hours",title:"Working Hours",value:e.totalWorkingHours.toFixed(1),subtitle:"This month",icon:"fa-clock",iconColor:"text-success",route:"/portal/my-attendance"},{id:"overtime",title:"Overtime Hours",value:e.overtimeHours.toFixed(1),subtitle:"This month",icon:"fa-business-time",iconColor:"text-warning",route:"/portal/my-attendance"},{id:"vacation",title:"Vacation Days",value:e.remainingVacationDays,subtitle:"Remaining this year",icon:"fa-umbrella-beach",iconColor:"text-info",route:"/employee-vacations"}]:[]});quickActions=f(()=>[{id:"request-vacation",title:"Request Vacation",description:"Submit a new vacation request",icon:"fa-umbrella-beach",route:"/employee-vacations/new",color:"primary",enabled:!0},{id:"request-excuse",title:"Request Excuse",description:"Submit an absence excuse",icon:"fa-file-medical",route:"/employee-excuses/new",color:"info",enabled:!0},{id:"fingerprint-request",title:"Fingerprint Request",description:"Request fingerprint enrollment or update",icon:"fa-fingerprint",route:"/portal/fingerprint-requests/new",color:"warning",enabled:!0},{id:"view-attendance",title:"My Attendance",description:"View attendance history",icon:"fa-calendar-alt",route:"/portal/my-attendance",color:"success",enabled:!0}]);_fingerprintRequests=n([]);_fingerprintRequestsLoading=n(!1);_fingerprintRequestsError=n(null);_fingerprintRequestsPagedResult=n(null);fingerprintRequests=this._fingerprintRequests.asReadonly();fingerprintRequestsLoading=this._fingerprintRequestsLoading.asReadonly();fingerprintRequestsError=this._fingerprintRequestsError.asReadonly();fingerprintRequestsPagedResult=this._fingerprintRequestsPagedResult.asReadonly();loadEmployeeDashboard(){return this._dashboardLoading.set(!0),this._dashboardError.set(null),this.http.get(`${this.portalApiUrl}/employee-dashboard`).pipe(a(e=>{if(!e.isSuccess)throw new Error(e.error||"Failed to load dashboard");return this.transformDashboardDates(e.value)}),l(e=>{this._dashboard.set(e),this._dashboardLoading.set(!1)}),o(e=>{let t=e.error?.error||e.message||"Failed to load employee dashboard";return this._dashboardError.set(t),this._dashboardLoading.set(!1),this.notificationService.error(t),s(()=>e)}))}refreshDashboard(){this.loadEmployeeDashboard().subscribe()}clearDashboard(){this._dashboard.set(null),this._dashboardError.set(null)}transformDashboardDates(e){return u(d({},e),{recentActivity:e.recentActivity.map(t=>u(d({},t),{date:new Date(t.date)}))})}loadFingerprintRequests(e){this._fingerprintRequestsLoading.set(!0),this._fingerprintRequestsError.set(null);let t=new m;return e&&(e.employeeId&&(t=t.set("employeeId",e.employeeId.toString())),e.status&&(t=t.set("status",e.status)),e.requestType&&(t=t.set("requestType",e.requestType)),e.startDate&&(t=t.set("startDate",e.startDate.toISOString())),e.endDate&&(t=t.set("endDate",e.endDate.toISOString())),e.pageNumber&&(t=t.set("pageNumber",e.pageNumber.toString())),e.pageSize&&(t=t.set("pageSize",e.pageSize.toString()))),this.http.get(this.fingerprintApiUrl,{params:t}).pipe(a(r=>{if(!r.isSuccess)throw new Error(r.error||"Failed to load fingerprint requests");return u(d({},r.value),{items:r.value.items.map(i=>this.transformFingerprintRequestDates(i))})}),l(r=>{this._fingerprintRequests.set(r.items),this._fingerprintRequestsPagedResult.set(r),this._fingerprintRequestsLoading.set(!1)}),o(r=>{let i=r.error?.error||r.message||"Failed to load fingerprint requests";return this._fingerprintRequestsError.set(i),this._fingerprintRequestsLoading.set(!1),this.notificationService.error(i),s(()=>r)}))}getFingerprintRequestById(e){return this.http.get(`${this.fingerprintApiUrl}/${e}`).pipe(a(t=>{if(!t.isSuccess)throw new Error(t.error||"Failed to load fingerprint request");return this.transformFingerprintRequestDates(t.value)}),o(t=>{let r=t.error?.error||t.message||"Failed to load fingerprint request";return this.notificationService.error(r),s(()=>t)}))}createFingerprintRequest(e){return this._fingerprintRequestsLoading.set(!0),this.http.post(this.fingerprintApiUrl,e).pipe(a(t=>{if(!t.isSuccess)throw new Error(t.error||"Failed to create fingerprint request");return t.value}),l(t=>{this._fingerprintRequestsLoading.set(!1),this.notificationService.success("Fingerprint request created successfully"),this._fingerprintRequestsPagedResult()&&this.loadFingerprintRequests().subscribe()}),o(t=>{this._fingerprintRequestsLoading.set(!1);let r=t.error?.error||t.message||"Failed to create fingerprint request";return this.notificationService.error(r),s(()=>t)}))}updateFingerprintRequest(e,t){return this._fingerprintRequestsLoading.set(!0),this.http.put(`${this.fingerprintApiUrl}/${e}`,t).pipe(a(r=>{if(!r.isSuccess)throw new Error(r.error||"Failed to update fingerprint request")}),l(()=>{this._fingerprintRequestsLoading.set(!1),this.notificationService.success("Fingerprint request updated successfully"),this._fingerprintRequestsPagedResult()&&this.loadFingerprintRequests().subscribe()}),o(r=>{this._fingerprintRequestsLoading.set(!1);let i=r.error?.error||r.message||"Failed to update fingerprint request";return this.notificationService.error(i),s(()=>r)}))}completeFingerprintRequest(e,t){return this._fingerprintRequestsLoading.set(!0),this.http.post(`${this.fingerprintApiUrl}/${e}/complete`,t).pipe(a(r=>{if(!r.isSuccess)throw new Error(r.error||"Failed to complete fingerprint request")}),l(()=>{this._fingerprintRequestsLoading.set(!1),this.notificationService.success("Fingerprint request completed successfully"),this._fingerprintRequestsPagedResult()&&this.loadFingerprintRequests().subscribe()}),o(r=>{this._fingerprintRequestsLoading.set(!1);let i=r.error?.error||r.message||"Failed to complete fingerprint request";return this.notificationService.error(i),s(()=>r)}))}cancelFingerprintRequest(e){return this._fingerprintRequestsLoading.set(!0),this.http.post(`${this.fingerprintApiUrl}/${e}/cancel`,{}).pipe(a(t=>{if(!t.isSuccess)throw new Error(t.error||"Failed to cancel fingerprint request")}),l(()=>{this._fingerprintRequestsLoading.set(!1),this.notificationService.success("Fingerprint request cancelled successfully"),this._fingerprintRequestsPagedResult()&&this.loadFingerprintRequests().subscribe()}),o(t=>{this._fingerprintRequestsLoading.set(!1);let r=t.error?.error||t.message||"Failed to cancel fingerprint request";return this.notificationService.error(r),s(()=>t)}))}transformFingerprintRequestDates(e){return u(d({},e),{preferredDate:e.preferredDate?new Date(e.preferredDate):void 0,scheduledDate:e.scheduledDate?new Date(e.scheduledDate):void 0,completedDate:e.completedDate?new Date(e.completedDate):void 0,createdAtUtc:new Date(e.createdAtUtc),modifiedAtUtc:e.modifiedAtUtc?new Date(e.modifiedAtUtc):void 0})}clearFingerprintRequests(){this._fingerprintRequests.set([]),this._fingerprintRequestsPagedResult.set(null),this._fingerprintRequestsError.set(null)}refreshFingerprintRequests(){let e=this._fingerprintRequestsPagedResult();e?this.loadFingerprintRequests({pageNumber:e.page,pageSize:e.pageSize}).subscribe():this.loadFingerprintRequests().subscribe()}_myAttendance=n([]);_myAttendanceLoading=n(!1);_myAttendanceError=n(null);myAttendance=this._myAttendance.asReadonly();myAttendanceLoading=this._myAttendanceLoading.asReadonly();myAttendanceError=this._myAttendanceError.asReadonly();loadMyAttendance(e){this._myAttendanceLoading.set(!0),this._myAttendanceError.set(null);let t={startDate:e.startDate?.toISOString()||new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString(),endDate:e.endDate?.toISOString()||new Date().toISOString(),employeeId:e.employeeId};return this.http.post(`${c.apiUrl}/api/v1/attendance/report`,t).pipe(a(r=>r.map(i=>u(d({},i),{date:new Date(i.date),checkInTime:i.checkInTime?new Date(i.checkInTime):null,checkOutTime:i.checkOutTime?new Date(i.checkOutTime):null}))),l(r=>{this._myAttendance.set(r),this._myAttendanceLoading.set(!1)}),o(r=>{let i=r.error?.message||r.message||"Failed to load attendance";return this._myAttendanceError.set(i),this._myAttendanceLoading.set(!1),this.notificationService.error(i),s(()=>r)}))}clearMyAttendance(){this._myAttendance.set([]),this._myAttendanceError.set(null)}_myProfile=n(null);_myProfileLoading=n(!1);_myProfileError=n(null);myProfile=this._myProfile.asReadonly();myProfileLoading=this._myProfileLoading.asReadonly();myProfileError=this._myProfileError.asReadonly();loadMyProfile(){return this._myProfileLoading.set(!0),this._myProfileError.set(null),this.http.get(`${c.apiUrl}/api/v1/users/me`).pipe(a(e=>!e.isSuccess&&e.value?e.value:e.value||e),l(e=>{this._myProfile.set(e),this._myProfileLoading.set(!1)}),o(e=>{let t=e.error?.error||e.message||"Failed to load profile";return this._myProfileError.set(t),this._myProfileLoading.set(!1),this.notificationService.error(t),s(()=>e)}))}updateMyProfile(e){return this._myProfileLoading.set(!0),this.http.put(`${c.apiUrl}/api/v1/users/me`,e).pipe(a(t=>{if(t&&!t.isSuccess)throw new Error(t.error||"Failed to update profile")}),l(()=>{this._myProfileLoading.set(!1),this.notificationService.success("Profile updated successfully"),this.loadMyProfile().subscribe()}),o(t=>{this._myProfileLoading.set(!1);let r=t.error?.error||t.message||"Failed to update profile";return this.notificationService.error(r),s(()=>t)}))}clearMyProfile(){this._myProfile.set(null),this._myProfileError.set(null)}static \u0275fac=function(t){return new(t||g)(p(y),p(b))};static \u0275prov=h({token:g,factory:g.\u0275fac,providedIn:"root"})};export{R as a};
