import{a as X}from"./chunk-BUDDO7QI.js";import{a as Q}from"./chunk-LK2JNJQF.js";import{b as z,c as I,d as j,e as q,g as B,h as O,k as $,l as W,r as H,s as J,t as K}from"./chunk-RH4QBYEM.js";import{d as A,g as D,h as L,m as G}from"./chunk-4DYU65FO.js";import{b as U}from"./chunk-CQWUHIOF.js";import{$a as l,$b as V,Ca as P,Db as M,Q as _,Ta as f,Ua as v,V as x,W as h,Xa as S,Ya as E,Za as u,_a as s,ab as m,ca as b,eb as y,ec as N,gb as C,ib as p,nb as w,qb as a,ra as i,rb as g,sb as c,ub as R,xb as F,yb as T,zb as k}from"./chunk-LHYYCVNR.js";import"./chunk-DGAILPFQ.js";var Z=()=>({standalone:!0}),ee=(o,t)=>t.group,te=(o,t)=>t.id;function ie(o,t){if(o&1&&(s(0,"div",10)(1,"div",13)(2,"span",14),a(3),l()()()),o&2){let e=p();i(3),g(e.i18n.t("common.loading"))}}function ne(o,t){if(o&1&&(s(0,"div",20),m(1,"i",54),a(2),l()),o&2){let e=p(2);i(2),c(" ",e.error()," ")}}function oe(o,t){if(o&1&&(s(0,"div",26),a(1),l()),o&2){let e=p(2);i(),g(e.getFieldError("name"))}}function re(o,t){if(o&1&&(s(0,"div",27),m(1,"i",55),a(2),l()),o&2){let e=p(2);i(2),c(" ",e.i18n.t("roles.system_role_name_readonly")," ")}}function se(o,t){if(o&1&&(s(0,"span",29),m(1,"i",55),a(2),l()),o&2){let e=p(2);i(2),c(" ",e.i18n.t("roles.system")," ")}}function le(o,t){if(o&1&&(s(0,"span",30),m(1,"i",56),a(2),l()),o&2){let e=p(2);i(2),c(" ",e.i18n.t("roles.custom")," ")}}function ae(o,t){if(o&1){let e=y();s(0,"div",61)(1,"div",62)(2,"div",63)(3,"input",64),C("change",function(){let d=x(e).$implicit,r=p(3);return h(r.onTogglePermission(d))}),l(),s(4,"div",65)(5,"div",66),m(6,"i",67),s(7,"label",68)(8,"small"),a(9),l()(),s(10,"span",69),a(11),l()(),s(12,"p",70),a(13),l()()()()()}if(o&2){let e=t.$implicit,n=p(3);i(),w("bg-light",n.isPermissionSelected(e.id)),i(2),u("id","permission-"+e.id)("checked",n.isPermissionSelected(e.id))("disabled",n.saving()),i(3),u("ngClass",n.getPermissionIcon(e.key)),i(),u("for","permission-"+e.id),i(2),g(n.getPermissionResource(e.key)),i(),u("ngClass",n.getActionBadgeClass(e.key)),i(),c(" ",n.getPermissionAction(e.key)," "),i(2),c(" ",n.getPermissionDescription(e)," ")}}function de(o,t){if(o&1&&(s(0,"div",47)(1,"h6",57),m(2,"i",58),a(3),s(4,"small",59),a(5),l()(),s(6,"div",60),S(7,ae,14,11,"div",61,te),l()()),o&2){let e=t.$implicit;i(3),c(" ",e.group," "),i(2),c("(",e.permissions.length," permissions)"),i(2),E(e.permissions)}}function me(o,t){if(o&1&&(s(0,"div",48),m(1,"i",71),s(2,"p",72),a(3),l()()),o&2){let e=p(2);i(3),g(e.i18n.t("roles.no_permissions_available"))}}function ce(o,t){o&1&&m(0,"span",52)}function pe(o,t){o&1&&m(0,"i",53)}function ue(o,t){if(o&1){let e=y();s(0,"div",11)(1,"div",15)(2,"h5",16),m(3,"i",17),a(4),l()(),s(5,"div",18)(6,"form",19),C("ngSubmit",function(){x(e);let d=p();return h(d.onSubmit())}),f(7,ne,3,1,"div",20),s(8,"div",21)(9,"div",22)(10,"label",23),a(11),s(12,"span",24),a(13,"*"),l()(),m(14,"input",25),f(15,oe,2,1,"div",26),f(16,re,3,1,"div",27),l(),s(17,"div",22)(18,"label",23),a(19),l(),s(20,"div",28),f(21,se,3,1,"span",29)(22,le,3,1,"span",30),l()()(),s(23,"div",31)(24,"div",32)(25,"h6",33),m(26,"i",34),a(27),l(),s(28,"div",35)(29,"button",36),C("click",function(){x(e);let d=p();return h(d.selectAllPermissions())}),m(30,"i",37),a(31),l(),s(32,"button",8),C("click",function(){x(e);let d=p();return h(d.clearAllPermissions())}),m(33,"i",38),a(34),l()()(),s(35,"div",39)(36,"small"),m(37,"i",40),a(38),l()(),s(39,"div",41)(40,"div",42)(41,"span",43),m(42,"i",44),l(),s(43,"input",45),k("ngModelChange",function(d){x(e);let r=p();return T(r.permissionSearchTerm,d)||(r.permissionSearchTerm=d),h(d)}),l()()(),s(44,"div",46),S(45,de,9,2,"div",47,ee),f(47,me,4,1,"div",48),l()(),s(48,"div",49)(49,"button",8),C("click",function(){x(e);let d=p();return h(d.onCancel())}),m(50,"i",50),a(51),l(),s(52,"button",51),f(53,ce,1,0,"span",52)(54,pe,1,0,"i",53),a(55),l()()()()()}if(o&2){let e,n,d,r=p();i(4),c(" ",r.i18n.t("roles.role_information")," "),i(2),u("formGroup",r.roleForm),i(),v(r.error()?7:-1),i(4),c(" ",r.i18n.t("roles.name")," "),i(3),w("is-invalid",r.isFieldInvalid("name")),u("placeholder",r.i18n.t("roles.name_placeholder"))("disabled",((e=r.role())==null?null:e.isSystem)||!1),i(),v(r.isFieldInvalid("name")?15:-1),i(),v((n=r.role())!=null&&n.isSystem?16:-1),i(3),g(r.i18n.t("roles.type")),i(2),v((d=r.role())!=null&&d.isSystem?21:22),i(6),c(" ",r.i18n.t("roles.permissions")," "),i(2),u("disabled",r.saving()),i(2),c(" ",r.i18n.t("roles.select_all")," "),i(),u("disabled",r.saving()),i(2),c(" ",r.i18n.t("roles.clear_all")," "),i(4),R(" ",r.selectedPermissions().size," ",r.i18n.t("roles.permissions_selected")," ",r.i18n.t("common.of")," ",r.allPermissions().length," "),i(5),F("ngModel",r.permissionSearchTerm),u("ngModelOptions",M(31,Z))("placeholder",r.i18n.t("roles.search_permissions_placeholder"))("disabled",r.saving()),i(2),E(r.getFilteredGroupedPermissions()),i(2),v(r.getFilteredGroupedPermissions().length===0?47:-1),i(2),u("disabled",r.saving()),i(2),c(" ",r.i18n.t("common.cancel")," "),i(),u("disabled",r.roleForm.invalid||r.saving()),i(),v(r.saving()?53:54),i(2),c(" ",r.saving()?r.i18n.t("common.saving"):r.i18n.t("roles.update_role")," ")}}function ge(o,t){if(o&1&&(s(0,"div",12),m(1,"i",54),a(2),l()),o&2){let e=p();i(2),c(" ",e.error()||e.i18n.t("roles.role_not_found")," ")}}var Y=class o{route=_(A);router=_(D);rolesService=_(X);fb=_(H);notificationService=_(Q);i18n=_(U);role=b(null);allPermissions=b([]);selectedPermissions=b(new Set);loading=b(!0);saving=b(!1);error=b("");permissionSearchTerm="";roleForm;ngOnInit(){this.initializeForm();let t=this.route.snapshot.paramMap.get("id");t?(this.loadPermissions(),this.loadRole(t)):(this.error.set("Invalid role ID"),this.loading.set(!1))}initializeForm(){this.roleForm=this.fb.group({name:["",[I.required,I.minLength(2)]]})}loadRole(t){this.rolesService.getRoleById(+t).subscribe({next:e=>{this.role.set(e),this.populateForm(e),this.loading.set(!1)},error:e=>{this.error.set(this.getErrorMessage(e)),this.loading.set(!1)}})}loadPermissions(){this.rolesService.getPermissions().subscribe({next:t=>{this.allPermissions.set(t)},error:t=>{console.error("Failed to load permissions:",t),this.allPermissions.set([]),this.notificationService.error(this.i18n.t("app.error"),"Failed to load permissions")}})}populateForm(t){this.roleForm.patchValue({name:t.name});let e=new Set(t.permissions.map(n=>n.id.toString()));this.selectedPermissions.set(e)}onSubmit(){if(this.roleForm.invalid){this.roleForm.markAllAsTouched();return}this.saving.set(!0),this.error.set("");let e={name:this.roleForm.value.name,permissionIds:Array.from(this.selectedPermissions()).map(n=>+n)};this.rolesService.updateRole(this.role().id,e).subscribe({next:()=>{this.saving.set(!1),this.notificationService.success(this.i18n.t("app.success"),"Role updated successfully"),this.router.navigate(["/roles",this.role().id,"view"])},error:n=>{this.saving.set(!1),this.error.set(this.getErrorMessage(n)),this.notificationService.error(this.i18n.t("app.error"),this.getErrorMessage(n))}})}onTogglePermission(t){let e=new Set(this.selectedPermissions()),n=t.id.toString();e.has(n)?e.delete(n):e.add(n),this.selectedPermissions.set(e)}selectAllPermissions(){let t=new Set(this.allPermissions().map(e=>e.id.toString()));this.selectedPermissions.set(t)}clearAllPermissions(){this.selectedPermissions.set(new Set)}isPermissionSelected(t){return this.selectedPermissions().has(t.toString())}getFilteredGroupedPermissions(){let t=this.allPermissions().filter(n=>!this.permissionSearchTerm||n.key.toLowerCase().includes(this.permissionSearchTerm.toLowerCase())||n.description.toLowerCase().includes(this.permissionSearchTerm.toLowerCase())),e=new Map;return t.forEach(n=>{let d=n.key.split(".")[0];e.has(d)||e.set(d,[]),e.get(d).push(n)}),Array.from(e.entries()).map(([n,d])=>({group:n,permissions:d}))}getPermissionIcon(t){return t.includes("read")?"fa-eye":t.includes("create")?"fa-plus":t.includes("update")?"fa-edit":t.includes("delete")?"fa-trash":"fa-key"}getPermissionResource(t){return t.split(".")[0]||t}getPermissionAction(t){return t.split(".")[1]||"unknown"}getActionBadgeClass(t){return t.includes("read")?"bg-info-subtle text-info":t.includes("create")?"bg-success-subtle text-success":t.includes("update")?"bg-warning-subtle text-warning":t.includes("delete")?"bg-danger-subtle text-danger":"bg-secondary-subtle text-secondary"}getPermissionDescription(t){return t.description||`${t.key} permission`}onCancel(){this.role()?this.router.navigate(["/roles",this.role().id,"view"]):this.router.navigate(["/roles"])}getFieldError(t){let e=this.roleForm.get(t);if(e?.errors&&e.touched){if(e.errors.required)return this.i18n.t("validation.required");if(e.errors.minlength)return this.i18n.t("validation.minlength").replace("{{min}}",e.errors.minlength.requiredLength)}return""}isFieldInvalid(t){let e=this.roleForm.get(t);return!!(e?.errors&&e.touched)}getErrorMessage(t){return t?.error?.error?t.error.error:this.i18n.t("errors.unknown")}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=P({type:o,selectors:[["app-edit-role"]],decls:21,vars:7,consts:[[1,"container-fluid"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/dashboard"],["routerLink","/roles"],[1,"breadcrumb-item","active"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"fa-solid","fa-arrow-left","me-2"],[1,"d-flex","justify-content-center","py-5"],[1,"card"],[1,"alert","alert-danger"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"card-header"],[1,"card-title","mb-0"],[1,"fa-solid","fa-user-shield","me-2"],[1,"card-body"],[3,"ngSubmit","formGroup"],["role","alert",1,"alert","alert-danger"],[1,"row","g-3"],[1,"col-md-6"],[1,"form-label"],[1,"text-danger"],["type","text","formControlName","name",1,"form-control",3,"placeholder","disabled"],[1,"invalid-feedback"],[1,"form-text","text-warning"],[1,"form-control-plaintext"],[1,"badge","bg-warning-subtle","text-warning"],[1,"badge","bg-success-subtle","text-success"],[1,"mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"mb-0"],[1,"fa-solid","fa-key","me-2"],["role","group",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],[1,"fa-solid","fa-check-double","me-1"],[1,"fa-solid","fa-times","me-1"],[1,"alert","alert-info","py-2","px-3","mb-3"],[1,"fa-solid","fa-info-circle","me-2"],[1,"mb-3"],[1,"input-group"],[1,"input-group-text"],[1,"fa-solid","fa-search"],["type","text",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions","placeholder","disabled"],[1,"permissions-list","border","rounded","p-3",2,"max-height","400px","overflow-y","auto"],[1,"permission-group","mb-4"],[1,"text-center","py-4"],[1,"d-flex","justify-content-end","gap-2","mt-4"],[1,"fa-solid","fa-times","me-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"fa-solid","fa-save","me-2"],[1,"fa-solid","fa-exclamation-triangle","me-2"],[1,"fa-solid","fa-shield-alt","me-1"],[1,"fa-solid","fa-user-cog","me-1"],[1,"fw-bold","text-primary","mb-3","border-bottom","pb-2"],[1,"fas","fa-layer-group","me-2"],[1,"text-muted","fw-normal"],[1,"row","g-2"],[1,"col-md-6","col-lg-4"],[1,"permission-item","border","rounded","p-2"],[1,"form-check","d-flex","align-items-start"],["type","checkbox",1,"form-check-input","mt-1",3,"change","id","checked","disabled"],[1,"form-check-content","ms-2","flex-grow-1"],[1,"d-flex","align-items-center","mb-1"],[1,"fas","me-1","text-muted",2,"font-size","0.75rem",3,"ngClass"],[1,"form-check-label","fw-medium","me-2",3,"for"],[1,"badge",2,"font-size","0.65rem",3,"ngClass"],[1,"text-muted","small","mb-0",2,"font-size","0.7rem","margin-left","1.25rem"],[1,"fa-solid","fa-key","fa-2x","text-muted","mb-2"],[1,"text-muted","mb-0"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"div",1)(2,"div")(3,"h2"),a(4),l(),s(5,"nav",2)(6,"ol",3)(7,"li",4)(8,"a",5),a(9),l()(),s(10,"li",4)(11,"a",6),a(12),l()(),s(13,"li",7),a(14),l()()()(),s(15,"button",8),C("click",function(){return n.onCancel()}),m(16,"i",9),a(17),l()(),f(18,ie,4,1,"div",10)(19,ue,56,32,"div",11)(20,ge,3,1,"div",12),l()),e&2&&(i(4),g(n.i18n.t("roles.edit_role")),i(5),g(n.i18n.t("dashboard.title")),i(3),g(n.i18n.t("roles.title")),i(2),g(n.i18n.t("roles.edit_role")),i(),u("disabled",n.saving()),i(2),c(" ",n.i18n.t("common.back")," "),i(),v(n.loading()?18:n.role()?19:20))},dependencies:[N,V,G,L,K,O,z,j,q,$,W,J,B],encapsulation:2})};export{Y as EditRoleComponent};
