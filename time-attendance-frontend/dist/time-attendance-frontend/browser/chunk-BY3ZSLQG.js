import{a as oe}from"./chunk-WOWRYADL.js";import{a as ie}from"./chunk-I575RJ3N.js";import{a as te}from"./chunk-W7QCIT7O.js";import"./chunk-MPEAAPTS.js";import"./chunk-Y62N6K5S.js";import{a as $}from"./chunk-EYAJMHM7.js";import{a as Y}from"./chunk-HHXRLUSQ.js";import"./chunk-TZ2XIVGW.js";import{a as ee}from"./chunk-SRPEDAT4.js";import{b as A,c as T,e as k,f as N,g as B,h as O,i as L,j,o as U,p as z,r as G,s as J,t as K,u as Q,x as X}from"./chunk-VRETN7JA.js";import{b as Z}from"./chunk-RCBJJ7UY.js";import{d as W,g as q,m as R}from"./chunk-TWXUAMJ4.js";import{$a as H,Bb as s,Cb as c,Db as P,Ea as F,H as S,I as w,Ib as p,Jb as _,Kb as h,R as g,W as d,X as x,Xa as v,Ya as E,ab as D,bb as y,cb as n,da as f,db as r,eb as C,f as b,lb as I,nb as M,pb as m,ta as i,wc as V}from"./chunk-JSQL33QG.js";import"./chunk-DGAILPFQ.js";var re=(l,t)=>t.id;function ae(l,t){l&1&&C(0,"app-loading-spinner")}function se(l,t){if(l&1&&(n(0,"option",10),s(1),r()),l&2){let e=t.$implicit;y("ngValue",e.id),i(),c(e.name)}}function le(l,t){if(l&1&&(n(0,"div",15),s(1),r()),l&2){let e=m(2);i(),c(e.validationErrors().maxPersonalExcusesPerMonth)}}function ce(l,t){if(l&1&&(n(0,"div",15),s(1),r()),l&2){let e=m(2);i(),c(e.validationErrors().maxPersonalExcuseHoursPerMonth)}}function me(l,t){if(l&1&&(n(0,"div",15),s(1),r()),l&2){let e=m(2);i(),c(e.validationErrors().maxPersonalExcuseHoursPerDay)}}function ue(l,t){if(l&1&&(n(0,"div",15),s(1),r()),l&2){let e=m(2);i(),c(e.validationErrors().maxHoursPerExcuse)}}function de(l,t){if(l&1&&(n(0,"div",15),s(1),r()),l&2){let e=m(2);i(),c(e.validationErrors().minimumExcuseDuration)}}function xe(l,t){l&1&&C(0,"span",40)}function pe(l,t){if(l&1){let e=I();C(0,"app-form-header",2),n(1,"form",3,0),M("ngSubmit",function(){d(e);let o=m();return x(o.onSubmit())}),n(3,"div",4)(4,"div",5)(5,"app-form-section",6)(6,"div",7)(7,"label",8),s(8),r(),n(9,"select",9),h("ngModelChange",function(o){d(e);let a=m();return _(a.policyForm.branchId,o)||(a.policyForm.branchId=o),x(o)}),n(10,"option",10),s(11),r(),H(12,se,2,2,"option",10,re),r(),n(14,"div",11),s(15),r()()()(),n(16,"div",12)(17,"app-form-section",6)(18,"div",7)(19,"label",13),s(20),r(),n(21,"input",14),h("ngModelChange",function(o){d(e);let a=m();return _(a.policyForm.maxPersonalExcusesPerMonth,o)||(a.policyForm.maxPersonalExcusesPerMonth=o),x(o)}),r(),v(22,le,2,1,"div",15),n(23,"div",11),s(24),r()(),n(25,"div",7)(26,"label",16),s(27),r(),n(28,"input",17),h("ngModelChange",function(o){d(e);let a=m();return _(a.policyForm.maxPersonalExcuseHoursPerMonth,o)||(a.policyForm.maxPersonalExcuseHoursPerMonth=o),x(o)}),r(),v(29,ce,2,1,"div",15),n(30,"div",11),s(31),r()()()(),n(32,"div",12)(33,"app-form-section",6)(34,"div",7)(35,"label",18),s(36),r(),n(37,"input",19),h("ngModelChange",function(o){d(e);let a=m();return _(a.policyForm.maxPersonalExcuseHoursPerDay,o)||(a.policyForm.maxPersonalExcuseHoursPerDay=o),x(o)}),r(),v(38,me,2,1,"div",15),n(39,"div",11),s(40),r()(),n(41,"div",7)(42,"label",20),s(43),r(),n(44,"input",21),h("ngModelChange",function(o){d(e);let a=m();return _(a.policyForm.maxHoursPerExcuse,o)||(a.policyForm.maxHoursPerExcuse=o),x(o)}),r(),v(45,ue,2,1,"div",15),n(46,"div",11),s(47),r()(),n(48,"div",7)(49,"label",22),s(50),r(),n(51,"input",23),h("ngModelChange",function(o){d(e);let a=m();return _(a.policyForm.minimumExcuseDuration,o)||(a.policyForm.minimumExcuseDuration=o),x(o)}),r(),v(52,de,2,1,"div",15),n(53,"div",11),s(54),r()()()(),n(55,"div",5)(56,"app-form-section",6)(57,"div",4)(58,"div",24)(59,"div",25)(60,"input",26),h("ngModelChange",function(o){d(e);let a=m();return _(a.policyForm.requiresApproval,o)||(a.policyForm.requiresApproval=o),x(o)}),r(),n(61,"label",27),s(62),r()(),n(63,"div",11),s(64),r()(),n(65,"div",24)(66,"div",25)(67,"input",28),h("ngModelChange",function(o){d(e);let a=m();return _(a.policyForm.allowPartialHourExcuses,o)||(a.policyForm.allowPartialHourExcuses=o),x(o)}),r(),n(68,"label",29),s(69),r()(),n(70,"div",11),s(71),r()(),n(72,"div",24)(73,"div",25)(74,"input",30),h("ngModelChange",function(o){d(e);let a=m();return _(a.policyForm.allowSelfServiceRequests,o)||(a.policyForm.allowSelfServiceRequests=o),x(o)}),r(),n(75,"label",31),s(76),r()(),n(77,"div",11),s(78),r()(),n(79,"div",24)(80,"label",32),s(81),r(),n(82,"input",33),h("ngModelChange",function(o){d(e);let a=m();return _(a.policyForm.maxRetroactiveDays,o)||(a.policyForm.maxRetroactiveDays=o),x(o)}),r(),n(83,"div",11),s(84),r()(),n(85,"div",24)(86,"div",25)(87,"input",34),h("ngModelChange",function(o){d(e);let a=m();return _(a.policyForm.isActive,o)||(a.policyForm.isActive=o),x(o)}),r(),n(88,"label",35),s(89),r()(),n(90,"div",11),s(91),r()()()()(),n(92,"div",36)(93,"div",37)(94,"button",38),M("click",function(){d(e);let o=m();return x(o.onCancel())}),s(95),r(),n(96,"button",39),v(97,xe,1,0,"span",40),s(98),r()()()()()}if(l&2){let e=m();y("title",e.t("excuse_policies.edit_policy"))("entityId",e.policyId()??void 0),i(5),y("title",e.t("excuse_policies.scope_configuration")),i(3),c(e.t("excuse_policies.branch")),i(),p("ngModel",e.policyForm.branchId),i(),y("ngValue",null),i(),c(e.t("excuse_policies.organization_wide")),i(),D(e.branches()),i(3),c(e.t("excuse_policies.branch_help")),i(2),y("title",e.t("excuse_policies.monthly_limits")),i(3),c(e.t("excuse_policies.max_personal_excuses_per_month")),i(),p("ngModel",e.policyForm.maxPersonalExcusesPerMonth),i(),E(e.validationErrors().maxPersonalExcusesPerMonth?22:-1),i(2),c(e.t("excuse_policies.max_excuses_month_help")),i(3),c(e.t("excuse_policies.max_personal_excuse_hours_per_month")),i(),p("ngModel",e.policyForm.maxPersonalExcuseHoursPerMonth),i(),E(e.validationErrors().maxPersonalExcuseHoursPerMonth?29:-1),i(2),c(e.t("excuse_policies.max_hours_month_help")),i(2),y("title",e.t("excuse_policies.time_limits")),i(3),c(e.t("excuse_policies.max_personal_excuse_hours_per_day")),i(),p("ngModel",e.policyForm.maxPersonalExcuseHoursPerDay),i(),E(e.validationErrors().maxPersonalExcuseHoursPerDay?38:-1),i(2),c(e.t("excuse_policies.max_hours_day_help")),i(3),c(e.t("excuse_policies.max_hours_per_excuse")),i(),p("ngModel",e.policyForm.maxHoursPerExcuse),i(),E(e.validationErrors().maxHoursPerExcuse?45:-1),i(2),c(e.t("excuse_policies.max_hours_per_excuse_help")),i(3),c(e.t("excuse_policies.minimum_duration")),i(),p("ngModel",e.policyForm.minimumExcuseDuration),i(),E(e.validationErrors().minimumExcuseDuration?52:-1),i(2),c(e.t("excuse_policies.minimum_duration_help")),i(2),y("title",e.t("excuse_policies.policy_options")),i(4),p("ngModel",e.policyForm.requiresApproval),i(2),P(" ",e.t("excuse_policies.requires_approval")," "),i(2),c(e.t("excuse_policies.requires_approval_help")),i(3),p("ngModel",e.policyForm.allowPartialHourExcuses),i(2),P(" ",e.t("excuse_policies.allow_partial_hours")," "),i(2),c(e.t("excuse_policies.allow_partial_hours_help")),i(3),p("ngModel",e.policyForm.allowSelfServiceRequests),i(2),P(" ",e.t("excuse_policies.allow_self_service")," "),i(2),c(e.t("excuse_policies.allow_self_service_help")),i(3),c(e.t("excuse_policies.max_retroactive_days")),i(),p("ngModel",e.policyForm.maxRetroactiveDays),i(2),c(e.t("excuse_policies.max_retroactive_days_help")),i(3),p("ngModel",e.policyForm.isActive),i(2),P(" ",e.t("excuse_policies.is_active")," "),i(2),c(e.t("excuse_policies.is_active_help")),i(3),y("disabled",e.submitting()),i(),P(" ",e.t("common.cancel")," "),i(),y("disabled",e.submitting()),i(),E(e.submitting()?97:-1),i(),P(" ",e.t("common.save")," ")}}var ne=class l{excusePoliciesService=g(oe);branchesService=g(te);router=g(q);route=g(W);notificationService=g(Y);destroy$=new b;i18n=g(Z);loading=f(!1);submitting=f(!1);branches=f([]);policyId=f(null);policyForm={id:0,branchId:null,maxPersonalExcusesPerMonth:5,maxPersonalExcuseHoursPerMonth:8,maxPersonalExcuseHoursPerDay:4,maxHoursPerExcuse:2,requiresApproval:!0,allowPartialHourExcuses:!0,minimumExcuseDuration:.5,maxRetroactiveDays:7,allowSelfServiceRequests:!0,isActive:!0};validationErrors=f({});ngOnInit(){this.loadBranches(),this.loadPolicy()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}t(t){return this.i18n.t(t)}loadBranches(){this.branchesService.getBranches(1,1e3).subscribe({next:t=>{this.branches.set(t.items)},error:t=>{console.error("Failed to load branches:",t)}})}loadPolicy(){this.loading.set(!0),this.route.paramMap.pipe(w(this.destroy$),S(t=>{let e=Number(t.get("id"));if(!e||e<=0)throw this.notificationService.error(this.t("app.error"),this.t("excuse_policies.errors.load_failed")),this.router.navigate(["/settings/excuse-policies"]),new Error("Invalid excuse policy ID");return this.policyId.set(e),this.excusePoliciesService.getExcusePolicyById(e)})).subscribe({next:t=>{this.loading.set(!1),this.policyForm={id:t.id,branchId:t.branchId,maxPersonalExcusesPerMonth:t.maxPersonalExcusesPerMonth,maxPersonalExcuseHoursPerMonth:t.maxPersonalExcuseHoursPerMonth,maxPersonalExcuseHoursPerDay:t.maxPersonalExcuseHoursPerDay,maxHoursPerExcuse:t.maxHoursPerExcuse,requiresApproval:t.requiresApproval,allowPartialHourExcuses:t.allowPartialHourExcuses,minimumExcuseDuration:t.minimumExcuseDuration,maxRetroactiveDays:t.maxRetroactiveDays,allowSelfServiceRequests:t.allowSelfServiceRequests,isActive:t.isActive}},error:t=>{this.loading.set(!1),console.error("Failed to load excuse policy:",t),this.notificationService.error(this.t("app.error"),this.t("excuse_policies.errors.load_failed")),this.router.navigate(["/settings/excuse-policies"])}})}validateForm(){let t={};return(this.policyForm.maxPersonalExcusesPerMonth<=0||this.policyForm.maxPersonalExcusesPerMonth>100)&&(t.maxPersonalExcusesPerMonth=this.t("excuse_policies.validation.excusesPerMonthRange")),(this.policyForm.maxPersonalExcuseHoursPerMonth<=0||this.policyForm.maxPersonalExcuseHoursPerMonth>744)&&(t.maxPersonalExcuseHoursPerMonth=this.t("excuse_policies.validation.hoursPerMonthRange")),(this.policyForm.maxPersonalExcuseHoursPerDay<=0||this.policyForm.maxPersonalExcuseHoursPerDay>24)&&(t.maxPersonalExcuseHoursPerDay=this.t("excuse_policies.validation.hoursPerDayRange")),this.policyForm.maxHoursPerExcuse<=0&&(t.maxHoursPerExcuse=this.t("validation.min")),this.policyForm.minimumExcuseDuration<=0&&(t.minimumExcuseDuration=this.t("validation.min")),this.policyForm.maxPersonalExcuseHoursPerDay>this.policyForm.maxPersonalExcuseHoursPerMonth&&(t.maxPersonalExcuseHoursPerDay=this.t("excuse_policies.validation.dailyExceedsMonthly")),this.policyForm.maxHoursPerExcuse>this.policyForm.maxPersonalExcuseHoursPerDay&&(t.maxHoursPerExcuse=this.t("excuse_policies.validation.excuseExceedsDaily")),this.policyForm.minimumExcuseDuration>this.policyForm.maxHoursPerExcuse&&(t.minimumExcuseDuration=this.t("excuse_policies.validation.minimumExceedsMaximum")),this.validationErrors.set(t),Object.keys(t).length===0}onSubmit(){if(!this.validateForm()){this.notificationService.error(this.t("app.error"),this.t("excuse_policies.validation.pleaseFix"));return}this.submitting.set(!0);let t={id:this.policyForm.id,branchId:this.policyForm.branchId,maxPersonalExcusesPerMonth:this.policyForm.maxPersonalExcusesPerMonth,maxPersonalExcuseHoursPerMonth:this.policyForm.maxPersonalExcuseHoursPerMonth,maxPersonalExcuseHoursPerDay:this.policyForm.maxPersonalExcuseHoursPerDay,maxHoursPerExcuse:this.policyForm.maxHoursPerExcuse,requiresApproval:this.policyForm.requiresApproval,allowPartialHourExcuses:this.policyForm.allowPartialHourExcuses,minimumExcuseDuration:this.policyForm.minimumExcuseDuration,maxRetroactiveDays:this.policyForm.maxRetroactiveDays,allowSelfServiceRequests:this.policyForm.allowSelfServiceRequests,isActive:this.policyForm.isActive};this.excusePoliciesService.updateExcusePolicy(this.policyForm.id,t).subscribe({next:()=>{this.submitting.set(!1),this.notificationService.success(this.t("app.success"),this.t("excuse_policies.update_success")),this.router.navigate(["/settings/excuse-policies",this.policyForm.id,"view"])},error:e=>{this.submitting.set(!1),console.error("Failed to update excuse policy:",e);let u=this.t("excuse_policies.update_error");e?.error?.error?u=e.error.error:e?.message&&(u=e.message),this.notificationService.error(this.t("app.error"),u)}})}onCancel(){this.router.navigate(["/settings/excuse-policies",this.policyForm.id,"view"])}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=F({type:l,selectors:[["app-edit-excuse-policy"]],decls:3,vars:2,consts:[["policyFormRef","ngForm"],[1,"container-fluid"],["mode","edit","moduleName","excuse_policies","moduleRoute","settings/excuse-policies",3,"title","entityId"],[3,"ngSubmit"],[1,"row"],[1,"col-md-12","mb-4"],[3,"title"],[1,"mb-3"],["for","branchId",1,"form-label"],["id","branchId","name","branchId",1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"form-text"],[1,"col-md-6","mb-4"],["for","maxExcusesMonth",1,"form-label"],["type","number","id","maxExcusesMonth","name","maxExcusesMonth","min","1","max","100","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-danger","small","mt-1"],["for","maxHoursMonth",1,"form-label"],["type","number","id","maxHoursMonth","name","maxHoursMonth","min","0.5","step","0.5","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","maxHoursDay",1,"form-label"],["type","number","id","maxHoursDay","name","maxHoursDay","min","0.5","step","0.5","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","maxHoursPerExcuse",1,"form-label"],["type","number","id","maxHoursPerExcuse","name","maxHoursPerExcuse","min","0.5","step","0.5","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","minimumDuration",1,"form-label"],["type","number","id","minimumDuration","name","minimumDuration","min","0.5","step","0.5","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-6","mb-3"],[1,"form-check","form-switch"],["type","checkbox","id","requiresApproval","name","requiresApproval",1,"form-check-input",3,"ngModelChange","ngModel"],["for","requiresApproval",1,"form-check-label"],["type","checkbox","id","allowPartialHours","name","allowPartialHours",1,"form-check-input",3,"ngModelChange","ngModel"],["for","allowPartialHours",1,"form-check-label"],["type","checkbox","id","allowSelfService","name","allowSelfService",1,"form-check-input",3,"ngModelChange","ngModel"],["for","allowSelfService",1,"form-check-label"],["for","maxRetroactiveDays",1,"form-label"],["type","number","id","maxRetroactiveDays","name","maxRetroactiveDays","min","0","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","checkbox","id","isActive","name","isActive",1,"form-check-input",3,"ngModelChange","ngModel"],["for","isActive",1,"form-check-label"],[1,"col-12"],[1,"d-flex","justify-content-end","gap-2"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"]],template:function(e,u){e&1&&(n(0,"div",1),v(1,ae,1,0,"app-loading-spinner"),v(2,pe,99,51),r()),e&2&&(i(),E(u.loading()?1:-1),i(),E(u.loading()?-1:2))},dependencies:[V,X,L,z,G,T,j,A,U,k,N,Q,K,J,O,B,R,ie,ee,$],styles:[".container-fluid[_ngcontent-%COMP%]{padding:1.5rem}.card[_ngcontent-%COMP%]{border:1px solid #dee2e6;box-shadow:0 .125rem .25rem #00000013}.card-header[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:.75rem 1rem}.card-header[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-weight:600;color:#495057}@media (max-width: 768px){.container-fluid[_ngcontent-%COMP%]{padding:1rem}}"]})};export{ne as EditExcusePolicyComponent};
