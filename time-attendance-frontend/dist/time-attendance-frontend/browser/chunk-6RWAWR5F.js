import{a as v}from"./chunk-HUSARQNL.js";import{a as u}from"./chunk-3VZ5QHEY.js";import{B as o,Bc as d,Cc as b,J as n,M as E,Q as x,c as y,da as p,j as i,x as a}from"./chunk-JSQL33QG.js";import{a as h,b as g}from"./chunk-DGAILPFQ.js";var f=class m{constructor(e){this.http=e}apiUrl=`${u.apiUrl}/api/v1/employee-excuses`;employeeExcuses=p([]);pagedResult=p(null);statistics=p(null);loading=p(!1);error=p(null);getEmployeeExcuses(e={}){this.loading.set(!0),this.error.set(null);let t=new d;return e.page&&(t=t.set("pageNumber",e.page.toString())),e.pageSize&&(t=t.set("pageSize",e.pageSize.toString())),e.employeeId&&(t=t.set("employeeId",e.employeeId.toString())),e.branchId&&(t=t.set("branchId",e.branchId.toString())),e.status&&(t=t.set("approvalStatus",e.status)),e.fromDate&&(t=t.set("startDate",e.fromDate)),e.toDate&&(t=t.set("endDate",e.toDate)),this.http.get(this.apiUrl,{params:t}).pipe(n(s=>{let r=s.isSuccess?s.value:{items:[],totalCount:0,pageNumber:1,pageSize:10,totalPages:0},c=(r.items||[]).map(l=>g(h({},l),{status:this.mapApprovalStatusToExcuseStatus(l.approvalStatus||l.approvalStatusDisplay),submissionDate:l.createdAtUtc,departmentName:l.departmentName||"",branchName:l.branchName||""}));this.employeeExcuses.set(c),this.pagedResult.set({items:c,totalCount:r.totalCount||0,page:r.pageNumber||1,pageSize:r.pageSize||10,totalPages:r.totalPages||0})}),a(s=>(this.error.set("Failed to load employee excuses"),console.error("Error loading employee excuses:",s),i({items:[],totalCount:0,page:1,pageSize:10,totalPages:0}))),o(()=>this.loading.set(!1)))}getEmployeeExcuseById(e){return this.loading.set(!0),this.error.set(null),new y(t=>{this.http.get(`${this.apiUrl}/${e}`).pipe(a(s=>(this.error.set("Failed to load employee excuse details"),console.error("Error loading employee excuse:",s),t.next(null),t.complete(),i(null))),o(()=>this.loading.set(!1))).subscribe(s=>{if(s&&s.isSuccess&&s.value){let r=s.value,c={id:r.id,employeeId:r.employeeId,employeeName:r.employeeName||"",employeeNumber:r.employeeNumber||"",departmentName:r.departmentName||"",branchName:r.branchName||"",excuseDate:r.excuseDate,excuseType:r.excuseType,startTime:r.startTime,endTime:r.endTime,durationHours:r.durationHours||0,reason:r.reason||"",status:this.mapApprovalStatusToExcuseStatus(r.approvalStatus||r.approvalStatusDisplay),submissionDate:r.createdAtUtc,reviewDate:r.reviewedAtUtc,reviewerId:r.reviewedByUserId,reviewerName:r.reviewerName,reviewerComments:r.reviewerComments,attachmentUrl:r.attachmentUrl,isWithinPolicy:!0,policyViolationReason:void 0};t.next(c)}else t.next(null);t.complete()})})}createEmployeeExcuse(e){this.loading.set(!0),this.error.set(null);let t=new FormData;return t.append("employeeId",e.employeeId.toString()),t.append("excuseDate",e.excuseDate),t.append("startTime",e.startTime),t.append("endTime",e.endTime),t.append("reason",e.reason),t.append("excuseType",e.excuseType||"PersonalExcuse"),e.attachmentFile&&t.append("attachmentFile",e.attachmentFile),this.http.post(this.apiUrl,t).pipe(n(()=>{this.refreshCurrentList()}),a(s=>{throw this.error.set("Failed to create employee excuse request"),console.error("Error creating employee excuse:",s),s}),o(()=>this.loading.set(!1)))}updateEmployeeExcuse(e,t){this.loading.set(!0),this.error.set(null);let s=new FormData;return s.append("excuseDate",t.excuseDate),s.append("excuseType",t.excuseType||"PersonalExcuse"),s.append("startTime",t.startTime),s.append("endTime",t.endTime),s.append("reason",t.reason),s.append("approvalStatus",t.approvalStatus||"Pending"),t.reviewerComments&&s.append("reviewerComments",t.reviewerComments),t.attachmentFile&&s.append("attachmentFile",t.attachmentFile),this.http.put(`${this.apiUrl}/${e}`,s).pipe(n(()=>{this.refreshCurrentList()}),a(r=>{throw this.error.set("Failed to update employee excuse request"),console.error("Error updating employee excuse:",r),r}),o(()=>this.loading.set(!1)))}reviewEmployeeExcuse(e,t){return this.loading.set(!0),this.error.set(null),this.http.post(`${this.apiUrl}/${e}/review`,t).pipe(n(()=>{this.refreshCurrentList()}),a(s=>{throw this.error.set("Failed to review employee excuse"),console.error("Error reviewing employee excuse:",s),s}),o(()=>this.loading.set(!1)))}cancelEmployeeExcuse(e){return this.loading.set(!0),this.error.set(null),this.http.delete(`${this.apiUrl}/${e}`).pipe(n(()=>{this.refreshCurrentList()}),a(t=>{throw this.error.set("Failed to cancel employee excuse"),console.error("Error cancelling employee excuse:",t),t}),o(()=>this.loading.set(!1)))}getEmployeeExcuseStatistics(e){this.loading.set(!0),this.error.set(null);let t=new d;return e&&(t=t.set("employeeId",e.toString())),this.http.get(`${this.apiUrl}/statistics`,{params:t}).pipe(n(s=>{this.statistics.set(s)}),a(s=>(this.error.set("Failed to load employee excuse statistics"),console.error("Error loading statistics:",s),i({totalRequests:0,pendingRequests:0,approvedRequests:0,rejectedRequests:0,currentMonthHours:0,remainingMonthlyHours:0,monthlyLimit:0}))),o(()=>this.loading.set(!1)))}downloadAttachment(e){return this.http.get(`${this.apiUrl}/${e}/attachment`,{responseType:"blob"}).pipe(a(t=>{throw this.error.set("Failed to download attachment"),console.error("Error downloading attachment:",t),t}))}getExcuseStatuses(){return Object.values(v)}refreshCurrentList(){let e=this.pagedResult();e?this.getEmployeeExcuses({page:e.page,pageSize:e.pageSize}).subscribe():this.getEmployeeExcuses({page:1,pageSize:10}).subscribe()}getEmployeesDropdown(){return this.http.get(`${u.apiUrl}/api/v1/employees/dropdown`).pipe(a(e=>(console.error("Error loading employees dropdown:",e),i([]))))}getDepartmentsDropdown(){return this.http.get(`${u.apiUrl}/api/v1/departments/dropdown`).pipe(a(e=>(console.error("Error loading departments dropdown:",e),i([]))))}getBranchesDropdown(){return this.http.get(`${u.apiUrl}/api/v1/branches/dropdown`).pipe(a(e=>(console.error("Error loading branches dropdown:",e),i([]))))}validateExcuse(e){this.loading.set(!0),this.error.set(null);let t={EmployeeId:e.employeeId,ExcuseDate:e.excuseDate,ExcuseType:e.excuseType,StartTime:e.startTime,EndTime:e.endTime};return this.http.post(`${this.apiUrl}/validate`,t).pipe(a(s=>{throw this.error.set("Failed to validate excuse request"),console.error("Error validating excuse:",s),s}),o(()=>this.loading.set(!1)))}mapApprovalStatusToExcuseStatus(e){switch(typeof e=="string"?e:String(e)){case"1":case"Pending":return"Pending";case"2":case"Approved":return"Approved";case"3":case"Rejected":return"Rejected";case"4":case"Cancelled":return"Cancelled";default:return"Pending"}}clearState(){this.employeeExcuses.set([]),this.pagedResult.set(null),this.statistics.set(null),this.loading.set(!1),this.error.set(null)}static \u0275fac=function(t){return new(t||m)(x(b))};static \u0275prov=E({token:m,factory:m.\u0275fac,providedIn:"root"})};export{f as a};
