import{c as T,d as D,e as V,f as z,i as A,m as U,n as j,w as L,x as G,y as $}from"./chunk-VRETN7JA.js";import{a as H}from"./chunk-ANEZOAXP.js";import{a as R}from"./chunk-UBCI4X5Q.js";import{a as B}from"./chunk-EYAJMHM7.js";import"./chunk-HHXRLUSQ.js";import{b as k}from"./chunk-S3CAEY4A.js";import{b as q}from"./chunk-TJ2U7DWW.js";import{g as N}from"./chunk-TWXUAMJ4.js";import{$a as x,Ab as E,Bb as l,Cb as p,Db as u,Ea as F,R as b,W as y,X as C,Xa as f,Ya as _,Yb as S,ab as P,bb as s,cb as r,da as I,db as o,eb as m,lb as h,nb as g,pb as c,ra as w,ta as i,wc as O,yb as M}from"./chunk-JSQL33QG.js";import"./chunk-DGAILPFQ.js";var J=(n,e)=>e.section,K=(n,e)=>e.label;function Q(n,e){if(n&1){let t=h();r(0,"button",10),g("click",function(){y(t);let a=c();return C(a.toggleEditMode())}),m(1,"i",11),l(2),o()}if(n&2){let t=c();s("disabled",t.loading()),i(2),u(" ",t.i18n.t("common.edit")," ")}}function W(n,e){if(n&1&&m(0,"app-loading-spinner",7),n&2){let t=c();s("message",t.i18n.t("common.loading"))}}function X(n,e){if(n&1){let t=h();r(0,"div",8),m(1,"i",12),l(2),r(3,"button",13),g("click",function(){y(t);let a=c();return C(a.refresh())}),l(4),o()()}if(n&2){let t=c();i(2),u(" ",t.error()," "),i(2),u(" ",t.i18n.t("common.retry")," ")}}function Z(n,e){if(n&1&&m(0,"img",18),n&2){let t=c(2);s("src",t.profile().photoUrl,w)}}function ee(n,e){n&1&&(r(0,"div",19),m(1,"i",30),o())}function te(n,e){if(n&1&&(r(0,"span",26),m(1,"i",31),l(2),o()),n&2){let t=c(2);i(2),u(" ",t.i18n.t("common.active")," ")}}function ie(n,e){if(n&1&&(r(0,"span",27),m(1,"i",31),l(2),o()),n&2){let t=c(2);i(2),u(" ",t.i18n.t("common.inactive")," ")}}function ne(n,e){if(n&1&&(r(0,"span"),l(1),o()),n&2){let t=c().$implicit;E(t.badgeClass),i(),p(t.value)}}function oe(n,e){if(n&1&&(r(0,"div",43),l(1),o()),n&2){let t=c().$implicit;i(),p(t.value)}}function ae(n,e){if(n&1&&(r(0,"div",37)(1,"div",38)(2,"div",39),m(3,"i"),o(),r(4,"div",40)(5,"label",41),l(6),o(),f(7,ne,2,3,"span",42)(8,oe,2,1,"div",43),o()()()),n&2){let t=e.$implicit;i(3),E("fa-solid "+t.icon),i(3),p(t.label),i(),_(t.badgeClass?7:8)}}function re(n,e){if(n&1&&(r(0,"div",32)(1,"div",33)(2,"h5",34),l(3),o()(),r(4,"div",35)(5,"div",36),x(6,ae,9,4,"div",37,K),o()()()),n&2){let t=e.$implicit;i(3),p(t.section),i(3),P(t.fields)}}function le(n,e){if(n&1&&x(0,re,8,1,"div",32,J),n&2){let t=c(2);P(t.displayFields())}}function de(n,e){if(n&1&&(r(0,"div",49),l(1),o()),n&2){let t=c(3);i(),p(t.getFieldError("email"))}}function me(n,e){if(n&1){let t=h();r(0,"div",29)(1,"div",33)(2,"h5",34),m(3,"i",44),l(4),o()(),r(5,"div",35)(6,"form",45),g("ngSubmit",function(){y(t);let a=c(2);return C(a.saveProfile())}),r(7,"div",36)(8,"div",37)(9,"label",46),l(10),o(),m(11,"input",47),o(),r(12,"div",37)(13,"label",46),l(14),o(),m(15,"input",48),f(16,de,2,1,"div",49),o(),r(17,"div",37)(18,"label",46),l(19),o(),m(20,"input",50),o(),r(21,"div",37)(22,"label",46),l(23),o(),m(24,"input",51),o(),r(25,"div",37)(26,"label",46),l(27),o(),m(28,"input",52),o(),r(29,"div",37)(30,"label",46),l(31),o(),m(32,"input",53),o()(),r(33,"div",54)(34,"button",55),g("click",function(){y(t);let a=c(2);return C(a.toggleEditMode())}),m(35,"i",56),l(36),o(),r(37,"button",57),m(38,"i",58),l(39),o()()()()()}if(n&2){let t,d,a=c(2);i(4),u(" ",a.i18n.t("common.edit_profile")," "),i(2),s("formGroup",a.editForm),i(4),p(a.i18n.t("common.phone")),i(),s("placeholder",a.i18n.t("common.phone")),i(3),p(a.i18n.t("common.email")),i(),M("is-invalid",((t=a.editForm.get("email"))==null?null:t.invalid)&&((t=a.editForm.get("email"))==null?null:t.touched)),s("placeholder",a.i18n.t("common.email")),i(),_((d=a.editForm.get("email"))!=null&&d.invalid&&((d=a.editForm.get("email"))!=null&&d.touched)?16:-1),i(3),p(a.i18n.t("common.display_name")),i(),s("placeholder",a.i18n.t("common.display_name")),i(3),p(a.i18n.t("common.address")),i(),s("placeholder",a.i18n.t("common.address")),i(3),p(a.i18n.t("common.emergency_contact")),i(),s("placeholder",a.i18n.t("common.emergency_contact")),i(3),p(a.i18n.t("common.emergency_phone")),i(),s("placeholder",a.i18n.t("common.emergency_phone")),i(2),s("disabled",a.loading()),i(2),u(" ",a.i18n.t("common.cancel")," "),i(),s("disabled",a.loading()||a.editForm.invalid),i(2),u(" ",a.i18n.t("common.save")," ")}}function ce(n,e){if(n&1&&(r(0,"div",9)(1,"div",14)(2,"div",15)(3,"div",16)(4,"div",17),f(5,Z,1,1,"img",18)(6,ee,2,0,"div",19),o(),r(7,"h4",20),l(8),o(),r(9,"p",21),l(10),o(),r(11,"div",22)(12,"div",23),m(13,"i",24),r(14,"span"),l(15),o()(),r(16,"div",23),m(17,"i",25),r(18,"span"),l(19),o()(),r(20,"div",23),f(21,te,3,1,"span",26)(22,ie,3,1,"span",27),o()()()()(),r(23,"div",28),f(24,le,2,0),f(25,me,40,21,"div",29),o()()),n&2){let t,d,a,v=c();i(5),_(v.profile().photoUrl?5:6),i(3),p(v.profile().displayName||v.profile().userName),i(2),p(((t=v.profile().employeeInfo)==null?null:t.position)||"Employee"),i(5),p(((d=v.profile().employeeInfo)==null?null:d.department)||"N/A"),i(4),p(((a=v.profile().employeeInfo)==null?null:a.branch)||"N/A"),i(2),_(v.profile().isActive?21:22),i(3),_(v.isEditMode()?-1:24),i(),_(v.isEditMode()?25:-1)}}var Y=class n{portalService=b(H);authService=b(k);router=b(N);fb=b(L);i18n=b(q);profile=this.portalService.myProfile;loading=this.portalService.myProfileLoading;error=this.portalService.myProfileError;currentUser=S(()=>this.authService.currentUser());isEditMode=I(!1);editForm;displayFields=S(()=>{let e=this.profile();return e?[{section:"Personal Information",fields:[{label:"Username",value:e.userName||"-",icon:"fa-user"},{label:"Email",value:e.email||"-",icon:"fa-envelope"},{label:"Phone",value:e.phoneNumber||"-",icon:"fa-phone"},{label:"Display Name",value:e.displayName||"-",icon:"fa-id-card"}]},{section:"Employee Information",fields:[{label:"Employee Code",value:e.employeeInfo?.employeeCode||"-",icon:"fa-id-badge"},{label:"Full Name",value:e.employeeInfo?.fullName||"-",icon:"fa-user-circle"},{label:"Department",value:e.employeeInfo?.department||"-",icon:"fa-building"},{label:"Branch",value:e.employeeInfo?.branch||"-",icon:"fa-map-marker-alt"},{label:"Position",value:e.employeeInfo?.position||"-",icon:"fa-briefcase"},{label:"Hire Date",value:e.employeeInfo?.hireDate?this.formatDate(e.employeeInfo.hireDate):"-",icon:"fa-calendar"}]},{section:"Account Information",fields:[{label:"Status",value:e.isActive?"Active":"Inactive",icon:"fa-circle",badgeClass:e.isActive?"badge bg-success":"badge bg-danger"},{label:"Roles",value:e.roles?.join(", ")||"-",icon:"fa-shield-alt"},{label:"Created",value:this.formatDate(e.createdAtUtc),icon:"fa-clock"},{label:"Last Login",value:e.lastLoginAtUtc?this.formatDate(e.lastLoginAtUtc):"Never",icon:"fa-sign-in-alt"}]}]:[]});ngOnInit(){this.initializeForm(),this.loadProfile()}ngOnDestroy(){this.portalService.clearMyProfile()}initializeForm(){this.editForm=this.fb.group({phoneNumber:[""],email:["",[D.email]],displayName:[""],address:[""],emergencyContact:[""],emergencyPhone:[""]})}loadProfile(){this.portalService.loadMyProfile().subscribe({next:()=>{let e=this.profile();e&&this.editForm.patchValue({phoneNumber:e.phoneNumber||"",email:e.email||"",displayName:e.displayName||"",address:e.employeeInfo?.address||"",emergencyContact:e.employeeInfo?.emergencyContact||"",emergencyPhone:e.employeeInfo?.emergencyPhone||""})},error:e=>{console.error("Failed to load profile:",e)}})}refresh(){this.loadProfile()}toggleEditMode(){this.isEditMode()?(this.isEditMode.set(!1),this.loadProfile()):this.isEditMode.set(!0)}saveProfile(){if(this.editForm.valid){let e=this.editForm.value;this.portalService.updateMyProfile(e).subscribe({next:()=>{this.isEditMode.set(!1)},error:t=>{console.error("Failed to update profile:",t)}})}else Object.keys(this.editForm.controls).forEach(e=>{this.editForm.get(e)?.markAsTouched()})}changePassword(){this.router.navigate(["/auth/change-password"])}formatDate(e){return(typeof e=="string"?new Date(e):e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}getFieldError(e){let t=this.editForm.get(e);return t?.hasError("required")?"This field is required":t?.hasError("email")?"Invalid email format":""}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=F({type:n,selectors:[["app-my-profile"]],decls:12,vars:10,consts:[[3,"title"],["header-actions",""],["type","button",1,"btn","btn-outline-secondary","btn-sm","me-2",3,"click"],[1,"fa-solid","fa-key","me-1"],["type","button",1,"btn","btn-primary","btn-sm","me-2",3,"disabled"],["type","button",1,"btn","btn-outline-primary","btn-sm",3,"click","disabled"],[1,"fa-solid","fa-sync-alt"],[3,"message"],["role","alert",1,"alert","alert-danger"],[1,"row","g-4"],["type","button",1,"btn","btn-primary","btn-sm","me-2",3,"click","disabled"],[1,"fa-solid","fa-edit","me-1"],[1,"fa-solid","fa-exclamation-triangle","me-2"],["type","button",1,"btn","btn-sm","btn-outline-danger","ms-3",3,"click"],[1,"col-lg-4"],[1,"card","profile-card"],[1,"card-body","text-center"],[1,"profile-photo-wrapper","mb-3"],["alt","Profile Photo",1,"profile-photo",3,"src"],[1,"profile-photo-placeholder"],[1,"mb-1"],[1,"text-muted","mb-3"],[1,"quick-stats"],[1,"stat-item"],[1,"fa-solid","fa-building","text-primary"],[1,"fa-solid","fa-map-marker-alt","text-danger"],[1,"badge","bg-success"],[1,"badge","bg-danger"],[1,"col-lg-8"],[1,"card"],[1,"fa-solid","fa-user"],[1,"fa-solid","fa-circle","me-1"],[1,"card","mb-3"],[1,"card-header","bg-white"],[1,"card-title","mb-0"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-6"],[1,"info-item"],[1,"info-icon"],[1,"info-content"],[1,"info-label"],[3,"class"],[1,"info-value"],[1,"fa-solid","fa-edit","me-2"],[3,"ngSubmit","formGroup"],[1,"form-label"],["type","tel","formControlName","phoneNumber",1,"form-control",3,"placeholder"],["type","email","formControlName","email",1,"form-control",3,"placeholder"],[1,"invalid-feedback"],["type","text","formControlName","displayName",1,"form-control",3,"placeholder"],["type","text","formControlName","address",1,"form-control",3,"placeholder"],["type","text","formControlName","emergencyContact",1,"form-control",3,"placeholder"],["type","tel","formControlName","emergencyPhone",1,"form-control",3,"placeholder"],[1,"d-flex","justify-content-end","gap-2","mt-4"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"fa-solid","fa-times","me-1"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"fa-solid","fa-save","me-1"]],template:function(t,d){t&1&&(r(0,"app-page-header",0)(1,"div",1)(2,"button",2),g("click",function(){return d.changePassword()}),m(3,"i",3),l(4),o(),f(5,Q,3,2,"button",4),r(6,"button",5),g("click",function(){return d.refresh()}),m(7,"i",6),l(8),o()()(),f(9,W,1,1,"app-loading-spinner",7),f(10,X,5,2,"div",8),f(11,ce,26,8,"div",9)),t&2&&(s("title",d.i18n.t("portal.my_profile")),i(4),u(" ",d.i18n.t("auth.change_password")," "),i(),_(d.isEditMode()?-1:5),i(),s("disabled",d.loading()),i(),M("fa-spin",d.loading()),i(),u(" ",d.i18n.t("common.refresh")," "),i(),_(d.loading()&&!d.profile()?9:-1),i(),_(d.error()&&!d.profile()?10:-1),i(),_(d.profile()?11:-1))},dependencies:[O,G,A,T,V,z,$,U,j,R,B],styles:[".profile-card[_ngcontent-%COMP%]{box-shadow:0 .125rem .25rem #00000013}.profile-photo-wrapper[_ngcontent-%COMP%]{position:relative;width:150px;height:150px;margin:0 auto}.profile-photo[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:50%;object-fit:cover;border:4px solid #fff;box-shadow:0 .25rem .5rem #0000001a}.profile-photo-placeholder[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:50%;background:linear-gradient(135deg,var(--bs-primary),var(--bs-info));display:flex;align-items:center;justify-content:center;color:#fff;font-size:4rem;box-shadow:0 .25rem .5rem #0000001a}.quick-stats[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;padding-top:1rem;border-top:1px solid var(--bs-border-color)}.stat-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.9rem}.stat-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.card[_ngcontent-%COMP%]{box-shadow:0 .125rem .25rem #00000013}.card-header[_ngcontent-%COMP%]{border-bottom:1px solid var(--bs-border-color)}.info-item[_ngcontent-%COMP%]{display:flex;align-items:start;gap:1rem;padding:.75rem;border-radius:.5rem;transition:background-color .2s ease}.info-item[_ngcontent-%COMP%]:hover{background-color:var(--bs-light)}.info-icon[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;border-radius:.5rem;background-color:var(--bs-light);display:flex;align-items:center;justify-content:center;color:var(--bs-primary);font-size:1.25rem;flex-shrink:0}.info-content[_ngcontent-%COMP%]{flex:1}.info-label[_ngcontent-%COMP%]{display:block;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--bs-secondary);margin-bottom:.25rem}.info-value[_ngcontent-%COMP%]{font-size:1rem;color:var(--bs-body-color);font-weight:500}.form-label[_ngcontent-%COMP%]{font-weight:600;font-size:.875rem;color:var(--bs-secondary)}.form-control[_ngcontent-%COMP%]:focus{border-color:var(--bs-primary);box-shadow:0 0 0 .25rem #0d6efd40}@media (max-width: 992px){.profile-photo-wrapper[_ngcontent-%COMP%]{margin-bottom:1.5rem}}@media (max-width: 576px){.profile-photo-wrapper[_ngcontent-%COMP%], .profile-photo[_ngcontent-%COMP%], .profile-photo-placeholder[_ngcontent-%COMP%]{width:120px;height:120px}.profile-photo-placeholder[_ngcontent-%COMP%]{font-size:3rem}.info-item[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem}.info-icon[_ngcontent-%COMP%]{width:2rem;height:2rem;font-size:1rem}}.badge[_ngcontent-%COMP%]{font-size:.875rem;padding:.5rem 1rem}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}"]})};export{Y as MyProfileComponent};
