{
  "version": 3,
  "sources": ["src/app/core/auth/permission.service.ts"],
  "sourcesContent": ["import { Injectable, computed } from '@angular/core';\r\nimport { AuthService } from './auth.service';\r\nimport { PermissionUtils, PermissionResources, PermissionActions } from '../../shared/utils/permission.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PermissionService {\r\n  private userPermissions = computed(() => {\r\n    const user = this.authService.currentUser();\r\n    return user?.permissions || [];\r\n  });\r\n\r\n  constructor(private authService: AuthService) {}\r\n\r\n  has(permission: string): boolean {\r\n    const permissions = this.userPermissions();\r\n    return permissions.includes(permission) || permissions.includes('*');\r\n  }\r\n\r\n  hasAny(permissions: string[]): boolean {\r\n    return permissions.some(permission => this.has(permission));\r\n  }\r\n\r\n  hasAll(permissions: string[]): boolean {\r\n    return permissions.every(permission => this.has(permission));\r\n  }\r\n\r\n  hasRole(role: string): boolean {\r\n    const user = this.authService.currentUser();\r\n    return user?.roles?.includes(role) || false;\r\n  }\r\n\r\n  isAdmin(): boolean {\r\n    return this.hasRole('Admin');\r\n  }\r\n\r\n  isSuperAdmin(): boolean {\r\n    return this.hasRole('SuperAdmin');\r\n  }\r\n\r\n  canAccessBranch(branchId: number): boolean {\r\n    const user = this.authService.currentUser();\r\n    if (!user?.branchIds || user.branchIds.length === 0) {\r\n      return true; // No branch restriction\r\n    }\r\n    return user.branchIds.includes(branchId);\r\n  }\r\n\r\n  // Enhanced permission checking methods using PermissionUtils\r\n  canRead(resource: string): boolean {\r\n    return this.has(PermissionUtils.buildPermissionKey(resource, PermissionActions.READ));\r\n  }\r\n\r\n  canCreate(resource: string): boolean {\r\n    return this.has(PermissionUtils.buildPermissionKey(resource, PermissionActions.CREATE));\r\n  }\r\n\r\n  canUpdate(resource: string): boolean {\r\n    return this.has(PermissionUtils.buildPermissionKey(resource, PermissionActions.UPDATE));\r\n  }\r\n\r\n  canDelete(resource: string): boolean {\r\n    return this.has(PermissionUtils.buildPermissionKey(resource, PermissionActions.DELETE));\r\n  }\r\n\r\n  canExport(resource: string): boolean {\r\n    return this.has(PermissionUtils.buildPermissionKey(resource, PermissionActions.EXPORT));\r\n  }\r\n\r\n  canImport(resource: string): boolean {\r\n    return this.has(PermissionUtils.buildPermissionKey(resource, PermissionActions.IMPORT));\r\n  }\r\n\r\n  canManage(resource: string): boolean {\r\n    return this.has(PermissionUtils.buildPermissionKey(resource, PermissionActions.MANAGE));\r\n  }\r\n\r\n  // Resource-specific helper methods\r\n  canManageUsers(): boolean {\r\n    return this.hasAny([\r\n      PermissionUtils.buildPermissionKey(PermissionResources.USER, PermissionActions.CREATE),\r\n      PermissionUtils.buildPermissionKey(PermissionResources.USER, PermissionActions.UPDATE),\r\n      PermissionUtils.buildPermissionKey(PermissionResources.USER, PermissionActions.DELETE),\r\n      PermissionUtils.buildPermissionKey(PermissionResources.USER, PermissionActions.MANAGE)\r\n    ]);\r\n  }\r\n\r\n  canManageRoles(): boolean {\r\n    return this.hasAny([\r\n      PermissionUtils.buildPermissionKey(PermissionResources.ROLE, PermissionActions.CREATE),\r\n      PermissionUtils.buildPermissionKey(PermissionResources.ROLE, PermissionActions.UPDATE),\r\n      PermissionUtils.buildPermissionKey(PermissionResources.ROLE, PermissionActions.DELETE),\r\n      PermissionUtils.buildPermissionKey(PermissionResources.ROLE, PermissionActions.MANAGE)\r\n    ]);\r\n  }\r\n\r\n  canManageEmployees(): boolean {\r\n    return this.hasAny([\r\n      PermissionUtils.buildPermissionKey(PermissionResources.EMPLOYEE, PermissionActions.CREATE),\r\n      PermissionUtils.buildPermissionKey(PermissionResources.EMPLOYEE, PermissionActions.UPDATE),\r\n      PermissionUtils.buildPermissionKey(PermissionResources.EMPLOYEE, PermissionActions.DELETE),\r\n      PermissionUtils.buildPermissionKey(PermissionResources.EMPLOYEE, PermissionActions.MANAGE)\r\n    ]);\r\n  }\r\n\r\n  canAccessShifts(): boolean {\r\n    return this.hasAny([\r\n      'shift.read',\r\n      'shift.create',\r\n      'shift.update',\r\n      'shift.delete',\r\n      'shift.assign',\r\n      'shift.unassign',\r\n      'shift.export',\r\n      'shift.import'\r\n    ]);\r\n  }\r\n\r\n\r\n  // ==== POLICY-BASED AUTHORIZATION METHODS (Mirroring Backend Policies) ====\r\n\r\n  // Employee Management Policies\r\n  canReadEmployees(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.isManager() ||\r\n           this.has('employee.read');\r\n  }\r\n\r\n  canManageEmployeesPolicy(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.hasAny([\r\n             'employee.create',\r\n             'employee.update',\r\n             'employee.delete',\r\n             'employee.manage'\r\n           ]);\r\n  }\r\n\r\n  canAssignEmployeeShifts(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.isManager() ||\r\n           this.has('employee.assign');\r\n  }\r\n\r\n  // User Management Policies\r\n  canReadUsers(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.has('user.read');\r\n  }\r\n\r\n  canManageUsersPolicy(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.hasAny([\r\n             'user.create',\r\n             'user.update',\r\n             'user.delete',\r\n             'user.manage'\r\n           ]);\r\n  }\r\n\r\n  canAssignUserRoles(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.hasAny([\r\n             'user.assignRole',\r\n             'user.removeRole'\r\n           ]);\r\n  }\r\n\r\n  canManageUserSessions(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.has('user.session.manage');\r\n  }\r\n\r\n  // Shift Management Policies\r\n  canReadShifts(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.isManager() ||\r\n           this.has('shift.read');\r\n  }\r\n\r\n  canManageShiftsPolicy(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.hasAny([\r\n             'shift.create',\r\n             'shift.update',\r\n             'shift.delete',\r\n             'shift.manage'\r\n           ]);\r\n  }\r\n\r\n  // Branch Management Policies\r\n  canReadBranches(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.isManager() ||\r\n           this.has('branch.read');\r\n  }\r\n\r\n  canManageBranches(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.hasAny([\r\n             'branch.create',\r\n             'branch.update',\r\n             'branch.delete',\r\n             'branch.manage'\r\n           ]);\r\n  }\r\n\r\n  // Department Management Policies\r\n  canReadDepartments(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.isManager() ||\r\n           this.has('department.read');\r\n  }\r\n\r\n  canManageDepartments(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.hasAny([\r\n             'department.create',\r\n             'department.update',\r\n             'department.delete',\r\n             'department.manage'\r\n           ]);\r\n  }\r\n\r\n  // Role and Permission Management Policies\r\n  canReadRoles(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.has('role.read');\r\n  }\r\n\r\n  canManageRolesPolicy(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.hasAny([\r\n             'role.create',\r\n             'role.update',\r\n             'role.delete',\r\n             'role.manage'\r\n           ]);\r\n  }\r\n\r\n  canManagePermissions(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.hasAny([\r\n             'permission.assign',\r\n             'permission.remove',\r\n             'permission.manage'\r\n           ]);\r\n  }\r\n\r\n  // Attendance Management Policies\r\n  canReadAttendance(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.isManager() ||\r\n           this.has('attendance.read');\r\n  }\r\n\r\n  canManageAttendance(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.hasAny([\r\n             'attendance.create',\r\n             'attendance.update',\r\n             'attendance.delete',\r\n             'attendance.manage'\r\n           ]);\r\n  }\r\n\r\n  // Settings Management Policies\r\n  canReadSettings(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.has('settings.read');\r\n  }\r\n\r\n  canManageSettings(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.hasAny([\r\n             'settings.create',\r\n             'settings.update',\r\n             'settings.delete',\r\n             'settings.manage'\r\n           ]);\r\n  }\r\n\r\n  // Report Access Policies\r\n  canAccessReports(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.isManager() ||\r\n           this.hasAny([\r\n             'report.read',\r\n             'report.view',\r\n             'report.access'\r\n           ]);\r\n  }\r\n\r\n  // Security and Audit Policies\r\n  canAccessSecurityAudit(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.hasAny([\r\n             'audit.read',\r\n             'audit.view',\r\n             'security.audit'\r\n           ]);\r\n  }\r\n\r\n  canSystemAdministration(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.hasAny([\r\n             'system.admin',\r\n             'system.configure',\r\n             'system.manage'\r\n           ]);\r\n  }\r\n\r\n  // Public Holidays Management Policies\r\n  canReadPublicHolidays(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.has('publicHoliday.read');\r\n  }\r\n\r\n  canManagePublicHolidays(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.hasAny([\r\n             'publicHoliday.create',\r\n             'publicHoliday.update',\r\n             'publicHoliday.delete',\r\n             'publicHoliday.manage'\r\n           ]);\r\n  }\r\n\r\n  canExportPublicHolidays(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.has('publicHoliday.export');\r\n  }\r\n\r\n  canImportPublicHolidays(): boolean {\r\n    return this.isSystemAdmin() ||\r\n           this.isAdmin() ||\r\n           this.has('publicHoliday.import');\r\n  }\r\n\r\n\r\n  // Role-based Helper Methods\r\n  private isSystemAdmin(): boolean {\r\n    return this.hasRole('SystemAdmin');\r\n  }\r\n\r\n  private isManager(): boolean {\r\n    return this.hasRole('Manager');\r\n  }\r\n\r\n  private isEmployee(): boolean {\r\n    return this.hasRole('Employee');\r\n  }\r\n\r\n  /**\r\n   * Get current user\r\n   */\r\n  getCurrentUser() {\r\n    return this.authService.currentUser();\r\n  }\r\n\r\n  /**\r\n   * Get current employee (alias for getCurrentUser)\r\n   */\r\n  getCurrentEmployee() {\r\n    return this.authService.currentUser();\r\n  }\r\n}"],
  "mappings": "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",
  "names": []
}
