import{a as J}from"./chunk-SRPEDAT4.js";import{a as K}from"./chunk-AY3UTFSR.js";import"./chunk-HUSARQNL.js";import{c as I,d as v,e as D,f as k,i as R,m as V,n as N,o as z,p as G,r as L,v as A,w as j,y as B}from"./chunk-VRETN7JA.js";import{a as H}from"./chunk-UBCI4X5Q.js";import{a as $}from"./chunk-EYAJMHM7.js";import{a as U}from"./chunk-HHXRLUSQ.js";import{b as w}from"./chunk-UWVH5K3J.js";import{b as Y}from"./chunk-RUY4WPQA.js";import{d as F,g as O}from"./chunk-TWXUAMJ4.js";import{$a as P,Bb as l,Cb as y,Db as s,Ea as S,Lb as T,R as f,W as _,X as g,Xa as d,Ya as u,ab as M,bb as x,cb as r,da as h,db as a,eb as p,lb as b,nb as C,pb as c,ta as i,wc as q,yb as E}from"./chunk-JSQL33QG.js";import"./chunk-DGAILPFQ.js";var X=(o,n)=>n.value;function Z(o,n){if(o&1&&p(0,"app-loading-spinner",0),o&2){let e=c();x("message",e.i18n.t("common.loading"))}}function ee(o,n){if(o&1&&(r(0,"option",12),l(1),a()),o&2){let e=n.$implicit;x("value",e.value),i(),y(e.label)}}function te(o,n){if(o&1&&(r(0,"div",13),l(1),a()),o&2){let e=c(2);i(),s(" ",e.getErrorMessage("excuseType")," ")}}function ie(o,n){if(o&1&&(r(0,"div",13),l(1),a()),o&2){let e=c(2);i(),s(" ",e.getErrorMessage("excuseDate")," ")}}function ne(o,n){if(o&1&&(r(0,"div",13),l(1),a()),o&2){let e=c(2);i(),s(" ",e.getErrorMessage("startTime")," ")}}function oe(o,n){if(o&1&&(r(0,"div",13),l(1),a()),o&2){let e=c(2);i(),s(" ",e.getErrorMessage("endTime")," ")}}function re(o,n){if(o&1&&(r(0,"div",13),l(1),a()),o&2){let e=c(2);i(),s(" ",e.getErrorMessage("reason")," ")}}function ae(o,n){if(o&1){let e=b();r(0,"input",33),C("change",function(m){_(e);let W=c(2);return g(W.onFileSelected(m))}),a(),r(1,"div",23),l(2),a()}if(o&2){let e=c(2);i(2),s(" ",e.i18n.t("portal.attachment_help")," ")}}function le(o,n){if(o&1){let e=b();r(0,"div",26)(1,"div",34),p(2,"i",35),r(3,"span"),l(4),a(),r(5,"span",36),l(6),a()(),r(7,"button",37),C("click",function(){_(e);let m=c(2);return g(m.removeFile())}),p(8,"i",38),l(9),a()()}if(o&2){let e=c(2);i(4),y(e.selectedFile().name),i(2),s(" (",(e.selectedFile().size/1024).toFixed(2)," KB) "),i(3),s(" ",e.i18n.t("common.remove")," ")}}function se(o,n){o&1&&p(0,"span",31)}function ce(o,n){if(o&1){let e=b();r(0,"div",1)(1,"app-page-header",2)(2,"div",3)(3,"button",4),C("click",function(){_(e);let m=c();return g(m.onCancel())}),p(4,"i",5),l(5),a()()(),r(6,"form",6),C("ngSubmit",function(){_(e);let m=c();return g(m.onSubmit())}),r(7,"app-form-section",2)(8,"div",7)(9,"div",8)(10,"label",9),l(11),r(12,"span",10),l(13,"*"),a()(),r(14,"select",11),P(15,ee,2,2,"option",12,X),a(),d(17,te,2,1,"div",13),a(),r(18,"div",8)(19,"label",14),l(20),r(21,"span",10),l(22,"*"),a()(),p(23,"input",15),d(24,ie,2,1,"div",13),a(),r(25,"div",8)(26,"label",16),l(27),r(28,"span",10),l(29,"*"),a()(),p(30,"input",17),d(31,ne,2,1,"div",13),a(),r(32,"div",8)(33,"label",18),l(34),r(35,"span",10),l(36,"*"),a()(),p(37,"input",19),d(38,oe,2,1,"div",13),a(),r(39,"div",20)(40,"label",21),l(41),r(42,"span",10),l(43,"*"),a()(),r(44,"textarea",22),l(45,"            "),a(),r(46,"div",23),l(47),a(),d(48,re,2,1,"div",13),a(),r(49,"div",20)(50,"label",24),l(51),r(52,"span",25),l(53),a()(),d(54,ae,3,1)(55,le,10,3,"div",26),a()()(),r(56,"div",27),p(57,"i",28),l(58),a(),r(59,"div",29)(60,"button",30),d(61,se,1,0,"span",31),l(62),a(),r(63,"button",32),C("click",function(){_(e);let m=c();return g(m.onCancel())}),l(64),a()()()()}if(o&2){let e,t=c();i(),x("title",t.isEditMode()?t.i18n.t("portal.edit_excuse"):t.i18n.t("portal.new_excuse")),i(4),s(" ",t.i18n.t("common.back")," "),i(),x("formGroup",t.form),i(),x("title",t.i18n.t("portal.excuse_details")),i(4),s(" ",t.i18n.t("portal.excuse_type")," "),i(3),E("is-invalid",t.hasError("excuseType","required")),i(),M(t.excuseTypes),i(2),u(t.hasError("excuseType","required")?17:-1),i(3),s(" ",t.i18n.t("portal.excuse_date")," "),i(3),E("is-invalid",t.hasError("excuseDate","required")),i(),u(t.hasError("excuseDate","required")?24:-1),i(3),s(" ",t.i18n.t("portal.start_time")," "),i(3),E("is-invalid",t.hasError("startTime","required")),i(),u(t.hasError("startTime","required")?31:-1),i(3),s(" ",t.i18n.t("portal.end_time")," "),i(3),E("is-invalid",t.hasError("endTime","required")),i(),u(t.hasError("endTime","required")?38:-1),i(3),s(" ",t.i18n.t("portal.reason")," "),i(3),E("is-invalid",t.hasError("reason","required")||t.hasError("reason","maxlength")),x("placeholder",T(t.i18n.t("portal.excuse_reason_placeholder"))),i(3),s(" ",((e=t.form.get("reason"))==null||e.value==null?null:e.value.length)||0," / 500 characters "),i(),u(t.hasError("reason","required")||t.hasError("reason","maxlength")?48:-1),i(3),s(" ",t.i18n.t("portal.attachment")," "),i(2),s("(",t.i18n.t("common.optional"),")"),i(),u(t.selectedFile()?55:54),i(4),s(" ",t.i18n.t("portal.excuse_form_info")," "),i(2),x("disabled",t.saving()||t.form.invalid),i(),u(t.saving()?61:-1),i(),s(" ",t.isEditMode()?t.i18n.t("common.update"):t.i18n.t("common.submit")," "),i(),x("disabled",t.saving()),i(),s(" ",t.i18n.t("common.cancel")," ")}}var Q=class o{i18n=f(Y);fb=f(j);router=f(O);route=f(F);excuseService=f(K);authService=f(w);notificationService=f(U);loading=h(!1);saving=h(!1);isEditMode=h(!1);currentExcuse=h(null);selectedFile=h(null);form;excuseTypes=[{value:"PersonalExcuse",label:"Personal Excuse"},{value:"OfficialDuty",label:"Official Duty"}];constructor(){this.form=this.createForm()}ngOnInit(){this.checkEditMode()}createForm(){return this.fb.group({excuseType:["PersonalExcuse",[v.required]],excuseDate:["",[v.required]],startTime:["",[v.required]],endTime:["",[v.required]],reason:["",[v.required,v.maxLength(500)]],attachment:[null]})}checkEditMode(){let n=this.route.snapshot.paramMap.get("id");n&&n!=="new"&&(this.isEditMode.set(!0),this.loadExcuse(+n))}loadExcuse(n){this.loading.set(!0),this.excuseService.getEmployeeExcuseById(n).subscribe({next:e=>{e?(this.currentExcuse.set(e),this.populateForm(e)):(this.notificationService.error(this.i18n.t("portal.excuse_not_found")),this.router.navigate(["/portal/excuse-requests"])),this.loading.set(!1)},error:e=>{console.error("Failed to load excuse:",e),this.notificationService.error(this.i18n.t("portal.failed_to_load_excuse")),this.loading.set(!1),this.router.navigate(["/portal/excuse-requests"])}})}populateForm(n){let e=new Date(n.excuseDate).toISOString().split("T")[0];this.form.patchValue({excuseType:n.excuseType||"PersonalExcuse",excuseDate:e,startTime:n.startTime,endTime:n.endTime,reason:n.reason})}onFileSelected(n){let e=n.target;if(e.files&&e.files.length>0){let t=e.files[0];this.selectedFile.set(t),this.form.patchValue({attachment:t})}}removeFile(){this.selectedFile.set(null),this.form.patchValue({attachment:null})}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched(),this.notificationService.error(this.i18n.t("common.form_validation_error"));return}this.isEditMode()?this.updateExcuse():this.createExcuse()}createExcuse(){this.saving.set(!0);let n=this.authService.currentUser();if(!n||!n.employeeId){this.notificationService.error(this.i18n.t("portal.employee_not_found")),this.saving.set(!1);return}let e=this.form.value,t={employeeId:n.employeeId,excuseType:e.excuseType,excuseDate:e.excuseDate,startTime:e.startTime,endTime:e.endTime,reason:e.reason,attachmentFile:this.selectedFile()||void 0};this.excuseService.createEmployeeExcuse(t).subscribe({next:()=>{this.notificationService.success(this.i18n.t("portal.excuse_created")),this.router.navigate(["/portal/excuse-requests"])},error:m=>{console.error("Failed to create excuse:",m),this.notificationService.error(this.i18n.t("portal.failed_to_create_excuse")),this.saving.set(!1)}})}updateExcuse(){let n=this.currentExcuse();if(!n)return;this.saving.set(!0);let e=this.form.value,t={excuseType:e.excuseType,excuseDate:e.excuseDate,startTime:e.startTime,endTime:e.endTime,reason:e.reason,approvalStatus:n.status,attachmentFile:this.selectedFile()||void 0};this.excuseService.updateEmployeeExcuse(n.id,t).subscribe({next:()=>{this.notificationService.success(this.i18n.t("portal.excuse_updated")),this.router.navigate(["/portal/excuse-requests"])},error:m=>{console.error("Failed to update excuse:",m),this.notificationService.error(this.i18n.t("portal.failed_to_update_excuse")),this.saving.set(!1)}})}onCancel(){this.router.navigate(["/portal/excuse-requests"])}hasError(n,e){let t=this.form.get(n);return!!(t&&t.hasError(e)&&(t.dirty||t.touched))}getErrorMessage(n){let e=this.form.get(n);if(!e||!e.errors)return"";if(e.hasError("required"))return this.i18n.t("common.field_required");if(e.hasError("maxlength")){let t=e.errors.maxlength.requiredLength;return this.i18n.t("common.field_max_length",{max:t})}return""}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=S({type:o,selectors:[["app-portal-excuse-request-form"]],decls:2,vars:2,consts:[[3,"message"],[1,"excuse-request-form"],[3,"title"],["header-actions",""],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"fa-solid","fa-arrow-left","me-1"],[1,"mt-4",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-md-6","mb-3"],["for","excuseType",1,"form-label"],[1,"text-danger"],["id","excuseType","formControlName","excuseType",1,"form-select"],[3,"value"],[1,"invalid-feedback"],["for","excuseDate",1,"form-label"],["type","date","id","excuseDate","formControlName","excuseDate",1,"form-control"],["for","startTime",1,"form-label"],["type","time","id","startTime","formControlName","startTime",1,"form-control"],["for","endTime",1,"form-label"],["type","time","id","endTime","formControlName","endTime",1,"form-control"],[1,"col-12","mb-3"],["for","reason",1,"form-label"],["id","reason","formControlName","reason","rows","4","maxlength","500",1,"form-control",3,"placeholder"],[1,"form-text"],["for","attachment",1,"form-label"],[1,"text-muted"],[1,"file-preview"],[1,"alert","alert-info","mt-3"],[1,"fa-solid","fa-info-circle","me-2"],[1,"form-actions","mt-4"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],["type","button",1,"btn","btn-outline-secondary","ms-2",3,"click","disabled"],["type","file","id","attachment","accept",".pdf,.doc,.docx,.jpg,.jpeg,.png",1,"form-control",3,"change"],[1,"file-info"],[1,"fa-solid","fa-file","me-2"],[1,"text-muted","ms-2"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"fa-solid","fa-times"]],template:function(e,t){e&1&&(d(0,Z,1,1,"app-loading-spinner",0),d(1,ce,65,36,"div",1)),e&2&&(u(t.loading()?0:-1),i(),u(t.loading()?-1:1))},dependencies:[q,B,R,G,L,I,z,D,k,A,V,N,H,J,$],styles:[`.excuse-request-form[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:1.5rem}.form-label[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.5rem;color:var(--bs-body-color)}.form-label[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{margin-left:.25rem}.form-label[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{font-weight:400;font-size:.875rem}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:.375rem;border:1px solid var(--bs-border-color)}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:var(--bs-primary);box-shadow:0 0 0 .25rem #0d6efd40}textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:100px}.file-preview[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.75rem;background-color:var(--bs-light);border:1px solid var(--bs-border-color);border-radius:.375rem}.file-info[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1}.file-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--bs-primary);font-size:1.25rem}.form-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;padding-top:1.5rem;border-top:1px solid var(--bs-border-color)}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:120px}.alert-info[_ngcontent-%COMP%]{background-color:#0dcaf01a;border-color:#0dcaf033;color:#055160}.invalid-feedback[_ngcontent-%COMP%]{display:block;margin-top:.25rem;font-size:.875rem}.form-control.is-invalid[_ngcontent-%COMP%], .form-select.is-invalid[_ngcontent-%COMP%]{border-color:var(--bs-danger);padding-right:calc(1.5em + .75rem);background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right calc(.375em + .1875rem) center;background-size:calc(.75em + .375rem) calc(.75em + .375rem)}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem;border-width:.15em}@media (max-width: 768px){.excuse-request-form[_ngcontent-%COMP%]{padding:1rem}.form-actions[_ngcontent-%COMP%]{flex-direction:column}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}.file-preview[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.75rem}.file-preview[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}.form-text[_ngcontent-%COMP%]{font-size:.875rem;color:var(--bs-secondary);margin-top:.25rem}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.excuse-request-form[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 8px #00000026;transition:all .2s ease}.btn-outline-secondary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);transition:all .2s ease}`]})};export{Q as PortalExcuseRequestFormComponent};
