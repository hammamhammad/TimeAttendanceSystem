import{a as m}from"./chunk-A6EM5NV6.js";import{E as n,e as l,fb as p,l as o,r as s,u as c,xb as u,y as g}from"./chunk-5OFYUWMA.js";var h=(r=>(r[r.All=0]="All",r[r.Branch=1]="Branch",r[r.Department=2]="Department",r[r.Role=3]="Role",r[r.Individual=4]="Individual",r))(h||{}),v=(a=>(a[a.Pending=0]="Pending",a[a.Sent=1]="Sent",a[a.PartiallyDelivered=2]="PartiallyDelivered",a[a.Failed=3]="Failed",a))(v||{}),b=class d{http=g(u);apiUrl=`${m.apiUrl}/api/v1/notifications/broadcasts`;broadcasts=n([]);stats=n(null);loading=n(!1);error=n(null);recentBroadcasts=p(()=>this.broadcasts().slice(0,5));pendingCount=p(()=>this.broadcasts().filter(t=>t.status===0).length);getBroadcasts(t){return this.loading.set(!0),this.error.set(null),this.http.get(this.apiUrl,{params:this.buildParams(t)}).pipe(s(e=>{this.broadcasts.set(e.items),this.loading.set(!1)}),o(e=>(this.error.set(e.message||"Failed to load broadcasts"),this.loading.set(!1),l({items:[],total:0}))))}getStats(){return this.http.get(`${this.apiUrl}/stats`).pipe(s(t=>this.stats.set(t)),o(t=>(console.error("Failed to load stats:",t),l({totalBroadcasts:0,totalRecipients:0,totalDelivered:0,totalRead:0,avgDeliveryRate:0,avgReadRate:0,todayBroadcasts:0,thisWeekBroadcasts:0,thisMonthBroadcasts:0}))))}getBroadcast(t){return this.http.get(`${this.apiUrl}/${t}`)}sendBroadcast(t){return this.loading.set(!0),this.http.post(this.apiUrl,t).pipe(s(e=>{this.broadcasts.update(i=>[e,...i]),this.loading.set(!1)}),o(e=>{throw this.error.set(e.message||"Failed to send broadcast"),this.loading.set(!1),e}))}getTargets(t){return this.http.get(`${this.apiUrl}/targets`,{params:{type:t}})}cancelBroadcast(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(s(()=>{this.broadcasts.update(e=>e.filter(i=>i.id!==t))}))}resendBroadcast(t){return this.http.post(`${this.apiUrl}/${t}/resend`,{}).pipe(s(e=>{this.broadcasts.update(i=>i.map(a=>a.id===t?e:a))}))}buildParams(t){if(!t)return{};let e={};return t.startDate&&(e.startDate=t.startDate.toISOString()),t.endDate&&(e.endDate=t.endDate.toISOString()),t.targetType!==void 0&&(e.targetType=t.targetType),t.status!==void 0&&(e.status=t.status),t.page&&(e.page=t.page),t.pageSize&&(e.pageSize=t.pageSize),e}static \u0275fac=function(e){return new(e||d)};static \u0275prov=c({token:d,factory:d.\u0275fac,providedIn:"root"})};export{h as a,v as b,b as c};
