import{a as Q}from"./chunk-U2ZTVJM6.js";import{a as ee}from"./chunk-CT6BHIHG.js";import{a as J}from"./chunk-CXFFM2PW.js";import{a as D}from"./chunk-KDISMZOF.js";import{a as Y}from"./chunk-EHNHB6RU.js";import{a as X}from"./chunk-JWR47IJL.js";import"./chunk-QHBTYDS6.js";import{a as Z}from"./chunk-32LY3B2D.js";import"./chunk-BSEKTODI.js";import"./chunk-HUSARQNL.js";import"./chunk-QXVLGI72.js";import{a as K}from"./chunk-7TWIWOLV.js";import{a as R}from"./chunk-4335LQ3A.js";import{a as p,b as u}from"./chunk-LDWMK676.js";import"./chunk-HCDX4O2L.js";import{a as W}from"./chunk-6B6T6MZ3.js";import"./chunk-HF7V7ZC6.js";import{a as q}from"./chunk-RUOWTK24.js";import"./chunk-HZR4WXEY.js";import{g as j}from"./chunk-O3U3HUCY.js";import{a as y}from"./chunk-77FC2LKR.js";import"./chunk-A6EM5NV6.js";import{$a as f,$b as B,Bb as V,Db as G,Eb as c,Fb as h,Gb as x,Ha as w,Hb as H,La as E,Na as C,T as _,Y as P,Z as U,_a as b,bb as F,cb as z,db as $,dc as k,eb as g,fa as d,fb as o,gb as a,hb as v,ob as T,qb as S,sb as s,wa as r}from"./chunk-IGEIB4M6.js";import{a as O,b as N,e as L}from"./chunk-YMDWBF3A.js";var re=(i,t)=>t.id;function oe(i,t){if(i&1&&(o(0,"div",2),v(1,"i",5),c(2),a()),i&2){let e=s();r(2),x(" ",e.error()," ")}}function ae(i,t){if(i&1&&(o(0,"span",18),c(1),a()),i&2){let e=t.$implicit;r(),h(e)}}function se(i,t){if(i&1&&(o(0,"div",14),z(1,ae,2,1,"span",18,F),a()),i&2){let e=s(2);r(),$(e.user==null?null:e.user.roles)}}function le(i,t){if(i&1&&(o(0,"p",11),c(1),a()),i&2){let e=s(2);r(),h(e.t("users.no_roles"))}}function me(i,t){if(i&1&&(o(0,"div",21)(1,"div",23)(2,"span",24),c(3),a()(),o(4,"p",25),c(5),a()()),i&2){let e=s(3);r(3),h(e.t("common.loading")),r(2),h(e.t("users.updating_roles"))}}function ce(i,t){if(i&1){let e=T();o(0,"input",34),S("change",function(){P(e);let m=s().$implicit,l=s(4);return U(l.onToggleRole(m))}),a()}if(i&2){let e=s().$implicit,n=s(4);g("id","role-"+e.id)("checked",n.isRoleAssigned(e.id))("disabled",n.loading())}}function de(i,t){if(i&1&&(o(0,"p",33),c(1),a()),i&2){let e=s().$implicit,n=s(4);r(),x(" ",n.getRoleDescription(e)," ")}}function ge(i,t){if(i&1&&(o(0,"div",27)(1,"div",28),E(2,ce,1,3,"input",29),o(3,"div",30)(4,"label",31)(5,"span",32),c(6),a()(),b(7,de,2,1,"p",33),a()()()),i&2){let e=t.$implicit,n=s(4);V("loading",n.loading()),r(2),g("appHasPermission",n.PERMISSIONS.USER_ASSIGN_ROLE),r(2),g("for","role-"+e.id),r(),G(n.getRoleBadgeClass(e)),r(),x(" ",e.name," "),r(),f(n.getRoleDescription(e)?7:-1)}}function pe(i,t){if(i&1&&(o(0,"div",22),z(1,ge,8,8,"div",26,re),a()),i&2){let e=s(3);r(),$(e.availableRoles())}}function ue(i,t){if(i&1&&(o(0,"div",19)(1,"h6",20),c(2),a(),b(3,me,6,2,"div",21)(4,pe,3,0,"div",22),a()),i&2){let e=s(2);r(2),h(e.t("users.available_roles")),r(),f(e.loading()?3:4)}}function _e(i,t){if(i&1&&(o(0,"div",35),v(1,"i",36),o(2,"small"),c(3),a()()),i&2){let e=s(2);r(3),h(e.t("users.role_management_help"))}}function he(i,t){if(i&1&&(o(0,"div",17),v(1,"i",37),o(2,"small"),c(3),a()()),i&2){let e=s(2);r(3),h(e.t("users.no_role_assignment_permission"))}}function Ce(i,t){if(i&1&&(o(0,"div",6)(1,"div",7)(2,"div",8)(3,"div",9),c(4),a()(),o(5,"div")(6,"h6",10),c(7),a(),o(8,"p",11),c(9),a()()()(),o(10,"div",12)(11,"h6",13),c(12),a(),b(13,se,3,0,"div",14)(14,le,2,1,"p",11),a(),E(15,ue,5,2,"div",15)(16,_e,4,1,"div",16),b(17,he,4,1,"div",17)),i&2){let e=s();r(4),x(" ",((e.user.username==null?null:e.user.username.charAt(0))||"").toUpperCase()," "),r(3),h(e.user==null?null:e.user.username),r(2),h(e.user==null?null:e.user.email),r(3),h(e.t("users.current_roles")),r(),f(e.user!=null&&e.user.roles&&e.user.roles.length>0?13:14),r(2),g("appHasPermission",e.PERMISSIONS.USER_ASSIGN_ROLE),r(),g("appHasPermission",e.PERMISSIONS.USER_ASSIGN_ROLE),r(),f(e.permissionService.has(e.PERMISSIONS.USER_ASSIGN_ROLE)?-1:17)}}var I=class i{user=null;show=!1;showChange=new C;rolesUpdated=new C;usersService=_(D);i18n=_(y);permissionService=_(R);PERMISSIONS={USER_ASSIGN_ROLE:`${u.USER}.${p.ASSIGN_ROLE}`,USER_MANAGE:`${u.USER}.${p.MANAGE}`};loading=d(!1);error=d("");availableRoles=d([{id:1,name:"SystemAdmin",description:"Full system access with all permissions"},{id:2,name:"Admin",description:"Administrative access to employee and role management"},{id:3,name:"HROperation",description:"HR operations with employee management access"},{id:4,name:"User",description:"Basic user access with read-only permissions"}]);userRoleIds=k(()=>this.user?this.user.roles.map(t=>this.availableRoles().find(n=>n.name===t)?.id||0).filter(t=>t>0):[]);ngOnInit(){}t(t){return this.i18n.t(t)}isRoleAssigned(t){return this.userRoleIds().includes(t)}onToggleRole(t){if(!this.user)return;this.loading.set(!0),this.error.set(""),this.isRoleAssigned(t.id)?this.removeRole(t.id):this.assignRole(t.id)}assignRole(t){if(!this.user)return;let e={roleId:t};this.usersService.assignRole(this.user.id,e).subscribe({next:()=>{this.refreshUserData()},error:n=>{this.loading.set(!1),this.error.set(this.getErrorMessage(n))}})}removeRole(t){this.user&&this.usersService.removeRole(this.user.id,t).subscribe({next:()=>{this.refreshUserData()},error:e=>{this.loading.set(!1),this.error.set(this.getErrorMessage(e))}})}refreshUserData(){this.user&&this.usersService.getUserById(this.user.id).subscribe({next:t=>{this.loading.set(!1),this.rolesUpdated.emit(t)},error:t=>{this.loading.set(!1),this.error.set(this.getErrorMessage(t))}})}closeModal(){this.show=!1,this.showChange.emit(!1),this.error.set("")}getErrorMessage(t){return t?.error?.error?t.error.error:this.t("errors.unknown")}getRoleDescription(t){return t.description||""}getRoleBadgeClass(t){return{SystemAdmin:"bg-danger",Admin:"bg-warning",HROperation:"bg-info",User:"bg-secondary"}[t.name]||"bg-primary"}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["app-role-management"]],inputs:{user:"user",show:"show"},outputs:{showChange:"showChange",rolesUpdated:"rolesUpdated"},decls:7,vars:8,consts:[[3,"close","show","title","size","centered","loading"],[1,"modal-body"],["role","alert",1,"alert","alert-danger"],["modal-footer","",1,"d-flex","gap-2","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fa-solid","fa-exclamation-triangle","me-2"],[1,"user-info","mb-4"],[1,"d-flex","align-items-center"],[1,"avatar-md","me-3"],[1,"avatar-title","bg-primary-subtle","text-primary","rounded-circle"],[1,"mb-1"],[1,"text-muted","mb-0"],[1,"current-roles","mb-4"],[1,"mb-2"],[1,"d-flex","flex-wrap","gap-2"],["class","available-roles",4,"appHasPermission"],["class","alert alert-info mt-3","role","alert",4,"appHasPermission"],["role","alert",1,"alert","alert-warning","mt-3"],[1,"badge","bg-primary"],[1,"available-roles"],[1,"mb-3"],[1,"text-center","py-3"],[1,"roles-list"],["role","status",1,"spinner-border","spinner-border-sm","text-primary"],[1,"visually-hidden"],[1,"text-muted","mt-2","mb-0"],[1,"role-item",3,"loading"],[1,"role-item"],[1,"form-check","d-flex","align-items-start"],["class","form-check-input mt-1","type","checkbox",3,"id","checked","disabled","change",4,"appHasPermission"],[1,"form-check-content","ms-2","flex-grow-1"],[1,"form-check-label","fw-medium",3,"for"],[1,"badge","me-2"],[1,"text-muted","small","mb-0"],["type","checkbox",1,"form-check-input","mt-1",3,"change","id","checked","disabled"],["role","alert",1,"alert","alert-info","mt-3"],[1,"fa-solid","fa-info-circle","me-2"],[1,"fa-solid","fa-lock","me-2"]],template:function(e,n){e&1&&(o(0,"app-modal-wrapper",0),S("close",function(){return n.closeModal()}),o(1,"div",1),b(2,oe,3,1,"div",2),b(3,Ce,18,8),a(),o(4,"div",3)(5,"button",4),S("click",function(){return n.closeModal()}),c(6),a()()()),e&2&&(g("show",n.show&&!!n.user)("title",n.t("users.manage_roles"))("size","md")("centered",!0)("loading",n.loading()),r(2),f(n.error()?2:-1),r(),f(n.user?3:-1),r(3),x(" ",n.t("common.close")," "))},dependencies:[J,Q],styles:[".modal.show[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .15s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.modal-content[_ngcontent-%COMP%]{border:none;box-shadow:0 .5rem 1rem #00000026;border-radius:.5rem}.modal-header[_ngcontent-%COMP%]{background-color:var(--bs-light);border-bottom:1px solid var(--bs-border-color);border-radius:.5rem .5rem 0 0}.modal-title[_ngcontent-%COMP%]{font-weight:600;color:var(--bs-primary)}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-footer[_ngcontent-%COMP%]{background-color:var(--bs-light);border-top:1px solid var(--bs-border-color);border-radius:0 0 .5rem .5rem}.avatar-md[_ngcontent-%COMP%]{width:48px;height:48px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.avatar-title[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.25rem;font-weight:600}.user-info[_ngcontent-%COMP%]{padding:1rem;background-color:var(--bs-light);border-radius:.5rem;border:1px solid var(--bs-border-color)}.current-roles[_ngcontent-%COMP%]{padding:1rem;background-color:var(--bs-primary-bg-subtle);border-radius:.5rem;border:1px solid var(--bs-primary-border-subtle)}.roles-list[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.role-item[_ngcontent-%COMP%]{padding:1rem;border:1px solid var(--bs-border-color);border-radius:.5rem;margin-bottom:.5rem;background-color:var(--bs-white);transition:all .2s ease}.role-item[_ngcontent-%COMP%]:hover{background-color:var(--bs-light);border-color:var(--bs-primary-border-subtle)}.role-item.loading[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.form-check[_ngcontent-%COMP%]{margin-bottom:0}.form-check-input[_ngcontent-%COMP%]{margin-top:.125rem}.form-check-input[_ngcontent-%COMP%]:checked{background-color:var(--bs-primary);border-color:var(--bs-primary)}.form-check-content[_ngcontent-%COMP%]{min-width:0}.form-check-label[_ngcontent-%COMP%]{margin-bottom:.25rem;cursor:pointer;line-height:1.2}.badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.375rem .75rem}.alert[_ngcontent-%COMP%]{border:none;border-radius:.5rem}.alert-danger[_ngcontent-%COMP%]{background-color:var(--bs-danger-bg-subtle);color:var(--bs-danger-text);border-left:4px solid var(--bs-danger)}.alert-info[_ngcontent-%COMP%]{background-color:var(--bs-info-bg-subtle);color:var(--bs-info-text);border-left:4px solid var(--bs-info)}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}h6[_ngcontent-%COMP%]{font-weight:600;color:var(--bs-primary)}.text-muted[_ngcontent-%COMP%]{color:var(--bs-secondary)!important}.small[_ngcontent-%COMP%]{font-size:.875rem}.bg-danger[_ngcontent-%COMP%]{background-color:var(--bs-danger)!important}.bg-warning[_ngcontent-%COMP%]{background-color:var(--bs-warning)!important;color:var(--bs-primary)!important}.bg-info[_ngcontent-%COMP%]{background-color:var(--bs-info)!important}.bg-secondary[_ngcontent-%COMP%]{background-color:var(--bs-secondary)!important}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--bs-light);border-radius:3px}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--bs-secondary);border-radius:3px}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--bs-primary)}[dir=rtl][_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{margin-left:0;margin-right:-1.5em}[dir=rtl][_ngcontent-%COMP%]   .form-check-content[_ngcontent-%COMP%]{margin-right:.5rem;margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .avatar-md[_ngcontent-%COMP%]{margin-right:0;margin-left:.75rem}@media (max-width: 768px){.modal-dialog[_ngcontent-%COMP%]{margin:1rem;max-width:none}.modal-body[_ngcontent-%COMP%]{padding:1rem}.user-info[_ngcontent-%COMP%], .current-roles[_ngcontent-%COMP%], .role-item[_ngcontent-%COMP%]{padding:.75rem}.avatar-md[_ngcontent-%COMP%]{width:40px;height:40px}.avatar-title[_ngcontent-%COMP%]{font-size:1rem}}.form-check-input[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem rgba(var(--bs-primary-rgb),.25)}@keyframes _ngcontent-%COMP%_pulse{0%{opacity:1}50%{opacity:.5}to{opacity:1}}.loading[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s ease-in-out infinite}"]})};function be(i,t){if(i&1&&(o(0,"div",2)(1,"div",4)(2,"div",5),c(3),a()(),o(4,"div")(5,"div",3),c(6),a(),o(7,"small",6),c(8),a()()()),i&2){let e=s().$implicit,n=s();r(3),x(" ",n.getInitials(e.firstName,e.lastName)," "),r(3),H("",e.firstName," ",e.lastName),r(2),h(e.email)}}function fe(i,t){i&1&&(o(0,"span",7),v(1,"i",8),a())}function ve(i,t){if(i&1&&(o(0,"span",3),c(1),b(2,fe,2,0,"span",7),a()),i&2){let e=s().$implicit,n=s();r(),x(" ",e.username," "),r(),f(n.isSystemAdmin(e)?2:-1)}}function Se(i,t){if(i&1&&(o(0,"div"),v(1,"app-badge-list",9),a()),i&2){let e=s().$implicit,n=s();r(),g("items",n.getRoleBadges(e.roles))("emptyMessage","No roles assigned")}}function xe(i,t){if(i&1&&(o(0,"span"),v(1,"app-status-badge",10),a()),i&2){let e=s().$implicit;r(),g("status",e.isActive?"active":"inactive")("label",e.isActive?"Active":"Inactive")("showIcon",!0)}}function Me(i,t){if(i&1&&(o(0,"span"),v(1,"app-status-badge",11),a()),i&2){let e=s().$implicit,n=s();r(),g("status",n.isUserLocked(e.lockoutEndUtc)?"warning":"success")("label",n.isUserLocked(e.lockoutEndUtc)?"Locked":"Unlocked")("icon",n.isUserLocked(e.lockoutEndUtc)?"fa-lock":"fa-unlock")("showIcon",!0)}}function Pe(i,t){if(i&1&&(o(0,"span"),v(1,"app-status-badge",11),a()),i&2){let e=s().$implicit;r(),g("status",e.mustChangePassword?"warning":"success")("label",e.mustChangePassword?"Must Change":"OK")("icon",e.mustChangePassword?"fa-key":"fa-check")("showIcon",!0)}}function Ue(i,t){if(i&1&&(o(0,"span"),c(1),a()),i&2){let e=s().$implicit,n=s();r(),x(" ",n.formatDate(e.createdAtUtc||e.createdAt)," ")}}function we(i,t){if(i&1&&(o(0,"span"),c(1),a()),i&2){let e=s(2).$implicit,n=s();r(),h(n.formatDate(e.lastLoginAt))}}function Re(i,t){i&1&&(o(0,"span",6),c(1,"Never"),a())}function ye(i,t){if(i&1&&(o(0,"span"),b(1,we,2,1,"span"),b(2,Re,2,0,"span",6),a()),i&2){let e=s().$implicit;r(),f(e.lastLoginAt?1:-1),r(),f(e.lastLoginAt?-1:2)}}function Oe(i,t){if(i&1&&b(0,be,9,4,"div",2)(1,ve,3,2,"span",3)(2,Se,2,2,"div")(3,xe,2,3,"span")(4,Me,2,4,"span")(5,Pe,2,4,"span")(6,Ue,2,1,"span")(7,ye,3,2,"span"),i&2){let e,n=t.column;f((e=n.key)==="user"?0:e==="username"?1:e==="roles"?2:e==="status"?3:e==="lockStatus"?4:e==="mustChangePassword"?5:e==="created"?6:e==="lastLogin"?7:-1)}}var A=class i{i18n=_(y);permissionService=_(R);users=[];loading=d(!1);currentPage=d(1);totalPages=d(1);totalItems=d(0);pageSize=d(10);viewUser=new C;editUser=new C;deleteUser=new C;manageRoles=new C;pageChange=new C;pageSizeChange=new C;selectionChange=new C;sortChange=new C;columns=[{key:"user",label:"User",width:"250px",sortable:!0},{key:"username",label:"Username",width:"150px",sortable:!0},{key:"roles",label:"Roles",width:"200px"},{key:"status",label:"Status",width:"100px",align:"center",sortable:!0},{key:"lockStatus",label:"Access",width:"100px",align:"center"},{key:"mustChangePassword",label:"Password Status",width:"130px",align:"center"},{key:"created",label:"Created",width:"120px",sortable:!0},{key:"lastLogin",label:"Last Login",width:"120px",sortable:!0}];get actions(){let t=[];return this.permissionService.has(`${u.USER}.${p.READ}`)&&t.push({key:"view",label:"View",icon:"fa-eye",color:"info"}),this.permissionService.has(`${u.USER}.${p.UPDATE}`)&&(t.push({key:"edit",label:"Edit",icon:"fa-edit",color:"primary",condition:e=>this.canEditUser(e)}),t.push({key:"manageRoles",label:"Manage Roles",icon:"fa-user-tag",color:"warning",condition:e=>this.canEditUser(e)})),this.permissionService.has(`${u.USER}.${p.DELETE}`)&&t.push({key:"delete",label:"Delete",icon:"fa-trash",color:"danger",condition:e=>this.canDeleteUser(e)}),t}onActionClick(t){let{action:e,item:n}=t;switch(e){case"view":this.viewUser.emit(n);break;case"edit":this.editUser.emit(n);break;case"delete":this.deleteUser.emit(n);break;case"manageRoles":this.manageRoles.emit(n);break}}onPageChange(t){this.pageChange.emit(t)}onPageSizeChange(t){this.pageSizeChange.emit(t)}onSelectionChange(t){this.selectionChange.emit(t)}onSortChange(t){this.sortChange.emit(t)}getInitials(t,e){let n=t?t.charAt(0).toUpperCase():"",m=e?e.charAt(0).toUpperCase():"";return n+m}isSystemAdmin(t){return t.username.toLowerCase()==="systemadmin"}getRoleBadges(t){return t.map(e=>({label:e,variant:"secondary"}))}canEditUser(t){return!this.isSystemAdmin(t)}canDeleteUser(t){return!this.isSystemAdmin(t)}isUserLocked(t){return t?new Date(t)>new Date:!1}formatDate(t){if(!t)return"N/A";let e=new Date(t);return isNaN(e.getTime())?"Invalid Date":e.toLocaleDateString(this.i18n.getCurrentLocale(),{year:"numeric",month:"short",day:"numeric"})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["app-user-table"]],inputs:{users:"users",loading:"loading",currentPage:"currentPage",totalPages:"totalPages",totalItems:"totalItems",pageSize:"pageSize"},outputs:{viewUser:"viewUser",editUser:"editUser",deleteUser:"deleteUser",manageRoles:"manageRoles",pageChange:"pageChange",pageSizeChange:"pageSizeChange",selectionChange:"selectionChange",sortChange:"sortChange"},decls:3,vars:11,consts:[["cellTemplate",""],[3,"actionClick","pageChange","pageSizeChange","selectionChange","sortChange","data","columns","actions","loading","currentPage","totalPages","totalItems","pageSize","allowSelection","emptyMessage","emptyTitle"],[1,"d-flex","align-items-center"],[1,"fw-medium"],[1,"avatar-sm","me-2"],[1,"avatar-initial","bg-primary","text-white","rounded-circle"],[1,"text-muted"],["title","System Administrator",1,"badge","bg-warning","text-dark","ms-1"],[1,"fas","fa-crown"],[3,"items","emptyMessage"],[3,"status","label","showIcon"],[3,"status","label","icon","showIcon"]],template:function(e,n){if(e&1){let m=T();o(0,"app-data-table",1),S("actionClick",function(M){return P(m),U(n.onActionClick(M))})("pageChange",function(M){return P(m),U(n.onPageChange(M))})("pageSizeChange",function(M){return P(m),U(n.onPageSizeChange(M))})("selectionChange",function(M){return P(m),U(n.onSelectionChange(M))})("sortChange",function(M){return P(m),U(n.onSortChange(M))}),E(1,Oe,8,1,"ng-template",null,0,B),a()}e&2&&g("data",n.users)("columns",n.columns)("actions",n.actions)("loading",n.loading)("currentPage",n.currentPage)("totalPages",n.totalPages)("totalItems",n.totalItems)("pageSize",n.pageSize)("allowSelection",!0)("emptyMessage","No users found")("emptyTitle","No Users")},dependencies:[Y,Z,ee],styles:[".avatar-sm[_ngcontent-%COMP%]{width:2rem;height:2rem}.avatar-initial[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:.875rem;font-weight:600}"]})};var ie=class i{usersService=_(D);notificationService=_(q);confirmationService=_(K);router=_(j);i18n=_(y);permissionService=_(R);loading=d(!1);users=d([]);pagedResult=d(null);currentPage=d(1);pageSize=d(10);currentFilter={};showRoleManagement=d(!1);selectedUser=d(null);availableRoles=d([{id:1,name:"SystemAdmin"},{id:2,name:"Admin"},{id:3,name:"HROperation"},{id:4,name:"User"}]);totalPages=k(()=>this.pagedResult()?.totalPages||1);totalItems=k(()=>this.pagedResult()?.totalItems||0);totalPagesSignal=d(1);totalItemsSignal=d(0);PERMISSIONS={USER_CREATE:`${u.USER}.${p.CREATE}`,USER_READ:`${u.USER}.${p.READ}`,USER_UPDATE:`${u.USER}.${p.UPDATE}`,USER_DELETE:`${u.USER}.${p.DELETE}`,USER_ASSIGN_ROLE:`${u.USER}.${p.ASSIGN_ROLE}`,USER_REMOVE_ROLE:`${u.USER}.${p.REMOVE_ROLE}`,USER_MANAGE:`${u.USER}.${p.MANAGE}`};ngOnInit(){this.loadUsers()}loadUsers(){this.loading.set(!0);let t=O({page:this.currentPage(),pageSize:this.pageSize()},this.currentFilter);this.usersService.getUsers(t).subscribe({next:e=>{this.pagedResult.set(e),this.users.set(e.items),this.totalPagesSignal.set(e.totalPages),this.totalItemsSignal.set(e.totalItems),this.loading.set(!1)},error:e=>{console.error("Failed to load users:",e),this.loading.set(!1),this.notificationService.error(this.i18n.t("errors.server"),this.i18n.t("errors.network"))}})}onSearchChange(t){this.currentFilter=N(O({},this.currentFilter),{search:t}),this.currentPage.set(1),this.loadUsers()}onFiltersChange(t){this.currentFilter=O({},t),this.currentPage.set(1),this.loadUsers()}onAddUser(){this.router.navigate(["/users/create"])}onRefreshData(){this.currentFilter={},this.currentPage.set(1),this.loadUsers()}onViewUser(t){this.router.navigate(["/users",t.id,"view"])}onEditUser(t){this.router.navigate(["/users",t.id,"edit"])}onDeleteUser(t){return L(this,null,function*(){let e=this.i18n.t("users.confirm_delete_user").replace("{{username}}",t.username);(yield this.confirmationService.confirm({title:this.i18n.t("users.delete_user"),message:e,confirmText:this.i18n.t("common.delete"),cancelText:this.i18n.t("common.cancel"),confirmButtonClass:"btn-danger",icon:"fa-trash",iconClass:"text-danger"})).confirmed&&this.usersService.deleteUser(t.id).subscribe({next:()=>{this.loadUsers(),this.notificationService.success(this.i18n.t("app.success"),this.i18n.t("users.user_deleted"))},error:m=>{let l=this.i18n.t("errors.server");m.error&&m.error.error&&(l=m.error.error),this.notificationService.error(this.i18n.t("app.error"),l)}})})}onManageRoles(t){this.selectedUser.set(t),this.showRoleManagement.set(!0)}onPageChange(t){this.currentPage.set(t),this.loadUsers()}onPageSizeChange(t){this.pageSize.set(t),this.currentPage.set(1),this.loadUsers()}onSelectionChange(t){console.log("Selected users:",t)}onSortChange(t){this.currentFilter=N(O({},this.currentFilter),{sortBy:t.column,sortDirection:t.direction}),this.currentPage.set(1),this.loadUsers()}onRolesUpdated(t){this.loadUsers(),this.notificationService.success(this.i18n.t("app.success"),"User roles updated successfully")}onCloseRoleManagement(){this.showRoleManagement.set(!1),this.selectedUser.set(null)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["app-users"]],decls:5,vars:10,consts:[[1,"app-list-page"],[3,"title"],["moduleName","users",3,"searchChange","filtersChange","add","refresh","refreshing"],[3,"viewUser","editUser","deleteUser","manageRoles","pageChange","pageSizeChange","selectionChange","sortChange","users","loading","currentPage","totalPages","totalItems","pageSize"],[3,"showChange","rolesUpdated","user","show"]],template:function(e,n){e&1&&(o(0,"div",0),v(1,"app-page-header",1),o(2,"app-unified-filter",2),S("searchChange",function(l){return n.onSearchChange(l)})("filtersChange",function(l){return n.onFiltersChange(l)})("add",function(){return n.onAddUser()})("refresh",function(){return n.onRefreshData()}),a(),o(3,"app-user-table",3),S("viewUser",function(l){return n.onViewUser(l)})("editUser",function(l){return n.onEditUser(l)})("deleteUser",function(l){return n.onDeleteUser(l)})("manageRoles",function(l){return n.onManageRoles(l)})("pageChange",function(l){return n.onPageChange(l)})("pageSizeChange",function(l){return n.onPageSizeChange(l)})("selectionChange",function(l){return n.onSelectionChange(l)})("sortChange",function(l){return n.onSortChange(l)}),a(),o(4,"app-role-management",4),S("showChange",function(){return n.onCloseRoleManagement()})("rolesUpdated",function(l){return n.onRolesUpdated(l)}),a()()),e&2&&(r(),g("title",n.i18n.t("users.title")),r(),g("refreshing",n.loading()),r(),g("users",n.users())("loading",n.loading)("currentPage",n.currentPage)("totalPages",n.totalPagesSignal)("totalItems",n.totalItemsSignal)("pageSize",n.pageSize),r(),g("user",n.selectedUser())("show",n.showRoleManagement()))},dependencies:[I,X,A,W],styles:[".users-page[_ngcontent-%COMP%]{padding:0}.avatar-sm[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.avatar-title[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:600}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.badge[_ngcontent-%COMP%]{font-size:.75rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:.25rem!important;margin-right:2px}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}.modal.show[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .15s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.table-responsive[_ngcontent-%COMP%]{border-radius:.375rem}.pagination[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{color:var(--bs-primary);border-color:var(--bs-border-color)}.pagination[_ngcontent-%COMP%]   .page-item.active[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{background-color:var(--bs-primary);border-color:var(--bs-primary)}.form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.input-group-text[_ngcontent-%COMP%]{background-color:var(--bs-light);border-color:var(--bs-border-color)}.card[_ngcontent-%COMP%]{box-shadow:0 .125rem .25rem #00000013;border:1px solid var(--bs-border-color)}.card-body[_ngcontent-%COMP%]{padding:1.5rem}.spinner-border[_ngcontent-%COMP%]{width:2rem;height:2rem}[dir=rtl][_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:0;margin-left:2px}[dir=rtl][_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .avatar-sm[_ngcontent-%COMP%]{margin-right:0;margin-left:.5rem}@media (max-width: 768px){.btn-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:0;width:100%}.table-responsive[_ngcontent-%COMP%]{font-size:.875rem}.badge[_ngcontent-%COMP%]{font-size:.7rem}}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar{height:8px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--bs-light);border-radius:4px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--bs-secondary);border-radius:4px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--bs-primary)}"]})};export{ie as UsersComponent};
