import{a as V}from"./chunk-3KGW4K32.js";import{a as U}from"./chunk-4QC5DFDN.js";import{a as A}from"./chunk-K7WTKFJQ.js";import{a as R}from"./chunk-MRHL7QNZ.js";import{a as B}from"./chunk-H5EPUHY6.js";import{a as $}from"./chunk-MUNQGSPX.js";import"./chunk-Y62N6K5S.js";import{a as L}from"./chunk-EYAJMHM7.js";import{a as N}from"./chunk-HHXRLUSQ.js";import"./chunk-S3CAEY4A.js";import{b as T}from"./chunk-TJ2U7DWW.js";import{d as w,g as O}from"./chunk-TWXUAMJ4.js";import{Bb as d,Db as p,Ea as P,H as b,I,Ia as f,R as l,Ub as C,Xa as x,Ya as _,Yb as m,bb as r,cb as s,da as u,db as c,eb as n,f as y,kb as S,pb as g,ta as t,tc as D,wb as E,wc as M}from"./chunk-JSQL33QG.js";import{d as v}from"./chunk-DGAILPFQ.js";function q(o,e){o&1&&n(0,"app-loading-spinner")}function W(o,e){o&1&&S(0)}function Y(o,e){if(o&1&&(n(0,"app-form-header",2),s(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"h6",7),n(6,"i",8),d(7),c()(),s(8,"div",9)(9,"app-definition-list",10),f(10,W,1,0,"ng-container",11),c()()()(),s(11,"div",4)(12,"div",5)(13,"div",6)(14,"h6",7),n(15,"i",12),d(16),c()(),s(17,"div",9),n(18,"app-definition-list",10),c()()(),s(19,"div",4)(20,"div",5)(21,"div",6)(22,"h6",7),n(23,"i",13),d(24),c()(),s(25,"div",9),n(26,"app-definition-list",10),c()()(),s(27,"div",4)(28,"div",5)(29,"div",6)(30,"h6",7),n(31,"i",14),d(32),c()(),s(33,"div",9),n(34,"app-definition-list",10),c()()(),s(35,"div",15)(36,"div",5)(37,"div",6)(38,"h6",7),n(39,"i",16),d(40),c()(),s(41,"div",9),n(42,"app-definition-list",17),c()()()()),o&2){let i=g(),a=E(4);r("title",i.t("excuse_policies.policy_details"))("entityId",i.policyId()??void 0),t(7),p(" ",i.t("excuse_policies.basic_information")," "),t(2),r("items",i.basicInfoItems()),t(),r("ngTemplateOutlet",a),t(6),p(" ",i.t("excuse_policies.monthly_limits")," "),t(2),r("items",i.monthlyLimitsItems()),t(6),p(" ",i.t("excuse_policies.time_limits")," "),t(2),r("items",i.timeLimitsItems()),t(6),p(" ",i.t("excuse_policies.policy_options")," "),t(2),r("items",i.policyOptionsItems()),t(6),p(" ",i.t("excuse_policies.audit_information")," "),t(2),r("items",i.auditInfoItems())("labelWidth","2")("valueWidth","10")}}function k(o,e){if(o&1&&n(0,"app-status-badge",18),o&2){let i=g();r("status",i.statusBadge().label)("variant",i.statusBadge().variant)}}var F=class o{router=l(O);route=l(w);excusePoliciesService=l(V);notificationService=l(N);confirmationService=l(B);destroy$=new y;i18n=l(T);permissionService=l($);loading=u(!1);policy=u(null);policyId=u(null);PERMISSIONS={POLICY_UPDATE:"settings.excusePolicy.update",POLICY_DELETE:"settings.excusePolicy.delete"};statusBadge=m(()=>{let e=this.policy();return e?{label:e.isActive?this.i18n.t("common.active"):this.i18n.t("common.inactive"),variant:e.isActive?"success":"secondary"}:{label:"",variant:"secondary"}});basicInfoItems=m(()=>{let e=this.policy();return e?[{label:this.i18n.t("excuse_policies.branch"),value:e.branchId===null?this.i18n.t("excuse_policies.organization_wide"):e.branchName||`Branch ${e.branchId}`},{label:this.i18n.t("common.status"),value:"",customContent:!0}]:[]});monthlyLimitsItems=m(()=>{let e=this.policy();return e?[{label:this.i18n.t("excuse_policies.max_personal_excuses_per_month"),value:`${e.maxPersonalExcusesPerMonth} ${this.i18n.t("excuse_policies.excuses")}`},{label:this.i18n.t("excuse_policies.max_personal_excuse_hours_per_month"),value:`${e.maxPersonalExcuseHoursPerMonth} ${this.i18n.t("common.hours")}`}]:[]});timeLimitsItems=m(()=>{let e=this.policy();return e?[{label:this.i18n.t("excuse_policies.max_personal_excuse_hours_per_day"),value:`${e.maxPersonalExcuseHoursPerDay} ${this.i18n.t("common.hours")}`},{label:this.i18n.t("excuse_policies.max_hours_per_excuse"),value:`${e.maxHoursPerExcuse} ${this.i18n.t("common.hours")}`},{label:this.i18n.t("excuse_policies.minimum_excuse_duration"),value:`${e.minimumExcuseDuration} ${this.i18n.t("common.hours")}`}]:[]});policyOptionsItems=m(()=>{let e=this.policy();return e?[{label:this.i18n.t("excuse_policies.requires_approval"),value:e.requiresApproval?this.i18n.t("common.yes"):this.i18n.t("common.no")},{label:this.i18n.t("excuse_policies.allow_partial_hour_excuses"),value:e.allowPartialHourExcuses?this.i18n.t("common.yes"):this.i18n.t("common.no")},{label:this.i18n.t("excuse_policies.allow_self_service_requests"),value:e.allowSelfServiceRequests?this.i18n.t("common.yes"):this.i18n.t("common.no")},{label:this.i18n.t("excuse_policies.max_retroactive_days"),value:`${e.maxRetroactiveDays} ${this.i18n.t("fields.daysUnit")}`}]:[]});auditInfoItems=m(()=>{let e=this.policy();if(!e)return[];let i=[{label:this.i18n.t("fields.createdBy"),value:e.createdBy},{label:this.i18n.t("fields.createdAt"),value:this.formatDate(e.createdAtUtc)}];return e.modifiedBy&&e.modifiedAtUtc&&i.push({label:this.i18n.t("fields.updatedBy"),value:e.modifiedBy},{label:this.i18n.t("fields.updatedAt"),value:this.formatDate(e.modifiedAtUtc)}),i});ngOnInit(){this.loadPolicy()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}t(e){return this.i18n.t(e)}loadPolicy(){this.loading.set(!0),this.route.paramMap.pipe(I(this.destroy$),b(e=>{let i=Number(e.get("id"));if(!i||i<=0)throw this.notificationService.error(this.i18n.t("app.error"),this.i18n.t("excuse_policies.errors.load_failed")),this.router.navigate(["/settings/excuse-policies"]),new Error("Invalid excuse policy ID");return this.policyId.set(i),this.excusePoliciesService.getExcusePolicyById(i)})).subscribe({next:e=>{this.loading.set(!1),this.policy.set(e)},error:e=>{this.loading.set(!1),console.error("Failed to load excuse policy:",e),this.notificationService.error(this.i18n.t("app.error"),this.i18n.t("excuse_policies.errors.load_failed")),this.router.navigate(["/settings/excuse-policies"])}})}formatDate(e){return new Date(e).toLocaleDateString(this.i18n.getCurrentLocale(),{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}onEdit(){let e=this.policy();e&&this.router.navigate(["/settings/excuse-policies",e.id,"edit"])}onToggleStatus(){return v(this,null,function*(){let e=this.policy();if(!e||!this.permissionService.has(this.PERMISSIONS.POLICY_UPDATE)){this.notificationService.error(this.i18n.t("app.error"),this.i18n.t("common.errors.insufficient_permissions"));return}let i=e.isActive?"deactivate":"activate";(yield this.confirmationService.confirm({title:this.i18n.t(`excuse_policies.${i}_title`),message:this.i18n.t(`excuse_policies.confirm_${i}`),confirmText:this.i18n.t(`common.${i}`),cancelText:this.i18n.t("common.cancel"),confirmButtonClass:"btn-primary",icon:"fa-toggle-on",iconClass:"text-primary"})).confirmed&&this.excusePoliciesService.toggleExcusePolicyStatus(e.id).subscribe({next:()=>{let h=e.isActive?this.i18n.t("excuse_policies.deactivate_success"):this.i18n.t("excuse_policies.activate_success");this.notificationService.success(this.i18n.t("app.success"),h),this.loadPolicy()},error:h=>{console.error("Failed to toggle policy status:",h);let H=e.isActive?this.i18n.t("excuse_policies.deactivate_error"):this.i18n.t("excuse_policies.activate_error");this.notificationService.error(this.i18n.t("app.error"),H)}})})}onDelete(){return v(this,null,function*(){let e=this.policy();if(!e||!this.permissionService.has(this.PERMISSIONS.POLICY_DELETE)){this.notificationService.error(this.i18n.t("app.error"),this.i18n.t("common.errors.insufficient_permissions"));return}(yield this.confirmationService.confirm({title:this.i18n.t("excuse_policies.delete_title"),message:this.i18n.t("excuse_policies.confirm_delete"),confirmText:this.i18n.t("common.delete"),cancelText:this.i18n.t("common.cancel"),confirmButtonClass:"btn-danger",icon:"fa-trash",iconClass:"text-danger"})).confirmed&&this.excusePoliciesService.deleteExcusePolicy(e.id).subscribe({next:()=>{this.notificationService.success(this.i18n.t("app.success"),this.i18n.t("excuse_policies.delete_success")),this.router.navigate(["/settings/excuse-policies"])},error:a=>{console.error("Failed to delete excuse policy:",a),this.notificationService.error(this.i18n.t("app.error"),this.i18n.t("excuse_policies.delete_error"))}})})}onBack(){this.router.navigate(["/settings/excuse-policies"])}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=P({type:o,selectors:[["app-view-excuse-policy"]],decls:5,vars:2,consts:[["statusBadgeTemplate",""],[1,"container-fluid"],["mode","view","moduleName","excuse_policies","moduleRoute","settings/excuse-policies",3,"title","entityId"],[1,"row"],[1,"col-md-6","mb-4"],[1,"card"],[1,"card-header","bg-light"],[1,"mb-0"],[1,"fas","fa-info-circle","me-2"],[1,"card-body"],[3,"items"],[4,"ngTemplateOutlet"],[1,"fas","fa-calendar-alt","me-2"],[1,"fas","fa-clock","me-2"],[1,"fas","fa-cog","me-2"],[1,"col-12","mb-4"],[1,"fas","fa-history","me-2"],[3,"items","labelWidth","valueWidth"],[3,"status","variant"]],template:function(i,a){i&1&&(s(0,"div",1),x(1,q,1,0,"app-loading-spinner"),x(2,Y,43,15),c(),f(3,k,1,2,"ng-template",null,0,C)),i&2&&(t(),_(a.loading()?1:-1),t(),_(!a.loading()&&a.policy()?2:-1))},dependencies:[M,D,U,L,A,R],styles:[".container-fluid[_ngcontent-%COMP%]{padding:1.5rem}.card[_ngcontent-%COMP%]{border:1px solid #dee2e6;box-shadow:0 .125rem .25rem #00000013}.card-header[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:.75rem 1rem}.card-header[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-weight:600;color:#495057}@media (max-width: 768px){.container-fluid[_ngcontent-%COMP%]{padding:1rem}.btn-group[_ngcontent-%COMP%]{flex-direction:column;width:100%}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:.25rem!important;margin-bottom:.5rem}}"]})};export{F as ViewExcusePolicyComponent};
