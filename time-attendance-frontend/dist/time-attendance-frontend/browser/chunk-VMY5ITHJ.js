import{a as ee}from"./chunk-UNGT5UFZ.js";import"./chunk-GBFD7MFB.js";import{a as K}from"./chunk-CN5BQHKT.js";import{a as Z}from"./chunk-HLRJHZ6V.js";import{a as W}from"./chunk-NPDCAEA6.js";import{a as Q}from"./chunk-XU52F2ZD.js";import{a as X}from"./chunk-INX4ARZ5.js";import{a as J}from"./chunk-U6T3NABJ.js";import{a as Y}from"./chunk-QXVLGI72.js";import{a as U}from"./chunk-H5EPUHY6.js";import{p as H,r as V,x as j}from"./chunk-VRETN7JA.js";import"./chunk-GRQ6RO47.js";import{a as G}from"./chunk-UBCI4X5Q.js";import{a as q}from"./chunk-EYAJMHM7.js";import{a as z}from"./chunk-HHXRLUSQ.js";import{b as $}from"./chunk-RUY4WPQA.js";import{d as B,g as N,m as F}from"./chunk-TWXUAMJ4.js";import{$a as A,Bb as s,Cb as g,Db as y,Ea as w,Eb as P,W as C,X as S,Xa as D,Ya as x,Yb as b,Zb as R,ab as O,bb as h,cb as r,da as u,db as o,eb as f,lb as E,nb as v,pb as m,ta as i,wc as L,ya as _,yb as k}from"./chunk-JSQL33QG.js";import{a as I,b as T,d as M}from"./chunk-DGAILPFQ.js";var ne=(c,e)=>e.value;function ae(c,e){if(c&1){let t=E();r(0,"div",11)(1,"div",46)(2,"div")(3,"h5",47),f(4,"i",48),s(5),o(),r(6,"small",49),s(7),o()()(),r(8,"div",13)(9,"div",50)(10,"div",51)(11,"label",16),s(12),o(),r(13,"input",17),v("change",function(a){C(t);let l=m();return S(l.onManualCalculationDateChange(a))}),o()(),r(14,"div",52)(15,"div",53)(16,"button",54),v("click",function(){C(t);let a=m();return S(a.generateMissingAttendanceForDate())}),f(17,"i",55),s(18),o(),r(19,"button",56),v("click",function(){C(t);let a=m();return S(a.forceRecalculateAllForDate())}),f(20,"i",55),s(21),o()(),r(22,"small",57),s(23),o()()()()()}if(c&2){let t=m();i(5),y(" ",t.i18n.t("attendance.manual_calculation.title")," "),i(2),g(t.i18n.t("attendance.manual_calculation.subtitle")),i(5),g(t.i18n.t("attendance.manual_calculation.select_date")),i(),h("value",t.manualCalculationDate())("disabled",t.calculatingBulk()),i(3),h("disabled",t.calculatingBulk())("title",t.i18n.t("attendance.manual_calculation.generate_missing_help")),i(),k("fa-plus",!t.calculatingBulk())("fa-spinner",t.calculatingBulk())("fa-spin",t.calculatingBulk()),i(),y("",t.i18n.t("attendance.manual_calculation.generate_missing")," "),i(),h("disabled",t.calculatingBulk())("title",t.i18n.t("attendance.manual_calculation.recalculate_all_help")),i(),k("fa-calculator",!t.calculatingBulk())("fa-spinner",t.calculatingBulk())("fa-spin",t.calculatingBulk()),i(),y("",t.i18n.t("attendance.manual_calculation.recalculate_all")," "),i(2),y(" ",t.i18n.t("attendance.manual_calculation.date_info").replace("{{date}}",t.manualCalculationDate())," ")}}function ie(c,e){if(c&1&&(r(0,"option",21),s(1),o()),c&2){let t=e.$implicit,n=m();h("value",t.value===null?"":t.value),i(),y(" ",n.i18n.t(t.label)," ")}}function le(c,e){if(c&1&&(r(0,"div",41),f(1,"app-loading-spinner",58),o()),c&2){let t=m();i(),h("message",t.i18n.t("attendance.messages.loading_data"))("variant","primary")("centered",!0)}}function re(c,e){if(c&1){let t=E();r(0,"button",62),v("click",function(){C(t);let a=m(2);return S(a.clearFilters())}),f(1,"i",63),s(2),o()}if(c&2){let t=m(2);h("title",t.i18n.t("attendance.actions.try_with_filter")),i(2),y(" ",t.i18n.t("attendance.actions.add_filter")," ")}}function oe(c,e){if(c&1&&(r(0,"div",42)(1,"div",59)(2,"div"),f(3,"i",60),s(4),o(),D(5,re,3,2,"button",61),o()()),c&2){let t=m();i(4),y(" ",t.error()," "),i(),x(t.hasActiveFilters()?-1:5)}}function se(c,e){if(c&1&&(r(0,"div",43),f(1,"i",64),s(2),r(3,"strong",65),s(4),o(),r(5,"div",66)(6,"small",49),s(7),o()()()),c&2){let t=m();i(2),y(" ",t.i18n.t("attendance.hints.better_performance")," "),i(2),g(t.i18n.t("attendance.hints.use_filters")),i(3),y(" ",t.i18n.t("attendance.hints.filter_help")||"Please select a Branch, Department, or Employee to view attendance records for today."," ")}}function ce(c,e){if(c&1){let t=E();r(0,"div",44)(1,"div",67)(2,"label",16),s(3),o(),r(4,"input",68),v("input",function(a){C(t);let l=m();return S(l.onSearchChange(a))}),o()()()}if(c&2){let t=m();i(3),g(t.i18n.t("attendance.filters.search")),i(),h("placeholder",t.i18n.t("attendance.filters.search_placeholder"))("disabled",t.loading())}}function de(c,e){if(c&1&&(r(0,"div",41),f(1,"i",74),r(2,"h5",49),s(3),o(),r(4,"p",49),s(5),o()()),c&2){let t=m(2);i(3),g(t.i18n.t("attendance.no_records")),i(2),g(t.i18n.t("attendance.no_records_description"))}}function ue(c,e){if(c&1){let t=E();r(0,"div")(1,"app-data-table",75),v("sortChange",function(a){C(t);let l=m(2);return S(l.onSort(a))})("actionClick",function(a){C(t);let l=m(2);return S(l.onActionClick(a))})("pageChange",function(a){C(t);let l=m(2);return S(l.onPageChange(a))})("pageSizeChange",function(a){C(t);let l=m(2);return S(l.onPageSizeChange(a))}),o()()}if(c&2){let t=m(2);i(),h("data",t.tableData())("columns",t.tableColumns())("actions",t.tableActions())("loading",t.loading)("showPagination",!0)("currentPage",t.currentPage)("totalPages",t.tableTotalPages)("totalItems",t.tableTotalItems)("pageSize",t.pageSize)("sortColumn",t.sortColumn)("sortDirection",t.sortDirection)("responsiveMode","horizontal-scroll")("emptyMessage",t.i18n.t("attendance.daily.no_records"))}}function me(c,e){if(c&1&&(r(0,"div",45)(1,"div",69)(2,"div",24)(3,"h5",70),f(4,"i",71),s(5),o(),r(6,"span",72),s(7),o()()(),r(8,"div",73),D(9,de,6,2,"div",41),D(10,ue,2,13,"div"),o()()),c&2){let t=m();i(5),y(" ",t.i18n.t("attendance.daily_records")," "),i(2),P("",t.filteredRecords().length," ",t.i18n.t("attendance.records")),i(2),x(t.filteredRecords().length===0?9:-1),i(),x(t.filteredRecords().length>0?10:-1)}}var te=class c{constructor(e,t,n,a,l,d,p,ge,pe,he){this.attendanceService=e;this.employeesService=t;this.departmentsService=n;this.branchesService=a;this.shiftAssignmentService=l;this.i18n=d;this.notificationService=p;this.confirmationService=ge;this.router=pe;this.route=he;R(()=>{this.tableTotalPages.set(this.totalPages()),this.tableTotalItems.set(this.totalItems())})}attendanceRecords=u([]);selectedDate=u(new Date().toISOString().split("T")[0]);loading=u(!0);error=u(null);searchTerm=u("");selectedStatus=u(null);selectedEmployeeId=u(null);selectedDepartmentId=u(null);selectedBranchId=u(null);calculating=u(!1);calculatingBulk=u(!1);manualCalculationDate=u(new Date().toISOString().split("T")[0]);currentPage=u(1);pageSize=u(10);sortColumn=u("");sortDirection=u("asc");tableTotalPages=u(1);tableTotalItems=u(0);availableEmployees=u([]);availableDepartments=u([]);availableBranches=u([]);loadingEmployees=u(!1);loadingDepartments=u(!1);loadingBranches=u(!1);filteredRecords=b(()=>{let e=this.attendanceRecords(),t=this.searchTerm().toLowerCase(),n=this.selectedStatus();return e.filter(a=>{let l=!t||a.employeeName.toLowerCase().includes(t)||a.employeeNumber.toLowerCase().includes(t),d=n===null||a.status===n;return l&&d})});sortedRecords=b(()=>{let e=[...this.filteredRecords()],t=this.sortColumn(),n=this.sortDirection();return t?e.sort((a,l)=>{let d=this.getValueForSorting(a,t),p=this.getValueForSorting(l,t);return d==null&&p==null?0:d==null?n==="asc"?1:-1:p==null||(typeof d=="string"&&(d=d.toLowerCase()),typeof p=="string"&&(p=p.toLowerCase()),d<p)?n==="asc"?-1:1:d>p?n==="asc"?1:-1:0}):e});totalItems=b(()=>this.sortedRecords().length);totalPages=b(()=>Math.ceil(this.totalItems()/this.pageSize()));paginatedRecords=b(()=>{let e=this.sortedRecords(),t=this.currentPage(),n=this.pageSize(),a=(t-1)*n,l=a+n;return e.slice(a,l)});totalEmployees=b(()=>this.filteredRecords().length);presentEmployees=b(()=>this.filteredRecords().filter(e=>e.status===1).length);absentEmployees=b(()=>this.filteredRecords().filter(e=>e.status===2).length);lateEmployees=b(()=>this.filteredRecords().filter(e=>this.calculateTotalLateMinutes(e)>0).length);employeeSelectOptions=b(()=>{let e=[{value:null,label:this.i18n.t("attendance.filters.all_employees")}];return this.availableEmployees().forEach(t=>{e.push({value:t.id,label:t.name,subLabel:t.employeeNumber})}),e});departmentSelectOptions=b(()=>{let e=[{value:null,label:this.i18n.t("attendance.filters.all_departments")}];return this.availableDepartments().forEach(t=>{e.push({value:t.id,label:t.name,subLabel:t.nameAr||""})}),e});branchSelectOptions=b(()=>{let e=[{value:null,label:this.i18n.t("attendance.filters.all_branches")}];return this.availableBranches().forEach(t=>{e.push({value:t.id,label:t.name,subLabel:t.code})}),e});AttendanceStatus=Y;availableStatuses=[{value:null,label:"attendance.filters.all_statuses"},{value:1,label:"attendance.status.present"},{value:2,label:"attendance.status.absent"},{value:3,label:"attendance.status.late"},{value:4,label:"attendance.status.early_leave"},{value:5,label:"attendance.status.on_leave"},{value:7,label:"attendance.status.overtime"}];tableColumns=b(()=>[{key:"employeeNumber",label:this.i18n.t("attendance.fields.employee_number"),sortable:!0,width:"120px",priority:"high",mobileLabel:this.i18n.t("attendance.fields.emp_no")},{key:"employeeName",label:this.i18n.t("attendance.fields.employee_name"),sortable:!0,width:"200px",priority:"high",mobileLabel:this.i18n.t("attendance.fields.name")},{key:"status",label:this.i18n.t("attendance.fields.status"),sortable:!0,width:"120px",align:"center",priority:"high",mobileLabel:this.i18n.t("attendance.fields.status"),renderHtml:!0},{key:"checkIn",label:this.i18n.t("attendance.fields.check_in"),sortable:!1,width:"100px",align:"center",priority:"medium",mobileLabel:this.i18n.t("attendance.fields.in")},{key:"checkOut",label:this.i18n.t("attendance.fields.check_out"),sortable:!1,width:"100px",align:"center",priority:"medium",mobileLabel:this.i18n.t("attendance.fields.out")},{key:"workingHours",label:this.i18n.t("attendance.fields.working_hours"),sortable:!0,width:"120px",align:"center",priority:"medium",hideOnMobile:!1,mobileLabel:this.i18n.t("attendance.fields.work_hrs")},{key:"scheduledHours",label:this.i18n.t("attendance.fields.scheduled_hours"),sortable:!0,width:"120px",align:"center",priority:"low",hideOnMobile:!0,mobileLabel:this.i18n.t("attendance.fields.sched_hrs")},{key:"overtimeHours",label:this.i18n.t("attendance.fields.overtime_hours"),sortable:!0,width:"120px",align:"center",priority:"low",hideOnMobile:!0,mobileLabel:this.i18n.t("attendance.fields.overtime")},{key:"lateMinutes",label:this.i18n.t("attendance.fields.late_minutes"),sortable:!0,width:"90px",align:"center",priority:"low",hideOnMobile:!0,mobileLabel:this.i18n.t("attendance.fields.late")},{key:"earlyLeaveMinutes",label:this.i18n.t("attendance.fields.early_leave_minutes"),sortable:!0,width:"90px",align:"center",priority:"low",hideOnMobile:!0,mobileLabel:this.i18n.t("attendance.fields.early")},{key:"totalLateMinutes",label:this.i18n.t("attendance.fields.total_late"),sortable:!0,width:"90px",align:"center",priority:"medium",hideOnMobile:!1,mobileLabel:this.i18n.t("attendance.fields.total_late")}]);tableActions=b(()=>[{key:"view",label:this.i18n.t("attendance.actions.view_details"),icon:"fa-eye",color:"primary",condition:()=>!0},{key:"edit",label:this.i18n.t("attendance.actions.edit_record"),icon:"fa-edit",color:"secondary",condition:()=>!0},{key:"change-shift",label:this.i18n.t("attendance.actions.change_shift"),icon:"fa-clock",color:"warning",condition:()=>!0},{key:"recalculate",label:this.i18n.t("attendance.actions.recalculate"),icon:"fa-calculator",color:"info",condition:()=>!0}]);getAttendanceRatePercentage(){let e=this.filteredRecords(),t=e.length;if(t===0)return 0;let n=e.filter(a=>a.status===1||a.status===3||a.status===7).length;return Math.round(n/t*100)}ngOnInit(){this.route.queryParams.subscribe(e=>{let t=e.date;t&&(this.selectedDate.set(t),this.manualCalculationDate.set(t))}),this.loadFilterOptions(),this.checkInitialLoad()}checkInitialLoad(){this.loading.set(!0),this.error.set(null);let e=this.selectedDate();console.log("=== DEBUG: Initial load attempt ==="),console.log("Date:",e),this.attendanceService.getDailyAttendance(e).subscribe({next:t=>{console.log("=== DEBUG: Initial load successful ==="),console.log("Records count:",t.length),this.attendanceRecords.set(t),this.loading.set(!1)},error:t=>{if(console.log("=== DEBUG: Initial load failed (expected if filters required) ==="),console.log("Error:",t),t?.status===400&&(t?.error?.includes?.("filter")||t?.error?.includes?.("must be specified")))this.loading.set(!1),this.error.set(null),this.attendanceRecords.set([]);else{let n=this.getDetailedErrorMessage(t);this.error.set(n),this.loading.set(!1),this.notificationService.error(n)}}})}ngOnDestroy(){}loadDailyAttendance(){this.loading.set(!0),this.error.set(null);let e=this.selectedDate(),t=this.selectedBranchId(),n=this.selectedDepartmentId(),a=this.selectedEmployeeId();console.log("=== DEBUG: Loading daily attendance ==="),console.log("Date:",e),console.log("Branch ID:",t),console.log("Department ID:",n),console.log("Employee ID:",a),console.log("Current records before loading:",this.attendanceRecords().length),this.attendanceService.getDailyAttendance(e,t||void 0,n||void 0,a||void 0).subscribe({next:l=>{if(console.log("=== DEBUG: Received attendance records ==="),console.log("Records count:",l.length),console.log("Records data:",l),l.length>0){let d=l[0];console.log("=== DEBUG: First record time fields ==="),console.log("checkInTime:",d.checkInTime),console.log("checkOutTime:",d.checkOutTime),console.log("actualCheckInTime:",d.actualCheckInTime),console.log("actualCheckOutTime:",d.actualCheckOutTime),console.log("scheduledStartTime:",d.scheduledStartTime),console.log("scheduledEndTime:",d.scheduledEndTime)}this.attendanceRecords.set(l),this.loading.set(!1),console.log("Records after setting:",this.attendanceRecords().length),console.log("Filtered records count:",this.filteredRecords().length)},error:l=>{console.error("=== DEBUG: Error loading daily attendance ==="),console.error("Error object:",l),console.error("Error status:",l?.status),console.error("Error message:",l?.message),console.error("Error error:",l?.error);let d=this.getDetailedErrorMessage(l);this.error.set(d),this.loading.set(!1),this.notificationService.error(d)}})}onDateChange(e){let t=e.target;this.selectedDate.set(t.value),this.loadDailyAttendance()}onSearchChange(e){let t=e.target;this.searchTerm.set(t.value)}onStatusChange(e){let t=e.target,n=t.value===""?null:parseInt(t.value);this.selectedStatus.set(n)}onEmployeeSelectionChange(e){this.selectedEmployeeId.set(e),this.loadDailyAttendance(),e===null&&this.selectedBranchId()&&this.loadEmployeesForBranch(this.selectedBranchId())}onDepartmentSelectionChange(e){this.selectedDepartmentId.set(e),this.loadDailyAttendance()}onBranchSelectionChange(e){this.selectedBranchId.set(e),this.loadDailyAttendance(),this.selectedEmployeeId.set(null),e?this.loadEmployeesForBranch(e):this.loadEmployeesForBranch()}loadEmployeesForBranch(e){this.loadingEmployees.set(!0),this.employeesService.getEmployeesForSelection(e).subscribe({next:t=>{this.availableEmployees.set(t),this.loadingEmployees.set(!1)},error:t=>{console.error("Error loading employees for branch:",t),this.loadingEmployees.set(!1)}})}loadFilterOptions(){this.loadingEmployees.set(!0),this.employeesService.getEmployeesForSelection().subscribe({next:e=>{this.availableEmployees.set(e),this.loadingEmployees.set(!1)},error:e=>{console.error("Error loading employees:",e),this.loadingEmployees.set(!1)}}),this.loadingDepartments.set(!0),this.departmentsService.getDepartments({}).subscribe({next:e=>{this.availableDepartments.set(e),this.loadingDepartments.set(!1)},error:e=>{console.error("Error loading departments:",e),this.loadingDepartments.set(!1)}}),this.loadingBranches.set(!0),this.branchesService.getBranches(1,1e3).subscribe({next:e=>{this.availableBranches.set(e.items),this.loadingBranches.set(!1)},error:e=>{console.error("Error loading branches:",e),this.loadingBranches.set(!1)}})}getStatusBadgeClass(e){switch(e){case 1:return"badge bg-success";case 2:return"badge bg-danger";case 3:return"badge bg-warning";case 4:return"badge bg-warning";case 5:return"badge bg-info";case 6:return"badge bg-secondary";case 7:return"badge bg-primary";case 8:return"badge bg-danger";case 9:return"badge bg-secondary";case 10:return"badge bg-warning";case 12:return"badge bg-info";case 13:return"badge bg-info";case 14:return"badge bg-primary";default:return"badge bg-secondary"}}getStatusText(e){switch(e){case 1:return"attendance.status.present";case 2:return"attendance.status.absent";case 3:return"attendance.status.late";case 4:return"attendance.status.early_leave";case 5:return"attendance.status.on_leave";case 6:return"attendance.status.day_off";case 7:return"attendance.status.overtime";case 8:return"attendance.status.incomplete";case 9:return"attendance.status.holiday";case 10:return"attendance.status.sick_leave";case 11:return"attendance.status.pending";case 12:return"attendance.status.on_duty";case 13:return"attendance.status.excused";case 14:return"attendance.status.remote_work";default:return"attendance.status.pending"}}formatTime(e){if(!e)return"--:--";try{let t=e;if(e.includes("T")&&(t=e.split("T")[1].split("Z")[0]),t.includes(":")){let n=new Date(`1970-01-01T${t}`);if(!isNaN(n.getTime()))return n.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}return t}catch{return e||"--:--"}}getCheckInTime(e){return e.checkInTime||e.actualCheckInTime||null}getCheckOutTime(e){return e.checkOutTime||e.actualCheckOutTime||null}formatHours(e){if(!e||e===0)return"0h 0m";let t=Math.floor(e),n=Math.round((e-t)*60);return t===0?`${n}m`:n===0?`${t}h`:`${t}h ${n}m`}formatLateTime(e){if(!e||e===0)return"--";let t=Math.floor(e/60),n=e%60;return t===0?`${n}m`:n===0?`${t}h`:`${t}h ${n}m`}calculateTotalLateMinutes(e){let t=e.lateMinutes||0,n=e.earlyLeaveMinutes||0;return t+n}formatStatusForTable(e){let t=this.i18n.t(this.getStatusText(e));return`<span class="${this.getStatusBadgeClass(e)}">${t}</span>`}getWorkingHoursClass(e,t){return!e||!t?"text-muted":e>=t?"text-success":e>=t*.8?"text-warning":"text-danger"}getLateTimeClass(e){return!e||e===0?"text-muted":e<=15?"text-warning":"text-danger"}viewDailyAttendanceDetail(e){this.router.navigate(["/attendance/daily-detail",e,this.selectedDate()])}viewEmployeeDetail(e){this.router.navigate(["/attendance/employee",e])}editAttendanceRecord(e){this.router.navigate(["/attendance/edit",e.id],{queryParams:{returnDate:this.selectedDate()}})}onSort(e){this.sortColumn.set(e.column),this.sortDirection.set(e.direction),this.currentPage.set(1)}onPageChange(e){this.currentPage.set(e)}onPageSizeChange(e){this.pageSize.set(e),this.currentPage.set(1)}getValueForSorting(e,t){switch(t){case"employeeNumber":return e.employeeNumber;case"employeeName":return e.employeeName;case"status":return e.status||0;case"workingHours":return e.workingHours||0;case"scheduledHours":return e.scheduledHours||0;case"lateMinutes":return e.lateMinutes||0;default:return e[t]}}onActionClick(e){let{action:t,item:n}=e;switch(t){case"view":this.viewDailyAttendanceDetail(n.employeeId);break;case"edit":this.editAttendanceRecord(n);break;case"change-shift":this.router.navigate(["/attendance",n.id,"change-shift"]);break;case"recalculate":this.recalculateEmployeeAttendance(n.employeeId);break;default:console.warn("Unknown action:",t)}}tableData=b(()=>this.paginatedRecords().map(e=>T(I({},e),{status:this.formatStatusForTable(e.status),checkIn:this.formatTime(this.getCheckInTime(e)),checkOut:this.formatTime(this.getCheckOutTime(e)),workingHours:this.formatHours(e.workingHours),scheduledHours:this.formatHours(e.scheduledHours),overtimeHours:this.formatHours(e.overtimeHours),lateMinutes:this.formatLateTime(e.lateMinutes),earlyLeaveMinutes:this.formatLateTime(e.earlyLeaveMinutes),totalLateMinutes:this.formatLateTime(this.calculateTotalLateMinutes(e))})));exportData(){let e=this.filteredRecords();if(e.length===0){this.notificationService.warning("No data to export");return}let t=this.generateCSV(e);this.downloadCSV(t,`daily-attendance-${this.selectedDate()}.csv`),this.notificationService.success("Data exported successfully")}generateCSV(e){let t=["Employee Number","Employee Name","Status","Check In","Check Out","Working Hours","Scheduled Hours","Overtime Hours","Late Minutes","Early Leave Minutes","Total Late"],n=e.map(a=>[a.employeeNumber,a.employeeName,this.i18n.t(this.getStatusText(a.status)),this.formatTime(this.getCheckInTime(a)),this.formatTime(this.getCheckOutTime(a)),this.formatHours(a.workingHours),this.formatHours(a.scheduledHours),this.formatHours(a.overtimeHours),this.formatLateTime(a.lateMinutes),this.formatLateTime(a.earlyLeaveMinutes),this.formatLateTime(this.calculateTotalLateMinutes(a))]);return[t,...n].map(a=>a.map(l=>`"${l}"`).join(",")).join(`
`)}downloadCSV(e,t){let n=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");if(a.download!==void 0){let l=URL.createObjectURL(n);a.setAttribute("href",l),a.setAttribute("download",t),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}onRefresh(){this.loadDailyAttendance()}trackByEmployeeId(e,t){return t.employeeId}getDetailedErrorMessage(e){return e?.status===400?e?.error&&typeof e.error=="string"?e.error.includes("At least one filter")||e.error.includes("must be specified")?"To view attendance records, please select at least one filter: Employee, Department, or Branch. You can also contact your administrator if you need access to view all records.":e.error:"Please select at least one filter (Employee, Department, or Branch) to view attendance records.":e?.status===403?"You do not have permission to view attendance records. Please contact your administrator.":e?.status===404?"No attendance records found for the selected criteria.":e?.status===500?"Server error occurred while loading attendance records. Please try again or contact support.":e?.error&&typeof e.error=="string"?e.error:e?.message?e.message:"Failed to load daily attendance records. Please try again."}hasActiveFilters(){return!!(this.selectedEmployeeId()||this.selectedDepartmentId()||this.selectedBranchId())}clearFilters(){this.selectedEmployeeId.set(null),this.selectedDepartmentId.set(null),this.selectedBranchId.set(null),this.selectedStatus.set(null),this.searchTerm.set(""),document.querySelectorAll("select").forEach(n=>n.value="");let t=document.querySelector('input[type="text"]');t&&(t.value=""),this.loadEmployeesForBranch(),this.loadDailyAttendance()}recalculateEmployeeAttendance(e){return M(this,null,function*(){let t=this.selectedDate();(yield this.confirmationService.confirm({title:this.i18n.t("attendance.actions.recalculate"),message:this.i18n.t("attendance.confirmations.recalculate_employee"),confirmText:this.i18n.t("app.confirm"),cancelText:this.i18n.t("app.cancel"),confirmButtonClass:"btn-info",icon:"fa-calculator",iconClass:"text-info"})).confirmed&&(this.calculating.set(!0),this.attendanceService.calculateAttendanceForEmployeeDate(e,t).subscribe({next:a=>{let l=this.attendanceRecords(),d=l.findIndex(p=>p.employeeId===e);if(d!==-1){let p=[...l];p[d]=a,this.attendanceRecords.set(p)}this.calculating.set(!1),this.notificationService.success(this.i18n.t("attendance.messages.recalculation_success"))},error:a=>{console.error("Error recalculating attendance:",a),this.calculating.set(!1);let l="Failed to recalculate attendance";a?.error&&typeof a.error=="string"&&(l=a.error),this.notificationService.error(l)}}))})}calculateAllEmployees(e=!1){this.calculateAllEmployeesForDate(this.selectedDate(),e)}calculateAllEmployeesForDate(e,t=!1){return M(this,null,function*(){let n=t?this.i18n.t("attendance.actions.recalculate_all"):this.i18n.t("attendance.actions.generate_missing"),a=t?this.i18n.t("attendance.confirmations.recalculate_all").replace("{{date}}",e):this.i18n.t("attendance.confirmations.generate_missing").replace("{{date}}",e);(yield this.confirmationService.confirm({title:n,message:a,confirmText:this.i18n.t("app.confirm"),cancelText:this.i18n.t("app.cancel"),confirmButtonClass:t?"btn-warning":"btn-info",icon:t?"fa-calculator":"fa-plus",iconClass:t?"text-warning":"text-info"})).confirmed&&(this.calculatingBulk.set(!0),this.attendanceService.calculateAttendanceForDate(e,t).subscribe({next:d=>{this.calculatingBulk.set(!1);let p=this.i18n.t("attendance.messages.bulk_calculation_success").replace("{{generated}}",d.recordsGenerated.toString()).replace("{{updated}}",d.recordsUpdated.toString()).replace("{{date}}",e);this.notificationService.success(p),e===this.selectedDate()&&this.loadDailyAttendance()},error:d=>{console.error("Error calculating attendance for all employees:",d),this.calculatingBulk.set(!1);let p=this.i18n.t("attendance.messages.calculation_failed");d?.error&&typeof d.error=="string"&&(p=d.error),this.notificationService.error(p)}}))})}forceRecalculateAll(){this.calculateAllEmployees(!0)}generateMissingAttendance(){this.calculateAllEmployees(!1)}generateMissingAttendanceForDate(){this.calculateAllEmployeesForDate(this.manualCalculationDate(),!1)}forceRecalculateAllForDate(){this.calculateAllEmployeesForDate(this.manualCalculationDate(),!0)}onManualCalculationDateChange(e){let t=e.target;this.manualCalculationDate.set(t.value)}canManuallyCalculate(){return!0}hasIncompleteRecords(){return this.filteredRecords().some(e=>e.status===8||e.status===11)}getMissingRecordsInfo(){let e=this.availableEmployees().length,t=this.attendanceRecords().length,n=Math.max(0,e-t);return n>0?this.i18n.t("attendance.info.missing_records").replace("{{count}}",n.toString()):""}static \u0275fac=function(t){return new(t||c)(_(K),_(J),_(X),_(Q),_(ee),_($),_(z),_(U),_(N),_(B))};static \u0275cmp=w({type:c,selectors:[["app-daily-attendance"]],decls:91,vars:49,consts:[[1,"container-fluid","p-4"],[3,"title"],[1,"row","mb-4"],[1,"col-12"],[1,"d-flex","justify-content-end","align-items-center"],["type","button",1,"btn","btn-outline-secondary","me-2",3,"click","disabled","title"],[1,"fa-solid","fa-filter-circle-xmark","me-2"],["type","button",1,"btn","btn-outline-primary","me-2",3,"click","disabled"],[1,"fa-solid","fa-refresh","me-2"],["type","button",1,"btn","btn-success",3,"click","disabled"],[1,"fa-solid","fa-download","me-2"],[1,"card","mb-4","border-info"],[1,"card","mb-4"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-2"],[1,"form-label"],["type","date",1,"form-control",3,"change","value","disabled"],[3,"selectionChange","options","loading","disabled","placeholder","clearable","value"],[3,"selectionChange","options","loading","disabled","placeholder","clearable","searchable","value"],[1,"form-select",3,"change","disabled"],[3,"value"],[1,"col-md-3","mb-3"],[1,"card","stats-card","border-start","border-primary","border-4"],[1,"d-flex","justify-content-between","align-items-center"],[1,"card-title","text-muted","small"],[1,"text-primary","mb-0"],[1,"icon-circle","bg-primary","bg-opacity-10"],[1,"fa-solid","fa-users","text-primary"],[1,"card","stats-card","border-start","border-success","border-4"],[1,"text-success","mb-0"],[1,"icon-circle","bg-success","bg-opacity-10"],[1,"fa-solid","fa-user-check","text-success"],[1,"card","stats-card","border-start","border-danger","border-4"],[1,"text-danger","mb-0"],[1,"icon-circle","bg-danger","bg-opacity-10"],[1,"fa-solid","fa-user-times","text-danger"],[1,"card","stats-card","border-start","border-warning","border-4"],[1,"text-warning","mb-0"],[1,"icon-circle","bg-warning","bg-opacity-10"],[1,"fa-solid","fa-clock","text-warning"],[1,"text-center","py-5"],[1,"alert","alert-danger"],[1,"alert","alert-info"],[1,"row","mb-3"],[1,"card"],[1,"card-header","bg-light"],[1,"mb-1"],[1,"fa-solid","fa-calculator","me-2","text-info"],[1,"text-muted"],[1,"row","align-items-end"],[1,"col-md-3"],[1,"col-md-9"],[1,"d-flex","gap-2"],["type","button",1,"btn","btn-info",3,"click","disabled","title"],[1,"fa-solid","me-2"],["type","button",1,"btn","btn-warning",3,"click","disabled","title"],[1,"text-muted","mt-1","d-block"],[3,"message","variant","centered"],[1,"d-flex","justify-content-between","align-items-start"],[1,"fa-solid","fa-exclamation-triangle","me-2"],["type","button",1,"btn","btn-outline-danger","btn-sm","ms-2",3,"title"],["type","button",1,"btn","btn-outline-danger","btn-sm","ms-2",3,"click","title"],[1,"fa-solid","fa-filter","me-1"],[1,"fa-solid","fa-info-circle","me-2"],[1,"ms-1"],[1,"mt-2"],[1,"col-md-6"],["type","text",1,"form-control",3,"input","placeholder","disabled"],[1,"card-header"],[1,"mb-0"],[1,"fa-solid","fa-calendar-check","me-2"],[1,"badge","bg-primary"],[1,"card-body","p-0"],[1,"fa-solid","fa-calendar-xmark","fa-3x","text-muted","mb-3"],[1,"table-hover",3,"sortChange","actionClick","pageChange","pageSizeChange","data","columns","actions","loading","showPagination","currentPage","totalPages","totalItems","pageSize","sortColumn","sortDirection","responsiveMode","emptyMessage"]],template:function(t,n){t&1&&(r(0,"div",0),f(1,"app-page-header",1),r(2,"div",2)(3,"div",3)(4,"div",4)(5,"div")(6,"button",5),v("click",function(){return n.clearFilters()}),f(7,"i",6),s(8),o(),r(9,"button",7),v("click",function(){return n.onRefresh()}),f(10,"i",8),s(11),o(),r(12,"button",9),v("click",function(){return n.exportData()}),f(13,"i",10),s(14),o()()()()(),D(15,ae,24,24,"div",11),r(16,"div",12)(17,"div",13)(18,"div",14)(19,"div",15)(20,"label",16),s(21),o(),r(22,"input",17),v("change",function(l){return n.onDateChange(l)}),o()(),r(23,"div",15)(24,"label",16),s(25),o(),r(26,"app-searchable-select",18),v("selectionChange",function(l){return n.onBranchSelectionChange(l)}),o()(),r(27,"div",15)(28,"label",16),s(29),o(),r(30,"app-searchable-select",18),v("selectionChange",function(l){return n.onDepartmentSelectionChange(l)}),o()(),r(31,"div",15)(32,"label",16),s(33),o(),r(34,"app-searchable-select",19),v("selectionChange",function(l){return n.onEmployeeSelectionChange(l)}),o()(),r(35,"div",15)(36,"label",16),s(37),o(),r(38,"select",20),v("change",function(l){return n.onStatusChange(l)}),A(39,ie,2,2,"option",21,ne),o()()()()(),r(41,"div",2)(42,"div",22)(43,"div",23)(44,"div",13)(45,"div",24)(46,"div")(47,"h6",25),s(48),o(),r(49,"h3",26),s(50),o()(),r(51,"div",27),f(52,"i",28),o()()()()(),r(53,"div",22)(54,"div",29)(55,"div",13)(56,"div",24)(57,"div")(58,"h6",25),s(59),o(),r(60,"h3",30),s(61),o()(),r(62,"div",31),f(63,"i",32),o()()()()(),r(64,"div",22)(65,"div",33)(66,"div",13)(67,"div",24)(68,"div")(69,"h6",25),s(70),o(),r(71,"h3",34),s(72),o()(),r(73,"div",35),f(74,"i",36),o()()()()(),r(75,"div",22)(76,"div",37)(77,"div",13)(78,"div",24)(79,"div")(80,"h6",25),s(81),o(),r(82,"h3",38),s(83),o()(),r(84,"div",39),f(85,"i",40),o()()()()()(),D(86,le,2,3,"div",41),D(87,oe,6,2,"div",42),D(88,se,8,3,"div",43),D(89,ce,5,3,"div",44),D(90,me,11,5,"div",45),o()),t&2&&(i(),h("title",n.i18n.t("attendance.daily_view")),i(5),h("disabled",n.loading()||!n.hasActiveFilters())("title",n.i18n.t("attendance.actions.clear_filters")),i(2),y("",n.i18n.t("attendance.actions.clear_filters")," "),i(),h("disabled",n.loading()),i(2),y("",n.i18n.t("app.refresh")," "),i(),h("disabled",n.loading()||n.filteredRecords().length===0),i(2),y("",n.i18n.t("attendance.actions.export_data")," "),i(),x(n.canManuallyCalculate()?15:-1),i(6),g(n.i18n.t("attendance.filters.date")),i(),h("value",n.selectedDate())("disabled",n.loading()),i(3),g(n.i18n.t("attendance.filters.branch")),i(),h("options",n.branchSelectOptions())("loading",n.loadingBranches())("disabled",n.loading())("placeholder",n.i18n.t("attendance.filters.all_branches"))("clearable",!0)("value",n.selectedBranchId()),i(3),g(n.i18n.t("attendance.filters.department")),i(),h("options",n.departmentSelectOptions())("loading",n.loadingDepartments())("disabled",n.loading())("placeholder",n.i18n.t("attendance.filters.all_departments"))("clearable",!0)("value",n.selectedDepartmentId()),i(3),g(n.i18n.t("attendance.filters.employee")),i(),h("options",n.employeeSelectOptions())("loading",n.loadingEmployees())("disabled",n.loading())("placeholder",n.i18n.t("attendance.filters.all_employees"))("clearable",!0)("searchable",!0)("value",n.selectedEmployeeId()),i(3),g(n.i18n.t("attendance.filters.status")),i(),h("disabled",n.loading()),i(),O(n.availableStatuses),i(9),g(n.i18n.t("attendance.statistics.total_employees")),i(2),g(n.totalEmployees()),i(9),g(n.i18n.t("attendance.statistics.present_employees")),i(2),g(n.presentEmployees()),i(9),g(n.i18n.t("attendance.statistics.absent_employees")),i(2),g(n.absentEmployees()),i(9),g(n.i18n.t("attendance.statistics.late_employees")),i(2),g(n.lateEmployees()),i(3),x(n.loading()?86:-1),i(),x(n.error()?87:-1),i(),x(!n.loading()&&!n.error()&&n.filteredRecords().length===0&&!n.hasActiveFilters()?88:-1),i(),x(!n.loading()&&!n.error()?89:-1),i(),x(!n.loading()&&!n.error()?90:-1))},dependencies:[L,j,H,V,F,Z,W,G,q],styles:['.daily-attendance[_ngcontent-%COMP%]{padding:1.5rem;min-height:calc(100vh - 120px);background:linear-gradient(135deg,#f8f9fa,#e9ecef);font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.page-title[_ngcontent-%COMP%]{color:#2c3e50;font-weight:600;margin-bottom:.5rem}.stats-card[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--bs-primary),var(--bs-info));opacity:0;transition:opacity .3s ease}.stats-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px) scale(1.02)}.stats-card[_ngcontent-%COMP%]:hover:before{opacity:1}.table-hover[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:all .3s ease;border-left:3px solid transparent}.table-hover[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:linear-gradient(90deg,#f8f9ff,#fff);border-left-color:#0d6efd;transform:translate(2px);box-shadow:0 2px 8px #0d6efd1a}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f8f9fa,#e9ecef)}.btn[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.4),transparent);transition:left .5s}.btn[_ngcontent-%COMP%]:hover:before{left:100%}.card-header[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:1.75rem;right:1.75rem;height:2px;background:linear-gradient(90deg,var(--bs-primary),var(--bs-info));border-radius:1px}.border-success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1987540d,#fff)}.border-danger[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dc35450d,#fff)}.border-warning[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fd7e140d,#fff)}.border-info[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0dcaf00d,#fff)}.border-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0d6efd0d,#fff)}.border-secondary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#6c757d0d,#fff)}@media (max-width: 768px){.daily-attendance[_ngcontent-%COMP%]{padding:1rem;background:linear-gradient(135deg,#f8f9fa,#fff)}.page-title[_ngcontent-%COMP%]{font-size:1.5rem;text-align:center}.d-flex.justify-content-between[_ngcontent-%COMP%]{flex-direction:column;gap:1.5rem;align-items:center}.stats-card[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%]{flex-direction:column;text-align:center;gap:.5rem}.stats-card[_ngcontent-%COMP%]   .icon-circle[_ngcontent-%COMP%]{margin:0 auto .75rem;width:56px;height:56px}.table-responsive[_ngcontent-%COMP%]{margin:0 -.5rem}.card-header[_ngcontent-%COMP%]{padding:1rem 1.25rem}.card-body[_ngcontent-%COMP%]{padding:1.25rem}}']})};export{te as DailyAttendanceComponent};
