import{a as $}from"./chunk-A3B6D6R2.js";import{a as L}from"./chunk-4QC5DFDN.js";import{a as H}from"./chunk-S52YPO73.js";import{a as B}from"./chunk-SRPEDAT4.js";import{a as J}from"./chunk-LHKEM3UB.js";import"./chunk-MUNQGSPX.js";import"./chunk-Y62N6K5S.js";import{c as N,d as S,e as M,f as V,i as F,m as T,n as O,w as j,y as G}from"./chunk-VRETN7JA.js";import{a as z}from"./chunk-EYAJMHM7.js";import{a as P}from"./chunk-HHXRLUSQ.js";import"./chunk-S3CAEY4A.js";import{b as A}from"./chunk-TJ2U7DWW.js";import{d as w,g as R}from"./chunk-TWXUAMJ4.js";import{Bb as m,Db as d,Ea as W,R as p,W as y,X as k,Xa as v,Ya as g,Yb as E,bb as u,cb as n,da as h,db as l,eb as _,lb as q,nb as x,pb as f,ta as i,wc as I,yb as D}from"./chunk-JSQL33QG.js";import"./chunk-DGAILPFQ.js";function Q(r,e){r&1&&_(0,"app-loading-spinner")}function U(r,e){if(r&1&&(n(0,"div",12),m(1),l()),r&2){let t=f(2);i(),d(" ",t.i18n.t("remoteWork.request.errors.start_date_required")," ")}}function X(r,e){if(r&1&&(n(0,"div",12),m(1),l()),r&2){let t=f(2);i(),d(" ",t.i18n.t("remoteWork.request.errors.end_date_required")," ")}}function Y(r,e){r&1&&_(0,"span",20)}function Z(r,e){if(r&1){let t=q();n(0,"form",3),x("ngSubmit",function(){y(t);let s=f();return k(s.onSubmit())}),n(1,"app-form-section",4)(2,"div",5)(3,"label",6),m(4),n(5,"span",7),m(6,"*"),l()(),n(7,"div",8)(8,"app-searchable-select",9),x("selectionChange",function(s){y(t);let c=f();return k(c.onEmployeeSelectionChange(s))}),l()()(),n(9,"div",5)(10,"label",10),m(11),n(12,"span",7),m(13,"*"),l()(),n(14,"div",8),_(15,"input",11),v(16,U,2,1,"div",12),l()(),n(17,"div",5)(18,"label",13),m(19),n(20,"span",7),m(21,"*"),l()(),n(22,"div",8),_(23,"input",14),v(24,X,2,1,"div",12),l()(),n(25,"div",5)(26,"label",15),m(27),l(),n(28,"div",8)(29,"textarea",16),m(30,"            "),l()()()(),n(31,"div",17)(32,"button",18),x("click",function(){y(t);let s=f();return k(s.onCancel())}),m(33),l(),n(34,"button",19),v(35,Y,1,0,"span",20),m(36),l()()()}if(r&2){let t,a,s,c,b,C,o=f();u("formGroup",o.form),i(),u("title",o.i18n.t("remoteWork.request.details")),i(3),d(" ",o.i18n.t("remoteWork.request.employee")," "),i(4),u("options",o.employeeOptions())("value",(t=o.form.get("employeeId"))==null?null:t.value)("placeholder",o.i18n.t("remoteWork.request.select_employee"))("searchable",!1)("clearable",!1)("required",!0)("disabled",!0)("isInvalid",!!((a=o.form.get("employeeId"))!=null&&a.invalid&&((a=o.form.get("employeeId"))!=null&&a.touched))),i(3),d(" ",o.i18n.t("remoteWork.request.startDate")," "),i(4),D("is-invalid",((s=o.form.get("startDate"))==null?null:s.invalid)&&((s=o.form.get("startDate"))==null?null:s.touched)),i(),g((c=o.form.get("startDate"))!=null&&c.invalid&&((c=o.form.get("startDate"))!=null&&c.touched)?16:-1),i(3),d(" ",o.i18n.t("remoteWork.request.endDate")," "),i(4),D("is-invalid",((b=o.form.get("endDate"))==null?null:b.invalid)&&((b=o.form.get("endDate"))==null?null:b.touched)),i(),g((C=o.form.get("endDate"))!=null&&C.invalid&&((C=o.form.get("endDate"))!=null&&C.touched)?24:-1),i(3),d(" ",o.i18n.t("remoteWork.request.reason")," "),i(2),u("placeholder",o.i18n.t("remoteWork.request.reason_placeholder")),i(3),u("disabled",o.submitting()),i(),d(" ",o.i18n.t("common.cancel")," "),i(),u("disabled",o.submitting()||o.form.invalid),i(),g(o.submitting()?35:-1),i(),d(" ",o.i18n.t("common.save")," ")}}var K=class r{fb=p(j);router=p(R);route=p(w);remoteWorkService=p($);employeesService=p(J);notification=p(P);i18n=p(A);form;loading=h(!1);submitting=h(!1);employees=h([]);requestId=h(null);employeeOptions=E(()=>this.employees().map(e=>({value:e.id,label:`${e.name} (${e.employeeNumber})`})));ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e?(this.requestId.set(parseInt(e,10)),this.initializeForm(),this.loadEmployees(),this.loadRequest()):(this.notification.error(this.i18n.t("remoteWork.request.errors.not_found")),this.router.navigate(["/remote-work"]))}initializeForm(){this.form=this.fb.group({employeeId:[{value:null,disabled:!0},S.required],startDate:["",S.required],endDate:["",S.required],reason:[""],status:[{value:0,disabled:!0}],rejectionReason:[{value:"",disabled:!0}]})}loadEmployees(){this.employeesService.getEmployeesForSelection().subscribe({next:e=>{this.employees.set(e)},error:e=>{console.error("Error loading employees:",e),this.notification.error(this.i18n.t("remoteWork.request.errors.load_employees_failed"))}})}loadRequest(){let e=this.requestId();e&&(this.loading.set(!0),this.remoteWorkService.getById(e).subscribe({next:t=>{this.form.patchValue({employeeId:t.employeeId,startDate:t.startDate,endDate:t.endDate,reason:t.reason||"",status:t.status,rejectionReason:t.rejectionReason||""}),this.loading.set(!1)},error:()=>{this.notification.error(this.i18n.t("remoteWork.request.errors.load_failed")),this.loading.set(!1),this.router.navigate(["/remote-work"])}}))}onEmployeeSelectionChange(e){let t=e?typeof e=="number"?e:parseInt(e):null;this.form.patchValue({employeeId:t}),this.form.get("employeeId")?.markAsTouched()}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched(),this.notification.warning(this.i18n.t("app.checkForm"));return}let e=this.requestId();if(!e){this.notification.error(this.i18n.t("remoteWork.request.errors.not_found"));return}this.submitting.set(!0);let t=this.form.getRawValue(),a={startDate:t.startDate,endDate:t.endDate,reason:t.reason||"",status:t.status,rejectionReason:t.rejectionReason||""};this.remoteWorkService.update(e,a).subscribe({next:()=>{this.notification.success(this.i18n.t("remoteWork.request.success.updated")),this.router.navigate(["/remote-work/view",e])},error:s=>{console.error("Error updating remote work request:",s);let c=s?.error?.error||this.i18n.t("remoteWork.request.errors.update_failed");this.notification.error(c),this.submitting.set(!1)}})}onCancel(){let e=this.requestId();e?this.router.navigate(["/remote-work",e,"view"]):this.router.navigate(["/remote-work"])}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=W({type:r,selectors:[["app-edit-remote-work"]],decls:4,vars:4,consts:[[1,"edit-remote-work-page"],["mode","edit","moduleName","remoteWork.request","moduleRoute","remote-work",3,"title","entityId"],[3,"formGroup"],[3,"ngSubmit","formGroup"],[3,"title"],[1,"row","mb-3"],[1,"col-sm-3","col-form-label"],[1,"text-danger"],[1,"col-sm-9"],[3,"selectionChange","options","value","placeholder","searchable","clearable","required","disabled","isInvalid"],["for","startDate",1,"col-sm-3","col-form-label"],["type","date","id","startDate","formControlName","startDate",1,"form-control"],[1,"invalid-feedback"],["for","endDate",1,"col-sm-3","col-form-label"],["type","date","id","endDate","formControlName","endDate",1,"form-control"],["for","reason",1,"col-sm-3","col-form-label"],["id","reason","formControlName","reason","rows","3",1,"form-control",3,"placeholder"],[1,"d-flex","justify-content-end","gap-2","mt-4"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"]],template:function(t,a){t&1&&(n(0,"div",0),_(1,"app-form-header",1),v(2,Q,1,0,"app-loading-spinner"),v(3,Z,37,26,"form",2),l()),t&2&&(i(),u("title",a.i18n.t("remoteWork.request.edit"))("entityId",a.requestId()??void 0),i(),g(a.loading()?2:-1),i(),g(a.loading()?-1:3))},dependencies:[I,G,F,N,M,V,T,O,L,B,H,z],styles:[".edit-remote-work-page[_ngcontent-%COMP%]{padding:20px}.form-control[_ngcontent-%COMP%]:disabled{background-color:#e9ecef;cursor:not-allowed}.invalid-feedback[_ngcontent-%COMP%]{display:block}"]})};export{K as EditRemoteWorkComponent};
