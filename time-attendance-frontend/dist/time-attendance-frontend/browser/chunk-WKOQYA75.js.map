{
  "version": 3,
  "sources": ["src/app/shared/directives/has-permission.directive.ts"],
  "sourcesContent": ["import { Directive, Input, TemplateRef, ViewContainerRef, effect } from '@angular/core';\r\nimport { PermissionService } from '../../core/auth/permission.service';\r\nimport { AuthService } from '../../core/auth/auth.service';\r\n\r\n/**\r\n * Angular structural directive for conditional template rendering based on user permissions.\r\n * Provides declarative permission-based access control in templates with reactive permission updates\r\n * and seamless integration with role-based access control (RBAC) system for secure UI component visibility.\r\n * \r\n * @example\r\n * ```html\r\n * <!-- Show button only if user has 'users:create' permission -->\r\n * <button *appHasPermission=\"'users:create'\">Create User</button>\r\n * \r\n * <!-- Show entire section for multiple operations -->\r\n * <div *appHasPermission=\"'employees:read'\">\r\n *   <app-employee-list></app-employee-list>\r\n * </div>\r\n * \r\n * <!-- Conditional navigation items -->\r\n * <nav-item *appHasPermission=\"'reports:view'\">Reports</nav-item>\r\n * ```\r\n * \r\n * @remarks\r\n * Permission-Based Access Control Features:\r\n * - Declarative permission checking through structural directive syntax\r\n * - Reactive permission updates with Angular Signals integration\r\n * - Automatic template re-evaluation on user authentication state changes\r\n * - Fine-grained access control at the UI component level\r\n * - Seamless integration with RBAC permission system\r\n * - Performance-optimized view creation and destruction\r\n * \r\n * Security Implementation:\r\n * - Client-side access control for user experience optimization\r\n * - Server-side permission validation remains primary security boundary\r\n * - Permission-based template rendering preventing unauthorized UI exposure\r\n * - Dynamic permission evaluation supporting role changes during session\r\n * - Secure permission string validation preventing injection attacks\r\n * - Integration with authentication state for comprehensive access control\r\n * \r\n * Angular Integration:\r\n * - Structural directive implementing Angular's templating system\r\n * - Standalone directive compatible with modern Angular architecture\r\n * - Angular Signals integration for reactive permission state management\r\n * - ViewContainerRef manipulation for efficient DOM updates\r\n * - TemplateRef-based conditional rendering with optimal performance\r\n * - Effect-based reactivity ensuring immediate UI updates on permission changes\r\n * \r\n * Performance Optimization:\r\n * - Efficient view creation and destruction minimizing DOM manipulation\r\n * - Lazy template evaluation reducing unnecessary component instantiation\r\n * - Signal-based reactivity preventing excessive change detection cycles\r\n * - View state caching preventing redundant template operations\r\n * - Memory-efficient template management with proper cleanup\r\n * - Optimized permission checking with cached permission resolution\r\n * \r\n * User Experience Features:\r\n * - Seamless UI adaptation to user permission changes\r\n * - Immediate visual feedback on permission state modifications\r\n * - Clean UI presentation hiding inaccessible functionality\r\n * - Consistent access control behavior across application components\r\n * - Progressive disclosure of functionality based on user capabilities\r\n * - Accessibility-compliant conditional rendering\r\n * \r\n * Enterprise Integration:\r\n * - Role-based access control integration with organizational hierarchies\r\n * - Multi-tenant permission isolation supporting organizational boundaries\r\n * - Dynamic permission updates supporting role-based workflow changes\r\n * - Audit-friendly permission checking with comprehensive logging\r\n * - Integration with enterprise identity management systems\r\n * - Support for complex permission hierarchies and inheritance patterns\r\n */\r\n@Directive({\r\n  selector: '[appHasPermission]',\r\n  standalone: true\r\n})\r\nexport class HasPermissionDirective {\r\n  private permission = '';\r\n  private hasView = false;\r\n\r\n  /**\r\n   * Sets the required permission for template visibility.\r\n   * Updates the view immediately when permission changes to ensure reactive UI updates.\r\n   * \r\n   * @param permission - The permission string to check (e.g., 'users:create', 'employees:read')\r\n   */\r\n  @Input() set appHasPermission(permission: string) {\r\n    this.permission = permission;\r\n    this.updateView();\r\n  }\r\n\r\n  /**\r\n   * Initializes the HasPermissionDirective with required Angular dependencies and reactive permission monitoring.\r\n   * Sets up automatic view updates based on user authentication state changes using Angular Signals.\r\n   * \r\n   * @param templateRef - Template reference for conditional rendering\r\n   * @param viewContainer - View container for DOM manipulation\r\n   * @param permissionService - Service for permission checking and validation\r\n   * @param authService - Authentication service providing user state and permissions\r\n   */\r\n  constructor(\r\n    private templateRef: TemplateRef<any>,\r\n    private viewContainer: ViewContainerRef,\r\n    private permissionService: PermissionService,\r\n    private authService: AuthService\r\n  ) {\r\n    // Use signals effect to watch for user changes\r\n    effect(() => {\r\n      // Access the current user signal to trigger effect\r\n      this.authService.currentUser();\r\n      this.updateView();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Updates the template visibility based on current user permissions.\r\n   * Efficiently manages view creation and destruction to minimize DOM manipulation overhead.\r\n   * Called automatically when permission or user state changes through reactive effects.\r\n   */\r\n  private updateView(): void {\r\n    if (!this.permission) return;\r\n    \r\n    const hasPermission = this.permissionService.has(this.permission);\r\n    \r\n    if (hasPermission && !this.hasView) {\r\n      this.viewContainer.createEmbeddedView(this.templateRef);\r\n      this.hasView = true;\r\n    } else if (!hasPermission && this.hasView) {\r\n      this.viewContainer.clear();\r\n      this.hasView = false;\r\n    }\r\n  }\r\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;AA4EM,IAAO,0BAAP,MAAO,wBAAsB;EAyBvB;EACA;EACA;EACA;EA3BF,aAAa;EACb,UAAU;;;;;;;EAQlB,IAAa,iBAAiB,YAAkB;AAC9C,SAAK,aAAa;AAClB,SAAK,WAAU;EACjB;;;;;;;;;;EAWA,YACU,aACA,eACA,mBACA,aAAwB;AAHxB,SAAA,cAAA;AACA,SAAA,gBAAA;AACA,SAAA,oBAAA;AACA,SAAA,cAAA;AAGR,WAAO,MAAK;AAEV,WAAK,YAAY,YAAW;AAC5B,WAAK,WAAU;IACjB,CAAC;EACH;;;;;;EAOQ,aAAU;AAChB,QAAI,CAAC,KAAK;AAAY;AAEtB,UAAM,gBAAgB,KAAK,kBAAkB,IAAI,KAAK,UAAU;AAEhE,QAAI,iBAAiB,CAAC,KAAK,SAAS;AAClC,WAAK,cAAc,mBAAmB,KAAK,WAAW;AACtD,WAAK,UAAU;IACjB,WAAW,CAAC,iBAAiB,KAAK,SAAS;AACzC,WAAK,cAAc,MAAK;AACxB,WAAK,UAAU;IACjB;EACF;;AAvDiC;cAAtB;mCAAA,yBAAsB,4BAAA,WAAA,GAAA,4BAAA,gBAAA,GAAA,4BAAA,iBAAA,GAAA,4BAAA,WAAA,CAAA;AAAA;cAAtB,0FAAA,yBAAsB,WAAA,CAAA,CAAA,IAAA,oBAAA,EAAA,CAAA,GAAA,QAAA,EAAA,kBAAA,mBAAA,EAAA,CAAA;AAA7B,IAAO,yBAAP;;sEAAO,wBAAsB,CAAA;UAJlC;WAAU;MACT,UAAU;MACV,YAAY;KACb;uHAWc,kBAAgB,CAAA;UAA5B;;;",
  "names": []
}
