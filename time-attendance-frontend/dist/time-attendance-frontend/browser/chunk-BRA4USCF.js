import{a as Y}from"./chunk-WVS5A55T.js";import{A as Q,c as j,d as w,e as z,f as $,h as B,i as O,m as W,p as H,y as J,z as K}from"./chunk-HF7V7ZC6.js";import{a as U}from"./chunk-RUOWTK24.js";import{d as N,g as D,h as L,m as q}from"./chunk-O3U3HUCY.js";import{a as X}from"./chunk-77FC2LKR.js";import"./chunk-A6EM5NV6.js";import{$a as x,Bb as y,Bc as V,Eb as a,Fb as g,Gb as p,Ha as I,Hb as R,Jb as F,Mb as k,Nb as T,Ob as G,T as b,Tb as M,Y as _,Z as f,_a as v,cb as E,db as P,eb as u,fa as C,fb as s,gb as l,hb as m,ob as S,qb as h,sb as c,uc as A,wa as n}from"./chunk-IGEIB4M6.js";import"./chunk-YMDWBF3A.js";var ee=()=>({standalone:!0}),te=(o,t)=>t.group,ie=(o,t)=>t.id;function ne(o,t){if(o&1&&(s(0,"div",10)(1,"div",13)(2,"span",14),a(3),l()()()),o&2){let e=c();n(3),g(e.i18n.t("common.loading"))}}function oe(o,t){if(o&1&&(s(0,"div",20),m(1,"i",54),a(2),l()),o&2){let e=c(2);n(2),p(" ",e.error()," ")}}function re(o,t){if(o&1&&(s(0,"div",26),a(1),l()),o&2){let e=c(2);n(),g(e.getFieldError("name"))}}function se(o,t){if(o&1&&(s(0,"div",27),m(1,"i",55),a(2),l()),o&2){let e=c(2);n(2),p(" ",e.i18n.t("roles.system_role_name_readonly")," ")}}function le(o,t){if(o&1&&(s(0,"span",29),m(1,"i",55),a(2),l()),o&2){let e=c(2);n(2),p(" ",e.i18n.t("roles.system")," ")}}function ae(o,t){if(o&1&&(s(0,"span",30),m(1,"i",56),a(2),l()),o&2){let e=c(2);n(2),p(" ",e.i18n.t("roles.custom")," ")}}function de(o,t){if(o&1){let e=S();s(0,"div",66)(1,"div",67)(2,"div",68)(3,"input",69),h("change",function(){let d=_(e).$implicit,r=c(4);return f(r.onTogglePermission(d))}),l(),s(4,"div",70)(5,"div",71),m(6,"i",72),s(7,"label",73)(8,"small"),a(9),l()(),s(10,"span",74),a(11),l()(),s(12,"p",75),a(13),l()()()()()}if(o&2){let e=t.$implicit,i=c(4);n(),y("bg-light",i.isPermissionSelected(e.id)),n(2),u("id","permission-"+e.id)("checked",i.isPermissionSelected(e.id))("disabled",i.saving()),n(3),u("ngClass",i.getPermissionIcon(e.key)),n(),u("for","permission-"+e.id),n(2),g(i.getPermissionResource(e.key)),n(),u("ngClass",i.getActionBadgeClass(e.key)),n(),p(" ",i.getPermissionAction(e.key)," "),n(2),p(" ",i.getPermissionDescription(e)," ")}}function me(o,t){if(o&1&&(s(0,"div",65),E(1,de,14,11,"div",66,ie),l()),o&2){let e=c().$implicit;n(),P(e.permissions)}}function ce(o,t){if(o&1){let e=S();s(0,"div",47)(1,"div",57)(2,"div",58)(3,"button",59),h("click",function(){let d=_(e).$implicit,r=c(2);return f(r.toggleGroupCollapse(d.group))}),m(4,"i",60),l(),s(5,"h6",61),m(6,"i",62),a(7),s(8,"small",63),a(9),l()()(),s(10,"div",35)(11,"button",64),h("click",function(){let d=_(e).$implicit,r=c(2);return f(r.toggleGroupSelection(d))}),m(12,"i",60),a(13),l()()(),v(14,me,3,0,"div",65),l()}if(o&2){let e=t.$implicit,i=c(2);n(3),u("disabled",i.saving())("title",i.isGroupCollapsed(e.group)?i.i18n.t("common.expand"):i.i18n.t("common.collapse")),n(),u("ngClass",i.isGroupCollapsed(e.group)?"fa-chevron-right":"fa-chevron-down"),n(3),p(" ",e.group," "),n(2),R("(",e.permissions.length," ",i.i18n.t("roles.permissions"),")"),n(2),y("btn-primary",i.areAllGroupPermissionsSelected(e))("btn-outline-primary",!i.areAllGroupPermissionsSelected(e)),u("disabled",i.saving())("title",i.areAllGroupPermissionsSelected(e)?i.i18n.t("roles.deselect_all_group"):i.i18n.t("roles.select_all_group")),n(),u("ngClass",i.areAllGroupPermissionsSelected(e)?"fa-check-square":i.areSomeGroupPermissionsSelected(e)?"fa-minus-square":"fa-square"),n(),p(" ",i.areAllGroupPermissionsSelected(e)?i.i18n.t("roles.deselect_all"):i.i18n.t("roles.select_all")," "),n(),x(i.isGroupCollapsed(e.group)?-1:14)}}function pe(o,t){if(o&1&&(s(0,"div",48),m(1,"i",76),s(2,"p",77),a(3),l()()),o&2){let e=c(2);n(3),g(e.i18n.t("roles.no_permissions_available"))}}function ue(o,t){o&1&&m(0,"span",52)}function ge(o,t){o&1&&m(0,"i",53)}function _e(o,t){if(o&1){let e=S();s(0,"div",11)(1,"div",15)(2,"h5",16),m(3,"i",17),a(4),l()(),s(5,"div",18)(6,"form",19),h("ngSubmit",function(){_(e);let d=c();return f(d.onSubmit())}),v(7,oe,3,1,"div",20),s(8,"div",21)(9,"div",22)(10,"label",23),a(11),s(12,"span",24),a(13,"*"),l()(),m(14,"input",25),v(15,re,2,1,"div",26),v(16,se,3,1,"div",27),l(),s(17,"div",22)(18,"label",23),a(19),l(),s(20,"div",28),v(21,le,3,1,"span",29)(22,ae,3,1,"span",30),l()()(),s(23,"div",31)(24,"div",32)(25,"h6",33),m(26,"i",34),a(27),l(),s(28,"div",35)(29,"button",36),h("click",function(){_(e);let d=c();return f(d.selectAllPermissions())}),m(30,"i",37),a(31),l(),s(32,"button",8),h("click",function(){_(e);let d=c();return f(d.clearAllPermissions())}),m(33,"i",38),a(34),l()()(),s(35,"div",39)(36,"small"),m(37,"i",40),a(38),l()(),s(39,"div",41)(40,"div",42)(41,"span",43),m(42,"i",44),l(),s(43,"input",45),G("ngModelChange",function(d){_(e);let r=c();return T(r.permissionSearchTerm,d)||(r.permissionSearchTerm=d),f(d)}),l()()(),s(44,"div",46),E(45,ce,15,15,"div",47,te),v(47,pe,4,1,"div",48),l()(),s(48,"div",49)(49,"button",8),h("click",function(){_(e);let d=c();return f(d.onCancel())}),m(50,"i",50),a(51),l(),s(52,"button",51),v(53,ue,1,0,"span",52)(54,ge,1,0,"i",53),a(55),l()()()()()}if(o&2){let e,i,d,r=c();n(4),p(" ",r.i18n.t("roles.role_information")," "),n(2),u("formGroup",r.roleForm),n(),x(r.error()?7:-1),n(4),p(" ",r.i18n.t("roles.name")," "),n(3),y("is-invalid",r.isFieldInvalid("name")),u("placeholder",r.i18n.t("roles.name_placeholder"))("disabled",((e=r.role())==null?null:e.isSystem)||!1),n(),x(r.isFieldInvalid("name")?15:-1),n(),x((i=r.role())!=null&&i.isSystem?16:-1),n(3),g(r.i18n.t("roles.type")),n(2),x((d=r.role())!=null&&d.isSystem?21:22),n(6),p(" ",r.i18n.t("roles.permissions")," "),n(2),u("disabled",r.saving()),n(2),p(" ",r.i18n.t("roles.select_all")," "),n(),u("disabled",r.saving()),n(2),p(" ",r.i18n.t("roles.clear_all")," "),n(4),F(" ",r.selectedPermissions().size," ",r.i18n.t("roles.permissions_selected")," ",r.i18n.t("common.of")," ",r.allPermissions().length," "),n(5),k("ngModel",r.permissionSearchTerm),u("ngModelOptions",M(31,ee))("placeholder",r.i18n.t("roles.search_permissions_placeholder"))("disabled",r.saving()),n(2),P(r.getFilteredGroupedPermissions()),n(2),x(r.getFilteredGroupedPermissions().length===0?47:-1),n(2),u("disabled",r.saving()),n(2),p(" ",r.i18n.t("common.cancel")," "),n(),u("disabled",r.roleForm.invalid||r.saving()),n(),x(r.saving()?53:54),n(2),p(" ",r.saving()?r.i18n.t("common.saving"):r.i18n.t("roles.update_role")," ")}}function fe(o,t){if(o&1&&(s(0,"div",12),m(1,"i",54),a(2),l()),o&2){let e=c();n(2),p(" ",e.error()||e.i18n.t("roles.role_not_found")," ")}}var Z=class o{route=b(N);router=b(D);rolesService=b(Y);fb=b(J);notificationService=b(U);i18n=b(X);role=C(null);allPermissions=C([]);selectedPermissions=C(new Set);loading=C(!0);saving=C(!1);error=C("");permissionSearchTerm="";collapsedGroups=new Set;roleForm;ngOnInit(){this.initializeForm();let t=this.route.snapshot.paramMap.get("id");t?(this.loadPermissions(),this.loadRole(t)):(this.error.set(this.i18n.t("roles.invalid_role_id")),this.loading.set(!1))}initializeForm(){this.roleForm=this.fb.group({name:["",[w.required,w.minLength(2)]]})}loadRole(t){this.rolesService.getRoleById(+t).subscribe({next:e=>{this.role.set(e),this.populateForm(e),this.loading.set(!1)},error:e=>{this.error.set(this.getErrorMessage(e)),this.loading.set(!1)}})}loadPermissions(){this.rolesService.getPermissions().subscribe({next:t=>{this.allPermissions.set(t)},error:t=>{console.error("Failed to load permissions:",t),this.allPermissions.set([]),this.notificationService.error(this.i18n.t("app.error"),this.i18n.t("roles.failed_to_load_permissions"))}})}populateForm(t){this.roleForm.patchValue({name:t.name});let e=new Set(t.permissions.map(i=>i.id.toString()));this.selectedPermissions.set(e)}onSubmit(){if(this.roleForm.invalid){this.roleForm.markAllAsTouched();return}this.saving.set(!0),this.error.set("");let e={name:this.roleForm.value.name,permissionIds:Array.from(this.selectedPermissions()).map(i=>+i)};this.rolesService.updateRole(this.role().id,e).subscribe({next:()=>{this.saving.set(!1),this.notificationService.success(this.i18n.t("app.success"),this.i18n.t("roles.role_updated_successfully")),this.router.navigate(["/roles",this.role().id,"view"])},error:i=>{this.saving.set(!1),this.error.set(this.getErrorMessage(i)),this.notificationService.error(this.i18n.t("app.error"),this.getErrorMessage(i))}})}onTogglePermission(t){let e=new Set(this.selectedPermissions()),i=t.id.toString();e.has(i)?e.delete(i):e.add(i),this.selectedPermissions.set(e)}selectAllPermissions(){let t=new Set(this.allPermissions().map(e=>e.id.toString()));this.selectedPermissions.set(t)}clearAllPermissions(){this.selectedPermissions.set(new Set)}isPermissionSelected(t){return this.selectedPermissions().has(t.toString())}getFilteredGroupedPermissions(){let t=this.allPermissions().filter(i=>!this.permissionSearchTerm||i.key.toLowerCase().includes(this.permissionSearchTerm.toLowerCase())||i.description.toLowerCase().includes(this.permissionSearchTerm.toLowerCase())),e=new Map;return t.forEach(i=>{let d=i.key.split(".")[0];e.has(d)||e.set(d,[]),e.get(d).push(i)}),Array.from(e.entries()).map(([i,d])=>({group:i,permissions:d}))}getPermissionIcon(t){return t.includes("read")?"fa-eye":t.includes("create")?"fa-plus":t.includes("update")?"fa-edit":t.includes("delete")?"fa-trash":"fa-key"}getPermissionResource(t){return t.split(".")[0]||t}getPermissionAction(t){return t.split(".")[1]||"unknown"}getActionBadgeClass(t){return t.includes("read")?"bg-info-subtle text-info":t.includes("create")?"bg-success-subtle text-success":t.includes("update")?"bg-warning-subtle text-warning":t.includes("delete")?"bg-danger-subtle text-danger":"bg-secondary-subtle text-secondary"}getPermissionDescription(t){return t.description||this.i18n.t("roles.no_description")}onCancel(){this.role()?this.router.navigate(["/roles",this.role().id,"view"]):this.router.navigate(["/roles"])}getFieldError(t){let e=this.roleForm.get(t);if(e?.errors&&e.touched){if(e.errors.required)return this.i18n.t("validation.required");if(e.errors.minlength)return this.i18n.t("validation.minlength").replace("{{min}}",e.errors.minlength.requiredLength)}return""}isFieldInvalid(t){let e=this.roleForm.get(t);return!!(e?.errors&&e.touched)}toggleGroupCollapse(t){this.collapsedGroups.has(t)?this.collapsedGroups.delete(t):this.collapsedGroups.add(t)}isGroupCollapsed(t){return this.collapsedGroups.has(t)}selectAllGroupPermissions(t){let e=new Set(this.selectedPermissions());t.permissions.forEach(i=>{e.add(i.id.toString())}),this.selectedPermissions.set(e)}deselectAllGroupPermissions(t){let e=new Set(this.selectedPermissions());t.permissions.forEach(i=>{e.delete(i.id.toString())}),this.selectedPermissions.set(e)}areAllGroupPermissionsSelected(t){return t.permissions.every(e=>this.selectedPermissions().has(e.id.toString()))}areSomeGroupPermissionsSelected(t){let e=t.permissions.filter(i=>this.selectedPermissions().has(i.id.toString())).length;return e>0&&e<t.permissions.length}toggleGroupSelection(t){this.areAllGroupPermissionsSelected(t)?this.deselectAllGroupPermissions(t):this.selectAllGroupPermissions(t)}getErrorMessage(t){return t?.error?.error?t.error.error:this.i18n.t("errors.unknown")}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-edit-role"]],decls:21,vars:7,consts:[[1,"container-fluid"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/dashboard"],["routerLink","/roles"],[1,"breadcrumb-item","active"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"fa-solid","fa-arrow-left","me-2"],[1,"d-flex","justify-content-center","py-5"],[1,"card"],[1,"alert","alert-danger"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"card-header"],[1,"card-title","mb-0"],[1,"fa-solid","fa-user-shield","me-2"],[1,"card-body"],[3,"ngSubmit","formGroup"],["role","alert",1,"alert","alert-danger"],[1,"row","g-3"],[1,"col-md-6"],[1,"form-label"],[1,"text-danger"],["type","text","formControlName","name",1,"form-control",3,"placeholder","disabled"],[1,"invalid-feedback"],[1,"form-text","text-warning"],[1,"form-control-plaintext"],[1,"badge","bg-warning-subtle","text-warning"],[1,"badge","bg-success-subtle","text-success"],[1,"mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"mb-0"],[1,"fa-solid","fa-key","me-2"],["role","group",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],[1,"fa-solid","fa-check-double","me-1"],[1,"fa-solid","fa-times","me-1"],[1,"alert","alert-info","py-2","px-3","mb-3"],[1,"fa-solid","fa-info-circle","me-2"],[1,"mb-3"],[1,"input-group"],[1,"input-group-text"],[1,"fa-solid","fa-search"],["type","text",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions","placeholder","disabled"],[1,"permissions-list","border","rounded","p-3",2,"max-height","400px","overflow-y","auto"],[1,"permission-group","mb-4"],[1,"text-center","py-4"],[1,"d-flex","justify-content-end","gap-2","mt-4"],[1,"fa-solid","fa-times","me-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"fa-solid","fa-save","me-2"],[1,"fa-solid","fa-exclamation-triangle","me-2"],[1,"fa-solid","fa-shield-alt","me-1"],[1,"fa-solid","fa-user-cog","me-1"],[1,"d-flex","justify-content-between","align-items-center","mb-3","border-bottom","pb-2"],[1,"d-flex","align-items-center"],["type","button",1,"btn","btn-sm","btn-link","text-decoration-none","p-0","me-2",3,"click","disabled","title"],[1,"fas",3,"ngClass"],[1,"fw-bold","text-primary","mb-0"],[1,"fas","fa-layer-group","me-2"],[1,"text-muted","fw-normal"],["type","button",1,"btn",3,"click","disabled","title"],[1,"row","g-2"],[1,"col-md-6","col-lg-4"],[1,"permission-item","border","rounded","p-2"],[1,"form-check","d-flex","align-items-start"],["type","checkbox",1,"form-check-input","mt-1",3,"change","id","checked","disabled"],[1,"form-check-content","ms-2","flex-grow-1"],[1,"d-flex","align-items-center","mb-1"],[1,"fas","me-1","text-muted",2,"font-size","0.75rem",3,"ngClass"],[1,"form-check-label","fw-medium","me-2",3,"for"],[1,"badge",2,"font-size","0.65rem",3,"ngClass"],[1,"text-muted","small","mb-0",2,"font-size","0.7rem","margin-left","1.25rem"],[1,"fa-solid","fa-key","fa-2x","text-muted","mb-2"],[1,"text-muted","mb-0"]],template:function(e,i){e&1&&(s(0,"div",0)(1,"div",1)(2,"div")(3,"h2"),a(4),l(),s(5,"nav",2)(6,"ol",3)(7,"li",4)(8,"a",5),a(9),l()(),s(10,"li",4)(11,"a",6),a(12),l()(),s(13,"li",7),a(14),l()()()(),s(15,"button",8),h("click",function(){return i.onCancel()}),m(16,"i",9),a(17),l()(),v(18,ne,4,1,"div",10)(19,_e,56,32,"div",11)(20,fe,3,1,"div",12),l()),e&2&&(n(4),g(i.i18n.t("roles.edit_role")),n(5),g(i.i18n.t("dashboard.title")),n(3),g(i.i18n.t("roles.title")),n(2),g(i.i18n.t("roles.edit_role")),n(),u("disabled",i.saving()),n(2),p(" ",i.i18n.t("common.back")," "),n(),x(i.loading()?18:i.role()?19:20))},dependencies:[V,A,q,L,Q,O,j,z,$,W,H,K,B],encapsulation:2})};export{Z as EditRoleComponent};
