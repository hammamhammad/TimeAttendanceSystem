import{c as V,d as h,e as A,f as D,i as j,m as L,n as $,w as z,y as O}from"./chunk-VRETN7JA.js";import{a as R}from"./chunk-HHXRLUSQ.js";import{a as I,b as G}from"./chunk-S3CAEY4A.js";import{b as Z}from"./chunk-TJ2U7DWW.js";import{g as k}from"./chunk-TWXUAMJ4.js";import{Bb as r,Cb as S,Cc as M,Db as d,Ea as T,R as g,W as y,X as E,Xa as c,Ya as m,bb as F,cb as i,da as b,db as l,eb as w,lb as N,nb as P,pb as u,ta as o,wc as q,yb as x}from"./chunk-JSQL33QG.js";import"./chunk-DGAILPFQ.js";function H(n,a){if(n&1){let t=N();i(0,"div",11),w(1,"i",26),r(2),i(3,"button",27),P("click",function(){y(t);let s=u();return E(s.error.set(""))}),l()()}if(n&2){let t=u();o(2),d(" ",t.error()," ")}}function U(n,a){if(n&1&&(i(0,"div",16),r(1),l()),n&2){let t=u();o(),d(" ",t.t("validation.required_field")," ")}}function Y(n,a){if(n&1&&r(0),n&2){let t=u(2);d(" ",t.t("validation.required_field")," ")}}function J(n,a){if(n&1&&r(0),n&2){let t=u(2);d(" ",t.t("auth.password_min_length")," ")}}function K(n,a){if(n&1&&r(0),n&2){let t=u(2);d(" ",t.t("auth.password_requirements")," ")}}function Q(n,a){if(n&1&&(i(0,"div",16),c(1,Y,1,1),c(2,J,1,1),c(3,K,1,1),l()),n&2){let t,e,s,p=u();o(),m(!((t=p.changePasswordForm.get("newPassword"))==null||t.errors==null)&&t.errors.required?1:-1),o(),m(!((e=p.changePasswordForm.get("newPassword"))==null||e.errors==null)&&e.errors.minlength?2:-1),o(),m(!((s=p.changePasswordForm.get("newPassword"))==null||s.errors==null)&&s.errors.pattern?3:-1)}}function W(n,a){if(n&1&&r(0),n&2){let t=u(2);d(" ",t.t("validation.required_field")," ")}}function X(n,a){if(n&1&&r(0),n&2){let t=u(2);d(" ",t.t("auth.passwords_dont_match")," ")}}function ee(n,a){if(n&1&&(i(0,"div",16),c(1,W,1,1),c(2,X,1,1),l()),n&2){let t,e,s=u();o(),m(!((t=s.changePasswordForm.get("confirmPassword"))==null||t.errors==null)&&t.errors.required?1:-1),o(),m(!((e=s.changePasswordForm.get("confirmPassword"))==null||e.errors==null)&&e.errors.passwordMismatch?2:-1)}}function te(n,a){n&1&&w(0,"span",22)}var B=class n{http=g(M);fb=g(z);router=g(k);authService=g(G);notificationService=g(R);i18n=g(Z);changePasswordForm;loading=b(!1);error=b("");constructor(){this.changePasswordForm=this.fb.group({currentPassword:["",[h.required]],newPassword:["",[h.required,h.minLength(8),h.pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\da-zA-Z]).{8,}$/)]],confirmPassword:["",[h.required]]},{validators:this.passwordMatchValidator})}passwordMatchValidator(a){let t=a.get("newPassword"),e=a.get("confirmPassword");return t&&e&&t.value!==e.value?e.setErrors({passwordMismatch:!0}):e&&!e.hasError("required")&&e.setErrors(null),null}t(a){return this.i18n.t(a)}onSubmit(){if(this.changePasswordForm.invalid){this.changePasswordForm.markAllAsTouched();return}this.loading.set(!0),this.error.set("");let a={currentPassword:this.changePasswordForm.value.currentPassword,newPassword:this.changePasswordForm.value.newPassword};this.http.post(`${I.baseUrl}${I.endpoints.auth.changePassword}`,a).subscribe({next:()=>{this.loading.set(!1),this.notificationService.success(this.t("auth.password_changed_success"),"You can now continue using the system"),this.router.navigate(["/dashboard"])},error:t=>{this.loading.set(!1);let e=t.error?.error||this.t("auth.password_change_failed");this.error.set(e),this.notificationService.error(this.t("auth.password_change_failed"),e)}})}onLogout(){this.authService.logout()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=T({type:n,selectors:[["app-change-password"]],decls:44,vars:21,consts:[[1,"min-vh-100","d-flex","align-items-center","justify-content-center","bg-light"],[1,"container"],[1,"row","justify-content-center"],[1,"col-md-6","col-lg-5"],[1,"card","shadow-sm"],[1,"card-body","p-4"],[1,"text-center","mb-4"],[1,"fa-solid","fa-key","fa-3x","text-warning","mb-3"],[1,"mb-2"],[1,"text-muted"],[3,"ngSubmit","formGroup"],["role","alert",1,"alert","alert-danger","alert-dismissible","fade","show"],[1,"mb-3"],[1,"form-label"],[1,"text-danger"],["type","password","formControlName","currentPassword",1,"form-control"],[1,"invalid-feedback"],["type","password","formControlName","newPassword",1,"form-control"],[1,"form-text","text-muted"],[1,"mb-4"],["type","password","formControlName","confirmPassword",1,"form-control"],["type","submit",1,"btn","btn-warning","w-100",3,"disabled"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"text-center","mt-3"],["type","button",1,"btn","btn-link","text-muted",3,"click"],[1,"fa-solid","fa-sign-out-alt","me-2"],[1,"fa-solid","fa-exclamation-triangle","me-2"],["type","button",1,"btn-close",3,"click"]],template:function(t,e){if(t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),w(7,"i",7),i(8,"h4",8),r(9),l(),i(10,"p",9),r(11),l()(),i(12,"form",10),P("ngSubmit",function(){return e.onSubmit()}),c(13,H,4,1,"div",11),i(14,"div",12)(15,"label",13),r(16),i(17,"span",14),r(18,"*"),l()(),w(19,"input",15),c(20,U,2,1,"div",16),l(),i(21,"div",12)(22,"label",13),r(23),i(24,"span",14),r(25,"*"),l()(),w(26,"input",17),c(27,Q,4,3,"div",16),i(28,"small",18),r(29),l()(),i(30,"div",19)(31,"label",13),r(32),i(33,"span",14),r(34,"*"),l()(),w(35,"input",20),c(36,ee,3,2,"div",16),l(),i(37,"button",21),c(38,te,1,0,"span",22),r(39),l(),i(40,"div",23)(41,"button",24),P("click",function(){return e.onLogout()}),w(42,"i",25),r(43),l()()()()()()()()()),t&2){let s,p,_,f,v,C;o(9),S(e.t("auth.change_password_required")),o(2),S(e.t("auth.change_password_message")),o(),F("formGroup",e.changePasswordForm),o(),m(e.error()?13:-1),o(3),d("",e.t("auth.current_password")," "),o(3),x("is-invalid",((s=e.changePasswordForm.get("currentPassword"))==null?null:s.invalid)&&((s=e.changePasswordForm.get("currentPassword"))==null?null:s.touched)),o(),m((p=e.changePasswordForm.get("currentPassword"))!=null&&p.invalid&&((p=e.changePasswordForm.get("currentPassword"))!=null&&p.touched)?20:-1),o(3),d("",e.t("auth.new_password")," "),o(3),x("is-invalid",((_=e.changePasswordForm.get("newPassword"))==null?null:_.invalid)&&((_=e.changePasswordForm.get("newPassword"))==null?null:_.touched)),o(),m((f=e.changePasswordForm.get("newPassword"))!=null&&f.invalid&&((f=e.changePasswordForm.get("newPassword"))!=null&&f.touched)?27:-1),o(2),d(" ",e.t("auth.password_requirements")," "),o(3),d("",e.t("auth.confirm_new_password")," "),o(3),x("is-invalid",((v=e.changePasswordForm.get("confirmPassword"))==null?null:v.invalid)&&((v=e.changePasswordForm.get("confirmPassword"))==null?null:v.touched)),o(),m((C=e.changePasswordForm.get("confirmPassword"))!=null&&C.invalid&&((C=e.changePasswordForm.get("confirmPassword"))!=null&&C.touched)?36:-1),o(),F("disabled",e.loading()||e.changePasswordForm.invalid),o(),m(e.loading()?38:-1),o(),d(" ",e.t("auth.change_password")," "),o(4),d(" ",e.t("auth.logout")," ")}},dependencies:[q,O,j,V,A,D,L,$],styles:["[_nghost-%COMP%]{display:block}"]})};export{B as ChangePasswordComponent};
