import{a as w}from"./chunk-5P3LUPXN.js";import{a as M}from"./chunk-FC4DSWWL.js";import{a as A}from"./chunk-NPDCAEA6.js";import"./chunk-QW24EDIR.js";import"./chunk-QXVLGI72.js";import"./chunk-HUSARQNL.js";import{a as I}from"./chunk-H5EPUHY6.js";import{a as x}from"./chunk-YRY7UVWD.js";import"./chunk-Y62N6K5S.js";import{x as S}from"./chunk-VRETN7JA.js";import"./chunk-GRQ6RO47.js";import{a as D}from"./chunk-UBCI4X5Q.js";import"./chunk-EYAJMHM7.js";import{a as y}from"./chunk-HHXRLUSQ.js";import"./chunk-WO762DVG.js";import{b as E}from"./chunk-7HHEMKQW.js";import{g as C}from"./chunk-TWXUAMJ4.js";import{Ea as f,Pb as P,R as a,Yb as d,bb as c,cb as l,da as s,db as u,eb as _,nb as m,ta as r,wc as v}from"./chunk-JSQL33QG.js";import{a as h,b as g,d as b}from"./chunk-DGAILPFQ.js";var N=()=>[],T=class p{excusePoliciesService=a(w);router=a(C);notificationService=a(y);confirmationService=a(I);i18n=a(E);permissionService=a(x);PERMISSIONS={POLICY_CREATE:"settings.excusePolicy.create",POLICY_READ:"settings.excusePolicy.read",POLICY_UPDATE:"settings.excusePolicy.update",POLICY_DELETE:"settings.excusePolicy.delete"};loading=s(!1);policies=s([]);totalCount=s(0);currentPage=s(1);pageSize=s(10);totalPages=s(0);selectedBranchId=s(void 0);selectedActiveStatus=s(void 0);tableColumns=d(()=>[{key:"scope",label:this.t("excuse_policies.branch"),sortable:!1,width:"180px",priority:"high",mobileLabel:this.t("excuse_policies.branch"),renderHtml:!0},{key:"maxPersonalExcusesPerMonth",label:this.t("excuse_policies.max_excuses_month"),sortable:!0,width:"140px",align:"center",priority:"medium",mobileLabel:this.t("excuse_policies.max_excuses_month")},{key:"maxPersonalExcuseHoursPerMonth",label:this.t("excuse_policies.max_hours_month"),sortable:!0,width:"140px",align:"center",priority:"medium",mobileLabel:this.t("excuse_policies.max_hours_month")},{key:"maxPersonalExcuseHoursPerDay",label:this.t("excuse_policies.max_hours_day"),sortable:!0,width:"120px",align:"center",priority:"low",hideOnMobile:!0,mobileLabel:this.t("excuse_policies.max_hours_day")},{key:"requiresApproval",label:this.t("excuse_policies.requires_approval"),sortable:!1,width:"130px",align:"center",priority:"low",hideOnMobile:!0,mobileLabel:this.t("excuse_policies.requires_approval"),renderHtml:!0},{key:"status",label:this.t("common.status"),sortable:!1,width:"100px",align:"center",priority:"high",mobileLabel:this.t("common.status"),renderHtml:!0},{key:"createdAt",label:this.t("common.created"),sortable:!0,width:"150px",priority:"low",hideOnMobile:!0,mobileLabel:this.t("common.created")}]);tableActions=d(()=>[{key:"view",label:this.t("common.view"),icon:"fa-eye",color:"primary",condition:()=>this.permissionService.has(this.PERMISSIONS.POLICY_READ)},{key:"edit",label:this.t("common.edit"),icon:"fa-edit",color:"secondary",condition:()=>this.permissionService.has(this.PERMISSIONS.POLICY_UPDATE)},{key:"delete",label:this.t("common.delete"),icon:"fa-trash",color:"danger",condition:()=>this.permissionService.has(this.PERMISSIONS.POLICY_DELETE)}]);tableData=d(()=>this.policies().map(e=>g(h({},e),{scope:this.formatScope(e),requiresApproval:this.formatBoolean(e.requiresApproval),status:this.formatStatus(e),createdAt:this.formatDate(e.createdAtUtc)})));ngOnInit(){this.loadPolicies()}t(e){return this.i18n.t(e)}loadPolicies(){this.loading.set(!0),this.excusePoliciesService.getExcusePolicies(this.currentPage(),this.pageSize(),this.selectedBranchId(),this.selectedActiveStatus()).subscribe({next:e=>{e&&e.items?(this.policies.set(e.items),this.totalCount.set(e.totalCount),this.totalPages.set(e.totalPages)):(console.warn("No data received from API:",e),this.policies.set([]),this.totalCount.set(0),this.totalPages.set(0)),this.loading.set(!1)},error:e=>{console.error("Failed to load excuse policies:",e),this.loading.set(!1),this.notificationService.error(this.t("app.error"),this.t("excuse_policies.load_error"))}})}formatDate(e){return new Date(e).toLocaleDateString(this.i18n.getCurrentLocale(),{year:"numeric",month:"short",day:"numeric"})}formatScope(e){let i=e.branchId===null?this.t("excuse_policies.organization_wide"):e.branchName||`Branch ${e.branchId}`;return`<span class="${this.getScopeBadgeClass(e)}">${i}</span>`}getScopeBadgeClass(e){return e.branchId===null?"badge bg-success":"badge bg-info"}formatBoolean(e){let i=e?this.t("common.yes"):this.t("common.no");return`<span class="${this.getBooleanBadgeClass(e)}">${i}</span>`}getBooleanBadgeClass(e){return e?"badge bg-success":"badge bg-secondary"}formatStatus(e){let i=e.isActive?this.t("common.active"):this.t("common.inactive");return`<span class="${this.getStatusBadgeClass(e)}">${i}</span>`}getStatusBadgeClass(e){return e.isActive?"badge bg-success":"badge bg-light text-dark border"}onActionClick(e){let{action:i,item:t}=e;switch(i){case"view":this.onViewPolicy(t);break;case"edit":this.onEditPolicy(t);break;case"delete":this.onDeletePolicy(t);break;default:console.warn("Unknown action:",i)}}onPageChange(e){this.currentPage.set(e),this.loadPolicies()}onPageSizeChange(e){this.pageSize.set(e),this.currentPage.set(1),this.loadPolicies()}onFiltersChange(e){e.branchId!==void 0&&this.selectedBranchId.set(e.branchId?parseInt(e.branchId):void 0),e.isActive!==void 0&&this.selectedActiveStatus.set(e.isActive==="true"?!0:e.isActive==="false"?!1:void 0),this.currentPage.set(1),this.loadPolicies()}onRefreshData(){this.onClearFilters()}onClearFilters(){this.selectedBranchId.set(void 0),this.selectedActiveStatus.set(void 0),this.currentPage.set(1),this.loadPolicies()}hasActiveFilters(){return this.selectedBranchId()!==void 0||this.selectedActiveStatus()!==void 0}onCreatePolicy(){this.router.navigate(["/settings/excuse-policies/create"])}onViewPolicy(e){this.router.navigate(["/settings/excuse-policies",e.id,"view"])}onEditPolicy(e){this.router.navigate(["/settings/excuse-policies",e.id,"edit"])}onDeletePolicy(e){return b(this,null,function*(){(yield this.confirmationService.confirm({title:this.t("excuse_policies.delete_title"),message:this.t("excuse_policies.confirm_delete"),confirmText:this.t("common.delete"),cancelText:this.t("common.cancel"),confirmButtonClass:"btn-danger",icon:"fa-trash",iconClass:"text-danger"})).confirmed&&this.excusePoliciesService.deleteExcusePolicy(e.id).subscribe({next:()=>{this.loadPolicies(),this.notificationService.success(this.t("app.success"),this.t("excuse_policies.delete_success"))},error:t=>{console.error("Failed to delete excuse policy:",t),this.notificationService.error(this.t("app.error"),this.t("excuse_policies.delete_error"))}})})}static \u0275fac=function(i){return new(i||p)};static \u0275cmp=f({type:p,selectors:[["app-excuse-policies"]],decls:4,vars:13,consts:[[1,"container-fluid"],[3,"title"],["moduleName","excuse_policies",3,"filtersChange","add","refresh","refreshing"],[3,"actionClick","pageChange","pageSizeChange","columns","data","actions","currentPage","pageSize","totalItems","totalPages","loading","emptyTitle","emptyMessage"]],template:function(i,t){i&1&&(l(0,"div",0),_(1,"app-page-header",1),l(2,"app-unified-filter",2),m("filtersChange",function(o){return t.onFiltersChange(o)})("add",function(){return t.onCreatePolicy()})("refresh",function(){return t.onRefreshData()}),u(),l(3,"app-data-table",3),m("actionClick",function(o){return t.onActionClick(o)})("pageChange",function(o){return t.onPageChange(o)})("pageSizeChange",function(o){return t.onPageSizeChange(o)}),u()()),i&2&&(r(),c("title",t.t("excuse_policies.title")),r(),c("refreshing",t.loading()),r(),c("columns",t.tableColumns())("data",t.tableData()||P(12,N))("actions",t.tableActions())("currentPage",t.currentPage())("pageSize",t.pageSize())("totalItems",t.totalCount())("totalPages",t.totalPages())("loading",t.loading)("emptyTitle",t.t("excuse_policies.no_policies_found"))("emptyMessage",t.hasActiveFilters()?t.t("common.try_different_filters"):t.t("excuse_policies.subtitle")))},dependencies:[v,S,A,M,D],styles:[".container-fluid[_ngcontent-%COMP%]{padding:1.5rem}@media (max-width: 768px){.container-fluid[_ngcontent-%COMP%]{padding:1rem}}"]})};export{T as ExcusePoliciesComponent};
