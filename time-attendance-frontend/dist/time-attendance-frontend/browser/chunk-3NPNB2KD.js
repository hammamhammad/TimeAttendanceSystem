import{a as Q}from"./chunk-CMZI37JF.js";import{a as K}from"./chunk-DGBMBYUB.js";import{a as J}from"./chunk-7YUBOVPA.js";import{a as H}from"./chunk-AVDFWZMN.js";import{a as W}from"./chunk-CARDG6TO.js";import"./chunk-4335LQ3A.js";import"./chunk-LDWMK676.js";import{a as U}from"./chunk-HCDX4O2L.js";import{A,c as q,d as S,e as k,f as P,i as G,m as j,p as R,y as L,z as $}from"./chunk-HF7V7ZC6.js";import{a as Y}from"./chunk-RUOWTK24.js";import"./chunk-HZR4WXEY.js";import{g as N}from"./chunk-O3U3HUCY.js";import{a as z}from"./chunk-77FC2LKR.js";import"./chunk-A6EM5NV6.js";import{$a as y,Bb as I,C as w,Eb as l,Fb as d,Gb as m,Ha as M,Hb as T,K as D,T as b,Y as C,Z as h,_a as _,dc as V,eb as v,f as F,fa as g,fb as o,gb as a,hb as x,ob as O,qb as E,sb as s,wa as t,z as B}from"./chunk-IGEIB4M6.js";import"./chunk-YMDWBF3A.js";function Z(r,n){if(r&1&&(o(0,"div",2),x(1,"app-loading-spinner",4),a()),r&2){let e=s();t(),v("message",e.i18n.t("employee_vacations.loading_data"))("variant","primary")("centered",!0)}}function ee(r,n){if(r&1&&(o(0,"div",12),l(1),a()),r&2){let e=s(2);t(),m(" ",e.getErrorMessage("employeeId")," ")}}function te(r,n){if(r&1&&(o(0,"div",12),l(1),a()),r&2){let e=s(2);t(),m(" ",e.getErrorMessage("vacationTypeId")," ")}}function ne(r,n){if(r&1&&(o(0,"div",16),l(1),a()),r&2){let e=s(2);t(),m(" ",e.getErrorMessage("startDate")," ")}}function ie(r,n){if(r&1&&(o(0,"div",16),l(1),a()),r&2){let e=s(2);t(),m(" ",e.getErrorMessage("endDate")," ")}}function ae(r,n){r&1&&x(0,"span",26)}function oe(r,n){if(r&1&&(o(0,"div",28)(1,"div",36)(2,"div",37)(3,"span",38),l(4),a()(),o(5,"p",39),l(6),a()()()),r&2){let e=s(2);t(4),d(e.i18n.t("common.loading")),t(2),d(e.i18n.t("employee_vacations.loading_balance"))}}function le(r,n){if(r&1&&(o(0,"div",58),x(1,"i",60),l(2),a()),r&2){let e=s(4);t(2),m(" ",e.i18n.t("employee_vacations.exceeds_balance_warning")," ")}}function re(r,n){if(r&1&&(o(0,"div",59)(1,"span"),l(2),a(),o(3,"span",61),l(4),a()()),r&2){let e,c=s(4);t(2),m("",c.i18n.t("employee_vacations.remaining_after"),":"),t(2),T(" ",(((e=c.currentBalance())==null?null:e.currentBalance)||0)-c.requestedDays()," ",c.i18n.t("common.days")," ")}}function ce(r,n){if(r&1&&(o(0,"div",55)(1,"div",56)(2,"span",43),l(3),a(),o(4,"span",57),l(5),a()(),_(6,le,3,1,"div",58)(7,re,5,3,"div",59),a()),r&2){let e=s(3);t(3),m("",e.i18n.t("employee_vacations.requested_days"),":"),t(),I("text-danger",e.exceedsBalance())("text-success",!e.exceedsBalance()),t(),T(" ",e.requestedDays()," ",e.i18n.t("common.days")," "),t(),y(e.exceedsBalance()?6:7)}}function de(r,n){if(r&1&&(o(0,"div",28)(1,"div",40)(2,"h6",41),x(3,"i",42),l(4),a()(),o(5,"div",33)(6,"div",19)(7,"small",43),l(8),a(),o(9,"div",44),l(10),a()(),o(11,"div",45)(12,"div",46)(13,"div",47)(14,"small",48),l(15),a(),o(16,"span",49),l(17),a(),o(18,"small",50),l(19),a()()(),o(20,"div",46)(21,"div",47)(22,"small",48),l(23),a(),o(24,"span",51),l(25),a(),o(26,"small",50),l(27),a()()(),o(28,"div",46)(29,"div",47)(30,"small",48),l(31),a(),o(32,"span",52),l(33),a(),o(34,"small",50),l(35),a()()(),o(36,"div",46)(37,"div",53)(38,"small",48),l(39),a(),o(40,"span",54),l(41),a(),o(42,"small",50),l(43),a()()()(),_(44,ce,8,8,"div",55),a()()),r&2){let e,c,i,u,f,p=s(2);t(4),m(" ",p.i18n.t("employee_vacations.leave_balance")," "),t(4),d(p.i18n.t("fields.vacationType")),t(2),d((e=p.currentBalance())==null?null:e.vacationTypeName),t(5),d(p.i18n.t("employee_vacations.entitled")),t(2),d(((c=p.currentBalance())==null?null:c.entitledDays)||0),t(2),d(p.i18n.t("common.days")),t(4),d(p.i18n.t("employee_vacations.used")),t(2),d(((i=p.currentBalance())==null?null:i.usedDays)||0),t(2),d(p.i18n.t("common.days")),t(4),d(p.i18n.t("employee_vacations.pending")),t(2),d(((u=p.currentBalance())==null?null:u.pendingDays)||0),t(2),d(p.i18n.t("common.days")),t(4),d(p.i18n.t("employee_vacations.available")),t(2),d(((f=p.currentBalance())==null?null:f.currentBalance)||0),t(2),d(p.i18n.t("common.days")),t(),y(p.requestedDays()>0?44:-1)}}function se(r,n){if(r&1){let e=O();o(0,"div",3)(1,"div",5)(2,"form",6),E("ngSubmit",function(){C(e);let i=s();return h(i.onSubmit())}),o(3,"app-form-section",7)(4,"div",3)(5,"div",8)(6,"label",9),l(7),o(8,"span",10),l(9,"*"),a()(),o(10,"app-searchable-select",11),E("selectionChange",function(i){let u;C(e);let f=s();return h((u=f.vacationForm.get("employeeId"))==null?null:u.setValue(i))}),a(),_(11,ee,2,1,"div",12),a(),o(12,"div",8)(13,"label",13),l(14),o(15,"span",10),l(16,"*"),a()(),o(17,"app-searchable-select",11),E("selectionChange",function(i){let u;C(e);let f=s();return h((u=f.vacationForm.get("vacationTypeId"))==null?null:u.setValue(i))}),a(),_(18,te,2,1,"div",12),a()(),o(19,"div",3)(20,"div",8)(21,"label",14),l(22),o(23,"span",10),l(24,"*"),a()(),x(25,"input",15),_(26,ne,2,1,"div",16),a(),o(27,"div",8)(28,"label",17),l(29),o(30,"span",10),l(31,"*"),a()(),x(32,"input",18),_(33,ie,2,1,"div",16),a()()(),o(34,"app-form-section",7)(35,"div",19)(36,"label",20),l(37),a(),x(38,"textarea",21),a()(),o(39,"div",22)(40,"button",23),E("click",function(){C(e);let i=s();return h(i.onCancel())}),l(41),a(),o(42,"button",24),E("click",function(){C(e);let i=s();return h(i.onReset())}),l(43),a(),o(44,"button",25),_(45,ae,1,0,"span",26),l(46),a()()()(),o(47,"div",27),_(48,oe,7,2,"div",28)(49,de,45,16,"div",28),o(50,"div",29)(51,"div",30)(52,"h6",31),x(53,"i",32),l(54),a()(),o(55,"div",33)(56,"p",34),l(57),a(),o(58,"ul",35)(59,"li"),l(60),a(),o(61,"li"),l(62),a(),o(63,"li"),l(64),a(),o(65,"li"),l(66),a()()()()()()}if(r&2){let e,c,i=s();t(2),v("formGroup",i.vacationForm),t(),v("title",i.i18n.t("employee_vacations.required_information")),t(4),m(" ",i.i18n.t("fields.employee")," "),t(3),v("options",i.employeeOptions)("placeholder",i.i18n.t("common.select_employee"))("value",(e=i.vacationForm.get("employeeId"))==null?null:e.value)("disabled",i.saving()),t(),y(i.hasError("employeeId")?11:-1),t(3),m(" ",i.i18n.t("fields.vacationType")," "),t(3),v("options",i.vacationTypeOptions)("placeholder",i.i18n.t("common.select_vacation_type"))("value",(c=i.vacationForm.get("vacationTypeId"))==null?null:c.value)("disabled",i.saving()),t(),y(i.hasError("vacationTypeId")?18:-1),t(4),m(" ",i.i18n.t("fields.startDate")," "),t(3),I("is-invalid",i.isFieldInvalid("startDate")),v("disabled",i.saving()),t(),y(i.hasError("startDate")?26:-1),t(3),m(" ",i.i18n.t("fields.endDate")," "),t(3),I("is-invalid",i.isFieldInvalid("endDate")),v("disabled",i.saving()),t(),y(i.hasError("endDate")?33:-1),t(),v("title",i.i18n.t("employee_vacations.additional_information")),t(3),d(i.i18n.t("fields.notes")),t(),v("placeholder",i.i18n.t("employee_vacations.notes_placeholder"))("disabled",i.saving()),t(2),v("disabled",i.saving()),t(),m(" ",i.i18n.t("common.cancel")," "),t(),v("disabled",i.saving()),t(),m(" ",i.i18n.t("common.reset")," "),t(),v("disabled",i.vacationForm.invalid||i.saving()),t(),y(i.saving()?45:-1),t(),m(" ",i.i18n.t("employee_vacations.create_vacation")," "),t(2),y(i.loadingBalance()?48:i.hasBalance()?49:-1),t(6),m(" ",i.i18n.t("employee_vacations.help_title")," "),t(3),d(i.i18n.t("employee_vacations.help_text")),t(3),d(i.i18n.t("employee_vacations.help_select_employee")),t(2),d(i.i18n.t("employee_vacations.help_select_type")),t(2),d(i.i18n.t("employee_vacations.help_date_range")),t(2),d(i.i18n.t("employee_vacations.help_notes_optional"))}}var X=class r{fb=b(L);router=b(N);notificationService=b(Y);employeeVacationsService=b(Q);leaveBalanceService=b(K);i18n=b(z);destroy$=new F;loading=g(!1);saving=g(!1);loadingBalance=g(!1);vacationForm;employees=g([]);vacationTypes=g([]);currentBalance=g(null);currentYear=new Date().getFullYear();hasBalance=V(()=>this.currentBalance()!==null);requestedDays=g(0);exceedsBalance=V(()=>{let n=this.currentBalance(),e=this.requestedDays();return!n||e<=0?!1:e>n.currentBalance});get employeeOptions(){return this.employees().map(n=>({value:n.id,label:n.name}))}get vacationTypeOptions(){return this.vacationTypes().map(n=>({value:n.id,label:n.name}))}constructor(){this.vacationForm=this.createForm()}ngOnInit(){this.loadEmployees(),this.loadVacationTypes(),this.setupFormWatchers()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setupFormWatchers(){this.vacationForm.valueChanges.pipe(D(this.destroy$),B(300),w((n,e)=>n.employeeId===e.employeeId&&n.vacationTypeId===e.vacationTypeId&&n.startDate===e.startDate&&n.endDate===e.endDate)).subscribe(n=>{if(n.startDate&&n.endDate){let e=this.calculateDays(n.startDate,n.endDate);this.requestedDays.set(e)}else this.requestedDays.set(0);n.employeeId&&n.vacationTypeId?this.fetchLeaveBalance(n.employeeId,n.vacationTypeId):this.currentBalance.set(null)})}calculateDays(n,e){let c=new Date(n),i=new Date(e);if(isNaN(c.getTime())||isNaN(i.getTime()))return 0;let u=i.getTime()-c.getTime(),f=Math.ceil(u/(1e3*60*60*24))+1;return f>0?f:0}fetchLeaveBalance(n,e){this.loadingBalance.set(!0),this.leaveBalanceService.getLeaveBalanceSummary(n,this.currentYear).pipe(D(this.destroy$)).subscribe({next:c=>{let i=c.vacationTypeBalances.find(u=>u.vacationTypeId===e);this.currentBalance.set(i||null),this.loadingBalance.set(!1)},error:()=>{this.currentBalance.set(null),this.loadingBalance.set(!1)}})}createForm(){return this.fb.group({employeeId:[null,[S.required]],vacationTypeId:[null,[S.required]],startDate:["",[S.required]],endDate:["",[S.required]],notes:[""]})}loadEmployees(){this.loading.set(!0),this.employeeVacationsService.getEmployees().subscribe({next:n=>{this.employees.set(n),this.loading.set(!1)},error:n=>{console.error("Failed to load employees:",n),this.notificationService.error(this.i18n.t("employee_vacations.errors.load_employees_failed")),this.loading.set(!1)}})}loadVacationTypes(){this.employeeVacationsService.getVacationTypes().subscribe({next:n=>{this.vacationTypes.set(n)},error:n=>{console.error("Failed to load vacation types:",n),this.notificationService.error(this.i18n.t("employee_vacations.errors.load_vacation_types_failed"))}})}onSubmit(){if(this.vacationForm.invalid){this.markFormGroupTouched();return}this.saving.set(!0);let n=this.vacationForm.value,e={employeeId:n.employeeId,vacationTypeId:n.vacationTypeId,startDate:new Date(n.startDate),endDate:new Date(n.endDate),notes:n.notes||void 0};this.employeeVacationsService.createVacation(e).subscribe({next:()=>{this.saving.set(!1),this.notificationService.success(this.i18n.t("employee_vacations.success.created")),this.router.navigate(["/employee-vacations"])},error:c=>{this.saving.set(!1),console.error("Failed to create vacation:",c),this.notificationService.error(this.i18n.t("employee_vacations.errors.create_failed"))}})}onCancel(){this.router.navigate(["/employee-vacations"])}onReset(){this.vacationForm.reset()}markFormGroupTouched(){Object.keys(this.vacationForm.controls).forEach(n=>{let e=this.vacationForm.get(n);e&&e.markAsTouched()})}hasError(n){let e=this.vacationForm.get(n);return!!(e&&e.invalid&&(e.dirty||e.touched))}getErrorMessage(n){let e=this.vacationForm.get(n);return!e||!e.errors?"":e.errors.required?this.i18n.t("validation.required"):""}isFieldInvalid(n){return this.hasError(n)}getFormMode(){return"create"}getVacationId(){}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=M({type:r,selectors:[["app-create-employee-vacation"]],decls:4,vars:6,consts:[[1,"container-fluid"],["moduleName","employee-vacations","moduleRoute","employee-vacations",3,"mode","title","entityId","loading"],[1,"text-center","py-5"],[1,"row"],[3,"message","variant","centered"],[1,"col-lg-8"],["novalidate","",3,"ngSubmit","formGroup"],[3,"title"],[1,"col-md-6","mb-3"],["for","employeeId",1,"form-label"],[1,"text-danger"],[3,"selectionChange","options","placeholder","value","disabled"],[1,"invalid-feedback","d-block"],["for","vacationTypeId",1,"form-label"],["for","startDate",1,"form-label"],["type","date","id","startDate","formControlName","startDate",1,"form-control",3,"disabled"],[1,"invalid-feedback"],["for","endDate",1,"form-label"],["type","date","id","endDate","formControlName","endDate",1,"form-control",3,"disabled"],[1,"mb-3"],["for","notes",1,"form-label"],["id","notes","rows","3","formControlName","notes",1,"form-control",3,"placeholder","disabled"],[1,"d-flex","justify-content-end","gap-2","mt-4"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"col-lg-4"],[1,"card","mb-3"],[1,"card"],[1,"card-header"],[1,"card-title","mb-0"],[1,"fas","fa-info-circle","me-2"],[1,"card-body"],[1,"small","text-muted","mb-2"],[1,"small","text-muted","mb-0"],[1,"card-body","text-center","py-4"],["role","status",1,"spinner-border","spinner-border-sm","text-primary"],[1,"visually-hidden"],[1,"small","text-muted","mt-2","mb-0"],[1,"card-header","bg-primary-subtle"],[1,"card-title","mb-0","text-primary"],[1,"fas","fa-balance-scale","me-2"],[1,"text-muted"],[1,"fw-semibold"],[1,"row","g-2","mb-3"],[1,"col-6"],[1,"border","rounded","p-2","text-center"],[1,"text-muted","d-block"],[1,"fw-bold","text-primary"],[1,"text-muted","ms-1"],[1,"fw-bold","text-warning"],[1,"fw-bold","text-info"],[1,"border","rounded","p-2","text-center","bg-light"],[1,"fw-bold","text-success","fs-5"],[1,"border-top","pt-3"],[1,"d-flex","justify-content-between","align-items-center"],[1,"fw-bold"],[1,"alert","alert-warning","mt-2","mb-0","py-2","px-3","small"],[1,"d-flex","justify-content-between","align-items-center","mt-2","text-muted","small"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"fw-semibold","text-success"]],template:function(e,c){e&1&&(o(0,"div",0),x(1,"app-form-header",1),_(2,Z,2,3,"div",2),_(3,se,67,42,"div",3),a()),e&2&&(t(),v("mode",c.getFormMode())("title",c.i18n.t("employee_vacations.create_vacation"))("entityId",c.getVacationId())("loading",c.loading()),t(),y(c.loading()?2:-1),t(),y(c.loading()?-1:3))},dependencies:[$,G,q,k,P,A,j,R,H,J,W,U],styles:[".form-label[_ngcontent-%COMP%]{font-weight:500;color:var(--bs-gray-700)}.form-control[_ngcontent-%COMP%]:disabled, .form-select[_ngcontent-%COMP%]:disabled{background-color:var(--bs-gray-100);opacity:.8}.invalid-feedback[_ngcontent-%COMP%]{font-size:.875rem}.help-card[_ngcontent-%COMP%]{position:sticky;top:1rem}.card-title[_ngcontent-%COMP%]{font-size:.95rem;font-weight:600}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:.375rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:not(:last-child){margin-right:.5rem}@media (max-width: 768px){.d-flex.justify-content-end[_ngcontent-%COMP%]{flex-direction:column}.btn[_ngcontent-%COMP%]{margin-bottom:.5rem}.btn[_ngcontent-%COMP%]:last-child{margin-bottom:0}}"]})};export{X as CreateEmployeeVacationComponent};
