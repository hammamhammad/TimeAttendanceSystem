import{a as Q}from"./chunk-KEMAMB2X.js";import"./chunk-GBFD7MFB.js";import{a as J}from"./chunk-J4V7WLTW.js";import{a as K}from"./chunk-A5YSTAD7.js";import{a as U}from"./chunk-UBCI4X5Q.js";import{a as B}from"./chunk-HHXRLUSQ.js";import{a as H}from"./chunk-SRPEDAT4.js";import{c as w,d as N,e as T,f as D,i as O,m as R,n as k,o as V,p as G,r as $,w as z,x as j,y as q}from"./chunk-VRETN7JA.js";import{b as L}from"./chunk-RCBJJ7UY.js";import{d as M,g as F}from"./chunk-TWXUAMJ4.js";import{$a as y,Bb as r,Cb as v,Db as d,Ea as b,Eb as C,R as f,W as S,X as x,Xa as g,Ya as u,ab as I,bb as m,cb as i,da as p,db as a,eb as l,lb as A,nb as _,pb as c,ta as n,wc as P,yb as E}from"./chunk-JSQL33QG.js";import"./chunk-DGAILPFQ.js";var X=(o,t)=>t.id;function Y(o,t){if(o&1&&(i(0,"div",2)(1,"div",5)(2,"span",6),r(3),a()(),i(4,"p",7),r(5),a()()),o&2){let e=c();n(3),v(e.i18n.t("common.loading")),n(2),v(e.i18n.t("attendance.loading_details"))}}function Z(o,t){if(o&1&&(i(0,"div",3),l(1,"i",8),r(2),a()),o&2){let e=c();n(2),d(" ",e.error()," ")}}function ee(o,t){if(o&1&&(i(0,"div",23),l(1,"i",8),r(2),a()),o&2){let e=c(2);n(2),d(" ",e.error()," ")}}function te(o,t){if(o&1&&(i(0,"option",30),r(1),a()),o&2){let e=t.$implicit,s=c(2);m("value",e.id),n(),C(" ",e.name," (",s.getShiftTimeDisplay(e),") ")}}function ne(o,t){if(o&1&&(i(0,"div",31),r(1),a()),o&2){let e=c(2);n(),d(" ",e.getErrorMessage("shiftId")," ")}}function ie(o,t){if(o&1&&(l(0,"span",55),r(1)),o&2){let e=c(2);n(),d(" ",e.i18n.t("attendance.changing_shift")," ")}}function ae(o,t){if(o&1&&(l(0,"i",56),r(1)),o&2){let e=c(2);n(),d(" ",e.i18n.t("attendance.change_shift")," ")}}function re(o,t){if(o&1){let e=A();i(0,"form",9),_("ngSubmit",function(){S(e);let h=c();return x(h.onSubmit())}),i(1,"div",10)(2,"div",11)(3,"app-form-section",1)(4,"div",12)(5,"div",13)(6,"div",14)(7,"div",15),r(8),a()(),i(9,"div")(10,"h6",16),r(11),a(),i(12,"small",17),r(13),a()()()()(),i(14,"app-form-section",1)(15,"div",18)(16,"div",19)(17,"div",20)(18,"div")(19,"strong"),r(20),a(),i(21,"div",21),r(22),a()(),i(23,"span",22),r(24),a()()()()(),i(25,"app-form-section",1),g(26,ee,3,1,"div",23),i(27,"div",24)(28,"div",25)(29,"label",26),r(30),i(31,"span",27),r(32,"*"),a()(),i(33,"select",28)(34,"option",29),r(35),a(),y(36,te,2,3,"option",30,X),a(),g(38,ne,2,1,"div",31),a(),i(39,"div",32)(40,"label",33),r(41),a(),i(42,"textarea",34),r(43,"                "),a()()(),i(44,"div",35),l(45,"i",36),r(46),a()()(),i(47,"div",37)(48,"div",38)(49,"div",39)(50,"h6",40),l(51,"i",41),r(52),a()(),i(53,"div",42)(54,"div",43)(55,"button",44),g(56,ie,2,1)(57,ae,2,1),a(),i(58,"button",45),_("click",function(){S(e);let h=c();return x(h.onReset())}),l(59,"i",46),r(60),a(),i(61,"button",47),_("click",function(){S(e);let h=c();return x(h.onCancel())}),l(62,"i",48),r(63),a()()()(),i(64,"div",49)(65,"div",39)(66,"h6",40),l(67,"i",36),r(68),a()(),i(69,"div",42)(70,"p",50),r(71),a(),i(72,"ul",51)(73,"li",16),l(74,"i",52),r(75),a(),i(76,"li",16),l(77,"i",53),r(78),a(),i(79,"li"),l(80,"i",54),r(81),a()()()()()()()}if(o&2){let e=c();m("formGroup",e.changeShiftForm),n(3),m("title",e.i18n.t("attendance.employee_and_date")),n(5),d(" ",e.getEmployeeInitials()," "),n(3),v(e.attendanceRecord().employeeName),n(2),C(" ",e.attendanceRecord().employeeNumber," \u2022 ",e.formatDate(e.attendanceRecord().attendanceDate)," "),n(),m("title",e.i18n.t("attendance.current_shift")),n(6),v(e.getCurrentShiftName()),n(2),d(" ",e.getCurrentShiftTime()," "),n(2),v(e.i18n.t("common.current")),n(),m("title",e.i18n.t("attendance.new_shift_assignment")),n(),u(e.error()?26:-1),n(4),d(" ",e.i18n.t("fields.newShift")," "),n(3),E("is-invalid",e.isFieldInvalid("shiftId")),n(2),v(e.i18n.t("attendance.placeholders.select_shift")),n(),I(e.availableShifts()),n(2),u(e.hasError("shiftId")?38:-1),n(3),d(" ",e.i18n.t("fields.notes")," "),n(),m("placeholder",e.i18n.t("attendance.placeholders.shift_change_notes")),n(4),d(" ",e.i18n.t("attendance.shift_change_warning")," "),n(6),d(" ",e.i18n.t("common.actions")," "),n(3),m("disabled",e.changeShiftForm.invalid||e.saving()),n(),u(e.saving()?56:57),n(2),m("disabled",e.saving()),n(2),d(" ",e.i18n.t("common.reset")," "),n(),m("disabled",e.saving()),n(2),d(" ",e.i18n.t("common.cancel")," "),n(5),d(" ",e.i18n.t("common.help")," "),n(3),d(" ",e.i18n.t("attendance.help.shift_change_instructions")," "),n(4),d(" ",e.i18n.t("attendance.help.select_new_shift")," "),n(3),d(" ",e.i18n.t("attendance.help.recalculation_note")," "),n(3),d(" ",e.i18n.t("attendance.help.optional_notes")," ")}}var W=class o{i18n=f(L);router=f(F);route=f(M);fb=f(z);attendanceService=f(J);shiftsService=f(K);shiftAssignmentService=f(Q);notificationService=f(B);loading=p(!1);saving=p(!1);attendanceRecord=p(null);availableShifts=p([]);currentShiftAssignment=p(null);currentShift=p(null);error=p(null);changeShiftForm;constructor(){this.changeShiftForm=this.fb.group({shiftId:["",N.required],notes:[""]})}ngOnInit(){this.loadAttendanceRecord()}loadAttendanceRecord(){let t=this.route.snapshot.paramMap.get("attendanceId");if(!t){this.router.navigate(["/attendance"]);return}this.loading.set(!0),this.error.set(null),this.attendanceService.getAttendanceById(+t).subscribe({next:e=>{this.attendanceRecord.set(e),this.loadShifts(),this.loadCurrentShiftAssignment(),this.loading.set(!1)},error:e=>{console.error("Failed to load attendance record:",e),this.error.set(this.i18n.t("attendance.errors.load_failed")),this.loading.set(!1)}})}loadShifts(){this.shiftsService.getActiveShifts().subscribe({next:t=>{this.availableShifts.set(t.items)},error:t=>{console.error("Failed to load shifts:",t),this.notificationService.error(this.i18n.t("shifts.errors.load_failed"))}})}loadCurrentShiftAssignment(){let t=this.attendanceRecord();t?.employeeId&&this.shiftAssignmentService.getShiftAssignments({employeeId:t.employeeId,assignmentType:1,status:2,currentlyActive:!0,pageSize:1}).subscribe({next:e=>{if(e.items&&e.items.length>0){let s=e.items[0];this.currentShiftAssignment.set(s),this.loadCurrentShiftDetails(s.shiftId)}else this.currentShiftAssignment.set(null),this.currentShift.set(null)},error:e=>{console.error("Failed to load current shift assignment:",e),this.currentShiftAssignment.set(null),this.currentShift.set(null)}})}loadCurrentShiftDetails(t){this.shiftsService.getShiftById(t).subscribe({next:e=>{this.currentShift.set(e)},error:e=>{console.error("Failed to load current shift details:",e),this.currentShift.set(null)}})}onSubmit(){if(this.changeShiftForm.invalid||!this.attendanceRecord()){this.changeShiftForm.markAllAsTouched();return}this.saving.set(!0),this.error.set(null);let t=this.changeShiftForm.value,s={attendanceId:this.attendanceRecord().id,shiftId:+t.shiftId,notes:t.notes||void 0};this.attendanceService.changeAttendanceShift(s).subscribe({next:()=>{this.notificationService.success(this.i18n.t("attendance.success.shift_changed")),this.router.navigate(["/attendance"])},error:h=>{console.error("Failed to change attendance shift:",h),this.error.set(this.i18n.t("attendance.errors.shift_change_failed")),this.saving.set(!1)}})}onReset(){this.changeShiftForm.reset({shiftId:"",notes:""}),this.error.set(null)}onCancel(){this.router.navigate(["/attendance"])}getEmployeeInitials(){let t=this.attendanceRecord();if(!t?.employeeName)return"";let e=t.employeeName.split(" "),s=e[0]?e[0].charAt(0).toUpperCase():"",h=e.length>1?e[e.length-1].charAt(0).toUpperCase():"";return s+h}formatDate(t){return new Date(t).toLocaleDateString(this.i18n.getCurrentLocale(),{year:"numeric",month:"long",day:"numeric"})}getCurrentShiftName(){let t=this.currentShift();return t?t.name:this.i18n.t("attendance.no_shift_assigned")}getCurrentShiftTime(){let t=this.currentShift();if(!t)return"";if(t.shiftPeriods&&t.shiftPeriods.length>0){let e=t.shiftPeriods[0],s=t.shiftPeriods[t.shiftPeriods.length-1];return`${e.startTime} - ${s.endTime}`}return this.i18n.t("shifts.time_not_specified")}getShiftTimeDisplay(t){if(t.shiftPeriods&&t.shiftPeriods.length>0){let e=t.shiftPeriods[0],s=t.shiftPeriods[t.shiftPeriods.length-1];return`${e.startTime} - ${s.endTime}`}return this.i18n.t("shifts.time_not_specified")}isFieldInvalid(t){let e=this.changeShiftForm.get(t);return!!(e&&e.invalid&&(e.dirty||e.touched))}hasError(t){return this.isFieldInvalid(t)}getErrorMessage(t){let e=this.changeShiftForm.get(t);return!e||!e.errors?"":e.errors.required?this.i18n.t("validation.required"):""}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=b({type:o,selectors:[["app-change-attendance-shift"]],decls:5,vars:4,consts:[[1,"app-form-page"],[3,"title"],[1,"text-center","py-5"],[1,"alert","alert-danger"],[3,"formGroup"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-3","text-muted"],[1,"fas","fa-exclamation-triangle","me-2"],[3,"ngSubmit","formGroup"],[1,"app-desktop-sidebar"],[1,"app-main-content"],[1,"alert","alert-info"],[1,"d-flex","align-items-center"],[1,"avatar-sm","me-3"],[1,"avatar-initial","bg-primary","text-white","rounded-circle"],[1,"mb-1"],[1,"text-muted"],[1,"card","bg-light"],[1,"card-body","py-3"],[1,"d-flex","justify-content-between","align-items-center"],[1,"small","text-muted","mt-1"],[1,"badge","bg-light","text-dark","border"],[1,"alert","alert-danger","mb-3"],[1,"row"],[1,"col-md-6","mb-3"],["for","shiftId",1,"form-label"],[1,"text-danger"],["id","shiftId","formControlName","shiftId",1,"form-select"],["value",""],[3,"value"],[1,"invalid-feedback"],[1,"col-12","mb-3"],["for","notes",1,"form-label"],["id","notes","formControlName","notes","rows","4",1,"form-control",3,"placeholder"],[1,"alert","alert-warning","mt-3"],[1,"fas","fa-info-circle","me-2"],[1,"app-sidebar-content"],[1,"card","mb-3"],[1,"card-header"],[1,"card-title","mb-0"],[1,"fas","fa-cogs","me-2"],[1,"card-body"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"fas","fa-undo","me-2"],["type","button",1,"btn","btn-outline-danger",3,"click","disabled"],[1,"fas","fa-times","me-2"],[1,"card"],[1,"card-text","small","text-muted","mb-2"],[1,"list-unstyled","small","text-muted","mb-0"],[1,"fas","fa-check-circle","text-success","me-1"],[1,"fas","fa-calculator","text-info","me-1"],[1,"fas","fa-sticky-note","text-warning","me-1"],["role","status",1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-clock","me-2"]],template:function(e,s){e&1&&(i(0,"div",0),l(1,"app-page-header",1),g(2,Y,6,2,"div",2),g(3,Z,3,1,"div",3),g(4,re,82,32,"form",4),a()),e&2&&(n(),m("title",s.i18n.t("attendance.change_shift_title")),n(),u(s.loading()?2:-1),n(),u(s.error()&&!s.loading()?3:-1),n(),u(!s.loading()&&s.attendanceRecord()?4:-1))},dependencies:[P,j,O,G,$,w,V,T,D,q,R,k,U,H],styles:[".avatar-sm[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem}.avatar-initial[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:1rem;font-weight:600}.alert-info[_ngcontent-%COMP%]{border-left:4px solid var(--bs-info)}.card.bg-light[_ngcontent-%COMP%]{border:1px solid #e9ecef}.card.bg-light[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{background-color:#f8f9fa}.alert-warning[_ngcontent-%COMP%]{border-left:4px solid var(--bs-warning)}.form-control[_ngcontent-%COMP%]:invalid{border-color:var(--bs-danger)}.form-control[_ngcontent-%COMP%]:valid{border-color:var(--bs-success)}.btn-primary[_ngcontent-%COMP%]{min-width:120px}@media (max-width: 768px){.avatar-sm[_ngcontent-%COMP%]{width:2rem;height:2rem}.avatar-initial[_ngcontent-%COMP%]{font-size:.875rem}.alert-info[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-size:1rem}.alert-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:.8rem}}"]})};export{W as ChangeAttendanceShiftComponent};
