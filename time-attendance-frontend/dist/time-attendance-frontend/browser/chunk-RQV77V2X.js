import{a as H}from"./chunk-46YUKDEL.js";import{A as $,b as A,c as w,d as v,e as R,f as z,i as V,j as P,m as D,p as q,q as L,r as G,t as O,u as j,v as U,y as Z}from"./chunk-YQIE4CGE.js";import{a as Y}from"./chunk-GEGVYT7O.js";import"./chunk-A6EM5NV6.js";import{A as I,Cb as T,Da as x,E as _,Fb as M,Ga as a,Gb as N,Ha as l,Ia as c,L as t,Lb as k,Q as S,aa as s,ba as p,ea as F,fa as y,ga as h,ha as n,ia as i,ja as d,qa as B,sa as g,ua as m,y as f,z as E}from"./chunk-5OFYUWMA.js";import"./chunk-YMDWBF3A.js";var K=(o,r)=>r.value;function Q(o,r){if(o&1&&(n(0,"div",10)(1,"div",13)(2,"span",14),a(3),i()()()),o&2){let e=m();t(3),l(e.i18n.t("common.loading"))}}function W(o,r){if(o&1&&(n(0,"div",20),d(1,"i",63),a(2),i()),o&2){let e=m(2);t(2),c(" ",e.error()," ")}}function X(o,r){if(o&1&&(n(0,"div",29),a(1),i()),o&2){let e=m(2);t(),l(e.getFieldError("name"))}}function ee(o,r){if(o&1&&(n(0,"div",29),a(1),i()),o&2){let e=m(2);t(),l(e.getFieldError("code"))}}function te(o,r){if(o&1&&(n(0,"option",34),a(1),i()),o&2){let e=r.$implicit;h("value",e.value),t(),l(e.label)}}function ie(o,r){if(o&1&&(n(0,"div",29),a(1),i()),o&2){let e=m(2);t(),l(e.getFieldError("timezone"))}}function ne(o,r){if(o&1&&(n(0,"div",29),a(1),i()),o&2){let e=m(2);t(),l(e.getFieldError("latitude"))}}function ae(o,r){if(o&1&&(n(0,"div",29),a(1),i()),o&2){let e=m(2);t(),l(e.getFieldError("longitude"))}}function oe(o,r){if(o&1&&(n(0,"div",47),a(1),i()),o&2){let e=m(2);t(),l(e.getFieldError("geofenceRadiusMeters"))}}function re(o,r){if(o&1&&(n(0,"div",29),a(1),i()),o&2){let e=m(2);t(),l(e.getFieldError("phone"))}}function le(o,r){if(o&1&&(n(0,"div",29),a(1),i()),o&2){let e=m(2);t(),l(e.getFieldError("email"))}}function de(o,r){if(o&1&&(n(0,"div",29),a(1),i()),o&2){let e=m(2);t(),l(e.getFieldError("address"))}}function ce(o,r){if(o&1&&(n(0,"div",29),a(1),i()),o&2){let e=m(2);t(),l(e.getFieldError("description"))}}function me(o,r){o&1&&d(0,"span",61)}function se(o,r){o&1&&d(0,"i",62)}function pe(o,r){if(o&1){let e=B();n(0,"div",11)(1,"div",15)(2,"h5",16),d(3,"i",17),a(4),i()(),n(5,"div",18)(6,"form",19),g("ngSubmit",function(){E(e);let b=m();return I(b.onSubmit())}),s(7,W,3,1,"div",20),n(8,"div",21)(9,"h6",22),d(10,"i",23),a(11),i(),n(12,"div",24)(13,"div",25)(14,"label",26),a(15),n(16,"span",27),a(17,"*"),i()(),d(18,"input",28),s(19,X,2,1,"div",29),i(),n(20,"div",25)(21,"label",26),a(22),n(23,"span",27),a(24,"*"),i()(),d(25,"input",30),s(26,ee,2,1,"div",29),n(27,"div",31),a(28),i()(),n(29,"div",25)(30,"label",26),a(31),n(32,"span",27),a(33,"*"),i()(),n(34,"select",32)(35,"option",33),a(36),i(),F(37,te,2,2,"option",34,K),i(),s(39,ie,2,1,"div",29),i(),n(40,"div",25)(41,"label",26),a(42),i(),n(43,"div",35),d(44,"input",36),n(45,"label",37),a(46),i()()()()(),d(47,"hr"),n(48,"div",21)(49,"h6",38),d(50,"i",39),a(51),i(),n(52,"div",40),d(53,"i",23),a(54),i(),n(55,"div",24)(56,"div",41)(57,"label",26),a(58),i(),d(59,"input",42),s(60,ne,2,1,"div",29),n(61,"div",31),a(62),i()(),n(63,"div",41)(64,"label",26),a(65),i(),d(66,"input",43),s(67,ae,2,1,"div",29),n(68,"div",31),a(69),i()(),n(70,"div",41)(71,"label",26),a(72),i(),n(73,"div",44),d(74,"input",45),n(75,"span",46),a(76),i()(),s(77,oe,2,1,"div",47),n(78,"div",31),a(79),i()()()(),d(80,"hr"),n(81,"div",21)(82,"h6",48),d(83,"i",49),a(84),i(),n(85,"div",24)(86,"div",25)(87,"label",26),a(88),i(),d(89,"input",50),s(90,re,2,1,"div",29),i(),n(91,"div",25)(92,"label",26),a(93),i(),d(94,"input",51),s(95,le,2,1,"div",29),i(),n(96,"div",52)(97,"label",26),a(98),i(),d(99,"textarea",53),s(100,de,2,1,"div",29),i(),n(101,"div",52)(102,"label",26),a(103),i(),d(104,"textarea",54),s(105,ce,2,1,"div",29),i()()(),n(106,"div",55)(107,"h6",56),d(108,"i",23),a(109),i(),n(110,"ul",57)(111,"li"),a(112),i(),n(113,"li"),a(114),i(),n(115,"li"),a(116),i(),n(117,"li"),a(118),i(),n(119,"li"),a(120),i()()(),n(121,"div",58)(122,"button",8),g("click",function(){E(e);let b=m();return I(b.onCancel())}),d(123,"i",59),a(124),i(),n(125,"button",60),s(126,me,1,0,"span",61)(127,se,1,0,"i",62),a(128),i()()()()()}if(o&2){let e=m();t(4),c(" ",e.i18n.t("branches.branch_information")," "),t(2),h("formGroup",e.branchForm),t(),p(e.error()?7:-1),t(4),c(" ",e.i18n.t("branches.basic_information")," "),t(4),c(" ",e.i18n.t("branches.name")," "),t(3),x("is-invalid",e.isFieldInvalid("name")),h("placeholder",e.i18n.t("branches.name_placeholder")),t(),p(e.isFieldInvalid("name")?19:-1),t(3),c(" ",e.i18n.t("branches.code")," "),t(3),x("is-invalid",e.isFieldInvalid("code")),h("placeholder",e.i18n.t("branches.code_placeholder")),t(),p(e.isFieldInvalid("code")?26:-1),t(2),l(e.i18n.t("branches.code_hint")),t(3),c(" ",e.i18n.t("branches.timezone")," "),t(3),x("is-invalid",e.isFieldInvalid("timezone")),t(2),l(e.i18n.t("branches.select_timezone")),t(),y(e.timezones),t(2),p(e.isFieldInvalid("timezone")?39:-1),t(3),l(e.i18n.t("common.status")),t(4),c(" ",e.i18n.t("common.active")," "),t(5),c(" ",e.i18n.t("branches.gps_settings")," "),t(3),c(" ",e.i18n.t("branches.gps_settings_hint")," "),t(4),c(" ",e.i18n.t("branches.latitude")," "),t(),x("is-invalid",e.isFieldInvalid("latitude")),t(),p(e.isFieldInvalid("latitude")?60:-1),t(2),l(e.i18n.t("branches.latitude_hint")),t(3),c(" ",e.i18n.t("branches.longitude")," "),t(),x("is-invalid",e.isFieldInvalid("longitude")),t(),p(e.isFieldInvalid("longitude")?67:-1),t(2),l(e.i18n.t("branches.longitude_hint")),t(3),c(" ",e.i18n.t("branches.geofence_radius")," "),t(2),x("is-invalid",e.isFieldInvalid("geofenceRadiusMeters")),t(2),l(e.i18n.t("common.meters")),t(),p(e.isFieldInvalid("geofenceRadiusMeters")?77:-1),t(2),l(e.i18n.t("branches.geofence_radius_hint")),t(5),c(" ",e.i18n.t("branches.contact_information")," "),t(4),l(e.i18n.t("common.phone")),t(),x("is-invalid",e.isFieldInvalid("phone")),h("placeholder",e.i18n.t("common.phone_placeholder")),t(),p(e.isFieldInvalid("phone")?90:-1),t(3),l(e.i18n.t("common.email")),t(),x("is-invalid",e.isFieldInvalid("email")),h("placeholder",e.i18n.t("common.email_placeholder")),t(),p(e.isFieldInvalid("email")?95:-1),t(3),l(e.i18n.t("branches.address")),t(),x("is-invalid",e.isFieldInvalid("address")),h("placeholder",e.i18n.t("branches.address_placeholder")),t(),p(e.isFieldInvalid("address")?100:-1),t(3),l(e.i18n.t("common.description")),t(),x("is-invalid",e.isFieldInvalid("description")),h("placeholder",e.i18n.t("branches.description_placeholder")),t(),p(e.isFieldInvalid("description")?105:-1),t(4),c(" ",e.i18n.t("branches.validation_rules.title")," "),t(3),l(e.i18n.t("branches.validation_rules.name")),t(2),l(e.i18n.t("branches.validation_rules.code")),t(2),l(e.i18n.t("branches.validation_rules.timezone")),t(2),l(e.i18n.t("branches.validation_rules.email")),t(2),l(e.i18n.t("branches.validation_rules.phone")),t(2),h("disabled",e.saving()),t(2),c(" ",e.i18n.t("common.cancel")," "),t(),h("disabled",e.branchForm.invalid||e.saving()),t(),p(e.saving()?126:127),t(2),c(" ",e.saving()?e.i18n.t("common.saving"):e.i18n.t("branches.update_branch")," ")}}function ve(o,r){if(o&1&&(n(0,"div",12),d(1,"i",63),a(2),i()),o&2){let e=m();t(2),c(" ",e.error()||e.i18n.t("branches.branch_not_found")," ")}}var J=class o{route=f(T);router=f(M);branchesService=f(H);fb=f(Z);i18n=f(Y);branch=_(null);loading=_(!0);saving=_(!1);error=_("");timezones=[{value:"UTC",label:"UTC"},{value:"America/New_York",label:"Eastern Time"},{value:"America/Chicago",label:"Central Time"},{value:"America/Denver",label:"Mountain Time"},{value:"America/Los_Angeles",label:"Pacific Time"},{value:"Europe/London",label:"London"},{value:"Europe/Paris",label:"Paris"},{value:"Asia/Tokyo",label:"Tokyo"},{value:"Asia/Dubai",label:"Dubai"}];branchForm;ngOnInit(){this.initializeForm();let r=this.route.snapshot.paramMap.get("id");r?this.loadBranch(r):(this.error.set("Invalid branch ID"),this.loading.set(!1))}initializeForm(){this.branchForm=this.fb.group({name:["",[v.required,v.minLength(2)]],code:["",[v.required,v.minLength(2)]],timezone:["",v.required],phone:[""],email:["",v.email],address:[""],description:[""],isActive:[!0],latitude:[null,[v.min(-90),v.max(90)]],longitude:[null,[v.min(-180),v.max(180)]],geofenceRadiusMeters:[100,[v.required,v.min(10),v.max(1e3)]]})}loadBranch(r){this.branchesService.getBranchById(parseInt(r)).subscribe({next:e=>{this.branch.set(e),this.populateForm(e),this.loading.set(!1)},error:e=>{this.error.set(this.getErrorMessage(e)),this.loading.set(!1)}})}populateForm(r){this.branchForm.patchValue({name:r.name,code:r.code,timezone:r.timeZone,phone:"",email:"",address:"",description:"",isActive:r.isActive,latitude:r.latitude,longitude:r.longitude,geofenceRadiusMeters:r.geofenceRadiusMeters||100})}onSubmit(){if(this.branchForm.invalid){this.branchForm.markAllAsTouched();return}this.saving.set(!0),this.error.set("");let r=this.branchForm.value,e=this.branch().id,u={name:r.name,code:r.code.toUpperCase(),timeZone:r.timezone,isActive:r.isActive},b={latitude:r.latitude,longitude:r.longitude,geofenceRadiusMeters:r.geofenceRadiusMeters};this.branchesService.updateBranch(e,u).subscribe({next:()=>{this.branchesService.updateBranchCoordinates(e,b).subscribe({next:()=>{this.saving.set(!1),this.router.navigate(["/branches",e,"view"])},error:C=>{this.saving.set(!1),this.error.set(this.getErrorMessage(C))}})},error:C=>{this.saving.set(!1),this.error.set(this.getErrorMessage(C))}})}onCancel(){this.branch()?this.router.navigate(["/branches",this.branch().id,"view"]):this.router.navigate(["/branches"])}getFieldError(r){let e=this.branchForm.get(r);if(e?.errors&&e.touched){if(e.errors.required)return this.i18n.t("validation.required");if(e.errors.email)return this.i18n.t("validation.email");if(e.errors.minlength)return this.i18n.t("validation.minlength").replace("{{min}}",e.errors.minlength.requiredLength)}return""}isFieldInvalid(r){let e=this.branchForm.get(r);return!!(e?.errors&&e.touched)}getErrorMessage(r){return r?.error?.error?r.error.error:this.i18n.t("errors.unknown")}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=S({type:o,selectors:[["app-edit-branch"]],decls:21,vars:7,consts:[[1,"container-fluid"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/dashboard"],["routerLink","/branches"],[1,"breadcrumb-item","active"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"fa-solid","fa-arrow-left","me-2"],[1,"d-flex","justify-content-center","py-5"],[1,"card"],[1,"alert","alert-danger"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"card-header"],[1,"card-title","mb-0"],[1,"fa-solid","fa-building","me-2"],[1,"card-body"],[3,"ngSubmit","formGroup"],["role","alert",1,"alert","alert-danger"],[1,"mb-4"],[1,"text-primary","mb-3"],[1,"fa-solid","fa-info-circle","me-2"],[1,"row","g-3"],[1,"col-md-6"],[1,"form-label"],[1,"text-danger"],["type","text","formControlName","name",1,"form-control",3,"placeholder"],[1,"invalid-feedback"],["type","text","formControlName","code",1,"form-control",2,"text-transform","uppercase",3,"placeholder"],[1,"form-text"],["formControlName","timezone",1,"form-select"],["value",""],[3,"value"],[1,"form-check","form-switch","mt-2"],["type","checkbox","role","switch","id","isActiveSwitch","formControlName","isActive",1,"form-check-input"],["for","isActiveSwitch",1,"form-check-label"],[1,"text-success","mb-3"],[1,"fa-solid","fa-location-dot","me-2"],[1,"alert","alert-info","mb-3"],[1,"col-md-4"],["type","number","step","0.000001","formControlName","latitude","placeholder","-90 to 90",1,"form-control"],["type","number","step","0.000001","formControlName","longitude","placeholder","-180 to 180",1,"form-control"],[1,"input-group"],["type","number","min","10","max","1000","formControlName","geofenceRadiusMeters",1,"form-control"],[1,"input-group-text"],[1,"invalid-feedback","d-block"],[1,"text-secondary","mb-3"],[1,"fa-solid","fa-address-book","me-2"],["type","tel","formControlName","phone",1,"form-control",3,"placeholder"],["type","email","formControlName","email",1,"form-control",3,"placeholder"],[1,"col-12"],["formControlName","address","rows","3",1,"form-control",3,"placeholder"],["formControlName","description","rows","3",1,"form-control",3,"placeholder"],[1,"alert","alert-info"],[1,"alert-heading"],[1,"mb-0"],[1,"d-flex","justify-content-end","gap-2","mt-4"],[1,"fa-solid","fa-times","me-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"fa-solid","fa-save","me-2"],[1,"fa-solid","fa-exclamation-triangle","me-2"]],template:function(e,u){e&1&&(n(0,"div",0)(1,"div",1)(2,"div")(3,"h2"),a(4),i(),n(5,"nav",2)(6,"ol",3)(7,"li",4)(8,"a",5),a(9),i()(),n(10,"li",4)(11,"a",6),a(12),i()(),n(13,"li",7),a(14),i()()()(),n(15,"button",8),g("click",function(){return u.onCancel()}),d(16,"i",9),a(17),i()(),s(18,Q,4,1,"div",10)(19,pe,129,72,"div",11)(20,ve,3,1,"div",12),i()),e&2&&(t(4),l(u.i18n.t("branches.edit_branch")),t(5),l(u.i18n.t("dashboard.title")),t(3),l(u.i18n.t("branches.title")),t(2),l(u.i18n.t("branches.edit_branch")),t(),h("disabled",u.saving()),t(2),c(" ",u.i18n.t("common.back")," "),t(),p(u.loading()?18:u.branch()?19:20))},dependencies:[k,N,$,V,G,O,w,P,A,L,R,z,U,j,D,q],encapsulation:2})};export{J as EditBranchComponent};
