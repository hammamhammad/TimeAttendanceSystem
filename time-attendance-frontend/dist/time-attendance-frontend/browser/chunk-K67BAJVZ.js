import{a as ie}from"./chunk-LRWEBFSR.js";import{a as ne,b as oe}from"./chunk-GBFD7MFB.js";import{a as te}from"./chunk-ZKUEJZLQ.js";import{b as R,c as L,e as D,f as G,g as U,h as j,i as z,j as J,k as K,s as Q,t as X,u as Y,v as Z,x as $}from"./chunk-7QCK55IR.js";import{b as ee}from"./chunk-AS5QRUY4.js";import{$ as r,E as n,Ea as u,Fa as p,Ga as g,Ha as W,J as H,La as q,U as C,V as S,W as P,X as I,Y as E,Ya as B,Z as k,_ as F,aa as o,ba as x,fb as O,ia as b,ka as y,ma as h,nb as A,qb as N,t as M,u as f,v as c,wa as a,xa as l,ya as _,z as w,za as V}from"./chunk-LDUBOZPL.js";import"./chunk-DGAILPFQ.js";var le=()=>({standalone:!0});function he(m,i){if(m&1&&(r(0,"div",4)(1,"div",5)(2,"div",6)(3,"span",7),a(4),o()(),r(5,"div",8),a(6),o()()()),m&2){let e=h();n(4),l(e.t("common.loading")),n(2),l(e.t("shifts.loading.shift"))}}function me(m,i){if(m&1){let e=b();r(0,"div",20)(1,"label",72),a(2),r(3,"span",22),a(4,"*"),o()(),r(5,"div",61)(6,"input",73),g("ngModelChange",function(t){f(e);let s=h(2);return p(s.shiftForm.requiredHours,t)||(s.shiftForm.requiredHours=t),c(t)}),o(),r(7,"span",63),a(8),o()(),r(9,"div",59),a(10),o()()}if(m&2){let e=h(2);n(2),_(" ",e.t("shifts.requiredHours")," "),n(4),u("ngModel",e.shiftForm.requiredHours),n(2),l(e.t("shifts.hours")),n(2),l(e.t("shifts.help.requiredHours"))}}function fe(m,i){if(m&1){let e=b();r(0,"button",80),y("click",function(){f(e);let t=h(3);return c(t.addShiftPeriod())}),x(1,"i",81),a(2),o()}if(m&2){let e=h(3);n(2),_("",e.t("shifts.addPeriod")," ")}}function ce(m,i){if(m&1){let e=b();r(0,"button",90),y("click",function(){f(e);let t=h().$index,s=h(3);return c(s.removeShiftPeriod(t))}),x(1,"i",91),o()}}function ue(m,i){if(m&1){let e=b();r(0,"div",77)(1,"div",82)(2,"span",33),a(3),o(),r(4,"div",83)(5,"span",84),a(6),o(),r(7,"span",85),a(8),o(),C(9,ce,2,0,"button",86),o()(),r(10,"div",87)(11,"div",2)(12,"div",29)(13,"label",88),a(14),o(),r(15,"input",89),g("ngModelChange",function(t){let s=f(e).$implicit;return p(s.startTime,t)||(s.startTime=t),c(t)}),o()(),r(16,"div",29)(17,"label",88),a(18),o(),r(19,"input",89),g("ngModelChange",function(t){let s=f(e).$implicit;return p(s.endTime,t)||(s.endTime=t),c(t)}),o()()()()()}if(m&2){let e=i.$implicit,d=i.$index,t=h(3);n(3),V("",t.t("shifts.period")," ",e.periodOrder),n(2),F("ngClass",t.isNightShift(e.startTime,e.endTime)?"bg-info":"bg-primary"),n(),_(" ",t.getPeriodTypeText(e)," "),n(2),l(t.formatHours(t.calculatePeriodHours(e.startTime,e.endTime))),n(),S(t.shiftForm.shiftPeriods.length>1?9:-1),n(5),l(t.t("shifts.startTime")),n(),u("ngModel",e.startTime),F("name","startTime_"+d),n(3),l(t.t("shifts.endTime")),n(),u("ngModel",e.endTime),F("name","endTime_"+d)}}function pe(m,i){if(m&1&&(r(0,"div",17)(1,"div",3)(2,"div",74)(3,"h5",75),a(4),o(),C(5,fe,3,1,"button",76),o(),x(6,"hr",19),E(7,ue,20,12,"div",77,P),r(9,"div",78),x(10,"i",79),r(11,"span"),a(12),r(13,"strong"),a(14),o()()()()()),m&2){let e=h(2);n(4),l(e.t("shifts.periods")),n(),S(e.shiftForm.shiftPeriods.length<2?5:-1),n(2),k(e.shiftForm.shiftPeriods),n(5),_("",e.t("shifts.totalHours"),": "),n(2),l(e.formatHours(e.getTotalShiftHours()))}}function ge(m,i){if(m&1){let e=b();r(0,"div",20)(1,"label",92),a(2),r(3,"span",22),a(4,"*"),o()(),r(5,"input",93),g("ngModelChange",function(t){f(e);let s=h(2);return p(s.shiftForm.coreStart,t)||(s.shiftForm.coreStart=t),c(t)}),o()(),r(6,"div",20)(7,"label",94),a(8),r(9,"span",22),a(10,"*"),o()(),r(11,"input",95),g("ngModelChange",function(t){f(e);let s=h(2);return p(s.shiftForm.coreEnd,t)||(s.shiftForm.coreEnd=t),c(t)}),o()()}if(m&2){let e=h(2);n(2),_(" ",e.t("shifts.coreStart")," "),n(3),u("ngModel",e.shiftForm.coreStart),n(3),_(" ",e.t("shifts.coreEnd")," "),n(3),u("ngModel",e.shiftForm.coreEnd)}}function _e(m,i){if(m&1){let e=b();r(0,"div",20)(1,"label",100),a(2),o(),r(3,"div",61)(4,"input",101),g("ngModelChange",function(t){f(e);let s=h(3);return p(s.shiftForm.flexMinutesBefore,t)||(s.shiftForm.flexMinutesBefore=t),c(t)}),o(),r(5,"span",63),a(6),o()(),r(7,"div",59),a(8),o()(),r(9,"div",20)(10,"label",102),a(11),o(),r(12,"div",61)(13,"input",103),g("ngModelChange",function(t){f(e);let s=h(3);return p(s.shiftForm.flexMinutesAfter,t)||(s.shiftForm.flexMinutesAfter=t),c(t)}),o(),r(14,"span",63),a(15),o()(),r(16,"div",59),a(17),o()()}if(m&2){let e=h(3);n(2),l(e.t("shifts.flexMinutesBefore")),n(2),u("ngModel",e.shiftForm.flexMinutesBefore),n(2),l(e.t("common.minutes")),n(2),l(e.t("shifts.help.flexBefore")),n(3),l(e.t("shifts.flexMinutesAfter")),n(2),u("ngModel",e.shiftForm.flexMinutesAfter),n(2),l(e.t("common.minutes")),n(2),l(e.t("shifts.help.flexAfter"))}}function xe(m,i){if(m&1){let e=b();r(0,"div",20)(1,"label",96),a(2),o(),r(3,"div",61)(4,"input",97),g("ngModelChange",function(t){f(e);let s=h(2);return p(s.shiftForm.gracePeriodMinutes,t)||(s.shiftForm.gracePeriodMinutes=t),c(t)}),y("ngModelChange",function(){f(e);let t=h(2);return c(t.onGracePeriodChange())}),o(),r(5,"span",63),a(6),o()(),r(7,"div",59),a(8),o()(),r(9,"div",26)(10,"div",56)(11,"input",98),g("ngModelChange",function(t){f(e);let s=h(2);return p(s.shiftForm.allowFlexibleHours,t)||(s.shiftForm.allowFlexibleHours=t),c(t)}),y("change",function(){f(e);let t=h(2);return c(t.onFlexibleHoursChange())}),o(),r(12,"label",99),a(13),o()(),r(14,"div",59),a(15),o()(),C(16,_e,18,8)}if(m&2){let e=h(2);n(2),l(e.t("shifts.gracePeriodMinutes")),n(2),u("ngModel",e.shiftForm.gracePeriodMinutes),n(2),l(e.t("common.minutes")),n(2),l(e.t("shifts.help.gracePeriod")),n(3),u("ngModel",e.shiftForm.allowFlexibleHours),n(2),_(" ",e.t("shifts.allowFlexibleHours")," "),n(2),l(e.t("shifts.help.flexibleHours")),n(),S(e.shiftForm.allowFlexibleHours?16:-1)}}function ye(m,i){if(m&1&&(r(0,"div",108),a(1),o()),m&2){let e=i.$implicit;n(),_("\u2022 ",e)}}function Ce(m,i){if(m&1&&(r(0,"div",17)(1,"div",3)(2,"div",104)(3,"div",105),x(4,"i",106),r(5,"div")(6,"h6",107),a(7),o(),E(8,ye,2,1,"div",108,I),o()()()()()),m&2){let e=h(2);n(7),l(e.t("common.validationErrors")),n(),k(e.getFormErrors())}}function Se(m,i){if(m&1&&(x(0,"span",109),a(1)),m&2){let e=h(2);n(),_(" ",e.t("shifts.loading.updating")," ")}}function Fe(m,i){if(m&1&&(x(0,"i",110),a(1)),m&2){let e=h(2);n(),_("",e.t("shifts.update")," ")}}function be(m,i){if(m&1){let e=b();r(0,"div",9)(1,"div")(2,"h2",10),a(3),o(),r(4,"p",11),a(5),o()(),r(6,"button",12),y("click",function(){f(e);let t=h();return c(t.onCancel())}),x(7,"i",13),a(8),o()(),r(9,"div",14)(10,"div",15)(11,"form",16,0),y("ngSubmit",function(){f(e);let t=h();return c(t.onSubmit())}),r(13,"div",17)(14,"div",3)(15,"h5",18),a(16),o(),x(17,"hr",19),o(),r(18,"div",20)(19,"label",21),a(20),r(21,"span",22),a(22,"*"),o()(),r(23,"input",23),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.name,t)||(s.shiftForm.name=t),c(t)}),o()(),r(24,"div",20)(25,"label",24),a(26),o(),r(27,"app-searchable-select",25),y("selectionChange",function(t){f(e);let s=h();return c(s.onStatusSelectionChange(t))}),o()(),r(28,"div",26)(29,"label",27),a(30),o(),r(31,"textarea",28),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.description,t)||(s.shiftForm.description=t),c(t)}),o()()(),r(32,"div",17)(33,"div",3)(34,"h5",18),a(35),o(),x(36,"hr",19),o(),r(37,"div",26)(38,"div",2)(39,"div",29)(40,"div",30)(41,"input",31),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.shiftType,t)||(s.shiftForm.shiftType=t),c(t)}),y("change",function(){f(e);let t=h();return c(t.onShiftTypeChange())}),o(),r(42,"label",32)(43,"div",33),a(44),o(),r(45,"small",34),a(46),o()()()(),r(47,"div",29)(48,"div",30)(49,"input",35),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.shiftType,t)||(s.shiftForm.shiftType=t),c(t)}),y("change",function(){f(e);let t=h();return c(t.onShiftTypeChange())}),o(),r(50,"label",36)(51,"div",33),a(52),o(),r(53,"small",34),a(54),o()()()()()(),C(55,me,11,4,"div",20),o(),r(56,"div",17)(57,"div",3)(58,"h5",18),a(59),o(),x(60,"hr",19),o(),r(61,"div",26)(62,"div",2)(63,"div",37)(64,"div",38)(65,"input",39),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.isSunday,t)||(s.shiftForm.isSunday=t),c(t)}),o(),r(66,"label",40),a(67),o()()(),r(68,"div",37)(69,"div",38)(70,"input",41),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.isMonday,t)||(s.shiftForm.isMonday=t),c(t)}),o(),r(71,"label",42),a(72),o()()(),r(73,"div",37)(74,"div",38)(75,"input",43),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.isTuesday,t)||(s.shiftForm.isTuesday=t),c(t)}),o(),r(76,"label",44),a(77),o()()(),r(78,"div",37)(79,"div",38)(80,"input",45),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.isWednesday,t)||(s.shiftForm.isWednesday=t),c(t)}),o(),r(81,"label",46),a(82),o()()(),r(83,"div",37)(84,"div",38)(85,"input",47),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.isThursday,t)||(s.shiftForm.isThursday=t),c(t)}),o(),r(86,"label",48),a(87),o()()(),r(88,"div",37)(89,"div",38)(90,"input",49),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.isFriday,t)||(s.shiftForm.isFriday=t),c(t)}),o(),r(91,"label",50),a(92),o()()(),r(93,"div",37)(94,"div",38)(95,"input",51),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.isSaturday,t)||(s.shiftForm.isSaturday=t),c(t)}),o(),r(96,"label",52),a(97),o()()()(),r(98,"small",34),a(99),o()(),r(100,"div",53)(101,"div",38)(102,"input",54),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.isNightShift,t)||(s.shiftForm.isNightShift=t),c(t)}),o(),r(103,"label",55),a(104),o()(),r(105,"small",34),a(106),o()()(),C(107,pe,15,4,"div",17),r(108,"div",17)(109,"div",3)(110,"h5",18),a(111),o(),x(112,"hr",19),o(),r(113,"div",26)(114,"div",56)(115,"input",57),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.hasCoreHours,t)||(s.shiftForm.hasCoreHours=t),c(t)}),y("change",function(){f(e);let t=h();return c(t.onCoreHoursChange())}),o(),r(116,"label",58),a(117),o()(),r(118,"div",59),a(119),o()(),C(120,ge,12,4),o(),r(121,"div",17)(122,"div",3)(123,"h5",18),a(124),o(),x(125,"hr",19),o(),r(126,"div",20)(127,"label",60),a(128),o(),r(129,"div",61)(130,"input",62),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.requiredWeeklyHours,t)||(s.shiftForm.requiredWeeklyHours=t),c(t)}),o(),r(131,"span",63),a(132),o()(),r(133,"div",59),a(134),o()(),r(135,"div",20)(136,"div",56)(137,"input",64),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.isCheckInRequired,t)||(s.shiftForm.isCheckInRequired=t),c(t)}),o(),r(138,"label",65),a(139),o()(),r(140,"div",59),a(141),o()(),r(142,"div",20)(143,"div",56)(144,"input",66),g("ngModelChange",function(t){f(e);let s=h();return p(s.shiftForm.isAutoCheckOut,t)||(s.shiftForm.isAutoCheckOut=t),c(t)}),o(),r(145,"label",67),a(146),o()(),r(147,"div",59),a(148),o()(),C(149,xe,17,8),o(),C(150,Ce,10,1,"div",17),r(151,"div",2)(152,"div",3),x(153,"hr",68),r(154,"div",69)(155,"button",70),y("click",function(){f(e);let t=h();return c(t.onCancel())}),a(156),o(),r(157,"button",71),C(158,Se,2,1)(159,Fe,2,1),o()()()()()()()}if(m&2){let e=h();n(3),l(e.t("shifts.edit")),n(2),l(e.t("shifts.editDescription")),n(3),_("",e.t("common.back")," "),n(8),l(e.t("common.basicInformation")),n(4),_(" ",e.t("shifts.name")," "),n(3),F("placeholder",W(e.t("shifts.namePlaceholder"))),u("ngModel",e.shiftForm.name),n(3),l(e.t("shifts.fields.status")),n(),F("options",e.statusSelectOptions)("ngModel",e.shiftForm.status.toString())("ngModelOptions",q(70,le))("searchable",!1)("clearable",!1),n(3),l(e.t("shifts.description")),n(),F("placeholder",W(e.t("shifts.descriptionPlaceholder"))),u("ngModel",e.shiftForm.description),n(4),l(e.t("shifts.type")),n(6),F("value",e.ShiftType.TimeBased),u("ngModel",e.shiftForm.shiftType),n(3),l(e.t("shifts.types.timeBased")),n(2),l(e.t("shifts.help.shiftType.timeBased")),n(3),F("value",e.ShiftType.HoursOnly),u("ngModel",e.shiftForm.shiftType),n(3),l(e.t("shifts.types.hoursOnly")),n(2),l(e.t("shifts.help.shiftType.hoursOnly")),n(),S(e.shiftForm.shiftType===e.ShiftType.HoursOnly?55:-1),n(4),l(e.t("shifts.workingDays")),n(6),u("ngModel",e.shiftForm.isSunday),n(2),l(e.t("common.days.sunday")),n(3),u("ngModel",e.shiftForm.isMonday),n(2),l(e.t("common.days.monday")),n(3),u("ngModel",e.shiftForm.isTuesday),n(2),l(e.t("common.days.tuesday")),n(3),u("ngModel",e.shiftForm.isWednesday),n(2),l(e.t("common.days.wednesday")),n(3),u("ngModel",e.shiftForm.isThursday),n(2),l(e.t("common.days.thursday")),n(3),u("ngModel",e.shiftForm.isFriday),n(2),l(e.t("common.days.friday")),n(3),u("ngModel",e.shiftForm.isSaturday),n(2),l(e.t("common.days.saturday")),n(2),l(e.t("shifts.help.workingDays")),n(3),u("ngModel",e.shiftForm.isNightShift),n(2),_(" ",e.t("shifts.isNightShift")," "),n(2),l(e.t("shifts.help.nightShift")),n(),S(e.shiftForm.shiftType===e.ShiftType.TimeBased?107:-1),n(4),l(e.t("shifts.coreHours")),n(4),u("ngModel",e.shiftForm.hasCoreHours),n(2),_(" ",e.t("shifts.hasCoreHours")," "),n(2),l(e.t("shifts.help.coreHours")),n(),S(e.shiftForm.hasCoreHours?120:-1),n(4),l(e.t("shifts.advancedOptions")),n(4),l(e.t("shifts.requiredWeeklyHours")),n(2),u("ngModel",e.shiftForm.requiredWeeklyHours),n(2),l(e.t("shifts.hours")),n(2),l(e.t("shifts.help.requiredWeeklyHours")),n(3),u("ngModel",e.shiftForm.isCheckInRequired),n(2),_(" ",e.t("shifts.checkInRequired")," "),n(2),l(e.t("shifts.help.checkInRequired")),n(3),u("ngModel",e.shiftForm.isAutoCheckOut),n(2),_(" ",e.t("shifts.autoCheckOut")," "),n(2),l(e.t("shifts.help.autoCheckOut")),n(),S(e.shiftForm.shiftType===e.ShiftType.TimeBased?149:-1),n(),S(!e.isFormValid()&&e.shiftForm.name?150:-1),n(5),F("disabled",e.submitting()),n(),_(" ",e.t("common.cancel")," "),n(),F("disabled",!e.isFormValid()||e.submitting()),n(),S(e.submitting()?158:159)}}var re=class m{shiftsService=M(ie);router=M(N);route=M(A);i18n=M(ee);ShiftType=ne;ShiftStatus=oe;loading=w(!1);submitting=w(!1);shiftId=w(0);originalShift=w(null);shiftForm={name:"",description:"",shiftType:1,status:1,requiredHours:void 0,isCheckInRequired:!0,isAutoCheckOut:!1,allowFlexibleHours:!1,flexMinutesBefore:void 0,flexMinutesAfter:void 0,gracePeriodMinutes:void 0,requiredWeeklyHours:void 0,hasCoreHours:!1,coreStart:"",coreEnd:"",isSunday:!1,isMonday:!0,isTuesday:!0,isWednesday:!0,isThursday:!0,isFriday:!0,isSaturday:!1,isNightShift:!1,shiftPeriods:[]};ngOnInit(){let i=this.route.snapshot.paramMap.get("id");i?(this.shiftId.set(parseInt(i,10)),this.loadShift()):this.router.navigate(["/shifts"])}t(i){return this.i18n.t(i)}loadShift(){this.loading.set(!0),this.shiftsService.getShiftById(this.shiftId()).subscribe({next:i=>{console.log("\u{1F50D} DEBUG: Raw shift data from API:",i),console.log("\u{1F50D} DEBUG: Shift status value:",i.status),console.log("\u{1F50D} DEBUG: Working days:",{isSunday:i.isSunday,isMonday:i.isMonday,isTuesday:i.isTuesday,isWednesday:i.isWednesday,isThursday:i.isThursday,isFriday:i.isFriday,isSaturday:i.isSaturday}),this.originalShift.set(i),this.populateForm(i),console.log("\u{1F50D} DEBUG: Form after population:",this.shiftForm),this.loading.set(!1)},error:i=>{console.error("Failed to load shift:",i),this.loading.set(!1),this.router.navigate(["/shifts"])}})}populateForm(i){this.shiftForm.name=i.name,this.shiftForm.description=i.description||"",this.shiftForm.shiftType=i.shiftType,this.shiftForm.status=i.status,i.shiftType===1?this.shiftForm.requiredHours=void 0:this.shiftForm.requiredHours=i.requiredHours,this.shiftForm.isCheckInRequired=i.isCheckInRequired,this.shiftForm.isAutoCheckOut=i.isAutoCheckOut,this.shiftForm.allowFlexibleHours=i.allowFlexibleHours,this.shiftForm.flexMinutesBefore=i.flexMinutesBefore,this.shiftForm.flexMinutesAfter=i.flexMinutesAfter,this.shiftForm.gracePeriodMinutes=i.gracePeriodMinutes,this.shiftForm.requiredWeeklyHours=i.requiredWeeklyHours&&i.requiredWeeklyHours>0?i.requiredWeeklyHours:void 0,this.shiftForm.hasCoreHours=i.hasCoreHours,this.shiftForm.coreStart=i.coreStart||"",this.shiftForm.coreEnd=i.coreEnd||"",this.shiftForm.isSunday=i.isSunday,this.shiftForm.isMonday=i.isMonday,this.shiftForm.isTuesday=i.isTuesday,this.shiftForm.isWednesday=i.isWednesday,this.shiftForm.isThursday=i.isThursday,this.shiftForm.isFriday=i.isFriday,this.shiftForm.isSaturday=i.isSaturday,this.shiftForm.isNightShift=i.isNightShift,this.shiftForm.shiftPeriods=i.shiftType===1?i.shiftPeriods?.map(e=>({id:e.id,periodOrder:e.periodOrder,startTime:e.startTime,endTime:e.endTime}))||[]:[]}onShiftTypeChange(){this.shiftForm.shiftType===2?(this.shiftForm.allowFlexibleHours=!1,this.shiftForm.flexMinutesBefore=void 0,this.shiftForm.flexMinutesAfter=void 0,this.shiftForm.gracePeriodMinutes=void 0,this.shiftForm.shiftPeriods=[],this.shiftForm.isNightShift=!1,this.shiftForm.requiredHours||(this.shiftForm.requiredHours=8)):(this.shiftForm.requiredHours=void 0,this.shiftForm.shiftPeriods.length===0&&this.addShiftPeriod())}onCoreHoursChange(){this.shiftForm.hasCoreHours?(this.shiftForm.coreStart||(this.shiftForm.coreStart="09:00"),this.shiftForm.coreEnd||(this.shiftForm.coreEnd="15:00")):(this.shiftForm.coreStart="",this.shiftForm.coreEnd="")}onFlexibleHoursChange(){this.shiftForm.allowFlexibleHours?this.shiftForm.gracePeriodMinutes=void 0:(this.shiftForm.flexMinutesBefore=void 0,this.shiftForm.flexMinutesAfter=void 0)}onGracePeriodChange(){this.shiftForm.gracePeriodMinutes&&this.shiftForm.gracePeriodMinutes>0&&(this.shiftForm.allowFlexibleHours=!1,this.shiftForm.flexMinutesBefore=void 0,this.shiftForm.flexMinutesAfter=void 0)}onWeeklyHoursChange(){this.shiftForm.requiredWeeklyHours&&this.shiftForm.requiredWeeklyHours>0&&(this.shiftForm.hasCoreHours||(this.shiftForm.hasCoreHours=!0,this.onCoreHoursChange()))}onNightShiftChange(){this.shiftForm.isNightShift&&this.shiftForm.shiftType===2&&(this.shiftForm.isNightShift=!1)}addShiftPeriod(){if(this.shiftForm.shiftPeriods.length<2){let i=this.shiftForm.shiftPeriods.length+1;this.shiftForm.shiftPeriods.push({periodOrder:i,startTime:i===1?"08:00":"13:00",endTime:i===1?"12:00":"17:00"})}}removeShiftPeriod(i){this.shiftForm.shiftPeriods.splice(i,1),this.shiftForm.shiftPeriods.forEach((e,d)=>{e.periodOrder=d+1})}calculatePeriodHours(i,e){if(!i||!e)return 0;let d=this.parseTime(i),t=this.parseTime(e);if(t>d)return(t-d)/(1e3*60*60);if(t<d){let s=(864e5-d)/36e5,v=t/(1e3*60*60);return s+v}else return 0}isNightShift(i,e){if(!i||!e)return!1;let d=this.parseTime(i);return this.parseTime(e)<d}getTotalShiftHours(){return this.shiftForm.shiftType===2?this.shiftForm.requiredHours||0:this.shiftForm.shiftPeriods.reduce((i,e)=>i+this.calculatePeriodHours(e.startTime,e.endTime),0)}getWorkingDaysCount(){let i=0;return this.shiftForm.isSunday&&i++,this.shiftForm.isMonday&&i++,this.shiftForm.isTuesday&&i++,this.shiftForm.isWednesday&&i++,this.shiftForm.isThursday&&i++,this.shiftForm.isFriday&&i++,this.shiftForm.isSaturday&&i++,i}parseTime(i){let[e,d]=i.split(":").map(Number);return(e*60+d)*60*1e3}formatTimeWithSeconds(i){return i?i.includes(":")&&i.split(":").length===3?i:i.length===5?`${i}:00`:i:""}formatHours(i){let e=Math.floor(i),d=Math.round((i-e)*60);return d>0?`${e}h ${d}m`:`${e}h`}getPeriodTypeText(i){return this.isNightShift(i.startTime,i.endTime)?this.t("shifts.periodTypes.nightShift"):this.t("shifts.periodTypes.dayShift")}getShiftStatusText(i){switch(i){case 1:return this.t("shifts.status.active");case 2:return this.t("shifts.status.inactive");case 3:return this.t("shifts.status.draft");case 4:return this.t("shifts.status.archived");default:return this.t("shifts.status.active")}}get statusSelectOptions(){return[{value:1 .toString(),label:this.getShiftStatusText(1)},{value:2 .toString(),label:this.getShiftStatusText(2)},{value:3 .toString(),label:this.getShiftStatusText(3)},{value:4 .toString(),label:this.getShiftStatusText(4)}]}onStatusSelectionChange(i){let e=i?parseInt(i):1;this.shiftForm.status=e}validateBusinessRules(){let i=[];if(this.shiftForm.name.trim()||i.push(this.t("shifts.validation.name.required")),this.shiftForm.isSunday||this.shiftForm.isMonday||this.shiftForm.isTuesday||this.shiftForm.isWednesday||this.shiftForm.isThursday||this.shiftForm.isFriday||this.shiftForm.isSaturday||i.push(this.t("shifts.validation.workingDays.required")),this.shiftForm.hasCoreHours)if(!this.shiftForm.coreStart||!this.shiftForm.coreEnd)i.push(this.t("shifts.validation.coreHours.required"));else{let d=this.parseTime(this.shiftForm.coreStart),t=this.parseTime(this.shiftForm.coreEnd);d===t&&i.push(this.t("shifts.validation.coreHours.sameTime")),this.shiftForm.shiftType===1&&this.shiftForm.shiftPeriods.length>0&&(this.shiftForm.shiftPeriods.some(v=>this.isCoreWithinPeriod(v,this.shiftForm.coreStart,this.shiftForm.coreEnd))||i.push(this.t("shifts.validation.coreHours.outsidePeriods")))}return this.shiftForm.requiredWeeklyHours!==void 0&&this.shiftForm.requiredWeeklyHours!==null&&(this.shiftForm.requiredWeeklyHours<=0&&i.push(this.t("shifts.validation.weeklyHours.positive")),this.shiftForm.requiredWeeklyHours>168&&i.push(this.t("shifts.validation.weeklyHours.maxWeekly"))),this.shiftForm.allowFlexibleHours&&this.shiftForm.gracePeriodMinutes&&this.shiftForm.gracePeriodMinutes>0&&i.push(this.t("shifts.validation.flexible.noGracePeriod")),this.shiftForm.shiftType===1?(this.shiftForm.shiftPeriods.length===0&&i.push(this.t("shifts.validation.timeBased.periodsRequired")),this.shiftForm.requiredHours!==void 0&&i.push(this.t("shifts.validation.timeBased.noRequiredHours"))):this.shiftForm.shiftType===2&&(this.shiftForm.shiftPeriods.length>0&&i.push(this.t("shifts.validation.hoursOnly.noPeriods")),(!this.shiftForm.requiredHours||this.shiftForm.requiredHours<=0)&&i.push(this.t("shifts.validation.hoursOnly.requiredHours")),this.shiftForm.requiredHours&&this.shiftForm.requiredHours>24&&i.push(this.t("shifts.validation.hoursOnly.maxHours"))),i}isCoreWithinPeriod(i,e,d){let t=this.parseTime(i.startTime),s=this.parseTime(i.endTime),v=this.parseTime(e),T=this.parseTime(d);if(s<t){let se=v>=t&&T>=t,ae=v<=s&&T<=s,de=v>=t&&T<=s;return se||ae||de}else return v>=t&&T<=s}isFormValid(){return this.validateBusinessRules().length===0}getFormErrors(){return this.validateBusinessRules()}onSubmit(){if(!this.isFormValid())return;this.submitting.set(!0);let i={name:this.shiftForm.name.trim(),description:this.shiftForm.description.trim()||void 0,shiftType:this.shiftForm.shiftType,status:this.shiftForm.status,requiredHours:this.shiftForm.requiredHours,isCheckInRequired:this.shiftForm.isCheckInRequired,isAutoCheckOut:this.shiftForm.isAutoCheckOut,allowFlexibleHours:this.shiftForm.allowFlexibleHours,flexMinutesBefore:this.shiftForm.flexMinutesBefore,flexMinutesAfter:this.shiftForm.flexMinutesAfter,gracePeriodMinutes:this.shiftForm.gracePeriodMinutes,requiredWeeklyHours:this.shiftForm.requiredWeeklyHours,hasCoreHours:this.shiftForm.hasCoreHours,coreStart:this.shiftForm.hasCoreHours?this.formatTimeWithSeconds(this.shiftForm.coreStart):void 0,coreEnd:this.shiftForm.hasCoreHours?this.formatTimeWithSeconds(this.shiftForm.coreEnd):void 0,isSunday:this.shiftForm.isSunday,isMonday:this.shiftForm.isMonday,isTuesday:this.shiftForm.isTuesday,isWednesday:this.shiftForm.isWednesday,isThursday:this.shiftForm.isThursday,isFriday:this.shiftForm.isFriday,isSaturday:this.shiftForm.isSaturday,isNightShift:this.shiftForm.isNightShift,shiftPeriods:this.shiftForm.shiftPeriods.length>0?this.shiftForm.shiftPeriods.map(e=>({id:e.id,periodOrder:e.periodOrder,startTime:this.formatTimeWithSeconds(e.startTime),endTime:this.formatTimeWithSeconds(e.endTime)})):void 0};this.shiftsService.updateShift(this.shiftId(),i).subscribe({next:()=>{this.router.navigate(["/shifts"]),this.submitting.set(!1)},error:e=>{console.error("Failed to update shift:",e),this.submitting.set(!1)}})}onCancel(){this.router.navigate(["/shifts"])}static \u0275fac=function(e){return new(e||m)};static \u0275cmp=H({type:m,selectors:[["app-edit-shift"]],decls:5,vars:1,consts:[["formRef","ngForm"],[1,"container-fluid","px-4"],[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-center","align-items-center",2,"height","400px"],[1,"text-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-3","text-muted"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"h4","mb-1"],[1,"text-muted","mb-0"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-arrow-left","me-2"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-4"],[3,"ngSubmit"],[1,"row","mb-4"],[1,"card-title","mb-3"],[1,"mt-0","mb-3"],[1,"col-md-6","mb-3"],["for","name",1,"form-label"],[1,"text-danger"],["type","text","id","name","name","name","required","","maxlength","200",1,"form-control",3,"ngModelChange","ngModel","placeholder"],["for","status",1,"form-label"],[3,"selectionChange","options","ngModel","ngModelOptions","searchable","clearable"],[1,"col-12","mb-3"],["for","description",1,"form-label"],["id","description","name","description","rows","3","maxlength","1000",1,"form-control",3,"ngModelChange","ngModel","placeholder"],[1,"col-md-6"],[1,"form-check","p-3","border","rounded"],["type","radio","name","shiftType","id","timeBased",1,"form-check-input",3,"ngModelChange","change","value","ngModel"],["for","timeBased",1,"form-check-label","w-100"],[1,"fw-medium"],[1,"text-muted"],["type","radio","name","shiftType","id","hoursOnly",1,"form-check-input",3,"ngModelChange","change","value","ngModel"],["for","hoursOnly",1,"form-check-label","w-100"],[1,"col-md-3","col-6","mb-2"],[1,"form-check"],["type","checkbox","id","sunday","name","isSunday",1,"form-check-input",3,"ngModelChange","ngModel"],["for","sunday",1,"form-check-label"],["type","checkbox","id","monday","name","isMonday",1,"form-check-input",3,"ngModelChange","ngModel"],["for","monday",1,"form-check-label"],["type","checkbox","id","tuesday","name","isTuesday",1,"form-check-input",3,"ngModelChange","ngModel"],["for","tuesday",1,"form-check-label"],["type","checkbox","id","wednesday","name","isWednesday",1,"form-check-input",3,"ngModelChange","ngModel"],["for","wednesday",1,"form-check-label"],["type","checkbox","id","thursday","name","isThursday",1,"form-check-input",3,"ngModelChange","ngModel"],["for","thursday",1,"form-check-label"],["type","checkbox","id","friday","name","isFriday",1,"form-check-input",3,"ngModelChange","ngModel"],["for","friday",1,"form-check-label"],["type","checkbox","id","saturday","name","isSaturday",1,"form-check-input",3,"ngModelChange","ngModel"],["for","saturday",1,"form-check-label"],[1,"col-12","mt-3"],["type","checkbox","id","nightShift","name","isNightShift",1,"form-check-input",3,"ngModelChange","ngModel"],["for","nightShift",1,"form-check-label","fw-medium"],[1,"form-check","form-switch"],["type","checkbox","id","hasCoreHours","name","hasCoreHours",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","hasCoreHours",1,"form-check-label"],[1,"form-text"],["for","requiredWeeklyHours",1,"form-label"],[1,"input-group"],["type","number","id","requiredWeeklyHours","name","requiredWeeklyHours","step","0.5","min","0","max","168",1,"form-control",3,"ngModelChange","ngModel"],[1,"input-group-text"],["type","checkbox","id","checkInRequired","name","isCheckInRequired",1,"form-check-input",3,"ngModelChange","ngModel"],["for","checkInRequired",1,"form-check-label"],["type","checkbox","id","autoCheckOut","name","isAutoCheckOut",1,"form-check-input",3,"ngModelChange","ngModel"],["for","autoCheckOut",1,"form-check-label"],[1,"mb-4"],[1,"d-flex","justify-content-end","gap-2"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],["for","requiredHours",1,"form-label"],["type","number","id","requiredHours","name","requiredHours","step","0.5","min","0.5","max","24","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"card-title","mb-0"],["type","button",1,"btn","btn-outline-primary","btn-sm"],[1,"card","border","mb-3"],[1,"alert","alert-info","d-flex","align-items-center"],[1,"bi","bi-info-circle","me-2"],["type","button",1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"bi","bi-plus-circle","me-1"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center","py-2"],[1,"d-flex","align-items-center","gap-2"],[1,"badge",3,"ngClass"],[1,"text-muted","small"],["type","button",1,"btn","btn-outline-danger","btn-sm"],[1,"card-body"],[1,"form-label"],["type","time","required","",1,"form-control",3,"ngModelChange","ngModel","name"],["type","button",1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"bi","bi-trash"],["for","coreStart",1,"form-label"],["type","time","id","coreStart","name","coreStart","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","coreEnd",1,"form-label"],["type","time","id","coreEnd","name","coreEnd","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","gracePeriod",1,"form-label"],["type","number","id","gracePeriod","name","gracePeriodMinutes","min","0","max","120",1,"form-control",3,"ngModelChange","ngModel"],["type","checkbox","id","flexibleHours","name","allowFlexibleHours",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","flexibleHours",1,"form-check-label"],["for","flexBefore",1,"form-label"],["type","number","id","flexBefore","name","flexMinutesBefore","min","1","max","480",1,"form-control",3,"ngModelChange","ngModel"],["for","flexAfter",1,"form-label"],["type","number","id","flexAfter","name","flexMinutesAfter","min","1","max","480",1,"form-control",3,"ngModelChange","ngModel"],[1,"alert","alert-danger"],[1,"d-flex","align-items-start"],[1,"bi","bi-exclamation-triangle","me-2","mt-1"],[1,"alert-heading","mb-2"],[1,"mb-1"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"bi","bi-check-circle","me-2"]],template:function(e,d){e&1&&(r(0,"div",1)(1,"div",2)(2,"div",3),C(3,he,7,2,"div",4)(4,be,160,71),o()()()),e&2&&(n(3),S(d.loading()?3:4))},dependencies:[O,B,$,z,L,J,R,K,D,G,Y,Z,X,Q,j,U,te],styles:[".form-check.p-3.border[_ngcontent-%COMP%]{cursor:pointer;transition:all .2s ease}.form-check.p-3.border[_ngcontent-%COMP%]:hover{background-color:#007bff0d;border-color:var(--bs-primary)!important}.form-check-input[_ngcontent-%COMP%]:checked ~ .form-check-label[_ngcontent-%COMP%]{color:var(--bs-primary)}.card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.125)}.badge[_ngcontent-%COMP%]{font-size:.75em}.alert-info[_ngcontent-%COMP%]{background-color:#0dcaf01a;border-color:#0dcaf033;color:#055160}.form-switch[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{cursor:pointer}.btn-outline-danger.btn-sm[_ngcontent-%COMP%]{--bs-btn-padding-y: .25rem;--bs-btn-padding-x: .5rem;--bs-btn-font-size: .875rem}.spinner-border[_ngcontent-%COMP%]{width:2rem;height:2rem}.form-control[_ngcontent-%COMP%]:invalid{border-color:#dc3545}.form-control[_ngcontent-%COMP%]:valid{border-color:#198754}@media (max-width: 768px){.container-fluid[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}.card-body[_ngcontent-%COMP%]{padding:1.5rem!important}}"]})};export{re as EditShiftComponent};
