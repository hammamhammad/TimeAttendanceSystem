import{a as Q}from"./chunk-4QC5DFDN.js";import{a as J}from"./chunk-SRPEDAT4.js";import{a as X}from"./chunk-46DVCVH4.js";import"./chunk-MUNQGSPX.js";import{c as b}from"./chunk-Y62N6K5S.js";import{c as q,e as j,f as z,g as B,h as W,i as L,u as K,x as $}from"./chunk-VRETN7JA.js";import{a as H}from"./chunk-HHXRLUSQ.js";import"./chunk-S3CAEY4A.js";import{b as U}from"./chunk-TJ2U7DWW.js";import{g as D,m as N}from"./chunk-TWXUAMJ4.js";import{$a as S,Bb as d,Cb as y,Db as u,Ea as T,Eb as E,Gb as I,Ib as k,Jb as F,Kb as G,R as x,W as g,X as _,Xa as h,Ya as v,ab as M,bb as a,cb as n,da as C,db as l,eb as p,lb as P,nb as f,nc as V,pb as c,ta as o,wc as A,yb as w}from"./chunk-JSQL33QG.js";import{a as R,b as O}from"./chunk-DGAILPFQ.js";var ee=(r,t)=>t.group,te=(r,t)=>t.id;function ie(r,t){if(r&1&&(n(0,"div",2)(1,"div",4)(2,"span",5),d(3),l()()()),r&2){let e=c();o(3),y(e.t("common.loading"))}}function oe(r,t){if(r&1&&(n(0,"div",7),p(1,"i",35),d(2),l()),r&2){let e=c(2);o(2),u(" ",e.error()," ")}}function re(r,t){if(r&1){let e=P();n(0,"div",44)(1,"div",45)(2,"div",46)(3,"input",47),f("change",function(){let s=g(e).$implicit,m=c(4);return _(m.onTogglePermissionForRole(s))}),l(),n(4,"div",48)(5,"div",49),p(6,"i",50),n(7,"label",51)(8,"small"),d(9),l()(),n(10,"span",52),d(11),l()(),n(12,"p",53),d(13),l()()()()()}if(r&2){let e=t.$implicit,i=c(4);o(),w("bg-primary-subtle",i.isPermissionSelectedForRole(e.id))("border-primary",i.isPermissionSelectedForRole(e.id)),o(2),a("id","permission-"+e.id)("checked",i.isPermissionSelectedForRole(e.id))("disabled",i.submitting()),o(3),a("ngClass",i.getPermissionIcon(e.key)),o(),a("for","permission-"+e.id),o(2),y(i.getPermissionResource(e.key)),o(),a("ngClass",i.getActionBadgeClass(e.key)),o(),u(" ",i.getPermissionAction(e.key)," "),o(2),u(" ",i.getPermissionDescription(e)," ")}}function ne(r,t){if(r&1&&(n(0,"div",9),S(1,re,14,13,"div",44,te),l()),r&2){let e=c().$implicit;o(),M(e.permissions)}}function se(r,t){if(r&1){let e=P();n(0,"div",28)(1,"div",36)(2,"div",37)(3,"button",38),f("click",function(){let s=g(e).$implicit,m=c(2);return _(m.toggleGroupCollapse(s.group))}),p(4,"i",39),l(),n(5,"h6",40),p(6,"i",41),d(7),n(8,"small",42),d(9),l()()(),n(10,"div",15)(11,"button",43),f("click",function(){let s=g(e).$implicit,m=c(2);return _(m.toggleGroupSelection(s))}),p(12,"i",39),d(13),l()()(),h(14,ne,3,0,"div",9),l()}if(r&2){let e=t.$implicit,i=c(2);o(3),a("disabled",i.submitting())("title",i.isGroupCollapsed(e.group)?i.t("common.expand"):i.t("common.collapse")),o(),a("ngClass",i.isGroupCollapsed(e.group)?"fa-chevron-right":"fa-chevron-down"),o(3),u(" ",e.group," "),o(2),E("(",e.permissions.length," ",i.t("roles.permissions"),")"),o(2),w("btn-primary",i.areAllGroupPermissionsSelected(e))("btn-outline-primary",!i.areAllGroupPermissionsSelected(e)),a("disabled",i.submitting())("title",i.areAllGroupPermissionsSelected(e)?i.t("roles.deselect_all_group"):i.t("roles.select_all_group")),o(),a("ngClass",i.areAllGroupPermissionsSelected(e)?"fa-check-square":i.areSomeGroupPermissionsSelected(e)?"fa-minus-square":"fa-square"),o(),u(" ",i.areAllGroupPermissionsSelected(e)?i.t("roles.deselect_all"):i.t("roles.select_all")," "),o(),v(i.isGroupCollapsed(e.group)?-1:14)}}function le(r,t){if(r&1&&(n(0,"div",29),p(1,"i",54),n(2,"p",55),d(3),l()()),r&2){let e=c(2);o(3),y(e.t("roles.no_permissions_available"))}}function ae(r,t){r&1&&p(0,"div",33)}function me(r,t){r&1&&p(0,"i",34)}function ce(r,t){if(r&1){let e=P();n(0,"app-form-section",3)(1,"div",6),h(2,oe,3,1,"div",7),n(3,"form",8),f("ngSubmit",function(){g(e);let s=c();return _(s.onSubmit())}),n(4,"app-form-section",3)(5,"div",9)(6,"div",10)(7,"label",11),d(8),n(9,"span",12),d(10,"*"),l()(),n(11,"input",13),G("ngModelChange",function(s){g(e);let m=c();return F(m.roleForm.name,s)||(m.roleForm.name=s),_(s)}),l()()()(),p(12,"hr"),n(13,"app-form-section",3)(14,"div",14)(15,"div",15)(16,"button",16),f("click",function(){g(e);let s=c();return _(s.selectAllPermissions())}),p(17,"i",17),d(18),l(),n(19,"button",18),f("click",function(){g(e);let s=c();return _(s.clearAllPermissions())}),p(20,"i",19),d(21),l()()(),n(22,"div",20)(23,"small"),p(24,"i",21),d(25),l()(),n(26,"div",22)(27,"div",23)(28,"span",24),p(29,"i",25),l(),n(30,"input",26),G("ngModelChange",function(s){g(e);let m=c();return F(m.permissionSearchTerm,s)||(m.permissionSearchTerm=s),_(s)}),l()()(),n(31,"div",27),S(32,se,15,15,"div",28,ee),h(34,le,4,1,"div",29),l()(),n(35,"div",30)(36,"button",18),f("click",function(){g(e);let s=c();return _(s.onCancel())}),p(37,"i",31),d(38),l(),n(39,"button",32),h(40,ae,1,0,"div",33)(41,me,1,0,"i",34),d(42),l()()()()()}if(r&2){let e=c();a("title",e.t("roles.role_information")),o(2),v(e.error()?2:-1),o(2),a("title",e.t("roles.basic_information")),o(4),u(" ",e.t("roles.role_name")," "),o(3),k("ngModel",e.roleForm.name),a("placeholder",e.t("roles.role_name_placeholder"))("disabled",e.submitting()),o(2),a("title",e.t("roles.select_permissions")),o(3),a("disabled",e.submitting()),o(2),u(" ",e.t("roles.select_all")," "),o(),a("disabled",e.submitting()),o(2),u(" ",e.t("roles.clear_all")," "),o(4),I(" ",e.roleForm.selectedPermissions.size," ",e.t("roles.permissions_selected")," ",e.t("common.of")," ",e.allPermissions().length," "),o(5),k("ngModel",e.permissionSearchTerm),a("placeholder",e.t("roles.search_permissions_placeholder"))("disabled",e.submitting()),o(2),M(e.getFilteredGroupedPermissions()),o(2),v(e.getFilteredGroupedPermissions().length===0?34:-1),o(2),a("disabled",e.submitting()),o(2),u(" ",e.t("common.cancel")," "),o(),a("disabled",!e.roleForm.name.trim()||e.submitting()),o(),v(e.submitting()?40:41),o(2),u(" ",e.submitting()?e.t("roles.creating_role"):e.t("roles.create_role")," ")}}var Y=class r{rolesService=x(X);router=x(D);notificationService=x(H);i18n=x(U);loading=C(!1);submitting=C(!1);error=C(null);allPermissions=C([]);groupedPermissions=C([]);roleForm={name:"",selectedPermissions:new Set};permissionSearchTerm="";collapsedGroups=new Set;ngOnInit(){this.loadPermissions()}t(t){return this.i18n.t(t)}loadPermissions(){this.loading.set(!0),this.rolesService.getPermissions().subscribe({next:t=>{this.allPermissions.set(t),this.groupedPermissions.set(this.groupPermissionsByGroup(t)),this.loading.set(!1)},error:t=>{console.error("Failed to load permissions:",t),this.error.set(this.t("roles.failed_to_load_permissions")),this.loading.set(!1),this.notificationService.error(this.t("app.error"),this.t("roles.failed_to_load_permissions"))}})}groupPermissionsByGroup(t){let e=t.reduce((i,s)=>{let m=s.group||"General";return i[m]||(i[m]=[]),i[m].push(s),i},{});return Object.entries(e).map(([i,s])=>({group:i,permissions:s.sort((m,Z)=>m.key.localeCompare(Z.key))}))}onSubmit(){if(!this.roleForm.name.trim()){this.error.set(this.t("roles.role_name_required"));return}this.submitting.set(!0),this.error.set(null);let t={name:this.roleForm.name.trim(),permissionIds:Array.from(this.roleForm.selectedPermissions)};this.rolesService.createRole(t).subscribe({next:()=>{this.notificationService.success(this.t("app.success"),this.t("roles.role_created_successfully")),this.router.navigate(["/roles"])},error:e=>{console.error("Failed to create role:",e),this.error.set(this.getErrorMessage(e)),this.submitting.set(!1),this.notificationService.error(this.t("app.error"),this.getErrorMessage(e))}})}onCancel(){this.router.navigate(["/roles"])}onTogglePermissionForRole(t){this.roleForm.selectedPermissions.has(t.id)?this.roleForm.selectedPermissions.delete(t.id):this.roleForm.selectedPermissions.add(t.id)}isPermissionSelectedForRole(t){return this.roleForm.selectedPermissions.has(t)}selectAllPermissions(){this.allPermissions().forEach(t=>{this.roleForm.selectedPermissions.add(t.id)})}clearAllPermissions(){this.roleForm.selectedPermissions.clear()}getFilteredGroupedPermissions(){if(!this.permissionSearchTerm.trim())return this.groupedPermissions();let t=this.permissionSearchTerm.toLowerCase();return this.groupedPermissions().map(e=>O(R({},e),{permissions:e.permissions.filter(i=>i.key.toLowerCase().includes(t)||i.description&&i.description.toLowerCase().includes(t))})).filter(e=>e.permissions.length>0)}getPermissionIcon(t){let{resource:e}=b.parsePermissionKey(t);return b.getResourceIcon(e)}getPermissionResource(t){let{resource:e}=b.parsePermissionKey(t);return b.getResourceName(e)}getPermissionAction(t){let{action:e}=b.parsePermissionKey(t);return b.getActionName(e)}getActionBadgeClass(t){let{action:e}=b.parsePermissionKey(t);return b.getActionBadgeClass(e)}getPermissionDescription(t){return t.description||this.t("roles.no_description")}toggleGroupCollapse(t){this.collapsedGroups.has(t)?this.collapsedGroups.delete(t):this.collapsedGroups.add(t)}isGroupCollapsed(t){return this.collapsedGroups.has(t)}selectAllGroupPermissions(t){t.permissions.forEach(e=>{this.roleForm.selectedPermissions.add(e.id)})}deselectAllGroupPermissions(t){t.permissions.forEach(e=>{this.roleForm.selectedPermissions.delete(e.id)})}areAllGroupPermissionsSelected(t){return t.permissions.every(e=>this.roleForm.selectedPermissions.has(e.id))}areSomeGroupPermissionsSelected(t){let e=t.permissions.filter(i=>this.roleForm.selectedPermissions.has(i.id)).length;return e>0&&e<t.permissions.length}toggleGroupSelection(t){this.areAllGroupPermissionsSelected(t)?this.deselectAllGroupPermissions(t):this.selectAllGroupPermissions(t)}getErrorMessage(t){return t?.error?.error?t.error.error:t?.error?.message?t.error.message:this.t("roles.failed_to_create_role")}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=T({type:r,selectors:[["app-create-role"]],decls:4,vars:3,consts:[[1,"container-fluid"],["mode","create","moduleName","roles","moduleRoute","roles",3,"title","loading"],[1,"d-flex","justify-content-center","py-5"],[3,"title"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"card-body"],["role","alert",1,"alert","alert-danger"],[3,"ngSubmit"],[1,"row","g-3"],[1,"col-md-6"],[1,"form-label"],[1,"text-danger"],["type","text","name","roleName","required","",1,"form-control",3,"ngModelChange","ngModel","placeholder","disabled"],[1,"d-flex","justify-content-end","align-items-center","mb-3"],["role","group",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],[1,"fa-solid","fa-check-double","me-1"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"fa-solid","fa-times","me-1"],[1,"alert","alert-info","py-2","px-3","mb-3"],[1,"fa-solid","fa-info-circle","me-2"],[1,"mb-3"],[1,"input-group"],[1,"input-group-text"],[1,"fa-solid","fa-search"],["type","text","name","permissionSearch",1,"form-control",3,"ngModelChange","ngModel","placeholder","disabled"],[1,"permissions-list","border","rounded","p-3",2,"max-height","500px","overflow-y","auto"],[1,"permission-group","mb-4"],[1,"text-center","py-4"],[1,"d-flex","justify-content-end","gap-2"],[1,"fa-solid","fa-times","me-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"fa-solid","fa-save","me-2"],[1,"fa-solid","fa-exclamation-triangle","me-2"],[1,"d-flex","justify-content-between","align-items-center","mb-3","border-bottom","pb-2"],[1,"d-flex","align-items-center"],["type","button",1,"btn","btn-sm","btn-link","text-decoration-none","p-0","me-2",3,"click","disabled","title"],[1,"fas",3,"ngClass"],[1,"fw-bold","text-primary","mb-0"],[1,"fas","fa-layer-group","me-2"],[1,"text-muted","fw-normal"],["type","button",1,"btn",3,"click","disabled","title"],[1,"col-md-6","col-lg-4"],[1,"permission-item","border","rounded","p-3"],[1,"form-check","d-flex","align-items-start"],["type","checkbox",1,"form-check-input","mt-1",3,"change","id","checked","disabled"],[1,"form-check-content","ms-2","flex-grow-1"],[1,"d-flex","align-items-center","mb-1"],[1,"fas","me-2","text-muted",2,"font-size","0.8rem",3,"ngClass"],[1,"form-check-label","fw-medium","me-2",3,"for"],[1,"badge",2,"font-size","0.65rem",3,"ngClass"],[1,"text-muted","small","mb-0",2,"font-size","0.75rem","margin-left","1.5rem"],[1,"fa-solid","fa-key","fa-2x","text-muted","mb-2"],[1,"text-muted","mb-0"]],template:function(e,i){e&1&&(n(0,"div",0),p(1,"app-form-header",1),h(2,ie,4,1,"div",2)(3,ce,43,25,"app-form-section",3),l()),e&2&&(o(),a("title",i.t("roles.create_role"))("loading",i.submitting()),o(),v(i.loading()?2:3))},dependencies:[A,V,$,L,q,j,z,K,W,B,N,Q,J],styles:['.permission-item[_ngcontent-%COMP%]{transition:all .2s ease-in-out;cursor:pointer}.permission-item[_ngcontent-%COMP%]:hover{box-shadow:0 2px 4px #0000001a}.permission-item.bg-primary-subtle[_ngcontent-%COMP%]{background-color:var(--bs-primary-bg-subtle)!important}.permission-item.border-primary[_ngcontent-%COMP%]{border-color:var(--bs-primary)!important}.permissions-list[_ngcontent-%COMP%]{background-color:var(--bs-light)}.permission-group[_ngcontent-%COMP%]:last-child{margin-bottom:0!important}.form-check-input[_ngcontent-%COMP%]:checked{background-color:var(--bs-primary);border-color:var(--bs-primary)}.badge[_ngcontent-%COMP%]{font-size:.7rem}.avatar-sm[_ngcontent-%COMP%]{width:2rem;height:2rem;display:flex;align-items:center;justify-content:center}.avatar-title[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:.875rem}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{font-size:.875rem;padding:.25rem .5rem}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}.breadcrumb[_ngcontent-%COMP%]{margin-bottom:0}.breadcrumb-item[_ngcontent-%COMP%] + .breadcrumb-item[_ngcontent-%COMP%]:before{content:">";color:var(--bs-secondary)}.card-header[_ngcontent-%COMP%]{background-color:var(--bs-light);border-bottom:1px solid var(--bs-border-color)}.alert-info[_ngcontent-%COMP%]{background-color:var(--bs-info-bg-subtle);border-color:var(--bs-info-border-subtle);color:var(--bs-info-text-emphasis)}.text-primary[_ngcontent-%COMP%]{color:var(--bs-primary)!important}.btn-outline-primary[_ngcontent-%COMP%]:hover{background-color:var(--bs-primary);border-color:var(--bs-primary)}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background-color:var(--bs-secondary);border-color:var(--bs-secondary)}@media (max-width: 768px){.col-md-6[_ngcontent-%COMP%], .col-lg-4[_ngcontent-%COMP%]{margin-bottom:.75rem}.permission-item[_ngcontent-%COMP%]{padding:1rem}.btn-group-sm[_ngcontent-%COMP%]{flex-direction:column;width:100%}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-bottom:.25rem}}']})};export{Y as CreateRoleComponent};
