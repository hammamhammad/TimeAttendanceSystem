import{A as z,c as G,d as h,e as V,f as A,i as D,m as j,p as L,y as $}from"./chunk-YQIE4CGE.js";import{a as O}from"./chunk-JNFDDMIM.js";import{a as I,b as M}from"./chunk-ZURD34HZ.js";import{a as R}from"./chunk-GEGVYT7O.js";import"./chunk-A6EM5NV6.js";import{A as E,Da as x,E as b,Fb as k,Ga as a,Ha as S,Ia as d,L as i,Q as T,aa as c,ba as m,ga as F,ha as o,ia as l,ja as w,qa as N,sa as P,ua as u,xb as q,y as g,z as y}from"./chunk-5OFYUWMA.js";import"./chunk-YMDWBF3A.js";function B(n,r){if(n&1){let t=N();o(0,"div",11),w(1,"i",26),a(2),o(3,"button",27),P("click",function(){y(t);let s=u();return E(s.error.set(""))}),l()()}if(n&2){let t=u();i(2),d(" ",t.error()," ")}}function H(n,r){if(n&1&&(o(0,"div",16),a(1),l()),n&2){let t=u();i(),d(" ",t.t("validation.required_field")," ")}}function U(n,r){if(n&1&&a(0),n&2){let t=u(2);d(" ",t.t("validation.required_field")," ")}}function Y(n,r){if(n&1&&a(0),n&2){let t=u(2);d(" ",t.t("auth.password_min_length")," ")}}function J(n,r){if(n&1&&a(0),n&2){let t=u(2);d(" ",t.t("auth.password_requirements")," ")}}function K(n,r){if(n&1&&(o(0,"div",16),c(1,U,1,1),c(2,Y,1,1),c(3,J,1,1),l()),n&2){let t,e,s,p=u();i(),m(!((t=p.changePasswordForm.get("newPassword"))==null||t.errors==null)&&t.errors.required?1:-1),i(),m(!((e=p.changePasswordForm.get("newPassword"))==null||e.errors==null)&&e.errors.minlength?2:-1),i(),m(!((s=p.changePasswordForm.get("newPassword"))==null||s.errors==null)&&s.errors.pattern?3:-1)}}function Q(n,r){if(n&1&&a(0),n&2){let t=u(2);d(" ",t.t("validation.required_field")," ")}}function W(n,r){if(n&1&&a(0),n&2){let t=u(2);d(" ",t.t("auth.passwords_dont_match")," ")}}function X(n,r){if(n&1&&(o(0,"div",16),c(1,Q,1,1),c(2,W,1,1),l()),n&2){let t,e,s=u();i(),m(!((t=s.changePasswordForm.get("confirmPassword"))==null||t.errors==null)&&t.errors.required?1:-1),i(),m(!((e=s.changePasswordForm.get("confirmPassword"))==null||e.errors==null)&&e.errors.passwordMismatch?2:-1)}}function ee(n,r){n&1&&w(0,"span",22)}var Z=class n{http=g(q);fb=g($);router=g(k);authService=g(M);notificationService=g(O);i18n=g(R);changePasswordForm;loading=b(!1);error=b("");constructor(){this.changePasswordForm=this.fb.group({currentPassword:["",[h.required]],newPassword:["",[h.required,h.minLength(8),h.pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\da-zA-Z]).{8,}$/)]],confirmPassword:["",[h.required]]},{validators:this.passwordMatchValidator})}passwordMatchValidator(r){let t=r.get("newPassword"),e=r.get("confirmPassword");return t&&e&&t.value!==e.value?e.setErrors({passwordMismatch:!0}):e&&!e.hasError("required")&&e.setErrors(null),null}t(r){return this.i18n.t(r)}onSubmit(){if(this.changePasswordForm.invalid){this.changePasswordForm.markAllAsTouched();return}this.loading.set(!0),this.error.set("");let r={currentPassword:this.changePasswordForm.value.currentPassword,newPassword:this.changePasswordForm.value.newPassword};this.http.post(`${I.baseUrl}${I.endpoints.auth.changePassword}`,r).subscribe({next:()=>{this.loading.set(!1),this.notificationService.success(this.t("auth.password_changed_success"),"You can now continue using the system"),this.router.navigate(["/dashboard"])},error:t=>{this.loading.set(!1);let e=t.error?.error||this.t("auth.password_change_failed");this.error.set(e),this.notificationService.error(this.t("auth.password_change_failed"),e)}})}onLogout(){this.authService.logout()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=T({type:n,selectors:[["app-change-password"]],decls:44,vars:21,consts:[[1,"min-vh-100","d-flex","align-items-center","justify-content-center","bg-light"],[1,"container"],[1,"row","justify-content-center"],[1,"col-md-6","col-lg-5"],[1,"card","shadow-sm"],[1,"card-body","p-4"],[1,"text-center","mb-4"],[1,"fa-solid","fa-key","fa-3x","text-warning","mb-3"],[1,"mb-2"],[1,"text-muted"],[3,"ngSubmit","formGroup"],["role","alert",1,"alert","alert-danger","alert-dismissible","fade","show"],[1,"mb-3"],[1,"form-label"],[1,"text-danger"],["type","password","formControlName","currentPassword",1,"form-control"],[1,"invalid-feedback"],["type","password","formControlName","newPassword",1,"form-control"],[1,"form-text","text-muted"],[1,"mb-4"],["type","password","formControlName","confirmPassword",1,"form-control"],["type","submit",1,"btn","btn-warning","w-100",3,"disabled"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"text-center","mt-3"],["type","button",1,"btn","btn-link","text-muted",3,"click"],[1,"fa-solid","fa-sign-out-alt","me-2"],[1,"fa-solid","fa-exclamation-triangle","me-2"],["type","button",1,"btn-close",3,"click"]],template:function(t,e){if(t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),w(7,"i",7),o(8,"h4",8),a(9),l(),o(10,"p",9),a(11),l()(),o(12,"form",10),P("ngSubmit",function(){return e.onSubmit()}),c(13,B,4,1,"div",11),o(14,"div",12)(15,"label",13),a(16),o(17,"span",14),a(18,"*"),l()(),w(19,"input",15),c(20,H,2,1,"div",16),l(),o(21,"div",12)(22,"label",13),a(23),o(24,"span",14),a(25,"*"),l()(),w(26,"input",17),c(27,K,4,3,"div",16),o(28,"small",18),a(29),l()(),o(30,"div",19)(31,"label",13),a(32),o(33,"span",14),a(34,"*"),l()(),w(35,"input",20),c(36,X,3,2,"div",16),l(),o(37,"button",21),c(38,ee,1,0,"span",22),a(39),l(),o(40,"div",23)(41,"button",24),P("click",function(){return e.onLogout()}),w(42,"i",25),a(43),l()()()()()()()()()),t&2){let s,p,_,f,v,C;i(9),S(e.t("auth.change_password_required")),i(2),S(e.t("auth.change_password_message")),i(),F("formGroup",e.changePasswordForm),i(),m(e.error()?13:-1),i(3),d("",e.t("auth.current_password")," "),i(3),x("is-invalid",((s=e.changePasswordForm.get("currentPassword"))==null?null:s.invalid)&&((s=e.changePasswordForm.get("currentPassword"))==null?null:s.touched)),i(),m((p=e.changePasswordForm.get("currentPassword"))!=null&&p.invalid&&((p=e.changePasswordForm.get("currentPassword"))!=null&&p.touched)?20:-1),i(3),d("",e.t("auth.new_password")," "),i(3),x("is-invalid",((_=e.changePasswordForm.get("newPassword"))==null?null:_.invalid)&&((_=e.changePasswordForm.get("newPassword"))==null?null:_.touched)),i(),m((f=e.changePasswordForm.get("newPassword"))!=null&&f.invalid&&((f=e.changePasswordForm.get("newPassword"))!=null&&f.touched)?27:-1),i(2),d(" ",e.t("auth.password_requirements")," "),i(3),d("",e.t("auth.confirm_new_password")," "),i(3),x("is-invalid",((v=e.changePasswordForm.get("confirmPassword"))==null?null:v.invalid)&&((v=e.changePasswordForm.get("confirmPassword"))==null?null:v.touched)),i(),m((C=e.changePasswordForm.get("confirmPassword"))!=null&&C.invalid&&((C=e.changePasswordForm.get("confirmPassword"))!=null&&C.touched)?36:-1),i(),F("disabled",e.loading()||e.changePasswordForm.invalid),i(),m(e.loading()?38:-1),i(),d(" ",e.t("auth.change_password")," "),i(4),d(" ",e.t("auth.logout")," ")}},dependencies:[z,D,G,V,A,j,L],styles:["[_nghost-%COMP%]{display:block}"]})};export{Z as ChangePasswordComponent};
