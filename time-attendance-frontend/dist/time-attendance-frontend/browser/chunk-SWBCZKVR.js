import{a as pe}from"./chunk-JG2HLXEI.js";import{a as Y}from"./chunk-FG4PW2NX.js";import{a as se}from"./chunk-LNNUMUW4.js";import{a as U}from"./chunk-CQWFZVPO.js";import{a as me}from"./chunk-4G2EQDXN.js";import{a as L}from"./chunk-Y4G43P3P.js";import{a as y,b as O}from"./chunk-AYMGSBNU.js";import"./chunk-3BUDJKKE.js";import{p as ce,r as de,x as j}from"./chunk-OTKBQKTN.js";import{b as R}from"./chunk-NJ656CWW.js";import{$ as l,A as oe,Ba as re,E as o,J as A,N,O as P,T as q,U as _,V as C,W as ie,Y as H,Z as z,_ as f,aa as c,ba as u,ca as v,da as h,ea as S,eb as F,ia as x,ja as V,ka as g,la as I,ma as r,pb as le,sa as k,t as T,ta as ae,u as s,ua as $,v as p,va as d,wa as D,xa as b,ya as J,z as E}from"./chunk-6T5SYK5O.js";import{a as te,b as ne,d as G}from"./chunk-DGAILPFQ.js";function ue(n,t){if(n&1){let e=x();l(0,"button",23),g("click",function(){s(e);let a=r(3);return p(a.onAddDepartment())}),u(1,"i",24),c()}if(n&2){let e=r(3);f("title",e.i18n.t("department.addDepartment"))}}function ge(n,t){if(n&1&&N(0,ue,2,1,"button",22),n&2){let e=r(2);f("appHasPermission",e.PERMISSIONS.DEPARTMENT_CREATE)}}function be(n,t){if(n&1){let e=x();l(0,"button",33),g("click",function(){s(e);let a=r(4);return p(a.onBulkDelete())}),u(1,"i",34),d(2),c()}if(n&2){let e=r(4);o(2),b(" ",e.i18n.t("common.deleteSelected")," ")}}function fe(n,t){if(n&1&&N(0,be,3,1,"button",32),n&2){let e=r(3);f("appHasPermission",e.PERMISSIONS.DEPARTMENT_DELETE)}}function xe(n,t){if(n&1){let e=x();l(0,"div",21)(1,"div",25)(2,"div",26)(3,"span",27),u(4,"i",28),d(5),c(),l(6,"div",17),_(7,fe,1,1,"button",29),l(8,"button",30),g("click",function(){s(e);let a=r(2);return p(a.clearSelection())}),u(9,"i",31),d(10),c()()()()()}if(n&2){let e=r(2);o(5),J(" ",e.selectedDepartments().size," ",e.i18n.t("common.selected")," "),o(2),C(e.allowDelete?7:-1),o(3),b(" ",e.i18n.t("common.clearSelection")," ")}}function he(n,t){if(n&1){let e=x();l(0,"div",1)(1,"div",4)(2,"div",5)(3,"div",6)(4,"span",7),u(5,"i",8),c(),l(6,"input",9),g("input",function(a){s(e);let m=r();return p(m.onSearchChange(a.target.value))}),c()()(),l(7,"div",10)(8,"div",11)(9,"input",12),g("change",function(a){s(e);let m=r();return p(m.onShowInactiveChange(a.target.checked))}),c(),l(10,"label",13),d(11),c()()(),l(12,"div",10)(13,"div",11)(14,"input",14),g("change",function(a){s(e);let m=r();return p(m.showHierarchy.set(a.target.checked))}),c(),l(15,"label",15),d(16),c()()(),l(17,"div",16)(18,"div",17)(19,"button",18),g("click",function(){s(e);let a=r();return p(a.refresh())}),u(20,"i",19),c(),_(21,ge,1,1,"button",20),c()()(),_(22,xe,11,4,"div",21),c()}if(n&2){let e=r();o(6),f("placeholder",e.i18n.t("common.search")+"...")("value",e.searchTerm()),o(3),f("checked",e.showInactive()),o(2),b(" ",e.i18n.t("common.showInactive")," "),o(3),f("checked",e.showHierarchy()),o(2),b(" ",e.i18n.t("department.showHierarchy")," "),o(3),f("title",e.i18n.t("common.refresh")),o(2),C(e.allowEdit?21:-1),o(),C(e.selectedDepartments().size>0&&e.allowSelection?22:-1)}}function De(n,t){if(n&1&&(l(0,"div",2)(1,"div",35)(2,"span",36),d(3),c()()()),n&2){let e=r();o(3),b("",e.i18n.t("common.loading"),"...")}}function ve(n,t){if(n&1){let e=x();l(0,"th",40)(1,"div",11)(2,"input",50),g("change",function(){s(e);let a=r(2);return p(a.toggleAllSelection())}),c()()()}if(n&2){let e=r(2);o(2),f("checked",e.isAllPageSelected())("indeterminate",e.isSomePageSelected())}}function we(n,t){if(n&1&&(l(0,"th"),d(1),c()),n&2){let e=r(2);o(),D(e.i18n.t("department.path"))}}function Ee(n,t){if(n&1&&(l(0,"th",46),d(1),c()),n&2){let e=r(2);o(),D(e.i18n.t("common.actions"))}}function Pe(n,t){if(n&1){let e=x();l(0,"td",40)(1,"div",11)(2,"input",60),g("change",function(a){s(e);let m=r().$implicit;return r(2).toggleSelection(m.id),p(a.stopPropagation())}),c()()()}if(n&2){let e=r().$implicit,i=r(2);o(2),f("checked",i.isSelected(e.id))}}function Te(n,t){if(n&1&&u(0,"div"),n&2){let e=r().$implicit,i=r(2);$(i.getIndentClass(e.level))}}function Me(n,t){if(n&1&&(l(0,"div",55),d(1),c()),n&2){let e=r().$implicit;o(),D(e.nameAr)}}function Se(n,t){if(n&1&&(l(0,"div",55),d(1),c()),n&2){let e=r().$implicit;o(),D(e.description)}}function ye(n,t){if(n&1&&(l(0,"td")(1,"small",57),d(2),c()()),n&2){let e=r().$implicit;o(2),D(e.path)}}function Oe(n,t){if(n&1&&(l(0,"div",42),u(1,"i",61),d(2),c()),n&2){let e=r().$implicit;o(2),b(" ",e.managerName," ")}}function Ie(n,t){n&1&&(l(0,"span",57),d(1,"-"),c())}function ke(n,t){if(n&1&&(l(0,"div",42),u(1,"i",62),d(2),c()),n&2){let e=r().$implicit;o(2),b(" ",e.location," ")}}function Ve(n,t){n&1&&(l(0,"span",57),d(1,"-"),c())}function Ae(n,t){if(n&1){let e=x();l(0,"button",66),g("click",function(a){s(e);let m=r(2).$implicit;return r(2).onViewDepartment(m),p(a.stopPropagation())}),u(1,"i",67),c()}if(n&2){let e=r(4);f("title",e.i18n.t("common.view"))}}function Ne(n,t){if(n&1){let e=x();l(0,"button",18),g("click",function(a){s(e);let m=r(3).$implicit;return r(2).onEditDepartment(m),p(a.stopPropagation())}),u(1,"i",69),c()}if(n&2){let e=r(5);f("title",e.i18n.t("common.edit"))}}function Fe(n,t){if(n&1&&N(0,Ne,2,1,"button",68),n&2){let e=r(4);f("appHasPermission",e.PERMISSIONS.DEPARTMENT_UPDATE)}}function Re(n,t){if(n&1){let e=x();l(0,"button",71),g("click",function(a){s(e);let m=r(3).$implicit;return r(2).onDeleteDepartment(m),p(a.stopPropagation())}),u(1,"i",72),c()}if(n&2){let e=r(5);f("title",e.i18n.t("common.delete"))}}function Be(n,t){if(n&1&&N(0,Re,2,1,"button",70),n&2){let e=r(4);f("appHasPermission",e.PERMISSIONS.DEPARTMENT_DELETE)}}function $e(n,t){if(n&1&&(l(0,"td",46)(1,"div",17),N(2,Ae,2,1,"button",63),_(3,Fe,1,1,"button",64),_(4,Be,1,1,"button",65),c()()),n&2){let e=r().$implicit,i=r(2);o(2),f("appHasPermission",i.PERMISSIONS.DEPARTMENT_READ),o(),C(i.allowEdit?3:-1),o(),C(i.allowDelete&&e.employeeCount===0?4:-1)}}function Le(n,t){if(n&1){let e=x();l(0,"tr",51),g("click",function(){let a=s(e).$implicit,m=r(2);return p(m.selectDepartment(a))}),_(1,Pe,3,1,"td",40),l(2,"td")(3,"div",42),_(4,Te,1,2,"div",52),u(5,"i",53),l(6,"div")(7,"div",54),d(8),c(),_(9,Me,2,1,"div",55),_(10,Se,2,1,"div",55),c()()(),l(11,"td")(12,"span",56),d(13),c()(),_(14,ye,3,1,"td"),l(15,"td"),_(16,Oe,3,1,"div",42),_(17,Ie,2,0,"span",57),c(),l(18,"td",58)(19,"span",59),d(20),c()(),l(21,"td"),_(22,ke,3,1,"div",42),_(23,Ve,2,0,"span",57),c(),l(24,"td",58)(25,"span",59),d(26),c()(),_(27,$e,5,3,"td",46),c()}if(n&2){let e=t.$implicit,i=r(2);k("table-warning",!e.isActive)("selected-row",i.isSelected(e.id)),o(),C(i.allowSelection?1:-1),o(3),C(i.showHierarchy()?4:-1),o(4),D(e.name),o(),C(e.nameAr?9:-1),o(),C(e.description?10:-1),o(3),D(e.code),o(),C(i.showHierarchy()?14:-1),o(2),C(e.managerName?16:-1),o(),C(e.managerName?-1:17),o(2),k("bg-success",e.employeeCount>0)("bg-light",e.employeeCount===0)("text-dark",e.employeeCount===0)("border",e.employeeCount===0),o(),b(" ",e.employeeCount," "),o(2),C(e.location?22:-1),o(),C(e.location?-1:23),o(2),k("bg-success",e.isActive)("bg-light",!e.isActive)("text-dark",!e.isActive)("border",!e.isActive),o(),b(" ",e.isActive?i.i18n.t("common.active"):i.i18n.t("common.inactive")," "),o(),C(i.showControls?27:-1)}}function He(n,t){if(n&1){let e=x();l(0,"button",75),g("click",function(){s(e);let a=r(3);return p(a.onAddDepartment())}),u(1,"i",76),d(2),c()}if(n&2){let e=r(3);o(2),b(" ",e.i18n.t("department.addFirstDepartment")," ")}}function ze(n,t){if(n&1&&(l(0,"div",48),u(1,"i",73),l(2,"h5"),d(3),c(),l(4,"p"),d(5),c(),_(6,He,3,1,"button",74),c()),n&2){let e=r(2);o(3),D(e.i18n.t("department.noDepartments")),o(2),D(e.i18n.t("department.noDepartmentsDescription")),o(),C(e.allowEdit?6:-1)}}function je(n,t){if(n&1&&(l(0,"option",81),d(1),c()),n&2){let e=t.$implicit;f("value",e),o(),D(e)}}function Ue(n,t){if(n&1){let e=x();l(0,"button",90),g("click",function(){s(e);let a=r().$implicit,m=r(3);return p(m.onPageChange(a))}),d(1),c()}if(n&2){let e=r().$implicit;o(),b(" ",e," ")}}function Ye(n,t){n&1&&(l(0,"span",89),d(1,"..."),c())}function Ge(n,t){if(n&1&&(l(0,"li",84),_(1,Ue,2,1,"button",89),_(2,Ye,2,0,"span",89),c()),n&2){let e=t.$implicit,i=r(3);k("active",e===i.currentPage())("disabled",e===-1),o(),C(e!==-1?1:-1),o(),C(e===-1?2:-1)}}function qe(n,t){if(n&1){let e=x();l(0,"nav",49)(1,"div",77)(2,"div",78)(3,"div",42)(4,"label",79),d(5),c(),l(6,"select",80),g("change",function(a){s(e);let m=r(2);return p(m.onPageSizeChange(+a.target.value))}),H(7,je,2,2,"option",81,ie),c(),l(9,"span",82),d(10),c()()(),l(11,"div",78)(12,"ul",83)(13,"li",84)(14,"button",85),g("click",function(){s(e);let a=r(2);return p(a.onPageChange(a.currentPage()-1))}),u(15,"i",86),c()(),H(16,Ge,3,6,"li",87,ie),l(18,"li",84)(19,"button",85),g("click",function(){s(e);let a=r(2);return p(a.onPageChange(a.currentPage()+1))}),u(20,"i",88),c()()()()()()}if(n&2){let e=r(2);o(5),b("",e.i18n.t("common.pageSize"),":"),o(),f("value",e.pageSize()),o(),z(e.pageSizeOptions),o(3),re(" ",e.i18n.t("common.showing")," ",(e.currentPage()-1)*e.pageSize()+1,"-",e.Math.min(e.currentPage()*e.pageSize(),e.filteredDepartments().length)," ",e.i18n.t("common.of")," ",e.filteredDepartments().length," "),o(3),k("disabled",e.currentPage()===1),o(),f("disabled",e.currentPage()===1),o(2),z(e.getPageNumbers()),o(2),k("disabled",e.currentPage()===e.totalPages()),o(),f("disabled",e.currentPage()===e.totalPages())}}function Je(n,t){if(n&1){let e=x();l(0,"div",3)(1,"div",37)(2,"table",38)(3,"thead",39)(4,"tr"),_(5,ve,3,2,"th",40),l(6,"th",41),g("click",function(){s(e);let a=r();return p(a.onSort("name"))}),l(7,"div",42),d(8),u(9,"i",43),c()(),l(10,"th",41),g("click",function(){s(e);let a=r();return p(a.onSort("code"))}),l(11,"div",42),d(12),u(13,"i",43),c()(),_(14,we,2,1,"th"),l(15,"th",41),g("click",function(){s(e);let a=r();return p(a.onSort("managerName"))}),l(16,"div",42),d(17),u(18,"i",43),c()(),l(19,"th",44),g("click",function(){s(e);let a=r();return p(a.onSort("employeeCount"))}),l(20,"div",45),d(21),u(22,"i",43),c()(),l(23,"th",41),g("click",function(){s(e);let a=r();return p(a.onSort("location"))}),l(24,"div",42),d(25),u(26,"i",43),c()(),l(27,"th",44),g("click",function(){s(e);let a=r();return p(a.onSort("isActive"))}),l(28,"div",45),d(29),u(30,"i",43),c()(),_(31,Ee,2,1,"th",46),c()(),l(32,"tbody"),H(33,Le,28,34,"tr",47,q().trackByDeptId,!0),c()()(),_(35,ze,7,3,"div",48),_(36,qe,21,13,"nav",49),c()}if(n&2){let e=r();o(5),C(e.allowSelection?5:-1),o(3),b(" ",e.i18n.t("department.name")," "),o(),$(e.getSortIcon("name")),o(3),b(" ",e.i18n.t("department.code")," "),o(),$(e.getSortIcon("code")),o(),C(e.showHierarchy()?14:-1),o(3),b(" ",e.i18n.t("department.manager")," "),o(),$(e.getSortIcon("managerName")),o(3),b(" ",e.i18n.t("common.employees")," "),o(),$(e.getSortIcon("employeeCount")),o(3),b(" ",e.i18n.t("department.location")," "),o(),$(e.getSortIcon("location")),o(3),b(" ",e.i18n.t("common.status")," "),o(),$(e.getSortIcon("isActive")),o(),C(e.showControls?31:-1),o(2),z(e.getPaginatedDepartments()),o(2),C(e.getPaginatedDepartments().length===0?35:-1),o(),C(e.totalPages()>1?36:-1)}}var K=class n{selectedBranchId;allowSelection=!0;allowEdit=!0;allowDelete=!0;showControls=!0;departmentSelected=new P;departmentView=new P;departmentEdit=new P;departmentDelete=new P;departmentAdd=new P;i18n=T(R);departmentsService=T(Y);permissionService=T(L);PERMISSIONS={DEPARTMENT_CREATE:`${O.DEPARTMENT}.${y.CREATE}`,DEPARTMENT_READ:`${O.DEPARTMENT}.${y.READ}`,DEPARTMENT_UPDATE:`${O.DEPARTMENT}.${y.UPDATE}`,DEPARTMENT_DELETE:`${O.DEPARTMENT}.${y.DELETE}`};loading=E(!1);departments=E([]);filteredDepartments=E([]);selectedDepartments=E(new Set);sortConfig=E({column:"name",direction:"asc"});searchTerm=E("");showInactive=E(!1);currentPage=E(1);pageSize=E(10);totalPages=E(0);showHierarchy=E(!1);pageSizeOptions=[5,10,25,50,100];ngOnInit(){console.log("DepartmentTableComponent ngOnInit - selectedBranchId:",this.selectedBranchId),this.loadDepartments()}ngOnChanges(t){console.log("DepartmentTableComponent ngOnChanges:",t),t.selectedBranchId&&(console.log("selectedBranchId changed from",t.selectedBranchId.previousValue,"to",t.selectedBranchId.currentValue),this.loadDepartments())}loadDepartments(){console.log("loadDepartments called - selectedBranchId:",this.selectedBranchId),this.loading.set(!0),console.log("Making departments API call with params:",{branchId:this.selectedBranchId,includeTree:!1,includeInactive:this.showInactive()}),this.departmentsService.getDepartments({branchId:this.selectedBranchId,includeTree:!1,includeInactive:this.showInactive()}).subscribe({next:t=>{console.log("Departments API response:",t),t&&(this.departments.set(t),this.applyFiltersAndSort()),this.loading.set(!1)},error:t=>{console.error("Failed to load departments:",t),this.loading.set(!1)}})}applyFiltersAndSort(){let t=[...this.departments()],e=this.searchTerm().toLowerCase();e&&(t=t.filter(a=>a.name.toLowerCase().includes(e)||a.code.toLowerCase().includes(e)||a.nameAr&&a.nameAr.toLowerCase().includes(e)||a.description&&a.description.toLowerCase().includes(e)||a.costCenter&&a.costCenter.toLowerCase().includes(e)||a.path.toLowerCase().includes(e))),this.showInactive()||(t=t.filter(a=>a.isActive));let i=this.sortConfig();t.sort((a,m)=>{let w=a[i.column],M=m[i.column];if(w==null&&M==null)return 0;if(w==null)return i.direction==="asc"?1:-1;if(M==null)return i.direction==="asc"?-1:1;let B=0;return typeof w=="string"&&typeof M=="string"?B=w.localeCompare(M):typeof w=="number"&&typeof M=="number"?B=w-M:B=String(w).localeCompare(String(M)),i.direction==="asc"?B:-B}),this.filteredDepartments.set(t),this.updatePagination()}updatePagination(){let t=this.filteredDepartments().length,e=Math.ceil(t/this.pageSize());this.totalPages.set(e),this.currentPage()>e&&e>0&&this.currentPage.set(e)}getPaginatedDepartments(){let t=(this.currentPage()-1)*this.pageSize(),e=t+this.pageSize();return this.filteredDepartments().slice(t,e)}onSort(t){let e=this.sortConfig(),i=e.column===t&&e.direction==="asc"?"desc":"asc";this.sortConfig.set({column:t,direction:i}),this.applyFiltersAndSort()}getSortIcon(t){let e=this.sortConfig();return e.column!==t?"fas fa-sort":e.direction==="asc"?"fas fa-sort-up":"fas fa-sort-down"}onSearchChange(t){this.searchTerm.set(t),this.currentPage.set(1),this.applyFiltersAndSort()}onShowInactiveChange(t){this.showInactive.set(t),this.currentPage.set(1),this.loadDepartments()}onPageSizeChange(t){this.pageSize.set(t),this.currentPage.set(1),this.updatePagination()}onPageChange(t){this.currentPage.set(t)}getPageNumbers(){let t=this.totalPages(),e=this.currentPage(),i=[];if(t<=7)for(let a=1;a<=t;a++)i.push(a);else e<=4?i.push(1,2,3,4,5,-1,t):e>=t-3?i.push(1,-1,t-4,t-3,t-2,t-1,t):i.push(1,-1,e-1,e,e+1,-1,t);return i}selectDepartment(t){this.allowSelection&&this.departmentSelected.emit(t)}toggleSelection(t){let e=this.selectedDepartments();e.has(t)?e.delete(t):e.add(t),this.selectedDepartments.set(new Set(e))}toggleAllSelection(){let t=this.selectedDepartments(),e=this.getPaginatedDepartments();this.isAllPageSelected()?e.forEach(i=>t.delete(i.id)):e.forEach(i=>t.add(i.id)),this.selectedDepartments.set(new Set(t))}isSelected(t){return this.selectedDepartments().has(t)}isAllPageSelected(){let t=this.getPaginatedDepartments();return t.length>0&&t.every(e=>this.isSelected(e.id))}isSomePageSelected(){return this.getPaginatedDepartments().some(e=>this.isSelected(e.id))&&!this.isAllPageSelected()}onAddDepartment(){this.departmentAdd.emit()}onViewDepartment(t){this.departmentView.emit(t)}onEditDepartment(t){this.departmentEdit.emit(t)}onDeleteDepartment(t){this.departmentDelete.emit(t)}onBulkDelete(){let t=this.selectedDepartments();this.departments().filter(i=>t.has(i.id)).forEach(i=>this.departmentDelete.emit(i))}clearSelection(){this.selectedDepartments.set(new Set)}refresh(){this.loadDepartments()}getIndentClass(t){return`indent-${Math.min(t,5)}`}trackByDeptId(t,e){return e.id}Math=Math;static \u0275fac=function(e){return new(e||n)};static \u0275cmp=A({type:n,selectors:[["app-department-table"]],inputs:{selectedBranchId:"selectedBranchId",allowSelection:"allowSelection",allowEdit:"allowEdit",allowDelete:"allowDelete",showControls:"showControls"},outputs:{departmentSelected:"departmentSelected",departmentView:"departmentView",departmentEdit:"departmentEdit",departmentDelete:"departmentDelete",departmentAdd:"departmentAdd"},features:[oe],decls:4,vars:3,consts:[[1,"department-table"],[1,"table-controls","mb-3"],[1,"text-center","p-4"],[1,"table-container"],[1,"row","g-2","align-items-center"],[1,"col-md-4"],[1,"input-group"],[1,"input-group-text"],[1,"fas","fa-search"],["type","text",1,"form-control",3,"input","placeholder","value"],[1,"col-md-3"],[1,"form-check"],["type","checkbox","id","showInactiveTable",1,"form-check-input",3,"change","checked"],["for","showInactiveTable",1,"form-check-label"],["type","checkbox","id","showHierarchy",1,"form-check-input",3,"change","checked"],["for","showHierarchy",1,"form-check-label"],[1,"col-md-2"],[1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary",3,"click","title"],[1,"fas","fa-sync"],["type","button",1,"btn","btn-primary",3,"title"],[1,"row","mt-2"],["type","button","class","btn btn-primary",3,"title","click",4,"appHasPermission"],["type","button",1,"btn","btn-primary",3,"click","title"],[1,"fas","fa-plus"],[1,"col-12"],[1,"alert","alert-info","d-flex","align-items-center"],[1,"flex-grow-1"],[1,"fas","fa-info-circle","me-2"],["type","button",1,"btn","btn-outline-danger"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-times","me-1"],["type","button","class","btn btn-outline-danger",3,"click",4,"appHasPermission"],["type","button",1,"btn","btn-outline-danger",3,"click"],[1,"fas","fa-trash","me-1"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"table-responsive"],[1,"table","table-hover"],[1,"table-light","sticky-top"],[1,"selection-column"],[1,"sortable",3,"click"],[1,"d-flex","align-items-center"],[1,"ms-2"],[1,"sortable","text-center",3,"click"],[1,"d-flex","align-items-center","justify-content-center"],[1,"actions-column"],[3,"table-warning","selected-row"],[1,"text-center","p-4","text-muted"],["aria-label","Department pagination",1,"mt-3"],["type","checkbox",1,"form-check-input",3,"change","checked","indeterminate"],[3,"click"],[3,"class"],[1,"fas","fa-building","text-primary","me-2"],[1,"fw-medium"],[1,"text-muted","small"],[1,"badge","bg-light","text-dark","border"],[1,"text-muted"],[1,"text-center"],[1,"badge"],["type","checkbox",1,"form-check-input",3,"change","checked"],[1,"fas","fa-user-tie","text-secondary","me-2"],[1,"fas","fa-map-marker-alt","text-secondary","me-2"],["type","button","class","btn btn-outline-primary",3,"title","click",4,"appHasPermission"],["type","button",1,"btn","btn-outline-secondary",3,"title"],["type","button",1,"btn","btn-outline-danger",3,"title"],["type","button",1,"btn","btn-outline-primary",3,"click","title"],[1,"fas","fa-eye"],["type","button","class","btn btn-outline-secondary",3,"title","click",4,"appHasPermission"],[1,"fas","fa-edit"],["type","button","class","btn btn-outline-danger",3,"title","click",4,"appHasPermission"],["type","button",1,"btn","btn-outline-danger",3,"click","title"],[1,"fas","fa-trash"],[1,"fas","fa-building","fa-3x","mb-3"],["type","button",1,"btn","btn-primary"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus","me-2"],[1,"row","align-items-center"],[1,"col-md-6"],[1,"form-label","me-2","mb-0"],[1,"form-select","form-select-sm",2,"width","auto",3,"change","value"],[3,"value"],[1,"text-muted","ms-3"],[1,"pagination","pagination-sm","justify-content-end","mb-0"],[1,"page-item"],[1,"page-link",3,"click","disabled"],[1,"fas","fa-chevron-left"],[1,"page-item",3,"active","disabled"],[1,"fas","fa-chevron-right"],[1,"page-link"],[1,"page-link",3,"click"]],template:function(e,i){e&1&&(l(0,"div",0),_(1,he,23,9,"div",1),_(2,De,4,1,"div",2),_(3,Je,37,23,"div",3),c()),e&2&&(o(),C(i.showControls?1:-1),o(),C(i.loading()?2:-1),o(),C(i.loading()?-1:3))},dependencies:[F,j,ce,de,U],styles:[".department-table[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a}.table-controls[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #e9ecef;background-color:#f8f9fa;border-radius:8px 8px 0 0}.table-container[_ngcontent-%COMP%]{max-height:70vh;overflow-y:auto}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.selected-row[_ngcontent-%COMP%]{background-color:#e3f2fd;border-left:4px solid #2196f3}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.table-warning[_ngcontent-%COMP%]{background-color:#fff3cd}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.table-warning[_ngcontent-%COMP%]:hover{background-color:#ffeaa7}.selection-column[_ngcontent-%COMP%]{width:50px;text-align:center}.actions-column[_ngcontent-%COMP%]{width:100px;text-align:center}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;transition:color .2s ease}.sortable[_ngcontent-%COMP%]:hover{color:#2196f3;background-color:#f0f7ff}.sortable[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%]{font-size:.75rem;opacity:.6;transition:opacity .2s ease}.sortable[_ngcontent-%COMP%]:hover   .fas[_ngcontent-%COMP%]{opacity:1}.indent-0[_ngcontent-%COMP%]{margin-left:0}.indent-1[_ngcontent-%COMP%]{margin-left:20px}.indent-2[_ngcontent-%COMP%]{margin-left:40px}.indent-3[_ngcontent-%COMP%]{margin-left:60px}.indent-4[_ngcontent-%COMP%]{margin-left:80px}.indent-5[_ngcontent-%COMP%]{margin-left:100px}.form-check-input[_ngcontent-%COMP%]:checked{background-color:#2196f3;border-color:#2196f3}.form-check-input[_ngcontent-%COMP%]:indeterminate{background-color:#ffc107;border-color:#ffc107}.form-select[_ngcontent-%COMP%]:focus{border-color:#2196f3;box-shadow:0 0 0 .2rem #2196f340}.page-link[_ngcontent-%COMP%]:hover{color:#2196f3;background-color:#f8f9fa;border-color:#dee2e6}.page-item.active[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{background-color:#2196f3;border-color:#2196f3;color:#fff}.alert-info[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#0277bd;border-left:4px solid #2196f3}.spinner-border[_ngcontent-%COMP%]{color:#2196f3;width:3rem;height:3rem}.text-muted[_ngcontent-%COMP%]   i.fa-3x[_ngcontent-%COMP%]{color:#adb5bd!important;margin-bottom:1rem}[dir=rtl][_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.selected-row[_ngcontent-%COMP%]{border-left:none;border-right:4px solid #2196f3}[dir=rtl][_ngcontent-%COMP%]   .indent-1[_ngcontent-%COMP%]{margin-right:20px;margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .indent-2[_ngcontent-%COMP%]{margin-right:40px;margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .indent-3[_ngcontent-%COMP%]{margin-right:60px;margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .indent-4[_ngcontent-%COMP%]{margin-right:80px;margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .indent-5[_ngcontent-%COMP%]{margin-right:100px;margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .alert-info[_ngcontent-%COMP%]{border-left:none;border-right:4px solid #2196f3}@media (max-width: 768px){.table-controls[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:.5rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.75rem}.pagination[_ngcontent-%COMP%]{justify-content:center;margin-top:1rem}.d-flex.align-items-center[_ngcontent-%COMP%]   span.text-muted[_ngcontent-%COMP%]{display:none}}@media (max-width: 576px){.table-container[_ngcontent-%COMP%]{max-height:60vh}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:.75rem;padding:.5rem .25rem}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem .25rem}.btn-group[_ngcontent-%COMP%]{flex-direction:column}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-bottom:2px;border-radius:4px!important}.actions-column[_ngcontent-%COMP%]{width:80px}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.sortable[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transition:transform .2s ease}.sortable[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transform:scale(1.1)}.btn[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transition:transform .2s ease}.btn-outline-primary[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%], .btn-outline-danger[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%], .btn-outline-secondary[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transform:scale(1.1)}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:focus-within{outline:2px solid #2196f3;outline-offset:-2px}.btn[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #2196f340}@media print{.table-controls[_ngcontent-%COMP%], .actions-column[_ngcontent-%COMP%], .pagination[_ngcontent-%COMP%]{display:none!important}.table[_ngcontent-%COMP%]{font-size:.8rem}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.selected-row[_ngcontent-%COMP%]{background-color:transparent!important;border-left:none!important}}"]})};function Ke(n,t){if(n&1){let e=x();v(0,"button",21),I("click",function(){s(e);let a=r(2);return p(a.onAddDepartment())}),S(1,"i",22),h()}if(n&2){let e=r(2);V("title",e.i18n.t("department.addDepartment"))}}function Qe(n,t){if(n&1){let e=x();v(0,"div",1)(1,"div",4)(2,"div",5)(3,"div",6)(4,"span",7),S(5,"i",8),h(),v(6,"input",9),I("input",function(a){s(e);let m=r();return p(m.onSearchChange(a.target.value))}),h()()(),v(7,"div",10)(8,"div",11)(9,"input",12),I("change",function(a){s(e);let m=r();return p(m.onShowInactiveChange(a.target.checked))}),h(),v(10,"label",13),d(11),h()()(),v(12,"div",14)(13,"div",15)(14,"button",16),I("click",function(){s(e);let a=r();return p(a.expandAll())}),S(15,"i",17),h(),v(16,"button",16),I("click",function(){s(e);let a=r();return p(a.collapseAll())}),S(17,"i",18),h(),v(18,"button",16),I("click",function(){s(e);let a=r();return p(a.refresh())}),S(19,"i",19),h(),_(20,Ke,2,1,"button",20),h()()()()}if(n&2){let e=r();o(6),V("placeholder",e.i18n.t("common.search")+"...")("value",e.searchTerm()),o(3),V("checked",e.showInactive()),o(2),b(" ",e.i18n.t("common.showInactive")," "),o(3),V("title",e.i18n.t("common.expandAll")),o(2),V("title",e.i18n.t("common.collapseAll")),o(2),V("title",e.i18n.t("common.refresh")),o(2),C(e.allowEdit?20:-1)}}function We(n,t){if(n&1&&(v(0,"div",2)(1,"div",23)(2,"span",24),d(3),h()()()),n&2){let e=r();o(3),b("",e.i18n.t("common.loading"),"...")}}function Xe(n,t){if(n&1){let e=x();v(0,"button",40),I("click",function(a){s(e);let m=r().$implicit;return r(2).toggleNode(m.id),p(a.stopPropagation())}),S(1,"i",41),h()}if(n&2){let e=r().$implicit,i=r(2);o(),k("fa-chevron-right",!i.isExpanded(e.id))("fa-chevron-down",i.isExpanded(e.id))}}function Ze(n,t){n&1&&S(0,"div",30)}function et(n,t){if(n&1&&(v(0,"span",35),d(1),h()),n&2){let e=r(3);o(),b(" ",e.i18n.t("common.inactive")," ")}}function tt(n,t){if(n&1&&(v(0,"div",36),d(1),h()),n&2){let e=r().$implicit;o(),b(" ",e.description," ")}}function nt(n,t){if(n&1&&(v(0,"span"),S(1,"i",42),d(2),h()),n&2){let e=r().$implicit;o(2),b(" ",e.managerName," ")}}function it(n,t){if(n&1&&(v(0,"span",38),S(1,"i",43),d(2),h()),n&2){let e=r().$implicit,i=r(2);o(2),J(" ",e.employeeCount," ",i.i18n.t("common.employees")," ")}}function ot(n,t){if(n&1&&(v(0,"span",38),S(1,"i",44),d(2),h()),n&2){let e=r().$implicit;o(2),b(" ",e.location," ")}}function at(n,t){if(n&1){let e=x();v(0,"button",50),I("click",function(a){s(e);let m=r(2).$implicit;return r(2).onAddDepartment(m),p(a.stopPropagation())}),S(1,"i",22),h()}if(n&2){let e=r(4);V("title",e.i18n.t("department.addSubDepartment"))}}function rt(n,t){if(n&1){let e=x();v(0,"button",16),I("click",function(a){s(e);let m=r(2).$implicit;return r(2).onEditDepartment(m),p(a.stopPropagation())}),S(1,"i",51),h()}if(n&2){let e=r(4);V("title",e.i18n.t("common.edit"))}}function lt(n,t){if(n&1){let e=x();v(0,"button",52),I("click",function(a){s(e);let m=r(2).$implicit;return r(2).onDeleteDepartment(m),p(a.stopPropagation())}),S(1,"i",53),h()}if(n&2){let e=r(4);V("title",e.i18n.t("common.delete"))}}function ct(n,t){if(n&1){let e=x();v(0,"div",39)(1,"div",15)(2,"button",45),I("click",function(a){s(e);let m=r().$implicit;return r(2).onViewDepartment(m),p(a.stopPropagation())}),S(3,"i",46),h(),_(4,at,2,1,"button",47),_(5,rt,2,1,"button",48),_(6,lt,2,1,"button",49),h()()}if(n&2){let e=r().$implicit,i=r(2);o(2),V("title",i.i18n.t("common.view")),o(2),C(i.allowEdit?4:-1),o(),C(i.allowEdit?5:-1),o(),C(i.allowDelete&&e.employeeCount===0?6:-1)}}function dt(n,t){if(n&1){let e=x();v(0,"div",27)(1,"div",28),I("click",function(){let a=s(e).$implicit,m=r(2);return p(m.selectNode(a))}),_(2,Xe,2,4,"button",29),_(3,Ze,1,0,"div",30),S(4,"i",31),v(5,"div",32)(6,"div",33)(7,"strong"),d(8),h(),v(9,"span",34),d(10),h(),_(11,et,2,1,"span",35),h(),_(12,tt,2,1,"div",36),v(13,"div",37),_(14,nt,3,1,"span"),_(15,it,3,2,"span",38),_(16,ot,3,1,"span",38),h()(),_(17,ct,7,4,"div",39),h()()}if(n&2){let e=t.$implicit,i=r(2);k("selected",i.isSelected(e.id))("inactive",!e.isActive),o(),ae(i.getIndentStyle(e.indentLevel)),o(),C(e.hasChildren?2:-1),o(),C(e.hasChildren?-1:3),o(5),D(e.name),o(2),b("(",e.code,")"),o(),C(e.isActive?-1:11),o(),C(e.description?12:-1),o(2),C(e.managerName?14:-1),o(),C(e.employeeCount>0?15:-1),o(),C(e.location?16:-1),o(),C(i.showControls?17:-1)}}function mt(n,t){if(n&1){let e=x();v(0,"button",56),I("click",function(){s(e);let a=r(3);return p(a.onAddDepartment())}),S(1,"i",57),d(2),h()}if(n&2){let e=r(3);o(2),b(" ",e.i18n.t("department.addFirstDepartment")," ")}}function st(n,t){if(n&1&&(v(0,"div",26),S(1,"i",54),v(2,"h5"),d(3),h(),v(4,"p"),d(5),h(),_(6,mt,3,1,"button",55),h()),n&2){let e=r(2);o(3),D(e.i18n.t("department.noDepartments")),o(2),D(e.i18n.t("department.noDepartmentsDescription")),o(),C(e.allowEdit?6:-1)}}function pt(n,t){if(n&1&&(v(0,"div",3),H(1,dt,18,16,"div",25,q().trackByNodeId,!0),_(3,st,7,3,"div",26),h()),n&2){let e=r();o(),z(e.getVisibleNodes()),o(2),C(e.getVisibleNodes().length===0?3:-1)}}var X=class n{selectedBranchId;allowSelection=!0;allowEdit=!0;allowDelete=!0;showControls=!0;departmentSelected=new P;departmentView=new P;departmentEdit=new P;departmentDelete=new P;departmentAdd=new P;i18n=T(R);departmentsService=T(Y);loading=E(!1);departments=E([]);expandedNodes=E(new Set);selectedNode=E(null);searchTerm=E("");showInactive=E(!1);ngOnInit(){this.loadDepartments()}loadDepartments(){return G(this,null,function*(){this.loading.set(!0);try{let t=yield this.departmentsService.getDepartmentTree(this.selectedBranchId).toPromise();t&&this.departments.set(this.convertToTreeNodes(t))}catch(t){console.error("Failed to load departments:",t)}finally{this.loading.set(!1)}})}convertToTreeNodes(t){return t.map(e=>ne(te({},e),{expanded:!1,selected:!1,indentLevel:e.level,children:e.children?this.convertToTreeNodes(e.children):[]}))}toggleNode(t){let e=this.expandedNodes();e.has(t)?e.delete(t):e.add(t),this.expandedNodes.set(new Set(e))}selectNode(t){this.allowSelection&&(this.selectedNode.set(t.id),this.departmentSelected.emit(t))}isExpanded(t){return this.expandedNodes().has(t)}isSelected(t){return this.selectedNode()===t}getVisibleNodes(){let t=[],e=this.searchTerm().toLowerCase(),i=this.showInactive(),a=(m,w=0)=>{for(let M of m){let B=!e||M.name.toLowerCase().includes(e)||M.code.toLowerCase().includes(e)||M.nameAr&&M.nameAr.toLowerCase().includes(e),Ce=i||M.isActive;B&&Ce&&t.push(ne(te({},M),{indentLevel:w})),M.children&&this.isExpanded(M.id)&&a(M.children,w+1)}};return a(this.departments()),t}expandAll(){let t=this.getAllNodeIds(this.departments());this.expandedNodes.set(new Set(t))}collapseAll(){this.expandedNodes.set(new Set)}getAllNodeIds(t){let e=[];for(let i of t)e.push(i.id),i.children&&e.push(...this.getAllNodeIds(i.children));return e}onAddDepartment(t){this.departmentAdd.emit({parentId:t?.id})}onViewDepartment(t){this.departmentView.emit(t)}onEditDepartment(t){this.departmentEdit.emit(t)}onDeleteDepartment(t){this.departmentDelete.emit(t)}getIndentStyle(t){return`margin-left: ${(t||0)*20}px`}onSearchChange(t){this.searchTerm.set(t),t&&this.expandMatchingNodes()}expandMatchingNodes(){let t=this.searchTerm().toLowerCase(),e=new Set,i=(a,m=[])=>{for(let w of a)(w.name.toLowerCase().includes(t)||w.code.toLowerCase().includes(t)||w.nameAr&&w.nameAr.toLowerCase().includes(t))&&m.forEach(B=>e.add(B)),w.children&&i(w.children,[...m,w.id])};i(this.departments()),this.expandedNodes.set(e)}onShowInactiveChange(t){this.showInactive.set(t)}refresh(){this.loadDepartments()}trackByNodeId(t,e){return e.id}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=A({type:n,selectors:[["app-department-tree"]],inputs:{selectedBranchId:"selectedBranchId",allowSelection:"allowSelection",allowEdit:"allowEdit",allowDelete:"allowDelete",showControls:"showControls"},outputs:{departmentSelected:"departmentSelected",departmentView:"departmentView",departmentEdit:"departmentEdit",departmentDelete:"departmentDelete",departmentAdd:"departmentAdd"},decls:4,vars:3,consts:[[1,"department-tree"],[1,"tree-controls","mb-3"],[1,"text-center","p-4"],[1,"tree-container"],[1,"row","g-2","align-items-center"],[1,"col-md-4"],[1,"input-group"],[1,"input-group-text"],[1,"fas","fa-search"],["type","text",1,"form-control",3,"input","placeholder","value"],[1,"col-md-3"],[1,"form-check"],["type","checkbox","id","showInactive",1,"form-check-input",3,"change","checked"],["for","showInactive",1,"form-check-label"],[1,"col-md-5"],[1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary",3,"click","title"],[1,"fas","fa-expand-arrows-alt"],[1,"fas","fa-compress-arrows-alt"],[1,"fas","fa-sync"],["type","button",1,"btn","btn-primary",3,"title"],["type","button",1,"btn","btn-primary",3,"click","title"],[1,"fas","fa-plus"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"tree-node",3,"selected","inactive"],[1,"text-center","p-4","text-muted"],[1,"tree-node"],[1,"node-content","d-flex","align-items-center","p-2",3,"click"],["type","button",1,"btn","btn-sm","btn-link","expand-btn","p-0","me-2"],[1,"expand-spacer","me-2"],[1,"fas","fa-building","me-2","text-primary"],[1,"node-info","flex-grow-1"],[1,"node-title"],[1,"text-muted","ms-1"],[1,"badge","bg-light","text-dark","border","ms-2"],[1,"node-subtitle","text-muted","small"],[1,"node-meta","text-muted","small"],[1,"ms-2"],[1,"node-actions"],["type","button",1,"btn","btn-sm","btn-link","expand-btn","p-0","me-2",3,"click"],[1,"fas"],[1,"fas","fa-user-tie","me-1"],[1,"fas","fa-users","me-1"],[1,"fas","fa-map-marker-alt","me-1"],["type","button",1,"btn","btn-outline-primary",3,"click","title"],[1,"fas","fa-eye"],["type","button",1,"btn","btn-outline-success",3,"title"],["type","button",1,"btn","btn-outline-secondary",3,"title"],["type","button",1,"btn","btn-outline-danger",3,"title"],["type","button",1,"btn","btn-outline-success",3,"click","title"],[1,"fas","fa-edit"],["type","button",1,"btn","btn-outline-danger",3,"click","title"],[1,"fas","fa-trash"],[1,"fas","fa-building","fa-3x","mb-3"],["type","button",1,"btn","btn-primary"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus","me-2"]],template:function(e,i){e&1&&(v(0,"div",0),_(1,Qe,21,8,"div",1),_(2,We,4,1,"div",2),_(3,pt,4,1,"div",3),h()),e&2&&(o(),C(i.showControls?1:-1),o(),C(i.loading()?2:-1),o(),C(i.loading()?-1:3))},dependencies:[F,j],styles:[".department-tree[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a}.tree-controls[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #e9ecef;background-color:#f8f9fa;border-radius:8px 8px 0 0}.tree-container[_ngcontent-%COMP%]{max-height:600px;overflow-y:auto}.tree-node[_ngcontent-%COMP%]{border-bottom:1px solid #f8f9fa;transition:all .2s ease}.tree-node[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.tree-node.selected[_ngcontent-%COMP%]{background-color:#e3f2fd;border-left:4px solid #2196f3}.tree-node.inactive[_ngcontent-%COMP%]{opacity:.6}.node-content[_ngcontent-%COMP%]{cursor:pointer;position:relative;min-height:48px}.expand-btn[_ngcontent-%COMP%]{width:24px;height:24px;border:none!important;color:#6c757d;display:flex;align-items:center;justify-content:center}.expand-btn[_ngcontent-%COMP%]:hover{color:#495057;background-color:#e9ecef;border-radius:4px}.expand-spacer[_ngcontent-%COMP%]{width:24px;height:24px}.node-info[_ngcontent-%COMP%]{min-height:36px;display:flex;flex-direction:column;justify-content:center}.node-title[_ngcontent-%COMP%]{font-weight:500;color:#212529;line-height:1.2}.node-subtitle[_ngcontent-%COMP%]{margin-top:2px;font-size:.875rem;line-height:1.2}.node-meta[_ngcontent-%COMP%]{margin-top:2px;font-size:.75rem;line-height:1.2}.node-meta[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline-flex;align-items:center}.node-actions[_ngcontent-%COMP%]{opacity:0;transition:opacity .2s ease}.tree-node[_ngcontent-%COMP%]:hover   .node-actions[_ngcontent-%COMP%]{opacity:1}.node-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border:none;box-shadow:0 1px 3px #0000001a}.node-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 2px 6px #00000026}[dir=rtl][_ngcontent-%COMP%]   .tree-node.selected[_ngcontent-%COMP%]{border-left:none;border-right:4px solid #2196f3}[dir=rtl][_ngcontent-%COMP%]   .node-content[_ngcontent-%COMP%]{flex-direction:row-reverse}@media (max-width: 768px){.tree-controls[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:.5rem}.node-actions[_ngcontent-%COMP%]{opacity:1}.node-actions[_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]{flex-direction:column}.node-meta[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;margin-left:0!important;margin-top:2px}}.tree-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.tree-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px}.tree-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:4px}.tree-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.tree-node[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.spinner-border[_ngcontent-%COMP%]{color:#2196f3}.text-muted[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#adb5bd!important}.badge[_ngcontent-%COMP%]{font-size:.65rem;padding:.25rem .5rem}.btn-outline-success[_ngcontent-%COMP%]:hover, .btn-outline-primary[_ngcontent-%COMP%]:hover, .btn-outline-danger[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}"]})};function _t(n,t){if(n&1){let e=x();l(0,"button",16),g("click",function(){s(e);let a=r();return p(a.onDepartmentAdd())}),u(1,"i",17),d(2),c()}if(n&2){let e=r();f("disabled",e.branchesLoading),o(2),b(" ",e.i18n.t("department.addDepartment")," ")}}var Z=class n{i18n=T(R);branchesService=T(pe);permissionService=T(L);viewMode="table";selectedBranch=null;branchesLoading=!1;viewModeChange=new P;branchSelectionChange=new P;departmentAdd=new P;branches=E([]);PERMISSIONS={DEPARTMENT_CREATE:`${O.DEPARTMENT}.${y.CREATE}`};get branchSelectOptions(){let t=[{value:"",label:this.i18n.t("common.selectBranch")}];return this.branches().forEach(e=>{t.push({value:e.id.toString(),label:`${e.name} (${e.code})`})}),t}ngOnInit(){this.loadBranches()}loadBranches(){this.branchesService.getBranchesForDropdown().subscribe({next:t=>{let e=t.map(i=>({id:i.id,name:i.name,code:i.code,location:void 0,isActive:i.isActive}));this.branches.set(e)},error:t=>{console.error("Failed to load branches:",t)}})}onViewModeChange(t){this.viewModeChange.emit(t)}onBranchSelectionChange(t){this.branchSelectionChange.emit(t)}onDepartmentAdd(){this.departmentAdd.emit()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=A({type:n,selectors:[["app-department-filters"]],inputs:{viewMode:"viewMode",selectedBranch:"selectedBranch",branchesLoading:"branchesLoading"},outputs:{viewModeChange:"viewModeChange",branchSelectionChange:"branchSelectionChange",departmentAdd:"departmentAdd"},decls:21,vars:13,consts:[[1,"card","mb-4"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-4"],[1,"form-label"],[3,"selectionChange","options","value","placeholder","searchable","clearable","loading"],[1,"col-md-3"],["role","group",1,"btn-group","w-100"],["type","radio","name","viewMode","id","tableView",1,"btn-check",3,"change","checked"],["for","tableView",1,"btn","btn-outline-primary"],[1,"fas","fa-table","me-2"],["type","radio","name","viewMode","id","treeView",1,"btn-check",3,"change","checked"],["for","treeView",1,"btn","btn-outline-primary"],[1,"fas","fa-sitemap","me-2"],[1,"col-md-3","d-flex","align-items-end"],["type","button","class","btn btn-primary",3,"disabled","click",4,"appHasPermission"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"fas","fa-plus","me-2"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"label",4),d(5),c(),l(6,"app-searchable-select",5),g("selectionChange",function(m){return i.onBranchSelectionChange(m)}),c()(),l(7,"div",6)(8,"label",4),d(9),c(),l(10,"div",7)(11,"input",8),g("change",function(){return i.onViewModeChange("table")}),c(),l(12,"label",9),u(13,"i",10),d(14),c(),l(15,"input",11),g("change",function(){return i.onViewModeChange("tree")}),c(),l(16,"label",12),u(17,"i",13),d(18),c()()(),l(19,"div",14),N(20,_t,3,2,"button",15),c()()()()),e&2&&(o(5),D(i.i18n.t("common.branch")),o(),f("options",i.branchSelectOptions)("value",(i.selectedBranch==null||i.selectedBranch.id==null?null:i.selectedBranch.id.toString())||"")("placeholder",i.i18n.t("common.selectBranch"))("searchable",!0)("clearable",!1)("loading",i.branchesLoading),o(3),D(i.i18n.t("common.view")),o(2),f("checked",i.viewMode==="table"),o(3),b(" ",i.i18n.t("common.table")," "),o(),f("checked",i.viewMode==="tree"),o(3),b(" ",i.i18n.t("common.tree")," "),o(2),f("appHasPermission",i.PERMISSIONS.DEPARTMENT_CREATE))},dependencies:[F,U,se],styles:[".card[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;box-shadow:0 2px 4px #0000001a}.card-body[_ngcontent-%COMP%]{padding:1.5rem}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#333;margin-bottom:.5rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:0}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:first-child{border-top-left-radius:.375rem;border-bottom-left-radius:.375rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{border-top-right-radius:.375rem;border-bottom-right-radius:.375rem}.btn-outline-primary[_ngcontent-%COMP%]:checked + .btn[_ngcontent-%COMP%], .btn-check[_ngcontent-%COMP%]:checked + .btn-outline-primary[_ngcontent-%COMP%]{background-color:#0d6efd;border-color:#0d6efd;color:#fff}@media (max-width: 768px){.col-md-3.d-flex[_ngcontent-%COMP%]{margin-top:1rem}.btn-group[_ngcontent-%COMP%]{flex-direction:column}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:.375rem!important;margin-bottom:.25rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-bottom:0}}"]})};function Ct(n,t){if(n&1&&(l(0,"p",12),d(1),c()),n&2){let e=r(2);o(),b(" ",e.selectedDepartment.description," ")}}function ut(n,t){if(n&1&&(l(0,"div",14)(1,"small",15),d(2),c(),u(3,"br"),l(4,"strong"),d(5),c()()),n&2){let e=r(2);o(2),D(e.i18n.t("department.manager")),o(3),D(e.selectedDepartment.managerName)}}function gt(n,t){if(n&1&&(l(0,"div",14)(1,"small",15),d(2),c(),u(3,"br"),l(4,"strong"),d(5),c()()),n&2){let e=r(2);o(2),D(e.i18n.t("department.location")),o(3),D(e.selectedDepartment.location)}}function bt(n,t){if(n&1){let e=x();l(0,"button",22),g("click",function(){s(e);let a=r(2);return p(a.onDepartmentView())}),u(1,"i",23),d(2),c()}if(n&2){let e=r(2);o(2),b(" ",e.i18n.t("common.view")," ")}}function ft(n,t){if(n&1){let e=x();l(0,"button",24),g("click",function(){s(e);let a=r(2);return p(a.onDepartmentEdit())}),u(1,"i",25),d(2),c()}if(n&2){let e=r(2);o(2),b(" ",e.i18n.t("common.edit")," ")}}function xt(n,t){if(n&1){let e=x();l(0,"button",26),g("click",function(){s(e);let a=r(2);return p(a.onDepartmentDelete())}),u(1,"i",27),d(2),c()}if(n&2){let e=r(2);f("disabled",e.selectedDepartment.employeeCount>0),o(2),b(" ",e.i18n.t("common.delete")," ")}}function ht(n,t){if(n&1){let e=x();l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div"),u(5,"i",4),d(6),c(),l(7,"button",5),g("click",function(){s(e);let a=r();return p(a.onClosePanel())}),u(8,"i",6),c()()(),l(9,"div",7)(10,"div",8)(11,"div",9)(12,"h6",10),d(13),c(),l(14,"p",11),d(15),c(),_(16,Ct,2,1,"p",12),c(),l(17,"div",9)(18,"div",13),_(19,ut,6,2,"div",14),l(20,"div",14)(21,"small",15),d(22),c(),u(23,"br"),l(24,"strong"),d(25),c()(),_(26,gt,6,2,"div",14),l(27,"div",14)(28,"small",15),d(29),c(),u(30,"br"),l(31,"span",16),d(32),c()()()()(),l(33,"div",17)(34,"div",18),N(35,bt,3,1,"button",19)(36,ft,3,1,"button",20)(37,xt,3,2,"button",21),c()()()()()}if(n&2){let e=r();o(6),b(" ",e.i18n.t("department.selectedDepartment")," "),o(7),D(e.selectedDepartment.name),o(2),D(e.selectedDepartment.code),o(),C(e.selectedDepartment.description?16:-1),o(3),C(e.selectedDepartment.managerName?19:-1),o(3),D(e.i18n.t("common.employees")),o(3),D(e.selectedDepartment.employeeCount||0),o(),C(e.selectedDepartment.location?26:-1),o(3),D(e.i18n.t("common.status")),o(2),k("bg-success",e.selectedDepartment.isActive)("bg-light",!e.selectedDepartment.isActive)("text-dark",!e.selectedDepartment.isActive)("border",!e.selectedDepartment.isActive),o(),b(" ",e.selectedDepartment.isActive?e.i18n.t("common.active"):e.i18n.t("common.inactive")," "),o(3),f("appHasPermission",e.PERMISSIONS.DEPARTMENT_READ),o(),f("appHasPermission",e.PERMISSIONS.DEPARTMENT_UPDATE),o(),f("appHasPermission",e.PERMISSIONS.DEPARTMENT_DELETE)}}var ee=class n{i18n=T(R);permissionService=T(L);selectedDepartment=null;departmentView=new P;departmentEdit=new P;departmentDelete=new P;closePanel=new P;PERMISSIONS={DEPARTMENT_READ:`${O.DEPARTMENT}.${y.READ}`,DEPARTMENT_UPDATE:`${O.DEPARTMENT}.${y.UPDATE}`,DEPARTMENT_DELETE:`${O.DEPARTMENT}.${y.DELETE}`};onDepartmentView(){this.selectedDepartment&&this.departmentView.emit(this.selectedDepartment)}onDepartmentEdit(){this.selectedDepartment&&this.departmentEdit.emit(this.selectedDepartment)}onDepartmentDelete(){this.selectedDepartment&&this.departmentDelete.emit(this.selectedDepartment)}onClosePanel(){this.closePanel.emit()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=A({type:n,selectors:[["app-department-info-panel"]],inputs:{selectedDepartment:"selectedDepartment"},outputs:{departmentView:"departmentView",departmentEdit:"departmentEdit",departmentDelete:"departmentDelete",closePanel:"closePanel"},decls:1,vars:1,consts:[[1,"selected-info"],[1,"card","border-primary"],[1,"card-header","bg-primary","text-white"],[1,"d-flex","align-items-center","justify-content-between"],[1,"fas","fa-info-circle","me-2"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],[1,"fas","fa-times"],[1,"card-body"],[1,"row"],[1,"col-md-6"],[1,"fw-bold"],[1,"text-muted","mb-2"],[1,"small","mb-2"],[1,"row","g-2"],[1,"col-6"],[1,"text-muted"],[1,"badge"],[1,"mt-3"],[1,"btn-group","btn-group-sm"],["type","button","class","btn btn-outline-primary",3,"click",4,"appHasPermission"],["type","button","class","btn btn-outline-secondary",3,"click",4,"appHasPermission"],["type","button","class","btn btn-outline-danger",3,"disabled","click",4,"appHasPermission"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"fas","fa-eye","me-1"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-edit","me-1"],["type","button",1,"btn","btn-outline-danger",3,"click","disabled"],[1,"fas","fa-trash","me-1"]],template:function(e,i){e&1&&_(0,ht,38,21,"div",0),e&2&&C(i.selectedDepartment?0:-1)},dependencies:[F,U],styles:[".selected-info[_ngcontent-%COMP%]{margin-top:1.5rem}.card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 4px 6px #0000001a;overflow:hidden}.card-header[_ngcontent-%COMP%]{border-bottom:1px solid rgba(255,255,255,.2);padding:1rem 1.25rem}.card-body[_ngcontent-%COMP%]{padding:1.5rem}.fw-bold[_ngcontent-%COMP%]{font-weight:600;color:#333;margin-bottom:.5rem}.text-muted[_ngcontent-%COMP%]{color:#6c757d!important}.small[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.4}.badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.375rem .75rem;border-radius:.375rem}.badge.bg-success[_ngcontent-%COMP%]{background-color:#198754!important}.badge.bg-secondary[_ngcontent-%COMP%]{background-color:#6c757d!important}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.875rem;border-radius:.25rem}.btn-outline-primary[_ngcontent-%COMP%]{color:#0d6efd;border-color:#0d6efd}.btn-outline-primary[_ngcontent-%COMP%]:hover{background-color:#0d6efd;border-color:#0d6efd;color:#fff}.btn-outline-secondary[_ngcontent-%COMP%]{color:#6c757d;border-color:#6c757d}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background-color:#6c757d;border-color:#6c757d;color:#fff}.btn-outline-danger[_ngcontent-%COMP%]{color:#dc3545;border-color:#dc3545}.btn-outline-danger[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#dc3545;border-color:#dc3545;color:#fff}.btn-outline-danger[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-outline-light[_ngcontent-%COMP%]{border:1px solid rgba(255,255,255,.5);color:#fff}.btn-outline-light[_ngcontent-%COMP%]:hover{background-color:#ffffff1a;border-color:#fff;color:#fff}@media (max-width: 768px){.card-body[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .col-md-6[_ngcontent-%COMP%]{margin-bottom:1rem}.btn-group-sm[_ngcontent-%COMP%]{flex-direction:column;width:100%}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:.375rem!important;margin-bottom:.25rem;width:100%}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-bottom:0}}"]})};function Dt(n,t){if(n&1&&(l(0,"div",5)(1,"div",8),u(2,"i",9),l(3,"div")(4,"strong"),d(5),c(),u(6,"br"),l(7,"small"),d(8),c()()()()),n&2){let e=r();o(5),D(e.i18n.t("department.allDepartments")||"All Departments"),o(3),D(e.i18n.t("department.showingAllDepartments")||"Showing departments from all branches. Select a specific branch to filter.")}}function vt(n,t){if(n&1){let e=x();l(0,"app-department-table",10),g("departmentSelected",function(a){s(e);let m=r();return p(m.onDepartmentSelected(a))})("departmentView",function(a){s(e);let m=r();return p(m.onDepartmentView(a))})("departmentEdit",function(a){s(e);let m=r();return p(m.onDepartmentEdit(a))})("departmentDelete",function(a){s(e);let m=r();return p(m.onDepartmentDelete(a))})("departmentAdd",function(){s(e);let a=r();return p(a.onDepartmentAdd())}),c()}if(n&2){let e,i=r();f("selectedBranchId",(e=i.selectedBranch())==null?null:e.id)("allowSelection",!0)("allowEdit",!0)("allowDelete",!0)("showControls",!0)}}function wt(n,t){if(n&1){let e=x();l(0,"app-department-tree",10),g("departmentSelected",function(a){s(e);let m=r();return p(m.onDepartmentSelected(a))})("departmentView",function(a){s(e);let m=r();return p(m.onDepartmentView(a))})("departmentEdit",function(a){s(e);let m=r();return p(m.onDepartmentEdit(a))})("departmentDelete",function(a){s(e);let m=r();return p(m.onDepartmentDelete(a))})("departmentAdd",function(a){s(e);let m=r();return p(m.onDepartmentAdd(a))}),c()}if(n&2){let e,i=r();f("selectedBranchId",(e=i.selectedBranch())==null?null:e.id)("allowSelection",!0)("allowEdit",!0)("allowDelete",!0)("showControls",!0)}}var _e=class n{i18n=T(R);departmentsService=T(Y);confirmationService=T(me);permissionService=T(L);router=T(le);PERMISSIONS={DEPARTMENT_CREATE:`${O.DEPARTMENT}.${y.CREATE}`,DEPARTMENT_READ:`${O.DEPARTMENT}.${y.READ}`,DEPARTMENT_UPDATE:`${O.DEPARTMENT}.${y.UPDATE}`,DEPARTMENT_DELETE:`${O.DEPARTMENT}.${y.DELETE}`,DEPARTMENT_MANAGE:`${O.DEPARTMENT}.${y.MANAGE}`};viewMode=E("table");selectedBranch=E(null);selectedDepartment=E(null);branchesLoading=E(!1);branches=E([]);ngOnInit(){}onViewModeChange(t){this.viewMode.set(t)}onBranchChange(t){if(!t||t===0){this.selectedBranch.set(null);return}let e=this.branches().find(i=>i.id===t);this.selectedBranch.set(e||null)}onBranchSelectionChange(t){let e=t?parseInt(t):0;this.onBranchChange(e)}onCloseInfoPanel(){this.selectedDepartment.set(null)}onDepartmentSelected(t){this.selectedDepartment.set(t)}onDepartmentView(t){this.router.navigate(["/departments",t.id,"view"])}onDepartmentEdit(t){this.router.navigate(["/departments",t.id,"edit"])}onDepartmentDelete(t){return G(this,null,function*(){(yield this.confirmationService.confirm({title:"Delete Department",message:`Are you sure you want to delete "${t.name}"? This action cannot be undone.`,confirmText:this.i18n.t("common.delete"),cancelText:this.i18n.t("common.cancel"),confirmButtonClass:"btn-danger",icon:"fa-trash",iconClass:"text-danger"})).confirmed&&this.deleteDepartment(t.id)})}onDepartmentAdd(t){t?.parentId?this.router.navigate(["/departments/create"],{queryParams:{parentId:t.parentId}}):this.router.navigate(["/departments/create"])}deleteDepartment(t){return G(this,null,function*(){try{yield this.departmentsService.deleteDepartment(t).toPromise(),this.refreshData()}catch(e){console.error("Failed to delete department:",e)}})}refreshData(){window.location.reload()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=A({type:n,selectors:[["app-departments"]],decls:11,vars:8,consts:[[1,"departments-page"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[3,"viewModeChange","branchSelectionChange","departmentAdd","viewMode","selectedBranch","branchesLoading"],[1,"card"],[1,"card-body"],[1,"alert","alert-info"],[3,"selectedBranchId","allowSelection","allowEdit","allowDelete","showControls"],[3,"departmentView","departmentEdit","departmentDelete","closePanel","selectedDepartment"],[1,"d-flex","align-items-center"],[1,"fas","fa-info-circle","me-3"],[3,"departmentSelected","departmentView","departmentEdit","departmentDelete","departmentAdd","selectedBranchId","allowSelection","allowEdit","allowDelete","showControls"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1)(2,"h2"),d(3),c()(),l(4,"app-department-filters",2),g("viewModeChange",function(m){return i.onViewModeChange(m)})("branchSelectionChange",function(m){return i.onBranchSelectionChange(m)})("departmentAdd",function(){return i.onDepartmentAdd()}),c(),l(5,"div",3)(6,"div",4),_(7,Dt,9,2,"div",5),_(8,vt,1,5,"app-department-table",6),_(9,wt,1,5,"app-department-tree",6),c()(),l(10,"app-department-info-panel",7),g("departmentView",function(m){return i.onDepartmentView(m)})("departmentEdit",function(m){return i.onDepartmentEdit(m)})("departmentDelete",function(m){return i.onDepartmentDelete(m)})("closePanel",function(){return i.onCloseInfoPanel()}),c()()),e&2&&(o(3),D(i.i18n.t("department.departments")),o(),f("viewMode",i.viewMode())("selectedBranch",i.selectedBranch())("branchesLoading",i.branchesLoading()),o(3),C(!i.selectedBranch()&&!i.branchesLoading()?7:-1),o(),C(i.viewMode()==="table"?8:-1),o(),C(i.viewMode()==="tree"?9:-1),o(),f("selectedDepartment",i.selectedDepartment()))},dependencies:[F,j,K,X,Z,ee],styles:[".selected-info[_ngcontent-%COMP%]{position:fixed;top:50%;right:2rem;transform:translateY(-50%);width:350px;z-index:1000}@media (max-width: 1200px){.selected-info[_ngcontent-%COMP%]{position:relative;top:auto;right:auto;transform:none;width:100%;margin-top:2rem}}"]})};export{_e as DepartmentsComponent};
