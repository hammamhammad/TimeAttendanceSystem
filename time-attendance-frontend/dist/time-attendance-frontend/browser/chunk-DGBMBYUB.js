import{a as y}from"./chunk-RUOWTK24.js";import{a as g}from"./chunk-A6EM5NV6.js";import{Gc as h,Hc as p,L as i,O as v,S as d,fa as o,k as s,n as u,x as n}from"./chunk-IGEIB4M6.js";import{a as l,b as c}from"./chunk-YMDWBF3A.js";var f=class m{constructor(e,a){this.http=e;this.notificationService=a}apiUrl=`${g.apiUrl}/api/v1/leave-balances`;_loading=o(!1);_error=o(null);_currentBalance=o(null);_balanceSummary=o(null);_transactions=o([]);_transactionsPagedResult=o(null);loading=this._loading.asReadonly();error=this._error.asReadonly();currentBalance=this._currentBalance.asReadonly();balanceSummary=this._balanceSummary.asReadonly();transactions=this._transactions.asReadonly();transactionsPagedResult=this._transactionsPagedResult.asReadonly();getEmployeeLeaveBalance(e,a,t){return this._loading.set(!0),this._error.set(null),this.http.get(`${this.apiUrl}/employee/${e}/vacation-type/${a}/year/${t}`).pipe(u(r=>r?this.transformBalanceDates(r):null),i(r=>{this._currentBalance.set(r),this._loading.set(!1)}),n(r=>(this._error.set(r.error?.message||"Failed to load leave balance"),this._loading.set(!1),this.notificationService.error("Failed to load leave balance"),s(()=>r))))}getLeaveBalanceSummary(e,a){return this._loading.set(!0),this._error.set(null),this.http.get(`${this.apiUrl}/employee/${e}/summary/${a}`).pipe(u(t=>this.transformSummaryDates(t)),i(t=>{this._balanceSummary.set(t),this._loading.set(!1)}),n(t=>(this._error.set(t.error?.message||"Failed to load balance summary"),this._loading.set(!1),this.notificationService.error("Failed to load balance summary"),s(()=>t))))}getLeaveTransactionHistory(e){this._loading.set(!0),this._error.set(null);let a=new h;return e.vacationTypeId&&(a=a.set("vacationTypeId",e.vacationTypeId.toString())),e.year&&(a=a.set("year",e.year.toString())),e.pageNumber&&(a=a.set("pageNumber",e.pageNumber.toString())),e.pageSize&&(a=a.set("pageSize",e.pageSize.toString())),this.http.get(`${this.apiUrl}/employee/${e.employeeId}/transactions`,{params:a}).pipe(u(t=>c(l({},t),{items:t.items.map(r=>this.transformTransactionDates(r))})),i(t=>{this._transactions.set(t.items),this._transactionsPagedResult.set(t),this._loading.set(!1)}),n(t=>(this._error.set(t.error?.message||"Failed to load transaction history"),this._loading.set(!1),this.notificationService.error("Failed to load transaction history"),s(()=>t))))}setLeaveEntitlement(e){return this._loading.set(!0),this._error.set(null),this.http.post(`${this.apiUrl}/entitlements`,e).pipe(i(a=>{this._loading.set(!1),this.notificationService.success("Leave entitlement set successfully")}),n(a=>{this._loading.set(!1);let t=a.error?.message||"Failed to set leave entitlement";return this._error.set(t),this.notificationService.error(t),s(()=>a)}))}processMonthlyAccrual(e){return this._loading.set(!0),this._error.set(null),this.http.post(`${this.apiUrl}/accrual/process-monthly`,e).pipe(i(a=>{this._loading.set(!1),this.notificationService.success(`Monthly accrual processed successfully for ${a} employee(s)`)}),n(a=>{this._loading.set(!1);let t=a.error?.message||"Failed to process monthly accrual";return this._error.set(t),this.notificationService.error(t),s(()=>a)}))}adjustLeaveBalance(e){return this._loading.set(!0),this._error.set(null),this.http.post(`${this.apiUrl}/adjustments`,e).pipe(i(()=>{this._loading.set(!1),this.notificationService.success("Leave balance adjusted successfully");let a=this._balanceSummary();a&&a.employeeId===e.employeeId&&this.getLeaveBalanceSummary(e.employeeId,e.year).subscribe()}),n(a=>{this._loading.set(!1);let t=a.error?.message||"Failed to adjust leave balance";return this._error.set(t),this.notificationService.error(t),s(()=>a)}))}getCurrentYear(){return new Date().getFullYear()}clearBalanceData(){this._currentBalance.set(null),this._balanceSummary.set(null),this._transactions.set([]),this._transactionsPagedResult.set(null),this._error.set(null)}refreshBalanceSummary(){let e=this._balanceSummary();e&&this.getLeaveBalanceSummary(e.employeeId,e.year).subscribe()}transformBalanceDates(e){return c(l({},e),{effectiveStartDate:e.effectiveStartDate||null,effectiveEndDate:e.effectiveEndDate||null,lastAccrualDate:e.lastAccrualDate||null})}transformSummaryDates(e){return c(l({},e),{vacationTypeBalances:e.vacationTypeBalances.map(a=>c(l({},a),{lastAccrualDate:a.lastAccrualDate||null}))})}transformTransactionDates(e){return c(l({},e),{transactionDate:e.transactionDate})}goToTransactionPage(e,a){let t=this._transactionsPagedResult();if(t&&a>=1&&a<=t.totalPages){let r={employeeId:e,pageNumber:a,pageSize:t.pageSize};this.getLeaveTransactionHistory(r).subscribe()}}changeTransactionPageSize(e,a){let t={employeeId:e,pageNumber:1,pageSize:a};this.getLeaveTransactionHistory(t).subscribe()}static \u0275fac=function(a){return new(a||m)(d(p),d(y))};static \u0275prov=v({token:m,factory:m.\u0275fac,providedIn:"root"})};export{f as a};
