import{a as X}from"./chunk-FDL2CFXM.js";import{a as Y}from"./chunk-RQBJFQCN.js";import{a as Q}from"./chunk-K7WTKFJQ.js";import{a as J}from"./chunk-NPDCAEA6.js";import{a as Z}from"./chunk-V5WU2NQ3.js";import"./chunk-QW24EDIR.js";import"./chunk-QXVLGI72.js";import"./chunk-HUSARQNL.js";import{a as j}from"./chunk-H5EPUHY6.js";import{a as B}from"./chunk-N7S3JMGU.js";import{a as f,b as h,c}from"./chunk-Y62N6K5S.js";import{x as G}from"./chunk-VRETN7JA.js";import{a as W}from"./chunk-GRQ6RO47.js";import{a as H}from"./chunk-UBCI4X5Q.js";import{a as q}from"./chunk-EYAJMHM7.js";import{a as V}from"./chunk-HHXRLUSQ.js";import"./chunk-UWVH5K3J.js";import{b as K}from"./chunk-RUY4WPQA.js";import{g as U}from"./chunk-TWXUAMJ4.js";import{$a as T,Bb as v,Cb as S,Db as M,Ea as D,Eb as N,Pb as $,R as g,W as x,X as k,Xa as P,Ya as y,Yb as R,ab as A,bb as d,cb as a,da as p,db as m,eb as u,lb as I,nb as _,nc as z,pb as C,ta as n,wc as F,yb as L}from"./chunk-JSQL33QG.js";import{a as E,b as O,d as w}from"./chunk-DGAILPFQ.js";var te=()=>[],ie=(l,e)=>e.id;function oe(l,e){if(l&1){let t=I();a(0,"div",17)(1,"div",20)(2,"div",21)(3,"input",22),_("change",function(){let o=x(t).$implicit,s=C(2);return k(s.onTogglePermission(o))}),m(),a(4,"div",23)(5,"div",24),u(6,"i",25),a(7,"label",26)(8,"small"),v(9),m()(),u(10,"app-status-badge",27),m(),a(11,"p",28),v(12),m()()()()()}if(l&2){let t=e.$implicit,i=C(2);n(),L("bg-light",i.isPermissionAssigned(t.id))("loading",i.managingPermissions()),n(2),d("id","permission-"+t.id)("checked",i.isPermissionAssigned(t.id))("disabled",i.managingPermissions()),n(3),d("ngClass",i.getPermissionIcon(t.key)),n(),d("for","permission-"+t.id),n(2),S(i.getPermissionResource(t.key)),n(),d("status",i.getPermissionBadgeStatus(t.key))("label",i.getPermissionAction(t.key))("size","sm"),n(2),M(" ",i.getPermissionDescription(t)," ")}}function ne(l,e){if(l&1&&u(0,"app-empty-state",18),l&2){let t=C(2);d("icon","fa-solid fa-key")("message",t.t("roles.no_permissions_available"))("size","sm")}}function se(l,e){if(l&1&&(a(0,"div",19),u(1,"app-loading-spinner",29),m()),l&2){let t=C(2);n(),d("message",t.t("roles.updating_permissions"))("variant","primary")("size","sm")("centered",!0)}}function re(l,e){if(l&1&&(a(0,"div",8)(1,"div",9)(2,"div",10)(3,"div",11),u(4,"i",12),m()(),a(5,"div")(6,"h6",13),v(7),m(),a(8,"p",14),v(9),m()()()(),a(10,"div",15)(11,"div",16),T(12,oe,13,14,"div",17,ie),m(),P(14,ne,1,3,"app-empty-state",18),m(),P(15,se,2,4,"div",19)),l&2){let t=C();n(7),S(t.selectedRole().name),n(2),N(" ",t.selectedRole().permissions.length," ",t.t("roles.permissions_assigned")," "),n(3),A(t.allPermissions()),n(2),y(t.allPermissions().length===0?14:-1),n(),y(t.managingPermissions()?15:-1)}}var ee=class l{rolesService=g(Z);router=g(U);notificationService=g(V);confirmationService=g(j);i18n=g(K);permissionService=g(B);PERMISSIONS={ROLE_CREATE:`${h.ROLE}.${f.CREATE}`,ROLE_READ:`${h.ROLE}.${f.READ}`,ROLE_UPDATE:`${h.ROLE}.${f.UPDATE}`,ROLE_DELETE:`${h.ROLE}.${f.DELETE}`,ROLE_MANAGE:`${h.ROLE}.${f.MANAGE}`,ROLE_ASSIGN_PERMISSIONS:`${h.ROLE}.${f.ASSIGN_PERMISSION}`};loading=p(!1);roles=p([]);allPermissions=p([]);groupedPermissions=p([]);searchTerm="";sortColumn=p("name");sortDirection=p("asc");showPermissionsModal=p(!1);selectedRole=p(null);managingPermissions=p(!1);tableColumns=R(()=>[{key:"name",label:this.t("roles.name"),sortable:!0,width:"200px",priority:"high",mobileLabel:this.t("roles.name"),renderHtml:!0},{key:"permissions",label:this.t("roles.permissions"),sortable:!1,width:"300px",priority:"medium",hideOnMobile:!1,mobileLabel:this.t("roles.permissions"),renderHtml:!0},{key:"userCount",label:this.t("roles.users"),sortable:!0,width:"100px",align:"center",priority:"medium",mobileLabel:this.t("roles.users"),renderHtml:!0},{key:"type",label:this.t("roles.type"),sortable:!1,width:"120px",align:"center",priority:"low",hideOnMobile:!0,mobileLabel:this.t("roles.type"),renderHtml:!0},{key:"createdAtUtc",label:this.t("common.created"),sortable:!0,width:"150px",priority:"low",hideOnMobile:!0,mobileLabel:this.t("common.created")}]);tableActions=R(()=>[{key:"view",label:this.t("common.view"),icon:"fa-eye",color:"primary",condition:()=>this.permissionService.has(this.PERMISSIONS.ROLE_READ)},{key:"manage-permissions",label:this.t("roles.manage_permissions"),icon:"fa-shield-alt",color:"info",condition:e=>this.canManagePermissions(e)&&this.permissionService.has(this.PERMISSIONS.ROLE_ASSIGN_PERMISSIONS)},{key:"edit",label:this.t("common.edit"),icon:"fa-edit",color:"secondary",condition:e=>this.canEditRole(e)&&this.permissionService.has(this.PERMISSIONS.ROLE_UPDATE)},{key:"delete",label:this.t("common.delete"),icon:"fa-trash",color:"danger",condition:e=>this.canDeleteRole(e)&&this.permissionService.has(this.PERMISSIONS.ROLE_DELETE)}]);tableData=R(()=>this.filteredRoles().map(e=>O(E({},e),{name:this.formatRoleName(e),permissions:this.formatRolePermissions(e),userCount:this.formatUserCount(e),type:this.formatRoleType(e),createdAtUtc:this.formatDate(e.createdAtUtc)})));ngOnInit(){this.loadRoles(),this.loadPermissions()}t(e){return this.i18n.t(e)}loadRoles(){this.loading.set(!0),this.rolesService.getRoles(!0).subscribe({next:e=>{this.roles.set(e),this.loading.set(!1)},error:e=>{console.error("Failed to load roles:",e),this.loading.set(!1),this.notificationService.error(this.t("app.error"),this.t("errors.server"))}})}loadPermissions(){this.rolesService.getPermissions().subscribe({next:e=>{this.allPermissions.set(e)},error:e=>{console.error("Failed to load permissions:",e),this.notificationService.error(this.t("app.error"),this.t("roles.failed_to_load_permissions"))}}),this.rolesService.getGroupedPermissions().subscribe({next:e=>{this.groupedPermissions.set(e)},error:e=>{console.error("Failed to load grouped permissions:",e),this.notificationService.error(this.t("app.error"),this.t("roles.failed_to_load_permissions"))}})}canEditRole(e){return this.permissionService.has(this.PERMISSIONS.ROLE_UPDATE)?this.canEditRoleBusinessLogic(e):!1}canDeleteRole(e){return this.permissionService.has(this.PERMISSIONS.ROLE_DELETE)?e.isDeletable&&e.userCount===0:!1}canManagePermissions(e){return this.permissionService.has(this.PERMISSIONS.ROLE_ASSIGN_PERMISSIONS)?this.canEditRoleBusinessLogic(e):!1}canEditRoleBusinessLogic(e){return e.isEditable}onManagePermissions(e){this.canManagePermissions(e)&&(this.selectedRole.set(e),this.showPermissionsModal.set(!0))}closePermissionsModal(){this.showPermissionsModal.set(!1),this.selectedRole.set(null)}isPermissionAssigned(e){let t=this.selectedRole();return t?t.permissions.some(i=>i.id===e):!1}onTogglePermission(e){let t=this.selectedRole();if(!t||this.managingPermissions())return;this.managingPermissions.set(!0);let i=this.isPermissionAssigned(e.id);(i?this.rolesService.removePermissionFromRole(t.id,e.id):this.rolesService.assignPermissionToRole(t.id,{permissionId:e.id})).subscribe({next:()=>{let s=this.roles().map(r=>(r.id===t.id&&(i?r.permissions=r.permissions.filter(b=>b.id!==e.id):r.permissions=[...r.permissions,e]),r));this.roles.set(s),this.selectedRole.set(s.find(r=>r.id===t.id)||null),this.managingPermissions.set(!1)},error:s=>{console.error("Failed to update permission:",s),this.managingPermissions.set(!1),this.notificationService.error(this.t("app.error"),this.t("roles.failed_to_update_permission"))}})}formatDate(e){return new Date(e).toLocaleDateString(this.i18n.getCurrentLocale(),{year:"numeric",month:"short",day:"numeric"})}filteredRoles=R(()=>{let e=this.roles();if(this.searchTerm?.trim()){let o=this.searchTerm.toLowerCase();e=e.filter(s=>s.name.toLowerCase().includes(o)||s.permissions.some(r=>r.key.toLowerCase().includes(o)))}let t=this.sortColumn(),i=this.sortDirection();return e.sort((o,s)=>{let r=o[t],b=s[t];return typeof r=="string"&&(r=r.toLowerCase(),b=b.toLowerCase()),r<b?i==="asc"?-1:1:r>b?i==="asc"?1:-1:0})});formatRoleName(e){let t=`<div><strong>${e.name}</strong>`;return e.isSystem&&(t+=`<i class="fa-solid fa-shield-alt text-primary ms-1" title="${this.t("roles.system_role")}"></i>`),t+="</div>",t}formatRolePermissions(e){if(e.permissions.length===0)return`<span class="text-muted">${this.t("roles.no_permissions")}</span>`;let t='<div class="d-flex flex-wrap gap-1">';return e.permissions.slice(0,3).forEach(o=>{t+=`<span class="badge bg-secondary-subtle text-secondary small">${o.key}</span>`}),e.permissions.length>3&&(t+=`<span class="badge bg-light text-dark small">+${e.permissions.length-3} more</span>`),t+="</div>",t}formatUserCount(e){return`<span class="badge bg-primary-subtle text-primary">${e.userCount}</span>`}formatRoleType(e){return e.isSystem?`<span class="badge bg-warning-subtle text-warning">${this.t("roles.system")}</span>`:`<span class="badge bg-success-subtle text-success">${this.t("roles.custom")}</span>`}onActionClick(e){let{action:t,item:i}=e;switch(t){case"view":this.onViewRole(i);break;case"manage-permissions":this.onManagePermissions(i);break;case"edit":this.onEditRole(i);break;case"delete":this.onDeleteRole(i);break;default:console.warn("Unknown action:",t)}}onSearchTermChange(e){this.searchTerm=e}onFiltersChange(e){console.log("Filters changed:",e)}onClearFilters(){this.searchTerm=""}onRefreshData(){this.searchTerm="",this.loadRoles()}hasActiveFilters(){return!!this.searchTerm}onCreateRole(){this.router.navigate(["/roles/create"])}onViewRole(e){this.router.navigate(["/roles",e.id,"view"])}onEditRole(e){this.canEditRole(e)&&this.router.navigate(["/roles",e.id,"edit"])}onDeleteRole(e){return w(this,null,function*(){if(!this.canDeleteRole(e))return;(yield this.confirmationService.confirm({title:this.t("roles.delete_role"),message:this.t("roles.delete_role_confirmation").replace("{{roleName}}",e.name),confirmText:this.t("common.delete"),cancelText:this.t("common.cancel"),confirmButtonClass:"btn-danger",icon:"fa-trash",iconClass:"text-danger"})).confirmed&&this.rolesService.deleteRole(e.id).subscribe({next:()=>{this.roles.set(this.roles().filter(i=>i.id!==e.id)),this.notificationService.success(this.t("app.success"),this.t("roles.role_deleted_successfully"))},error:i=>{console.error("Failed to delete role:",i),this.notificationService.error(this.t("app.error"),this.t("errors.server"))}})})}canCreateRoles(){return this.permissionService.has(this.PERMISSIONS.ROLE_CREATE)}getPermissionResource(e){return c.getResourceName(c.parsePermissionKey(e).resource)}getPermissionAction(e){let t=c.parsePermissionKey(e).action;return t?c.getActionName(t):"Action"}getActionBadgeClass(e){let t=c.parsePermissionKey(e).action;return t?c.getActionBadgeClass(t):"bg-light text-dark"}getPermissionBadgeStatus(e){let t=c.parsePermissionKey(e).action,i=t?c.getActionBadgeClass(t):"bg-light text-dark";return i.includes("bg-success")?"success":i.includes("bg-info")?"info":i.includes("bg-warning")?"warning":i.includes("bg-primary")?"primary":i.includes("bg-danger")?"danger":"secondary"}getPermissionIcon(e){let t=c.parsePermissionKey(e).resource;return c.getResourceIcon(t)}getPermissionDescription(e){if(e.description)return e.description;let{resource:t,action:i}=c.parsePermissionKey(e.key),o=c.getActionDescription(i),s=c.getResourceDescription(t);return`${o} ${s.toLowerCase()}`}onSort(e){let t=this.sortColumn(),i=this.sortDirection();t===e?this.sortDirection.set(i==="asc"?"desc":"asc"):(this.sortColumn.set(e),this.sortDirection.set("asc"))}getSortIcon(e){let t=this.sortColumn(),i=this.sortDirection();return t!==e?"fas fa-sort text-muted":i==="asc"?"fas fa-sort-up text-primary":"fas fa-sort-down text-primary"}isSortable(e){return["name","userCount","createdAtUtc"].includes(e)}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=D({type:l,selectors:[["app-roles"]],decls:10,vars:18,consts:[[1,"app-list-page"],[3,"title"],["moduleName","roles",3,"searchChange","filtersChange","add","refresh","refreshing"],[1,"table-hover",3,"actionClick","data","columns","actions","loading","emptyTitle","emptyMessage","paginated","responsiveMode"],[3,"close","show","title","size","centered","loading"],[1,"modal-body"],["modal-footer","",1,"d-flex","gap-2","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"role-info","mb-4"],[1,"d-flex","align-items-center"],[1,"avatar-md","me-3"],[1,"avatar-title","bg-info-subtle","text-info","rounded-circle"],[1,"fa-solid","fa-user-shield"],[1,"mb-1"],[1,"text-muted","mb-0"],[1,"permissions-list","border","rounded","p-3",2,"max-height","400px","overflow-y","auto"],[1,"row","g-2"],[1,"col-md-6","col-lg-4"],[3,"icon","message","size"],[1,"text-center","py-3"],[1,"permission-item","border","rounded","p-2"],[1,"form-check","d-flex","align-items-start"],["type","checkbox",1,"form-check-input","mt-1",3,"change","id","checked","disabled"],[1,"form-check-content","ms-2","flex-grow-1"],[1,"d-flex","align-items-center","mb-1"],[1,"fas","me-1","text-muted",2,"font-size","0.75rem",3,"ngClass"],[1,"form-check-label","fw-medium","me-2",3,"for"],[3,"status","label","size"],[1,"text-muted","small","mb-0",2,"font-size","0.7rem","margin-left","1.25rem"],[3,"message","variant","size","centered"]],template:function(t,i){if(t&1&&(a(0,"div",0),u(1,"app-page-header",1),a(2,"app-unified-filter",2),_("searchChange",function(s){return i.onSearchTermChange(s)})("filtersChange",function(s){return i.onFiltersChange(s)})("add",function(){return i.onCreateRole()})("refresh",function(){return i.onRefreshData()}),m(),a(3,"app-data-table",3),_("actionClick",function(s){return i.onActionClick(s)}),m()(),a(4,"app-modal-wrapper",4),_("close",function(){return i.closePermissionsModal()}),a(5,"div",5),P(6,re,16,5),m(),a(7,"div",6)(8,"button",7),_("click",function(){return i.closePermissionsModal()}),v(9),m()()()),t&2){let o;n(),d("title",i.t("roles.title")),n(),d("refreshing",i.loading()),n(),d("data",i.tableData()||$(17,te))("columns",i.tableColumns())("actions",i.tableActions())("loading",i.loading)("emptyTitle",i.t("roles.no_roles_found"))("emptyMessage",i.hasActiveFilters()?i.t("common.try_different_filters"):i.t("roles.no_roles_description"))("paginated",!0)("responsiveMode","auto"),n(),d("show",i.showPermissionsModal())("title",i.t("roles.manage_permissions_for")+": "+(((o=i.selectedRole())==null?null:o.name)||""))("size","xl")("centered",!0)("loading",i.managingPermissions()),n(2),y(i.selectedRole()?6:-1),n(3),M(" ",i.t("common.close")," ")}},dependencies:[F,z,G,J,H,Y,Q,X,q,W],styles:[".roles-page[_ngcontent-%COMP%]{padding:0}.avatar-sm[_ngcontent-%COMP%]{width:2rem;height:2rem;display:flex;align-items:center;justify-content:center}.avatar-md[_ngcontent-%COMP%]{width:3rem;height:3rem;display:flex;align-items:center;justify-content:center}.avatar-title[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1rem;font-weight:500}.permission-item[_ngcontent-%COMP%]{padding:.75rem;border:1px solid #e9ecef;border-radius:.375rem;transition:all .15s ease-in-out;background-color:#fff}.permission-item[_ngcontent-%COMP%]:hover{border-color:#0d6efd;background-color:#f8f9fa;box-shadow:0 2px 4px #0000001a}.permission-item.bg-light[_ngcontent-%COMP%]{background-color:#e3f2fd!important;border-color:#2196f3!important;box-shadow:0 2px 4px #2196f333}.permission-item.loading[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.permission-group[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #e9ecef;border-radius:.5rem;padding:1rem;margin-bottom:1rem}.permission-group[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:#212529;font-weight:600;margin-bottom:1rem}.form-check-content[_ngcontent-%COMP%]{min-width:0}.form-check-label[_ngcontent-%COMP%]{word-break:break-word;color:#000!important;font-weight:600!important;font-size:.9rem!important}.form-check-label[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#000!important;font-weight:600!important;font-size:.9rem!important}.permission-item[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{color:#333!important;font-size:.8rem!important;line-height:1.3!important;font-weight:500!important}.permissions-groups[_ngcontent-%COMP%]   .border[_ngcontent-%COMP%]{border-color:#dee2e6!important}.bg-purple-subtle[_ngcontent-%COMP%]{background-color:#e9d5ff!important}.text-purple[_ngcontent-%COMP%]{color:#7c3aed!important}.permission-item[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.7rem;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.permission-item[_ngcontent-%COMP%]   .form-check-label[_ngcontent-%COMP%]{font-size:.85rem}.permission-group[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.75rem}.badge.small[_ngcontent-%COMP%]{font-size:.65em}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:disabled, .btn-group[_ngcontent-%COMP%]   .btn.disabled[_ngcontent-%COMP%]{opacity:.4}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.role-info[_ngcontent-%COMP%]{background-color:#f8f9fa;border-radius:.5rem;padding:1rem}th.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;transition:background-color .15s ease-in-out}th.sortable[_ngcontent-%COMP%]:hover{background-color:#e9ecef}th.sortable[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem;opacity:.7;transition:opacity .15s ease-in-out}th.sortable[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{opacity:1}"]})};export{ee as RolesComponent};
