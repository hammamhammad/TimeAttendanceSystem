import{a as te}from"./chunk-DNP7HDGU.js";import{a as ee}from"./chunk-GNG6SBUX.js";import{a as Z}from"./chunk-CQWFZVPO.js";import{a as Y}from"./chunk-4G2EQDXN.js";import{a as j}from"./chunk-Y4G43P3P.js";import{a as S,b as y,c as p}from"./chunk-AYMGSBNU.js";import{a as Q}from"./chunk-4DSP56PF.js";import"./chunk-3BUDJKKE.js";import{c as K,e as W,h as q,x as J}from"./chunk-OTKBQKTN.js";import{b as X}from"./chunk-NJ656CWW.js";import{$ as s,Da as V,E as o,Ea as F,Fa as U,J as T,Ka as z,N as A,Ra as O,U as x,V as R,Xa as G,Y as N,Z as L,_ as f,aa as r,ba as h,eb as B,ia as M,ka as _,ma as m,pb as H,sa as $,t as b,u as C,v,va as c,wa as g,xa as P,ya as k,z as u}from"./chunk-6T5SYK5O.js";import{a as w,b as D,d as I}from"./chunk-DGAILPFQ.js";var ne=()=>({standalone:!0}),oe=(n,e)=>e.id;function se(n,e){if(n&1){let t=M();s(0,"button",19),_("click",function(){C(t);let a=m();return v(a.onCreateRole())}),h(1,"i",20),c(2),r()}if(n&2){let t=m();o(2),P(" ",t.t("roles.create_role")," ")}}function re(n,e){if(n&1&&(s(0,"div",16)(1,"div",21)(2,"span",22),c(3),r()(),s(4,"p",23),c(5),r()()),n&2){let t=m();o(3),g(t.t("common.loading")),o(2),g(t.t("common.loading"))}}function ae(n,e){if(n&1){let t=M();s(0,"button",27),_("click",function(){C(t);let a=m(2);return v(a.onClearFilters())}),c(1),r()}if(n&2){let t=m(2);o(),P(" ",t.t("common.clear_filters")," ")}}function le(n,e){if(n&1&&(s(0,"div",16),h(1,"i",24),s(2,"p",25),c(3),r(),x(4,ae,2,1,"button",26),r()),n&2){let t=m();o(3),g(t.t("roles.no_roles_found")),o(),R(t.hasActiveFilters()?4:-1)}}function ce(n,e){if(n&1){let t=M();s(0,"app-data-table",28),_("actionClick",function(a){C(t);let l=m();return v(l.onActionClick(a))}),r()}if(n&2){let t=m();f("data",t.tableData())("columns",t.tableColumns())("actions",t.tableActions())("loading",t.loading)("paginated",!0)("emptyMessage",t.t("roles.no_roles_found"))("responsiveMode","auto")}}function me(n,e){if(n&1){let t=M();s(0,"div",47)(1,"div",49)(2,"div",50)(3,"input",51),_("change",function(){let a=C(t).$implicit,l=m(3);return v(l.onTogglePermission(a))}),r(),s(4,"div",52)(5,"div",53),h(6,"i",54),s(7,"label",55)(8,"small"),c(9),r()(),s(10,"span",56),c(11),r()(),s(12,"p",57),c(13),r()()()()()}if(n&2){let t=e.$implicit,i=m(3);o(),$("bg-light",i.isPermissionAssigned(t.id))("loading",i.managingPermissions()),o(2),f("id","permission-"+t.id)("checked",i.isPermissionAssigned(t.id))("disabled",i.managingPermissions()),o(3),f("ngClass",i.getPermissionIcon(t.key)),o(),f("for","permission-"+t.id),o(2),g(i.getPermissionResource(t.key)),o(),f("ngClass",i.getActionBadgeClass(t.key)),o(),P(" ",i.getPermissionAction(t.key)," "),o(2),P(" ",i.getPermissionDescription(t)," ")}}function de(n,e){if(n&1&&(s(0,"div",16),h(1,"i",58),s(2,"p",44),c(3),r()()),n&2){let t=m(3);o(3),g(t.t("roles.no_permissions_available"))}}function pe(n,e){if(n&1&&(s(0,"div",48)(1,"div",59)(2,"span",22),c(3),r()(),s(4,"p",60),c(5),r()()),n&2){let t=m(3);o(3),g(t.t("common.loading")),o(2),g(t.t("roles.updating_permissions"))}}function ge(n,e){if(n&1&&(s(0,"div",38)(1,"div",39)(2,"div",40)(3,"div",41),h(4,"i",42),r()(),s(5,"div")(6,"h6",43),c(7),r(),s(8,"p",44),c(9),r()()()(),s(10,"div",45)(11,"div",46),N(12,me,14,13,"div",47,oe),r(),x(14,de,4,1,"div",16),r(),x(15,pe,6,2,"div",48)),n&2){let t=m(2);o(7),g(t.selectedRole().name),o(2),k(" ",t.selectedRole().permissions.length," ",t.t("roles.permissions_assigned")," "),o(3),L(t.allPermissions()),o(2),R(t.allPermissions().length===0?14:-1),o(),R(t.managingPermissions()?15:-1)}}function ue(n,e){if(n&1){let t=M();s(0,"div",18)(1,"div",29)(2,"div",30)(3,"div",31)(4,"h5",32),h(5,"i",33),c(6),r(),s(7,"button",34),_("click",function(){C(t);let a=m();return v(a.closePermissionsModal())}),r()(),s(8,"div",35),x(9,ge,16,5),r(),s(10,"div",36)(11,"button",37),_("click",function(){C(t);let a=m();return v(a.closePermissionsModal())}),c(12),r()()()()()}if(n&2){let t,i=m();o(6),k(" ",i.t("roles.manage_permissions_for"),": ",(t=i.selectedRole())==null?null:t.name," "),o(3),R(i.selectedRole()?9:-1),o(3),P(" ",i.t("common.close")," ")}}var ie=class n{rolesService=b(te);router=b(H);notificationService=b(Q);confirmationService=b(Y);i18n=b(X);permissionService=b(j);PERMISSIONS={ROLE_CREATE:`${y.ROLE}.${S.CREATE}`,ROLE_READ:`${y.ROLE}.${S.READ}`,ROLE_UPDATE:`${y.ROLE}.${S.UPDATE}`,ROLE_DELETE:`${y.ROLE}.${S.DELETE}`,ROLE_MANAGE:`${y.ROLE}.${S.MANAGE}`,ROLE_ASSIGN_PERMISSIONS:`${y.ROLE}.${S.ASSIGN_PERMISSION}`};loading=u(!1);roles=u([]);allPermissions=u([]);groupedPermissions=u([]);searchTerm="";sortColumn=u("name");sortDirection=u("asc");showPermissionsModal=u(!1);selectedRole=u(null);managingPermissions=u(!1);tableColumns=O(()=>[{key:"name",label:this.t("roles.name"),sortable:!0,width:"200px",priority:"high",mobileLabel:this.t("roles.name"),renderHtml:!0},{key:"permissions",label:this.t("roles.permissions"),sortable:!1,width:"300px",priority:"medium",hideOnMobile:!1,mobileLabel:this.t("roles.permissions"),renderHtml:!0},{key:"userCount",label:this.t("roles.users"),sortable:!0,width:"100px",align:"center",priority:"medium",mobileLabel:this.t("roles.users"),renderHtml:!0},{key:"type",label:this.t("roles.type"),sortable:!1,width:"120px",align:"center",priority:"low",hideOnMobile:!0,mobileLabel:this.t("roles.type"),renderHtml:!0},{key:"createdAtUtc",label:this.t("common.created"),sortable:!0,width:"150px",priority:"low",hideOnMobile:!0,mobileLabel:this.t("common.created")}]);tableActions=O(()=>[{key:"view",label:this.t("common.view"),icon:"fa-eye",color:"primary",condition:()=>this.permissionService.has(this.PERMISSIONS.ROLE_READ)},{key:"manage-permissions",label:this.t("roles.manage_permissions"),icon:"fa-shield-alt",color:"info",condition:e=>this.canManagePermissions(e)&&this.permissionService.has(this.PERMISSIONS.ROLE_ASSIGN_PERMISSIONS)},{key:"edit",label:this.t("common.edit"),icon:"fa-edit",color:"secondary",condition:e=>this.canEditRole(e)&&this.permissionService.has(this.PERMISSIONS.ROLE_UPDATE)},{key:"delete",label:this.t("common.delete"),icon:"fa-trash",color:"danger",condition:e=>this.canDeleteRole(e)&&this.permissionService.has(this.PERMISSIONS.ROLE_DELETE)}]);tableData=O(()=>this.filteredRoles().map(e=>D(w({},e),{name:this.formatRoleName(e),permissions:this.formatRolePermissions(e),userCount:this.formatUserCount(e),type:this.formatRoleType(e),createdAtUtc:this.formatDate(e.createdAtUtc)})));ngOnInit(){this.loadRoles(),this.loadPermissions()}t(e){return this.i18n.t(e)}loadRoles(){this.loading.set(!0),this.rolesService.getRoles(!0).subscribe({next:e=>{this.roles.set(e),this.loading.set(!1)},error:e=>{console.error("Failed to load roles:",e),this.loading.set(!1),this.notificationService.error(this.t("app.error"),this.t("errors.server"))}})}loadPermissions(){this.rolesService.getPermissions().subscribe({next:e=>{this.allPermissions.set(e)},error:e=>{console.error("Failed to load permissions:",e),this.notificationService.error(this.t("app.error"),this.t("roles.failed_to_load_permissions"))}}),this.rolesService.getGroupedPermissions().subscribe({next:e=>{this.groupedPermissions.set(e)},error:e=>{console.error("Failed to load grouped permissions:",e),this.notificationService.error(this.t("app.error"),this.t("roles.failed_to_load_permissions"))}})}canEditRole(e){return this.permissionService.has(this.PERMISSIONS.ROLE_UPDATE)?this.canEditRoleBusinessLogic(e):!1}canDeleteRole(e){return this.permissionService.has(this.PERMISSIONS.ROLE_DELETE)?e.isDeletable&&e.userCount===0:!1}canManagePermissions(e){return this.permissionService.has(this.PERMISSIONS.ROLE_ASSIGN_PERMISSIONS)?this.canEditRoleBusinessLogic(e):!1}canEditRoleBusinessLogic(e){return e.isEditable}onManagePermissions(e){this.canManagePermissions(e)&&(this.selectedRole.set(e),this.showPermissionsModal.set(!0))}closePermissionsModal(){this.showPermissionsModal.set(!1),this.selectedRole.set(null)}isPermissionAssigned(e){let t=this.selectedRole();return t?t.permissions.some(i=>i.id===e):!1}onTogglePermission(e){let t=this.selectedRole();if(!t||this.managingPermissions())return;this.managingPermissions.set(!0);let i=this.isPermissionAssigned(e.id);(i?this.rolesService.removePermissionFromRole(t.id,e.id):this.rolesService.assignPermissionToRole(t.id,{permissionId:e.id})).subscribe({next:()=>{let l=this.roles().map(d=>(d.id===t.id&&(i?d.permissions=d.permissions.filter(E=>E.id!==e.id):d.permissions=[...d.permissions,e]),d));this.roles.set(l),this.selectedRole.set(l.find(d=>d.id===t.id)||null),this.managingPermissions.set(!1)},error:l=>{console.error("Failed to update permission:",l),this.managingPermissions.set(!1),this.notificationService.error(this.t("app.error"),this.t("roles.failed_to_update_permission"))}})}formatDate(e){return new Date(e).toLocaleDateString(this.i18n.getCurrentLocale(),{year:"numeric",month:"short",day:"numeric"})}filteredRoles=O(()=>{let e=this.roles();if(this.searchTerm?.trim()){let a=this.searchTerm.toLowerCase();e=e.filter(l=>l.name.toLowerCase().includes(a)||l.permissions.some(d=>d.key.toLowerCase().includes(a)))}let t=this.sortColumn(),i=this.sortDirection();return e.sort((a,l)=>{let d=a[t],E=l[t];return typeof d=="string"&&(d=d.toLowerCase(),E=E.toLowerCase()),d<E?i==="asc"?-1:1:d>E?i==="asc"?1:-1:0})});formatRoleName(e){let t=`<div><strong>${e.name}</strong>`;return e.isSystem&&(t+=`<i class="fa-solid fa-shield-alt text-primary ms-1" title="${this.t("roles.system_role")}"></i>`),t+="</div>",t}formatRolePermissions(e){if(e.permissions.length===0)return`<span class="text-muted">${this.t("roles.no_permissions")}</span>`;let t='<div class="d-flex flex-wrap gap-1">';return e.permissions.slice(0,3).forEach(a=>{t+=`<span class="badge bg-secondary-subtle text-secondary small">${a.key}</span>`}),e.permissions.length>3&&(t+=`<span class="badge bg-light text-dark small">+${e.permissions.length-3} more</span>`),t+="</div>",t}formatUserCount(e){return`<span class="badge bg-primary-subtle text-primary">${e.userCount}</span>`}formatRoleType(e){return e.isSystem?`<span class="badge bg-warning-subtle text-warning">${this.t("roles.system")}</span>`:`<span class="badge bg-success-subtle text-success">${this.t("roles.custom")}</span>`}onActionClick(e){let{action:t,item:i}=e;switch(t){case"view":this.onViewRole(i);break;case"manage-permissions":this.onManagePermissions(i);break;case"edit":this.onEditRole(i);break;case"delete":this.onDeleteRole(i);break;default:console.warn("Unknown action:",t)}}onSearchChange(){setTimeout(()=>{},300)}onClearFilters(){this.searchTerm=""}hasActiveFilters(){return!!this.searchTerm}onCreateRole(){this.router.navigate(["/roles/create"])}onViewRole(e){this.router.navigate(["/roles",e.id,"view"])}onEditRole(e){this.canEditRole(e)&&this.router.navigate(["/roles",e.id,"edit"])}onDeleteRole(e){return I(this,null,function*(){if(!this.canDeleteRole(e))return;(yield this.confirmationService.confirm({title:this.t("roles.delete_role"),message:this.t("roles.delete_role_confirmation").replace("{{roleName}}",e.name),confirmText:this.t("common.delete"),cancelText:this.t("common.cancel"),confirmButtonClass:"btn-danger",icon:"fa-trash",iconClass:"text-danger"})).confirmed&&this.rolesService.deleteRole(e.id).subscribe({next:()=>{this.roles.set(this.roles().filter(i=>i.id!==e.id)),this.notificationService.success(this.t("app.success"),this.t("roles.role_deleted_successfully"))},error:i=>{console.error("Failed to delete role:",i),this.notificationService.error(this.t("app.error"),this.t("errors.server"))}})})}canCreateRoles(){return this.permissionService.has(this.PERMISSIONS.ROLE_CREATE)}getPermissionResource(e){return p.getResourceName(p.parsePermissionKey(e).resource)}getPermissionAction(e){let t=p.parsePermissionKey(e).action;return t?p.getActionName(t):"Action"}getActionBadgeClass(e){let t=p.parsePermissionKey(e).action;return t?p.getActionBadgeClass(t):"bg-light text-dark"}getPermissionIcon(e){let t=p.parsePermissionKey(e).resource;return p.getResourceIcon(t)}getPermissionDescription(e){if(e.description)return e.description;let{resource:t,action:i}=p.parsePermissionKey(e.key),a=p.getActionDescription(i),l=p.getResourceDescription(t);return`${a} ${l.toLowerCase()}`}onSort(e){let t=this.sortColumn(),i=this.sortDirection();t===e?this.sortDirection.set(i==="asc"?"desc":"asc"):(this.sortColumn.set(e),this.sortDirection.set("asc"))}getSortIcon(e){let t=this.sortColumn(),i=this.sortDirection();return t!==e?"fas fa-sort text-muted":i==="asc"?"fas fa-sort-up text-primary":"fas fa-sort-down text-primary"}isSortable(e){return["name","userCount","createdAtUtc"].includes(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=T({type:n,selectors:[["app-roles"]],decls:25,vars:10,consts:[[1,"roles-page"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],["class","btn btn-primary",3,"click",4,"appHasPermission"],[1,"card","mb-4"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-8"],[1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"fa-solid","fa-search"],["type","text",1,"form-control",3,"ngModelChange","input","placeholder","ngModel","ngModelOptions"],[1,"col-md-4","d-flex","align-items-end"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fa-solid","fa-filter-circle-xmark","me-1"],[1,"card"],[1,"text-center","py-4"],[1,"table-hover",3,"data","columns","actions","loading","paginated","emptyMessage","responsiveMode"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background-color","rgba(0,0,0,0.5)"],[1,"btn","btn-primary",3,"click"],[1,"fa-solid","fa-plus","me-2"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2","text-muted"],[1,"fa-solid","fa-user-shield","fa-3x","text-muted","mb-3"],[1,"text-muted"],[1,"btn","btn-outline-primary"],[1,"btn","btn-outline-primary",3,"click"],[1,"table-hover",3,"actionClick","data","columns","actions","loading","paginated","emptyMessage","responsiveMode"],[1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"fa-solid","fa-key","me-2"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"role-info","mb-4"],[1,"d-flex","align-items-center"],[1,"avatar-md","me-3"],[1,"avatar-title","bg-info-subtle","text-info","rounded-circle"],[1,"fa-solid","fa-user-shield"],[1,"mb-1"],[1,"text-muted","mb-0"],[1,"permissions-list","border","rounded","p-3",2,"max-height","400px","overflow-y","auto"],[1,"row","g-2"],[1,"col-md-6","col-lg-4"],[1,"text-center","py-3"],[1,"permission-item","border","rounded","p-2"],[1,"form-check","d-flex","align-items-start"],["type","checkbox",1,"form-check-input","mt-1",3,"change","id","checked","disabled"],[1,"form-check-content","ms-2","flex-grow-1"],[1,"d-flex","align-items-center","mb-1"],[1,"fas","me-1","text-muted",2,"font-size","0.75rem",3,"ngClass"],[1,"form-check-label","fw-medium","me-2",3,"for"],[1,"badge",2,"font-size","0.65rem",3,"ngClass"],[1,"text-muted","small","mb-0",2,"font-size","0.7rem","margin-left","1.25rem"],[1,"fa-solid","fa-key","fa-2x","text-muted","mb-2"],["role","status",1,"spinner-border","spinner-border-sm","text-primary"],[1,"text-muted","mt-2","mb-0"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"div",1)(2,"h2"),c(3),r(),A(4,se,3,1,"button",2),r(),s(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),c(10),r(),s(11,"div",8)(12,"span",9),h(13,"i",10),r(),s(14,"input",11),U("ngModelChange",function(l){return F(i.searchTerm,l)||(i.searchTerm=l),l}),_("input",function(){return i.onSearchChange()}),r()()(),s(15,"div",12)(16,"button",13),_("click",function(){return i.onClearFilters()}),h(17,"i",14),c(18),r()()()()(),s(19,"div",15)(20,"div",4),x(21,re,6,2,"div",16)(22,le,5,2,"div",16)(23,ce,1,7,"app-data-table",17),r()()(),x(24,ue,13,4,"div",18)),t&2&&(o(3),g(i.t("roles.title")),o(),f("appHasPermission",i.PERMISSIONS.ROLE_CREATE),o(6),g(i.t("common.search")),o(4),f("placeholder",i.t("roles.search_placeholder")),V("ngModel",i.searchTerm),f("ngModelOptions",z(9,ne)),o(4),P(" ",i.t("common.clear")," "),o(3),R(i.loading()?21:i.filteredRoles().length===0?22:23),o(3),R(i.showPermissionsModal()?24:-1))},dependencies:[B,G,J,K,W,q,Z,ee],styles:[".roles-page[_ngcontent-%COMP%]{padding:0}.avatar-sm[_ngcontent-%COMP%]{width:2rem;height:2rem;display:flex;align-items:center;justify-content:center}.avatar-md[_ngcontent-%COMP%]{width:3rem;height:3rem;display:flex;align-items:center;justify-content:center}.avatar-title[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1rem;font-weight:500}.permission-item[_ngcontent-%COMP%]{padding:.75rem;border:1px solid #e9ecef;border-radius:.375rem;transition:all .15s ease-in-out;background-color:#fff}.permission-item[_ngcontent-%COMP%]:hover{border-color:#0d6efd;background-color:#f8f9fa;box-shadow:0 2px 4px #0000001a}.permission-item.bg-light[_ngcontent-%COMP%]{background-color:#e3f2fd!important;border-color:#2196f3!important;box-shadow:0 2px 4px #2196f333}.permission-item.loading[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.permission-group[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #e9ecef;border-radius:.5rem;padding:1rem;margin-bottom:1rem}.permission-group[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:#212529;font-weight:600;margin-bottom:1rem}.form-check-content[_ngcontent-%COMP%]{min-width:0}.form-check-label[_ngcontent-%COMP%]{word-break:break-word;color:#000!important;font-weight:600!important;font-size:.9rem!important}.form-check-label[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#000!important;font-weight:600!important;font-size:.9rem!important}.permission-item[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{color:#333!important;font-size:.8rem!important;line-height:1.3!important;font-weight:500!important}.permissions-groups[_ngcontent-%COMP%]   .border[_ngcontent-%COMP%]{border-color:#dee2e6!important}.bg-purple-subtle[_ngcontent-%COMP%]{background-color:#e9d5ff!important}.text-purple[_ngcontent-%COMP%]{color:#7c3aed!important}.permission-item[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.7rem;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.permission-item[_ngcontent-%COMP%]   .form-check-label[_ngcontent-%COMP%]{font-size:.85rem}.permission-group[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.75rem}.badge.small[_ngcontent-%COMP%]{font-size:.65em}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:disabled, .btn-group[_ngcontent-%COMP%]   .btn.disabled[_ngcontent-%COMP%]{opacity:.4}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.role-info[_ngcontent-%COMP%]{background-color:#f8f9fa;border-radius:.5rem;padding:1rem}th.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;transition:background-color .15s ease-in-out}th.sortable[_ngcontent-%COMP%]:hover{background-color:#e9ecef}th.sortable[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem;opacity:.7;transition:opacity .15s ease-in-out}th.sortable[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{opacity:1}"]})};export{ie as RolesComponent};
