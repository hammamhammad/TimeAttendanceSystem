import{a as q}from"./chunk-BUDDO7QI.js";import{c as x}from"./chunk-65M2O2LF.js";import{a as W}from"./chunk-NYAEJKNV.js";import{a as G}from"./chunk-LK2JNJQF.js";import{b as L,d as B,g as j,s as K}from"./chunk-RH4QBYEM.js";import{g as z}from"./chunk-4DYU65FO.js";import{b as U}from"./chunk-CQWUHIOF.js";import{$a as r,$b as A,Ca as T,Fb as D,Hb as V,Q as y,Ta as _,Ua as g,V as C,W as b,Xa as S,Ya as w,Za as u,_a as s,ab as p,ca as R,dc as N,eb as P,ec as $,gb as f,ib as a,nb as k,qb as l,ra as o,rb as d,sb as v,tb as M,xb as I,yb as O,zb as F}from"./chunk-LHYYCVNR.js";import{d as E}from"./chunk-DGAILPFQ.js";var J=(i,t)=>t.id,X=(i,t)=>t.key||t.id;function Y(i,t){if(i&1){let e=P();s(0,"button",19),f("click",function(){C(e);let c=a();return b(c.onCreateRole())}),p(1,"i",20),l(2),r()}if(i&2){let e=a();o(2),v(" ",e.t("roles.create_role")," ")}}function Z(i,t){if(i&1&&(s(0,"div",16)(1,"div",21)(2,"span",22),l(3),r()(),s(4,"p",23),l(5),r()()),i&2){let e=a();o(3),d(e.t("common.loading")),o(2),d(e.t("common.loading"))}}function ee(i,t){if(i&1){let e=P();s(0,"button",27),f("click",function(){C(e);let c=a(2);return b(c.onClearFilters())}),l(1),r()}if(i&2){let e=a(2);o(),v(" ",e.t("common.clear_filters")," ")}}function te(i,t){if(i&1&&(s(0,"div",16),p(1,"i",24),s(2,"p",25),l(3),r(),_(4,ee,2,1,"button",26),r()),i&2){let e=a();o(3),d(e.t("roles.no_roles_found")),o(),g(e.hasActiveFilters()?4:-1)}}function ie(i,t){if(i&1&&p(0,"i",36),i&2){let e=a(3);u("title",e.t("roles.system_role"))}}function ne(i,t){if(i&1&&(s(0,"span",49),l(1),r()),i&2){let e=t.$implicit;o(),d(e.key)}}function oe(i,t){if(i&1&&(s(0,"span",50),l(1),r()),i&2){let e=a(2).$implicit;o(),v("+",e.permissions.length-3," more")}}function re(i,t){if(i&1&&(s(0,"div",37),S(1,ne,2,1,"span",49,X),D(3,"slice"),_(4,oe,2,1,"span",50),r()),i&2){let e=a().$implicit;o(),w(V(3,1,e.permissions,0,3)),o(3),g(e.permissions.length>3?4:-1)}}function se(i,t){if(i&1&&(s(0,"span",25),l(1),r()),i&2){let e=a(3);o(),d(e.t("roles.no_permissions"))}}function le(i,t){if(i&1&&(s(0,"span",39),l(1),r()),i&2){let e=a(3);o(),d(e.t("roles.system"))}}function ae(i,t){if(i&1&&(s(0,"span",40),l(1),r()),i&2){let e=a(3);o(),d(e.t("roles.custom"))}}function ce(i,t){if(i&1){let e=P();s(0,"button",51),f("click",function(){C(e);let c=a().$implicit,m=a(2);return b(m.onEditRole(c))}),p(1,"i",52),r()}if(i&2){let e=a(3);u("title",e.t("common.edit"))}}function de(i,t){if(i&1){let e=P();s(0,"button",53),f("click",function(){C(e);let c=a().$implicit,m=a(2);return b(m.onDeleteRole(c))}),p(1,"i",54),r()}if(i&2){let e=a(3);u("title",e.t("common.delete"))}}function me(i,t){if(i&1&&(s(0,"span",48),p(1,"i",55),r()),i&2){let e=a(3);u("title",e.t("roles.protected_role"))}}function pe(i,t){if(i&1){let e=P();s(0,"tr")(1,"td")(2,"div",31)(3,"div",32)(4,"div",33),p(5,"i",34),r()(),s(6,"div")(7,"div",35),l(8),_(9,ie,1,1,"i",36),r()()()(),s(10,"td"),_(11,re,5,5,"div",37)(12,se,2,1,"span",25),r(),s(13,"td")(14,"span",38),l(15),r()(),s(16,"td"),_(17,le,2,1,"span",39)(18,ae,2,1,"span",40),r(),s(19,"td"),l(20),r(),s(21,"td")(22,"div",41)(23,"button",42),f("click",function(){let c=C(e).$implicit,m=a(2);return b(m.onViewRole(c))}),p(24,"i",43),r(),s(25,"button",44),f("click",function(){let c=C(e).$implicit,m=a(2);return b(m.onManagePermissions(c))}),p(26,"i",45),r(),_(27,ce,2,1,"button",46),_(28,de,2,1,"button",47),_(29,me,2,1,"span",48),r()()()}if(i&2){let e=t.$implicit,n=a(2);o(8),v(" ",e.name," "),o(),g(e.isSystem?9:-1),o(2),g(e.permissions.length>0?11:12),o(4),d(e.userCount),o(2),g(e.isSystem?17:18),o(3),d(n.formatDate(e.createdAtUtc)),o(3),u("title",n.t("common.view")),o(2),k("disabled",!n.canEditRole(e)),u("title",n.t("roles.manage_permissions"))("disabled",!n.canEditRole(e)),o(2),g(n.canEditRole(e)?27:-1),o(),g(n.canDeleteRole(e)?28:-1),o(),g(n.isProtectedRole(e)?29:-1)}}function _e(i,t){if(i&1&&(s(0,"div",17)(1,"table",28)(2,"thead",29)(3,"tr")(4,"th"),l(5),r(),s(6,"th"),l(7),r(),s(8,"th"),l(9),r(),s(10,"th"),l(11),r(),s(12,"th"),l(13),r(),s(14,"th",30),l(15),r()()(),s(16,"tbody"),S(17,pe,30,14,"tr",null,J),r()()()),i&2){let e=a();o(5),d(e.t("roles.name")),o(2),d(e.t("roles.permissions")),o(2),d(e.t("roles.user_count")),o(2),d(e.t("roles.type")),o(2),d(e.t("roles.created_at")),o(2),d(e.t("common.actions")),o(2),w(e.filteredRoles())}}function ge(i,t){if(i&1){let e=P();s(0,"div",71)(1,"div",73)(2,"div",74)(3,"input",75),f("change",function(){let c=C(e).$implicit,m=a(3);return b(m.onTogglePermission(c))}),r(),s(4,"div",76)(5,"div",77),p(6,"i",78),s(7,"label",79)(8,"small"),l(9),r()(),s(10,"span",80),l(11),r()(),s(12,"p",81),l(13),r()()()()()}if(i&2){let e=t.$implicit,n=a(3);o(),k("bg-light",n.isPermissionAssigned(e.id))("loading",n.managingPermissions()),o(2),u("id","permission-"+e.id)("checked",n.isPermissionAssigned(e.id))("disabled",n.managingPermissions()),o(3),u("ngClass",n.getPermissionIcon(e.key)),o(),u("for","permission-"+e.id),o(2),d(n.getPermissionResource(e.key)),o(),u("ngClass",n.getActionBadgeClass(e.key)),o(),v(" ",n.getPermissionAction(e.key)," "),o(2),v(" ",n.getPermissionDescription(e)," ")}}function ue(i,t){if(i&1&&(s(0,"div",16),p(1,"i",82),s(2,"p",68),l(3),r()()),i&2){let e=a(3);o(3),d(e.t("roles.no_permissions_available"))}}function fe(i,t){if(i&1&&(s(0,"div",72)(1,"div",83)(2,"span",22),l(3),r()(),s(4,"p",84),l(5),r()()),i&2){let e=a(3);o(3),d(e.t("common.loading")),o(2),d(e.t("roles.updating_permissions"))}}function xe(i,t){if(i&1&&(s(0,"div",65)(1,"div",31)(2,"div",66)(3,"div",33),p(4,"i",34),r()(),s(5,"div")(6,"h6",67),l(7),r(),s(8,"p",68),l(9),r()()()(),s(10,"div",69)(11,"div",70),S(12,ge,14,13,"div",71,J),r(),_(14,ue,4,1,"div",16),r(),_(15,fe,6,2,"div",72)),i&2){let e=a(2);o(7),d(e.selectedRole().name),o(2),M(" ",e.selectedRole().permissions.length," ",e.t("roles.permissions_assigned")," "),o(3),w(e.allPermissions()),o(2),g(e.allPermissions().length===0?14:-1),o(),g(e.managingPermissions()?15:-1)}}function Ce(i,t){if(i&1){let e=P();s(0,"div",18)(1,"div",56)(2,"div",57)(3,"div",58)(4,"h5",59),p(5,"i",60),l(6),r(),s(7,"button",61),f("click",function(){C(e);let c=a();return b(c.closePermissionsModal())}),r()(),s(8,"div",62),_(9,xe,16,5),r(),s(10,"div",63)(11,"button",64),f("click",function(){C(e);let c=a();return b(c.closePermissionsModal())}),l(12),r()()()()()}if(i&2){let e,n=a();o(6),M(" ",n.t("roles.manage_permissions_for"),": ",(e=n.selectedRole())==null?null:e.name," "),o(3),g(n.selectedRole()?9:-1),o(3),v(" ",n.t("common.close")," ")}}var H=class i{rolesService=y(q);router=y(z);notificationService=y(G);confirmationService=y(W);i18n=y(U);loading=R(!1);roles=R([]);allPermissions=R([]);groupedPermissions=R([]);searchTerm="";showPermissionsModal=R(!1);selectedRole=R(null);managingPermissions=R(!1);ngOnInit(){this.loadRoles(),this.loadPermissions()}t(t){return this.i18n.t(t)}loadRoles(){this.loading.set(!0),this.rolesService.getRoles(!0).subscribe({next:t=>{this.roles.set(t),this.loading.set(!1)},error:t=>{console.error("Failed to load roles:",t),this.loading.set(!1),this.notificationService.error(this.t("app.error"),this.t("errors.server"))}})}loadPermissions(){this.rolesService.getPermissions().subscribe({next:t=>{this.allPermissions.set(t)},error:t=>{console.error("Failed to load permissions:",t),this.notificationService.error(this.t("app.error"),"Failed to load permissions")}}),this.rolesService.getGroupedPermissions().subscribe({next:t=>{this.groupedPermissions.set(t)},error:t=>{console.error("Failed to load grouped permissions:",t),this.notificationService.error(this.t("app.error"),"Failed to load grouped permissions")}})}filteredRoles(){let t=this.roles();if(this.searchTerm){let e=this.searchTerm.toLowerCase();t=t.filter(n=>n.name.toLowerCase().includes(e))}return t}canEditRole(t){let n=["systemadmin","admin"].includes(t.name.toLowerCase());return!t.isSystem&&!n}canDeleteRole(t){let n=["systemadmin","admin"].includes(t.name.toLowerCase());return!t.isSystem&&!n&&t.userCount===0}isProtectedRole(t){return["systemadmin","admin"].includes(t.name.toLowerCase())||t.isSystem}onManagePermissions(t){this.canEditRole(t)&&(this.selectedRole.set(t),this.showPermissionsModal.set(!0))}closePermissionsModal(){this.showPermissionsModal.set(!1),this.selectedRole.set(null)}isPermissionAssigned(t){let e=this.selectedRole();return e?e.permissions.some(n=>n.id===t):!1}onTogglePermission(t){let e=this.selectedRole();if(!e||this.managingPermissions())return;this.managingPermissions.set(!0);let n=this.isPermissionAssigned(t.id);(n?this.rolesService.removePermissionFromRole(e.id,t.id):this.rolesService.assignPermissionToRole(e.id,{permissionId:t.id})).subscribe({next:()=>{let m=this.roles().map(h=>(h.id===e.id&&(n?h.permissions=h.permissions.filter(Q=>Q.id!==t.id):h.permissions=[...h.permissions,t]),h));this.roles.set(m),this.selectedRole.set(m.find(h=>h.id===e.id)||null),this.managingPermissions.set(!1)},error:m=>{console.error("Failed to update permission:",m),this.managingPermissions.set(!1),this.notificationService.error(this.t("app.error"),"Failed to update permission")}})}formatDate(t){return new Date(t).toLocaleDateString(this.i18n.getCurrentLocale(),{year:"numeric",month:"short",day:"numeric"})}onSearchChange(){setTimeout(()=>{},300)}onClearFilters(){this.searchTerm=""}hasActiveFilters(){return!!this.searchTerm}onCreateRole(){this.router.navigate(["/roles/create"])}onViewRole(t){this.router.navigate(["/roles",t.id,"view"])}onEditRole(t){this.canEditRole(t)&&this.router.navigate(["/roles",t.id,"edit"])}onDeleteRole(t){return E(this,null,function*(){if(!this.canDeleteRole(t))return;(yield this.confirmationService.confirm({title:"Delete Role",message:`Are you sure you want to delete the role "${t.name}"? This action cannot be undone.`,confirmText:this.t("common.delete"),cancelText:this.t("common.cancel"),confirmButtonClass:"btn-danger",icon:"fa-trash",iconClass:"text-danger"})).confirmed&&this.rolesService.deleteRole(t.id).subscribe({next:()=>{this.roles.set(this.roles().filter(n=>n.id!==t.id)),this.notificationService.success(this.t("app.success"),"Role deleted successfully")},error:n=>{console.error("Failed to delete role:",n),this.notificationService.error(this.t("app.error"),this.t("errors.server"))}})})}canCreateRoles(){return!0}getPermissionResource(t){return x.getResourceName(x.parsePermissionKey(t).resource)}getPermissionAction(t){let e=x.parsePermissionKey(t).action;return e?x.getActionName(e):"Action"}getActionBadgeClass(t){let e=x.parsePermissionKey(t).action;return e?x.getActionBadgeClass(e):"bg-light text-dark"}getPermissionIcon(t){let e=x.parsePermissionKey(t).resource;return x.getResourceIcon(e)}getPermissionDescription(t){if(t.description)return t.description;let{resource:e,action:n}=x.parsePermissionKey(t.key),c=x.getActionDescription(n),m=x.getResourceDescription(e);return`${c} ${m.toLowerCase()}`}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=T({type:i,selectors:[["app-roles"]],decls:25,vars:8,consts:[[1,"roles-page"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"btn","btn-primary"],[1,"card","mb-4"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-8"],[1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"fa-solid","fa-search"],["type","text",1,"form-control",3,"ngModelChange","input","placeholder","ngModel"],[1,"col-md-4","d-flex","align-items-end"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fa-solid","fa-filter-circle-xmark","me-1"],[1,"card"],[1,"text-center","py-4"],[1,"table-responsive"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background-color","rgba(0,0,0,0.5)"],[1,"btn","btn-primary",3,"click"],[1,"fa-solid","fa-plus","me-2"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2","text-muted"],[1,"fa-solid","fa-user-shield","fa-3x","text-muted","mb-3"],[1,"text-muted"],[1,"btn","btn-outline-primary"],[1,"btn","btn-outline-primary",3,"click"],[1,"table","table-hover"],[1,"table-light"],["width","120"],[1,"d-flex","align-items-center"],[1,"avatar-sm","me-2"],[1,"avatar-title","bg-info-subtle","text-info","rounded-circle"],[1,"fa-solid","fa-user-shield"],[1,"fw-medium"],[1,"fa-solid","fa-shield-alt","text-primary","ms-1",3,"title"],[1,"d-flex","flex-wrap","gap-1"],[1,"badge","bg-primary-subtle","text-primary"],[1,"badge","bg-warning-subtle","text-warning"],[1,"badge","bg-success-subtle","text-success"],["role","group",1,"btn-group"],[1,"btn","btn-sm","btn-outline-primary",3,"click","title"],[1,"fa-solid","fa-eye"],[1,"btn","btn-sm","btn-outline-info",3,"click","title","disabled"],[1,"fa-solid","fa-key"],[1,"btn","btn-sm","btn-outline-warning",3,"title"],[1,"btn","btn-sm","btn-outline-danger",3,"title"],[1,"btn","btn-sm","btn-outline-secondary","disabled",3,"title"],[1,"badge","bg-secondary-subtle","text-secondary","small"],[1,"badge","bg-light","text-dark","small"],[1,"btn","btn-sm","btn-outline-warning",3,"click","title"],[1,"fa-solid","fa-edit"],[1,"btn","btn-sm","btn-outline-danger",3,"click","title"],[1,"fa-solid","fa-trash"],[1,"fa-solid","fa-shield-alt"],[1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"fa-solid","fa-key","me-2"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"role-info","mb-4"],[1,"avatar-md","me-3"],[1,"mb-1"],[1,"text-muted","mb-0"],[1,"permissions-list","border","rounded","p-3",2,"max-height","400px","overflow-y","auto"],[1,"row","g-2"],[1,"col-md-6","col-lg-4"],[1,"text-center","py-3"],[1,"permission-item","border","rounded","p-2"],[1,"form-check","d-flex","align-items-start"],["type","checkbox",1,"form-check-input","mt-1",3,"change","id","checked","disabled"],[1,"form-check-content","ms-2","flex-grow-1"],[1,"d-flex","align-items-center","mb-1"],[1,"fas","me-1","text-muted",2,"font-size","0.75rem",3,"ngClass"],[1,"form-check-label","fw-medium","me-2",3,"for"],[1,"badge",2,"font-size","0.65rem",3,"ngClass"],[1,"text-muted","small","mb-0",2,"font-size","0.7rem","margin-left","1.25rem"],[1,"fa-solid","fa-key","fa-2x","text-muted","mb-2"],["role","status",1,"spinner-border","spinner-border-sm","text-primary"],[1,"text-muted","mt-2","mb-0"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"div",1)(2,"h2"),l(3),r(),_(4,Y,3,1,"button",2),r(),s(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),l(10),r(),s(11,"div",8)(12,"span",9),p(13,"i",10),r(),s(14,"input",11),F("ngModelChange",function(m){return O(n.searchTerm,m)||(n.searchTerm=m),m}),f("input",function(){return n.onSearchChange()}),r()()(),s(15,"div",12)(16,"button",13),f("click",function(){return n.onClearFilters()}),p(17,"i",14),l(18),r()()()()(),s(19,"div",15)(20,"div",4),_(21,Z,6,2,"div",16)(22,te,5,2,"div",16)(23,_e,19,6,"div",17),r()()(),_(24,Ce,13,4,"div",18)),e&2&&(o(3),d(n.t("roles.title")),o(),g(n.canCreateRoles()?4:-1),o(6),d(n.t("common.search")),o(4),u("placeholder",n.t("roles.search_placeholder")),I("ngModel",n.searchTerm),o(4),v(" ",n.t("common.clear")," "),o(3),g(n.loading()?21:n.filteredRoles().length===0?22:23),o(3),g(n.showPermissionsModal()?24:-1))},dependencies:[$,A,K,L,B,j,N],styles:[".roles-page[_ngcontent-%COMP%]{padding:0}.avatar-sm[_ngcontent-%COMP%]{width:2rem;height:2rem;display:flex;align-items:center;justify-content:center}.avatar-md[_ngcontent-%COMP%]{width:3rem;height:3rem;display:flex;align-items:center;justify-content:center}.avatar-title[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1rem;font-weight:500}.permission-item[_ngcontent-%COMP%]{padding:.75rem;border:1px solid #e9ecef;border-radius:.375rem;transition:all .15s ease-in-out;background-color:#fff}.permission-item[_ngcontent-%COMP%]:hover{border-color:#0d6efd;background-color:#f8f9fa;box-shadow:0 2px 4px #0000001a}.permission-item.bg-light[_ngcontent-%COMP%]{background-color:#e3f2fd!important;border-color:#2196f3!important;box-shadow:0 2px 4px #2196f333}.permission-item.loading[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.permission-group[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #e9ecef;border-radius:.5rem;padding:1rem;margin-bottom:1rem}.permission-group[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:#212529;font-weight:600;margin-bottom:1rem}.form-check-content[_ngcontent-%COMP%]{min-width:0}.form-check-label[_ngcontent-%COMP%]{word-break:break-word;color:#000!important;font-weight:600!important;font-size:.9rem!important}.form-check-label[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#000!important;font-weight:600!important;font-size:.9rem!important}.permission-item[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{color:#333!important;font-size:.8rem!important;line-height:1.3!important;font-weight:500!important}.permissions-groups[_ngcontent-%COMP%]   .border[_ngcontent-%COMP%]{border-color:#dee2e6!important}.alert-info[_ngcontent-%COMP%]{background-color:#d1ecf1;border-color:#bee5eb;color:#0c5460;font-weight:500}.bg-purple-subtle[_ngcontent-%COMP%]{background-color:#e9d5ff!important}.text-purple[_ngcontent-%COMP%]{color:#7c3aed!important}.permission-item[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.7rem;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.permission-item[_ngcontent-%COMP%]   .form-check-label[_ngcontent-%COMP%]{font-size:.85rem}.permission-group[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.75rem}.badge.small[_ngcontent-%COMP%]{font-size:.65em}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:disabled, .btn-group[_ngcontent-%COMP%]   .btn.disabled[_ngcontent-%COMP%]{opacity:.4}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.role-info[_ngcontent-%COMP%]{background-color:#f8f9fa;border-radius:.5rem;padding:1rem}"]})};export{H as RolesComponent};
