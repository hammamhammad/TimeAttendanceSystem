import{a as ve}from"./chunk-YK3NS7DC.js";import{a as ge}from"./chunk-IE5XUEO5.js";import{a as he}from"./chunk-C3GHRZ52.js";import{r as de,t as ce,z as me}from"./chunk-YQIE4CGE.js";import{a as pe}from"./chunk-JNFDDMIM.js";import{b as le}from"./chunk-ZURD34HZ.js";import{a as ue}from"./chunk-GEGVYT7O.js";import{a as se}from"./chunk-A6EM5NV6.js";import{A as M,Ca as Y,Da as Z,E as x,Fa as T,Fb as oe,Ga as o,Ha as l,Ia as _,Ja as $,L as n,O as E,Q as k,Va as R,Wa as ee,_a as P,aa as h,ab as I,ba as g,c as W,ca as B,e as V,ea as C,fa as y,fb as S,g as G,ga as f,gb as te,ha as r,ia as i,j as H,ja as v,l as j,qa as O,rb as ne,sa as D,sb as ae,u as q,ua as p,ub as ie,va as Q,wa as X,wb as L,x as J,xb as re,y as K,z as w}from"./chunk-5OFYUWMA.js";import{a as F}from"./chunk-YMDWBF3A.js";var xe=["*"];function Ce(a,t){if(a&1&&(r(0,"div")(1,"div",2)(2,"div",3)(3,"div",4),v(4,"div",5)(5,"div",6)(6,"div",7),i()()()()),a&2){let e=p(2);T(e.getColumnClasses())}}function ye(a,t){if(a&1&&C(0,Ce,7,2,"div",1,B),a&2){let e=p();y(e.getSkeletonItems())}}function Se(a,t){if(a&1){let e=O();r(0,"div")(1,"app-stat-card",8),D("click",function(){let d=w(e).$implicit,c=p(2);return M(c.onCardClick(d))}),i()()}if(a&2){let e=t.$implicit,s=p(2);T(s.getColumnClasses()),n(),Y("cursor",e.route?"pointer":"default"),f("label",e.label)("value",e.value)("icon",e.icon)("variant",e.variant||"primary")("prefix",e.prefix)("suffix",e.suffix)("subtitle",e.subtitle)("change",e.change)("size",s.cardSize)("borderAccent",e.borderAccent??!0)("clickable",!!e.route||(e.clickable??!1))("clickableText",e.clickableText)}}function De(a,t){if(a&1&&C(0,Se,2,16,"div",1,B),a&2){let e=p();y(e.stats)}}function we(a,t){a&1&&(r(0,"div",0)(1,"div",9),v(2,"i",10),r(3,"p",11),o(4,"No statistics available"),i()()())}var z=class a{router=K(oe);stats=[];columns=4;loading=!1;gap="md";cardSize="md";getGridClasses(){let t=["stats-grid","row"];switch(this.gap){case"sm":t.push("g-2");break;case"lg":t.push("g-4");break;default:t.push("g-3")}return t.join(" ")}getColumnClasses(){let t=["stats-grid-item"];switch(this.columns){case 2:t.push("col-md-6");break;case 3:t.push("col-md-4");break;case 4:t.push("col-md-6","col-lg-3");break}return t.join(" ")}getSkeletonItems(){return Array(this.columns).fill(0)}onCardClick(t){t.route&&this.router.navigate(Array.isArray(t.route)?t.route:[t.route])}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=k({type:a,selectors:[["app-stats-grid"]],inputs:{stats:"stats",columns:"columns",loading:"loading",gap:"gap",cardSize:"cardSize"},ngContentSelectors:xe,decls:5,vars:3,consts:[[1,"col-12"],[3,"class"],[1,"card","h-100"],[1,"card-body"],[1,"skeleton-loader"],[1,"skeleton-line","skeleton-title"],[1,"skeleton-line","skeleton-value"],[1,"skeleton-line","skeleton-subtitle"],[3,"click","label","value","icon","variant","prefix","suffix","subtitle","change","size","borderAccent","clickable","clickableText"],[1,"text-center","py-4","text-muted"],[1,"fa-solid","fa-chart-simple","fa-2x","mb-2"],[1,"mb-0"]],template:function(e,s){e&1&&(Q(),r(0,"div"),h(1,ye,2,0)(2,De,2,0)(3,we,5,0,"div",0),X(4),i()),e&2&&(T(s.getGridClasses()),n(),g(s.loading?1:s.stats.length>0?2:3))},dependencies:[ve],styles:[".stats-grid[_ngcontent-%COMP%]{margin-bottom:1.5rem}.stats-grid-item[_ngcontent-%COMP%]{margin-bottom:0}.skeleton-loader[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s ease-in-out infinite}.skeleton-line[_ngcontent-%COMP%]{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0,#f0f0f0 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite;border-radius:4px;margin-bottom:.75rem}.skeleton-title[_ngcontent-%COMP%]{height:14px;width:60%}.skeleton-value[_ngcontent-%COMP%]{height:32px;width:40%}.skeleton-subtitle[_ngcontent-%COMP%]{height:12px;width:50%}@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:-200% 0}to{background-position:200% 0}}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.8}}"]})};var A=class a{constructor(t){this.http=t}apiUrl=`${se.apiUrl}/api/v1/dashboard`;_dashboardData=x(null);_loading=x(!1);_error=x(null);_lastRefresh=x(null);_autoRefresh=x(!1);_refreshInterval=x(30);dashboardData=this._dashboardData.asReadonly();loading=this._loading.asReadonly();error=this._error.asReadonly();lastRefresh=this._lastRefresh.asReadonly();autoRefresh=this._autoRefresh.asReadonly();refreshInterval=this._refreshInterval.asReadonly();dashboardSubject=new W(null);dashboard$=this.dashboardSubject.asObservable();refreshSubscription;getDashboardOverview(t){this._loading.set(!0),this._error.set(null);let e=new L;return t?.branchId&&(e=e.set("branchId",t.branchId.toString())),t?.departmentId&&(e=e.set("departmentId",t.departmentId.toString())),this.http.get(`${this.apiUrl}/overview`,{params:e}).pipe(G(s=>(this._dashboardData.set(s),this._lastRefresh.set(new Date),this._loading.set(!1),this.dashboardSubject.next(s),s)),j(s=>(this._error.set(s.message||"Failed to load dashboard data"),this._loading.set(!1),console.error("Dashboard data loading failed:",s),V({organization:{},humanResources:{},attendance:{},leaves:{},shifts:{},system:{}}))))}getWidgetData(t,e){let s=new L;return e?.branchId&&(s=s.set("branchId",e.branchId.toString())),e?.departmentId&&(s=s.set("departmentId",e.departmentId.toString())),this.http.get(`${this.apiUrl}/widgets/${t}`,{params:s}).pipe(j(d=>(console.error(`Failed to load ${t} widget data:`,d),V(null))))}refreshDashboard(t){this.getDashboardOverview(t).subscribe()}startAutoRefresh(t){t&&this._refreshInterval.set(t),this.stopAutoRefresh(),this._autoRefresh.set(!0),this.refreshSubscription=H(this._refreshInterval()*1e3).subscribe(()=>{this._autoRefresh()&&this.refreshDashboard()})}stopAutoRefresh(){this.refreshSubscription&&(this.refreshSubscription.unsubscribe(),this.refreshSubscription=null),this._autoRefresh.set(!1)}updateRefreshInterval(t){this._refreshInterval.set(t),this._autoRefresh()&&this.startAutoRefresh(t)}clearData(){this._dashboardData.set(null),this._error.set(null),this._lastRefresh.set(null),this.dashboardSubject.next(null)}getTimeSinceLastRefresh(){let t=this._lastRefresh();if(!t)return"Never";let s=new Date().getTime()-t.getTime(),d=Math.floor(s/1e3),c=Math.floor(d/60);return d<60?`${d} seconds ago`:c<60?`${c} minutes ago`:`${Math.floor(c/60)} hours ago`}hasData(){return this._dashboardData()!==null}getCurrentFilters(){return{}}ngOnDestroy(){this.stopAutoRefresh()}static \u0275fac=function(e){return new(e||a)(J(re))};static \u0275prov=q({token:a,factory:a.\u0275fac,providedIn:"root"})};var Oe=a=>({username:a}),N=()=>[],U=(a,t)=>t.id,Pe=(a,t)=>t.employeeId,Ie=(a,t)=>t.roleName,Ee=(a,t)=>t.vacationId,Re=(a,t)=>t.value;function ke(a,t){if(a&1&&(r(0,"small",6),v(1,"i",18),o(2),i()),a&2){let e=p();n(2),$(" ",e.t("dashboard.last_refresh"),": ",e.getTimeSinceLastRefresh()," ")}}function Te(a,t){if(a&1&&(r(0,"option",21),o(1),i()),a&2){let e=t.$implicit;f("value",e.id),n(),l(e.name)}}function ze(a,t){if(a&1){let e=O();r(0,"select",19),D("change",function(d){w(e);let c=p();return M(c.updateFilters({branchId:d.target.value?+d.target.value:void 0}))}),r(1,"option",20),o(2),i(),C(3,Te,2,2,"option",21,U),i()}if(a&2){let e=p();f("value",e.filters().branchId||""),n(2),l(e.t("dashboard.all_branches")),n(),y(e.availableBranches())}}function Ae(a,t){if(a&1&&(r(0,"option",21),o(1),i()),a&2){let e=t.$implicit;f("value",e.id),n(),l(e.name)}}function Ne(a,t){if(a&1){let e=O();r(0,"select",19),D("change",function(d){w(e);let c=p();return M(c.updateFilters({departmentId:d.target.value?+d.target.value:void 0}))}),r(1,"option",20),o(2),i(),C(3,Ae,2,2,"option",21,U),i()}if(a&2){let e=p();f("value",e.filters().departmentId||""),n(2),l(e.t("dashboard.all_departments")),n(),y(e.availableDepartments())}}function Fe(a,t){if(a&1&&(r(0,"div",16)(1,"div",22),v(2,"app-loading-spinner",23),i()()),a&2){let e=p();n(2),f("message",e.t("dashboard.loading_comprehensive"))("variant","primary")("centered",!0)}}function Ve(a,t){if(a&1){let e=O();r(0,"div",17),v(1,"i",24),o(2),r(3,"button",25),D("click",function(){w(e);let d=p();return M(d.refreshData())}),o(4),i()()}if(a&2){let e=p();n(2),_(" ",e.error()," "),n(2),_(" ",e.t("common.retry")," ")}}function je(a,t){if(a&1&&(r(0,"div",52)(1,"span",53),o(2),i(),r(3,"span",54),o(4),i()()),a&2){let e=t.$implicit;n(2),l(e.employeeName),n(2),l(e.status)}}function Be(a,t){if(a&1&&(r(0,"div",50)(1,"h5"),o(2),i(),r(3,"div",51),C(4,je,5,2,"div",52,Pe),i()()),a&2){let e,s=p(3);n(2),l(s.t("dashboard.incomplete_records")),n(2),y(((e=s.dashboardData())==null||e.attendance==null||e.attendance.incompleteRecords==null?null:e.attendance.incompleteRecords.slice(0,5))||R(1,N))}}function $e(a,t){if(a&1&&(r(0,"div",31)(1,"div",38)(2,"h3"),v(3,"i",39),o(4),i(),r(5,"a",40),o(6),v(7,"i",41),i()(),r(8,"div",42)(9,"div",43)(10,"div",44)(11,"span",45),o(12),i(),r(13,"span",46),o(14),i()(),r(15,"div",44)(16,"span",45),o(17),i(),r(18,"span",47),o(19),i()(),r(20,"div",44)(21,"span",45),o(22),i(),r(23,"span",48),o(24),i()(),r(25,"div",44)(26,"span",45),o(27),i(),r(28,"span",49),o(29),P(30,"number"),i()()(),h(31,Be,6,2,"div",50),i()()),a&2){let e,s,d,c,m,u=p(2);n(4),l(u.t("dashboard.attendance_overview")),n(2),_(" ",u.t("common.view_details")||"View Details"," "),n(6),l(u.t("dashboard.present_today")),n(2),l(((e=u.dashboardData())==null?null:e.attendance.todayPresent)||0),n(3),l(u.t("dashboard.absent_today")),n(2),l(((s=u.dashboardData())==null?null:s.attendance.todayAbsent)||0),n(3),l(u.t("dashboard.late_today")),n(2),l(((d=u.dashboardData())==null?null:d.attendance.todayLate)||0),n(3),l(u.t("dashboard.attendance_rate")),n(2),_("",I(30,11,((c=u.dashboardData())==null?null:c.attendance.attendanceRate)||0,"1.1-1"),"%"),n(2),g(!((m=u.dashboardData())==null||m.attendance==null||m.attendance.incompleteRecords==null)&&m.attendance.incompleteRecords.length?31:-1)}}function Le(a,t){if(a&1&&(r(0,"div",61)(1,"span",62),o(2),i(),r(3,"span",63),o(4),i(),r(5,"span",64),o(6),P(7,"number"),i()()),a&2){let e=t.$implicit;n(2),l(e.roleName),n(2),l(e.userCount),n(2),_("(",I(7,3,e.percentage,"1.0-0"),"%)")}}function Ue(a,t){if(a&1&&(r(0,"div",60)(1,"h5"),o(2),i(),C(3,Le,8,6,"div",61,Ie),i()),a&2){let e,s=p(3);n(2),l(s.t("dashboard.role_distribution")),n(),y(((e=s.dashboardData())==null||e.humanResources==null||e.humanResources.roleDistribution==null?null:e.humanResources.roleDistribution.slice(0,4))||R(1,N))}}function We(a,t){if(a&1&&(r(0,"div",32)(1,"div",38)(2,"h3"),v(3,"i",55),o(4),i(),r(5,"a",56),o(6),v(7,"i",41),i()(),r(8,"div",42)(9,"div",57)(10,"div",58)(11,"span",45),o(12),i(),r(13,"span",59),o(14),i()(),r(15,"div",58)(16,"span",45),o(17),i(),r(18,"span",46),o(19),i()(),r(20,"div",58)(21,"span",45),o(22),i(),r(23,"span",59),o(24),i()(),r(25,"div",58)(26,"span",45),o(27),i(),r(28,"span",46),o(29),i()()(),h(30,Ue,5,2,"div",60),i()()),a&2){let e,s,d,c,m,u=p(2);n(4),l(u.t("dashboard.human_resources")),n(2),_(" ",u.t("common.view_details")||"View Details"," "),n(6),l(u.t("dashboard.total_employees")),n(2),l(((e=u.dashboardData())==null?null:e.humanResources.totalEmployees)||0),n(3),l(u.t("dashboard.active_employees")),n(2),l(((s=u.dashboardData())==null?null:s.humanResources.activeEmployees)||0),n(3),l(u.t("dashboard.total_users")),n(2),l(((d=u.dashboardData())==null?null:d.humanResources.totalUsers)||0),n(3),l(u.t("dashboard.active_users")),n(2),l(((c=u.dashboardData())==null?null:c.humanResources.activeUsers)||0),n(),g(!((m=u.dashboardData())==null||m.humanResources==null||m.humanResources.roleDistribution==null)&&m.humanResources.roleDistribution.length?30:-1)}}function Ge(a,t){if(a&1&&(r(0,"div",70)(1,"span",53),o(2),i(),r(3,"span",71),o(4),i(),r(5,"span",72),o(6),P(7,"date"),P(8,"date"),i()()),a&2){let e=t.$implicit;n(2),l(e.employeeName),n(2),l(e.vacationType),n(2),$("",I(7,4,e.startDate,"shortDate")," - ",I(8,7,e.endDate,"shortDate"))}}function He(a,t){if(a&1&&(r(0,"div",69)(1,"h5"),o(2),i(),C(3,Ge,9,10,"div",70,Ee),i()),a&2){let e,s=p(3);n(2),l(s.t("dashboard.upcoming_vacations")),n(),y(((e=s.dashboardData())==null||e.leaves==null||e.leaves.upcomingVacations==null?null:e.leaves.upcomingVacations.slice(0,3))||R(1,N))}}function qe(a,t){if(a&1&&(r(0,"div",33)(1,"div",38)(2,"h3"),v(3,"i",65),o(4),i(),r(5,"a",66),o(6),v(7,"i",41),i()(),r(8,"div",42)(9,"div",67)(10,"div",44)(11,"span",45),o(12),i(),r(13,"span",48),o(14),i()(),r(15,"div",44)(16,"span",45),o(17),i(),r(18,"span",68),o(19),i()(),r(20,"div",44)(21,"span",45),o(22),i(),r(23,"span",46),o(24),i()()(),h(25,He,5,2,"div",69),i()()),a&2){let e,s,d,c,m=p(2);n(4),l(m.t("dashboard.leave_management")),n(2),_(" ",m.t("common.view_details")||"View Details"," "),n(6),l(m.t("dashboard.pending_requests")),n(2),l(((e=m.dashboardData())==null?null:e.leaves.pendingRequests)||0),n(3),l(m.t("dashboard.on_leave_today")),n(2),l(((s=m.dashboardData())==null?null:s.leaves.onLeaveToday)||0),n(3),l(m.t("dashboard.approved_today")),n(2),l(((d=m.dashboardData())==null?null:d.leaves.approvedToday)||0),n(),g(!((c=m.dashboardData())==null||c.leaves==null||c.leaves.upcomingVacations==null)&&c.leaves.upcomingVacations.length?25:-1)}}function Je(a,t){if(a&1&&(r(0,"div",34)(1,"div",73)(2,"h3"),v(3,"i",74),o(4),i()(),r(5,"div",42)(6,"div",75)(7,"div",58)(8,"span",45),o(9),i(),r(10,"span",59),o(11),i()(),r(12,"div",58)(13,"span",45),o(14),i(),r(15,"span",46),o(16),i()(),r(17,"div",58)(18,"span",45),o(19),i(),r(20,"span",59),o(21),i()(),r(22,"div",58)(23,"span",45),o(24),i(),r(25,"span",46),o(26),i()()()()()),a&2){let e,s,d,c,m=p(2);n(4),l(m.t("dashboard.organization_structure")),n(5),l(m.t("dashboard.total_branches")),n(2),l(((e=m.dashboardData())==null?null:e.organization.totalBranches)||0),n(3),l(m.t("dashboard.active_branches")),n(2),l(((s=m.dashboardData())==null?null:s.organization.activeBranches)||0),n(3),l(m.t("dashboard.total_departments")),n(2),l(((d=m.dashboardData())==null?null:d.organization.totalDepartments)||0),n(3),l(m.t("dashboard.active_departments")),n(2),l(((c=m.dashboardData())==null?null:c.organization.activeDepartments)||0)}}function Ke(a,t){if(a&1&&(r(0,"div",35)(1,"div",38)(2,"h3"),v(3,"i",76),o(4),i(),r(5,"a",77),o(6),v(7,"i",41),i()(),r(8,"div",42)(9,"div",78)(10,"div",44)(11,"span",45),o(12),i(),r(13,"span",59),o(14),i()(),r(15,"div",44)(16,"span",45),o(17),i(),r(18,"span",59),o(19),i()(),r(20,"div",44)(21,"span",45),o(22),i(),r(23,"span",46),o(24),i()()()()()),a&2){let e,s,d,c=p(2);n(4),l(c.t("dashboard.shift_management")),n(2),_(" ",c.t("common.view_details")||"View Details"," "),n(6),l(c.t("dashboard.active_shifts")),n(2),l(((e=c.dashboardData())==null?null:e.shifts.activeShifts)||0),n(3),l(c.t("dashboard.total_assignments")),n(2),l(((s=c.dashboardData())==null?null:s.shifts.totalShiftAssignments)||0),n(3),l(c.t("dashboard.today_coverage")),n(2),l(((d=c.dashboardData())==null?null:d.shifts.todayCoverage)||0)}}function Qe(a,t){if(a&1&&(r(0,"div",82)(1,"span",83),o(2),i(),r(3,"span",84),o(4),P(5,"date"),i()()),a&2){let e=t.$implicit;n(2),l(e.description),n(2),l(I(5,2,e.timestamp,"short"))}}function Xe(a,t){if(a&1&&(r(0,"div",81)(1,"h5"),o(2),i(),C(3,Qe,6,5,"div",82,U),i()),a&2){let e,s=p(3);n(2),l(s.t("dashboard.recent_activities")),n(),y(((e=s.dashboardData())==null||e.system==null||e.system.recentActivities==null?null:e.system.recentActivities.slice(0,3))||R(1,N))}}function Ye(a,t){if(a&1&&(r(0,"div",36)(1,"div",73)(2,"h3"),v(3,"i",79),o(4),i()(),r(5,"div",42)(6,"div",80)(7,"div",58)(8,"span",45),o(9),i(),r(10,"span",46),o(11),i()(),r(12,"div",58)(13,"span",45),o(14),i(),r(15,"span",59),o(16),i()(),r(17,"div",58)(18,"span",45),o(19),i(),r(20,"span",68),o(21),i()()(),h(22,Xe,5,2,"div",81),i()()),a&2){let e,s,d,c,m=p(2);n(4),l(m.t("dashboard.system_health")),n(5),l(m.t("dashboard.active_sessions")),n(2),l(((e=m.dashboardData())==null?null:e.system.activeSessions)||0),n(3),l(m.t("dashboard.today_logins")),n(2),l(((s=m.dashboardData())==null?null:s.system.todayLogins)||0),n(3),l(m.t("dashboard.system_uptime")),n(2),l(((d=m.dashboardData())==null?null:d.system.systemUptime)||"N/A"),n(),g(!((c=m.dashboardData())==null||c.system==null||c.system.recentActivities==null)&&c.system.recentActivities.length?22:-1)}}function Ze(a,t){if(a&1&&(r(0,"option",21),o(1),i()),a&2){let e=t.$implicit;f("value",e.value),n(),l(e.label)}}function et(a,t){if(a&1){let e=O();r(0,"div",37)(1,"div",85)(2,"label",86),o(3),i(),r(4,"select",87),D("change",function(d){w(e);let c=p(2);return M(c.updateRefreshInterval(+d.target.value))}),C(5,Ze,2,2,"option",21,Re),i()()()}if(a&2){let e=p(2);n(3),l(e.t("dashboard.refresh_interval")),n(),f("value",e.dashboardService.refreshInterval()),n(),y(e.refreshIntervals)}}function tt(a,t){if(a&1&&(r(0,"div",26)(1,"h2",27),o(2),i(),v(3,"app-stats-grid",28),i(),r(4,"div",29)(5,"div",30),h(6,$e,32,14,"div",31),h(7,We,31,11,"div",32),h(8,qe,26,9,"div",33),h(9,Je,27,9,"div",34),h(10,Ke,25,8,"div",35),h(11,Ye,23,8,"div",36),i()(),h(12,et,7,2,"div",37)),a&2){let e,s,d,c,m,u,b=p();n(2),l(b.t("dashboard.key_metrics")),n(),f("stats",b.dashboardStats())("columns",4)("loading",b.loading()),n(3),g(b.showAttendanceWidget()&&((e=b.dashboardData())!=null&&e.attendance)?6:-1),n(),g(b.showHumanResourcesWidget()&&((s=b.dashboardData())!=null&&s.humanResources)?7:-1),n(),g(b.showVacationWidget()&&((d=b.dashboardData())!=null&&d.leaves)?8:-1),n(),g(b.showOrganizationWidget()&&((c=b.dashboardData())!=null&&c.organization)?9:-1),n(),g(b.showShiftWidget()&&((m=b.dashboardData())!=null&&m.shifts)?10:-1),n(),g(b.showSystemWidget()&&((u=b.dashboardData())!=null&&u.system)?11:-1),n(),g(b.autoRefresh()?12:-1)}}var fe=class a{constructor(t,e,s,d){this.authService=t;this.i18n=e;this.dashboardService=s;this.notificationService=d;this.setupErrorHandling()}currentUser=S(()=>this.authService.currentUser());dashboardData;loading;error;lastRefresh;autoRefresh;dashboardCards=S(()=>{let t=this.dashboardData();return t?[{title:this.t("dashboard.total_employees"),value:t.humanResources?.totalEmployees||0,icon:"fa-solid fa-users",color:"primary",change:this.calculateChange(t.humanResources?.activeEmployees,t.humanResources?.totalEmployees),trend:"up",module:"humanResources",route:"/employees"},{title:this.t("dashboard.today_attendance"),value:t.attendance?.todayPresent||0,icon:"fa-solid fa-calendar-check",color:"success",change:t.attendance?.attendanceRate||0,trend:(t.attendance?.attendanceRate||0)>=90?"up":"down",module:"attendance",route:"/reports/attendance"},{title:this.t("dashboard.pending_vacations"),value:t.leaves?.pendingRequests||0,icon:"fa-solid fa-calendar-times",color:"warning",trend:"stable",module:"leaves",route:"/approvals"},{title:this.t("dashboard.active_shifts"),value:t.shifts?.activeShifts||0,icon:"fa-solid fa-clock",color:"info",trend:"stable",module:"shifts",route:"/shifts"},{title:this.t("dashboard.total_branches"),value:t.organization?.totalBranches||0,icon:"fa-solid fa-code-branch",color:"secondary",trend:"stable",module:"organization",route:"/branches"},{title:this.t("dashboard.active_users"),value:t.humanResources?.activeUsers||0,icon:"fa-solid fa-user-check",color:"primary",trend:"up",module:"humanResources",route:"/users"},{title:this.t("dashboard.today_late"),value:t.attendance?.todayLate||0,icon:"fa-solid fa-exclamation-triangle",color:"danger",trend:(t.attendance?.todayLate||0)>5?"up":"down",module:"attendance",route:"/reports/attendance"},{title:this.t("dashboard.active_sessions"),value:t.system?.activeSessions||0,icon:"fa-solid fa-wifi",color:"info",trend:"stable",module:"system"}]:[]});dashboardStats=S(()=>this.dashboardCards().map(e=>({label:e.title,value:e.value,icon:e.icon,variant:this.mapColorToVariant(e.color),change:e.change!==void 0?{value:Math.abs(e.change),type:e.trend==="up"?"increase":e.trend==="down"?"decrease":"neutral",isPercentage:e.module==="attendance"}:void 0,route:e.route})));filters=x({});availableBranches=x([]);availableDepartments=x([]);showOrganizationWidget=S(()=>this.hasPermission("branch.read")||this.hasPermission("department.read"));showHumanResourcesWidget=S(()=>this.hasPermission("user.read")||this.hasPermission("employee.read"));showAttendanceWidget=S(()=>this.hasPermission("attendance.read"));showVacationWidget=S(()=>this.hasPermission("vacation.read"));showShiftWidget=S(()=>this.hasPermission("shift.read"));showSystemWidget=S(()=>this.isSystemAdmin());refreshIntervals=[{value:15,label:"15 seconds"},{value:30,label:"30 seconds"},{value:60,label:"1 minute"},{value:300,label:"5 minutes"},{value:900,label:"15 minutes"}];ngOnInit(){this.dashboardData=this.dashboardService.dashboardData,this.loading=this.dashboardService.loading,this.error=this.dashboardService.error,this.lastRefresh=this.dashboardService.lastRefresh,this.autoRefresh=this.dashboardService.autoRefresh,this.loadDashboardData(),this.loadFilterOptions()}ngOnDestroy(){this.dashboardService.stopAutoRefresh()}loadDashboardData(){let t=this.filters();this.dashboardService.getDashboardOverview(t).subscribe({next:e=>{e.organization?.branchSummaries&&this.availableBranches.set(e.organization.branchSummaries),e.organization?.departmentSummaries&&this.availableDepartments.set(e.organization.departmentSummaries)},error:e=>{this.notificationService.error(this.t("dashboard.load_error")),console.error("Dashboard load failed:",e)}})}refreshData(){this.dashboardService.refreshDashboard(this.filters()),this.notificationService.success(this.t("dashboard.refreshed"))}updateFilters(t){this.filters.update(e=>F(F({},e),t)),this.loadDashboardData()}toggleAutoRefresh(){this.autoRefresh()?(this.dashboardService.stopAutoRefresh(),this.notificationService.info(this.t("dashboard.auto_refresh_disabled"))):(this.dashboardService.startAutoRefresh(),this.notificationService.info(this.t("dashboard.auto_refresh_enabled")))}updateRefreshInterval(t){this.dashboardService.updateRefreshInterval(t),this.autoRefresh()&&this.notificationService.info(this.t("dashboard.refresh_interval_updated"))}getTimeSinceLastRefresh(){return this.dashboardService.getTimeSinceLastRefresh()}t(t,e){return this.i18n.t(t,e)}getCardColorClass(t){return`card-${t}`}getTrendIcon(t){switch(t){case"up":return"fa-solid fa-arrow-up text-success";case"down":return"fa-solid fa-arrow-down text-danger";default:return"fa-solid fa-minus text-muted"}}calculateChange(t,e){return!t||!e||e===0?0:Math.round(t/e*100)}mapColorToVariant(t){return{primary:"primary",success:"success",warning:"warning",danger:"danger",info:"info",secondary:"secondary"}[t]||"primary"}hasPermission(t){return this.currentUser()?.permissions?.includes(t)||this.isSystemAdmin()}isSystemAdmin(){return this.currentUser()?.roles?.includes("SystemAdmin")||!1}setupErrorHandling(){te(()=>{let t=this.error();t&&this.notificationService.error(t)})}loadFilterOptions(){}exportDashboard(t){this.notificationService.info(this.t("dashboard.export_not_implemented"))}static \u0275fac=function(e){return new(e||a)(E(le),E(ue),E(A),E(pe))};static \u0275cmp=k({type:a,selectors:[["app-dashboard"]],decls:23,vars:16,consts:[[1,"dashboard-container"],[3,"title"],[1,"dashboard-controls","mb-4"],[1,"d-flex","justify-content-between","align-items-start"],[1,"welcome-section"],[1,"dashboard-subtitle","mb-0"],[1,"text-muted"],[1,"controls-section"],[1,"d-flex","align-items-center","gap-3"],[1,"btn","btn-outline-primary","btn-sm",3,"click","disabled"],[1,"fa-solid","fa-refresh"],[1,"form-check","form-switch"],["type","checkbox","id","autoRefreshToggle",1,"form-check-input",3,"change","checked"],["for","autoRefreshToggle",1,"form-check-label"],[1,"d-flex","gap-2"],[1,"form-select","form-select-sm",3,"value"],[1,"loading-overlay"],["role","alert",1,"alert","alert-danger"],[1,"fa-solid","fa-clock","me-1"],[1,"form-select","form-select-sm",3,"change","value"],["value",""],[3,"value"],[1,"loading-content"],[3,"message","variant","centered"],[1,"fa-solid","fa-exclamation-triangle","me-2"],[1,"btn","btn-sm","btn-outline-danger","ms-2",3,"click"],[1,"metrics-section"],[1,"section-title"],[3,"stats","columns","loading"],[1,"widgets-section"],[1,"widgets-grid"],[1,"widget","attendance-widget"],[1,"widget","hr-widget"],[1,"widget","vacation-widget"],[1,"widget","organization-widget"],[1,"widget","shift-widget"],[1,"widget","system-widget"],[1,"auto-refresh-settings"],[1,"widget-header","d-flex","justify-content-between","align-items-center"],[1,"fa-solid","fa-calendar-check","me-2"],["routerLink","/reports/attendance",1,"btn","btn-sm","btn-link","text-decoration-none"],[1,"fa-solid","fa-arrow-right","ms-1"],[1,"widget-content"],[1,"attendance-stats"],[1,"stat-item"],[1,"stat-label"],[1,"stat-value","text-success"],[1,"stat-value","text-danger"],[1,"stat-value","text-warning"],[1,"stat-value","text-primary"],[1,"incomplete-records","mt-3"],[1,"records-list"],[1,"record-item"],[1,"employee-name"],[1,"employee-status","badge","bg-warning"],[1,"fa-solid","fa-users","me-2"],["routerLink","/employees",1,"btn","btn-sm","btn-link","text-decoration-none"],[1,"hr-stats"],[1,"stat-row"],[1,"stat-value"],[1,"role-distribution","mt-3"],[1,"role-item"],[1,"role-name"],[1,"role-count"],[1,"role-percentage"],[1,"fa-solid","fa-calendar-times","me-2"],["routerLink","/approvals",1,"btn","btn-sm","btn-link","text-decoration-none"],[1,"vacation-stats"],[1,"stat-value","text-info"],[1,"upcoming-vacations","mt-3"],[1,"vacation-item"],[1,"vacation-type"],[1,"vacation-dates"],[1,"widget-header"],[1,"fa-solid","fa-sitemap","me-2"],[1,"org-stats"],[1,"fa-solid","fa-clock","me-2"],["routerLink","/shifts",1,"btn","btn-sm","btn-link","text-decoration-none"],[1,"shift-stats"],[1,"fa-solid","fa-server","me-2"],[1,"system-stats"],[1,"recent-activities","mt-3"],[1,"activity-item"],[1,"activity-description"],[1,"activity-time"],[1,"settings-card"],["for","refreshInterval",1,"form-label"],["id","refreshInterval",1,"form-select","form-select-sm",3,"change","value"]],template:function(e,s){if(e&1&&(r(0,"div",0),v(1,"app-page-header",1),r(2,"div",2)(3,"div",3)(4,"div",4)(5,"p",5),o(6),i(),h(7,ke,3,2,"small",6),i(),r(8,"div",7)(9,"div",8)(10,"button",9),D("click",function(){return s.refreshData()}),v(11,"i",10),o(12),i(),r(13,"div",11)(14,"input",12),D("change",function(){return s.toggleAutoRefresh()}),i(),r(15,"label",13),o(16),i()(),r(17,"div",14),h(18,ze,5,2,"select",15),h(19,Ne,5,2,"select",15),i()()()()(),h(20,Fe,3,3,"div",16),h(21,Ve,5,2,"div",17),h(22,tt,13,11),i()),e&2){let d;n(),f("title",s.t("dashboard.title")),n(5),_("",s.t("dashboard.welcome",ee(14,Oe,((d=s.currentUser())==null?null:d.username)||"User"))," "),n(),g(s.lastRefresh()?7:-1),n(3),f("disabled",s.loading()),n(),Z("fa-spin",s.loading()),n(),_(" ",s.t("dashboard.refresh")," "),n(2),f("checked",s.autoRefresh()),n(2),_(" ",s.t("dashboard.auto_refresh")," "),n(2),g(s.availableBranches().length>1?18:-1),n(),g(s.availableDepartments().length>1?19:-1),n(),g(s.loading()?20:-1),n(),g(s.error()&&!s.loading()?21:-1),n(),g(!s.loading()&&!s.error()?22:-1)}},dependencies:[ie,me,de,ce,he,ge,z,ae,ne],styles:['.dashboard-container[_ngcontent-%COMP%]{min-height:calc(100vh - 120px);padding:1.5rem;background-color:var(--bs-light)}.dashboard-header[_ngcontent-%COMP%]{background:#fff;color:var(--bs-dark);border-radius:.5rem;padding:2rem;margin-bottom:2rem;border:1px solid rgba(0,0,0,.125);box-shadow:0 .125rem .25rem #00000013}.header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:1.5rem}.title-section[_ngcontent-%COMP%]{flex:1;min-width:200px}.dashboard-title[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;margin-bottom:.5rem;color:var(--bs-primary)}.dashboard-subtitle[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--bs-secondary);margin-bottom:0}.header-controls[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap;align-items:center}.refresh-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.auto-refresh-toggle[_ngcontent-%COMP%]   .form-check-label[_ngcontent-%COMP%]{color:var(--bs-dark);font-weight:500}.filter-section[_ngcontent-%COMP%]{display:flex;gap:.5rem}.refresh-info[_ngcontent-%COMP%]{margin-top:1rem;padding-top:1rem;border-top:1px solid var(--bs-border-color)}.loading-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#ffffffe6;display:flex;align-items:center;justify-content:center;z-index:1050}.loading-content[_ngcontent-%COMP%]{text-align:center;padding:2rem;background:#fff;border-radius:1rem;box-shadow:0 10px 30px #0000001a}.loading-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--bs-secondary);font-weight:500}.metrics-section[_ngcontent-%COMP%]{margin-bottom:2rem}.section-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--bs-dark);margin-bottom:1.5rem;padding-left:1rem;border-left:4px solid var(--bs-primary)}.metrics-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;margin-bottom:2rem}.metric-card[_ngcontent-%COMP%]{background:#fff;border-radius:.5rem;padding:1.5rem;border:1px solid rgba(0,0,0,.125);box-shadow:0 .125rem .25rem #00000013;transition:box-shadow .15s ease-in-out;position:relative;overflow:hidden}.metric-card[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:4px;background:var(--accent-color, var(--bs-primary))}.metric-card[_ngcontent-%COMP%]:hover{box-shadow:0 .5rem 1rem #00000026}.metric-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.metric-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;color:#fff;background:var(--accent-color, var(--bs-primary))}.trend-indicator[_ngcontent-%COMP%]{font-size:1.2rem}.metric-value[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:var(--bs-dark);line-height:1;margin-bottom:.5rem}.metric-title[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:var(--bs-secondary);text-transform:uppercase;letter-spacing:.5px;margin-bottom:.5rem}.metric-change[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;color:var(--bs-success)}.card-primary[_ngcontent-%COMP%]{--accent-color: var(--bs-primary)}.card-success[_ngcontent-%COMP%]{--accent-color: var(--bs-success)}.card-info[_ngcontent-%COMP%]{--accent-color: var(--bs-info)}.card-warning[_ngcontent-%COMP%]{--accent-color: var(--bs-warning)}.card-danger[_ngcontent-%COMP%]{--accent-color: var(--bs-danger)}.card-secondary[_ngcontent-%COMP%]{--accent-color: var(--bs-secondary)}.widgets-section[_ngcontent-%COMP%]{margin-bottom:2rem}.widgets-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:2rem}.widget[_ngcontent-%COMP%]{background:#fff;border-radius:.5rem;border:1px solid rgba(0,0,0,.125);box-shadow:0 .125rem .25rem #00000013;overflow:hidden;transition:box-shadow .15s ease-in-out}.widget[_ngcontent-%COMP%]:hover{box-shadow:0 .5rem 1rem #00000026}.widget-header[_ngcontent-%COMP%]{background-color:rgba(var(--bs-primary-rgb),.1);border-bottom:1px solid rgba(var(--bs-primary-rgb),.2);padding:1.5rem}.widget-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.2rem;font-weight:600;color:var(--bs-dark)}.widget-content[_ngcontent-%COMP%]{padding:1.5rem}.attendance-stats[_ngcontent-%COMP%], .vacation-stats[_ngcontent-%COMP%], .shift-stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:1rem;margin-bottom:1.5rem}.stat-item[_ngcontent-%COMP%]{text-align:center;padding:1rem;background:#f8f9fa;border-radius:.5rem}.stat-label[_ngcontent-%COMP%]{display:block;font-size:.8rem;font-weight:600;color:var(--bs-secondary);text-transform:uppercase;letter-spacing:.5px;margin-bottom:.5rem}.stat-value[_ngcontent-%COMP%]{display:block;font-size:1.8rem;font-weight:700;color:var(--bs-dark)}.hr-stats[_ngcontent-%COMP%], .org-stats[_ngcontent-%COMP%], .system-stats[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.stat-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;background:#f8f9fa;border-radius:.5rem}.stat-row[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.9rem;font-weight:500;color:var(--bs-dark);text-transform:none;letter-spacing:normal;margin:0}.stat-row[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600}.records-list[_ngcontent-%COMP%], .recent-activities[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto}.record-item[_ngcontent-%COMP%], .activity-item[_ngcontent-%COMP%], .vacation-item[_ngcontent-%COMP%], .role-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;border-bottom:1px solid rgba(0,0,0,.05);gap:1rem}.record-item[_ngcontent-%COMP%]:last-child, .activity-item[_ngcontent-%COMP%]:last-child, .vacation-item[_ngcontent-%COMP%]:last-child, .role-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.employee-name[_ngcontent-%COMP%], .activity-description[_ngcontent-%COMP%], .role-name[_ngcontent-%COMP%]{font-weight:500;color:var(--bs-dark);flex:1}.employee-status[_ngcontent-%COMP%]{font-size:.75rem}.vacation-type[_ngcontent-%COMP%], .vacation-dates[_ngcontent-%COMP%], .activity-time[_ngcontent-%COMP%], .role-percentage[_ngcontent-%COMP%]{font-size:.85rem;color:var(--bs-secondary)}.role-count[_ngcontent-%COMP%]{font-weight:600;color:var(--bs-primary)}.auto-refresh-settings[_ngcontent-%COMP%]{position:fixed;bottom:2rem;right:2rem;z-index:1000}.settings-card[_ngcontent-%COMP%]{background:#fff;border-radius:.5rem;padding:1rem;box-shadow:0 5px 15px #0000001a;border:1px solid rgba(0,0,0,.05);min-width:200px}.settings-card[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;color:var(--bs-dark);margin-bottom:.5rem}@media (max-width: 1200px){.metrics-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(250px,1fr))}.widgets-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(350px,1fr))}}@media (max-width: 768px){.dashboard-container[_ngcontent-%COMP%]{padding:1rem}.dashboard-header[_ngcontent-%COMP%]{padding:1.5rem}.header-content[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.dashboard-title[_ngcontent-%COMP%]{font-size:2rem}.header-controls[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.metrics-grid[_ngcontent-%COMP%], .widgets-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1rem}.metric-card[_ngcontent-%COMP%]{padding:1rem}.metric-value[_ngcontent-%COMP%]{font-size:2rem}.attendance-stats[_ngcontent-%COMP%], .vacation-stats[_ngcontent-%COMP%], .shift-stats[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:.5rem}.stat-item[_ngcontent-%COMP%]{padding:.75rem}.stat-value[_ngcontent-%COMP%]{font-size:1.5rem}.auto-refresh-settings[_ngcontent-%COMP%]{position:relative;bottom:auto;right:auto;margin-top:2rem}}@media (max-width: 480px){.dashboard-title[_ngcontent-%COMP%]{font-size:1.5rem}.header-controls[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.refresh-section[_ngcontent-%COMP%]{justify-content:space-between}.filter-section[_ngcontent-%COMP%]{flex-direction:column}.attendance-stats[_ngcontent-%COMP%], .vacation-stats[_ngcontent-%COMP%], .shift-stats[_ngcontent-%COMP%]{grid-template-columns:1fr}.stat-row[_ngcontent-%COMP%]{flex-direction:column;text-align:center;gap:.5rem}.record-item[_ngcontent-%COMP%], .activity-item[_ngcontent-%COMP%], .vacation-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}}[_ngcontent-%COMP%]:root[dir=rtl]   .section-title[_ngcontent-%COMP%]{padding-right:1rem;padding-left:0;border-right:4px solid var(--bs-primary);border-left:none}[_ngcontent-%COMP%]:root[dir=rtl]   .me-1[_ngcontent-%COMP%]{margin-left:.25rem!important;margin-right:0!important}[_ngcontent-%COMP%]:root[dir=rtl]   .me-2[_ngcontent-%COMP%]{margin-left:.5rem!important;margin-right:0!important}[_ngcontent-%COMP%]:root[dir=rtl]   .ms-2[_ngcontent-%COMP%]{margin-right:.5rem!important;margin-left:0!important}[_ngcontent-%COMP%]:root[dir=rtl]   .auto-refresh-settings[_ngcontent-%COMP%]{right:auto;left:2rem}.metric-card[_ngcontent-%COMP%]:focus, .widget[_ngcontent-%COMP%]:focus{outline:2px solid var(--bs-primary);outline-offset:2px}@media (prefers-reduced-motion: reduce){.metric-card[_ngcontent-%COMP%], .widget[_ngcontent-%COMP%]{animation:none}.metric-card[_ngcontent-%COMP%]:hover, .widget[_ngcontent-%COMP%]:hover{transform:none}.fa-spin[_ngcontent-%COMP%]{animation:none}}']})};export{fe as DashboardComponent};
