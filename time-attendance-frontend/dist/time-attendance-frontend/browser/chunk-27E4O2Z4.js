import{a as Y}from"./chunk-B7JUHE5X.js";import{a as U}from"./chunk-SRPEDAT4.js";import{c as E,d as k,e as O,f as W,i as I,m as F,n as N,v as T,w as V,y as z}from"./chunk-VRETN7JA.js";import{a as L}from"./chunk-UBCI4X5Q.js";import{a as A}from"./chunk-EYAJMHM7.js";import{a as G}from"./chunk-HHXRLUSQ.js";import{b as S}from"./chunk-UWVH5K3J.js";import{b as B}from"./chunk-RUY4WPQA.js";import{d as q,g as P}from"./chunk-TWXUAMJ4.js";import{Bb as a,Db as c,Ea as D,Eb as w,Lb as R,R as d,W as h,X as x,Xa as p,Ya as u,bb as f,cb as i,da as v,db as s,eb as g,lb as y,nb as b,pb as m,ta as r,wc as M,yb as C}from"./chunk-JSQL33QG.js";import"./chunk-DGAILPFQ.js";function H(n,o){if(n&1&&g(0,"app-loading-spinner",0),n&2){let e=m();f("message",e.i18n.t("common.loading"))}}function J(n,o){if(n&1&&(i(0,"div",12),a(1),s()),n&2){let e=m(2);r(),c(" ",e.getErrorMessage("startDate")," ")}}function K(n,o){if(n&1&&(i(0,"div",12),a(1),s()),n&2){let e=m(2);r(),c(" ",e.getErrorMessage("endDate")," ")}}function Q(n,o){if(n&1&&(i(0,"div",15)(1,"div",26),g(2,"i",27),i(3,"strong"),a(4),s(),a(5),i(6,"span",28),a(7),s()()()),n&2){let e=m(2);r(4),c("",e.i18n.t("portal.working_days"),":"),r(),w(" ",e.calculatedDays()," ",e.calculatedDays()===1?e.i18n.t("common.day"):e.i18n.t("common.days")," "),r(2),c("(",e.i18n.t("portal.weekdays_only"),")")}}function X(n,o){if(n&1&&(i(0,"div",12),a(1),s()),n&2){let e=m(2);r(),c(" ",e.getErrorMessage("reason")," ")}}function Z(n,o){n&1&&g(0,"span",24)}function $(n,o){if(n&1){let e=y();i(0,"div",1)(1,"app-page-header",2)(2,"div",3)(3,"button",4),b("click",function(){h(e);let l=m();return x(l.onCancel())}),g(4,"i",5),a(5),s()()(),i(6,"form",6),b("ngSubmit",function(){h(e);let l=m();return x(l.onSubmit())}),i(7,"app-form-section",2)(8,"div",7)(9,"div",8)(10,"label",9),a(11),i(12,"span",10),a(13,"*"),s()(),g(14,"input",11),p(15,J,2,1,"div",12),s(),i(16,"div",8)(17,"label",13),a(18),i(19,"span",10),a(20,"*"),s()(),g(21,"input",14),p(22,K,2,1,"div",12),s(),p(23,Q,8,4,"div",15),i(24,"div",15)(25,"label",16),a(26),i(27,"span",17),a(28),s()(),i(29,"textarea",18),a(30,"            "),s(),i(31,"div",19),a(32),s(),p(33,X,2,1,"div",12),s()()(),i(34,"div",20),g(35,"i",21),a(36),s(),i(37,"div",22)(38,"button",23),p(39,Z,1,0,"span",24),a(40),s(),i(41,"button",25),b("click",function(){h(e);let l=m();return x(l.onCancel())}),a(42),s()()()()}if(n&2){let e,t=m();r(),f("title",t.isEditMode()?t.i18n.t("portal.edit_remote_work"):t.i18n.t("portal.new_remote_work")),r(4),c(" ",t.i18n.t("common.back")," "),r(),f("formGroup",t.form),r(),f("title",t.i18n.t("portal.remote_work_details")),r(4),c(" ",t.i18n.t("portal.start_date")," "),r(3),C("is-invalid",t.hasError("startDate","required")),r(),u(t.hasError("startDate","required")?15:-1),r(3),c(" ",t.i18n.t("portal.end_date")," "),r(3),C("is-invalid",t.hasError("endDate","required")),r(),u(t.hasError("endDate","required")?22:-1),r(),u(t.calculatedDays()>0?23:-1),r(3),c(" ",t.i18n.t("portal.reason")," "),r(2),c("(",t.i18n.t("common.optional"),")"),r(),C("is-invalid",t.hasError("reason","maxlength")),f("placeholder",R(t.i18n.t("portal.remote_work_reason_placeholder"))),r(3),c(" ",((e=t.form.get("reason"))==null||e.value==null?null:e.value.length)||0," / 500 characters "),r(),u(t.hasError("reason","maxlength")?33:-1),r(3),c(" ",t.i18n.t("portal.remote_work_form_info")," "),r(2),f("disabled",t.saving()||t.form.invalid),r(),u(t.saving()?39:-1),r(),c(" ",t.isEditMode()?t.i18n.t("common.update"):t.i18n.t("common.submit")," "),r(),f("disabled",t.saving()),r(),c(" ",t.i18n.t("common.cancel")," ")}}var j=class n{i18n=d(B);fb=d(V);router=d(P);route=d(q);remoteWorkService=d(Y);authService=d(S);notificationService=d(G);loading=v(!1);saving=v(!1);isEditMode=v(!1);currentRequest=v(null);calculatedDays=v(0);form;constructor(){this.form=this.createForm()}ngOnInit(){this.checkEditMode(),this.setupDateWatcher()}createForm(){return this.fb.group({startDate:["",[k.required]],endDate:["",[k.required]],reason:["",[k.maxLength(500)]]})}setupDateWatcher(){this.form.get("startDate")?.valueChanges.subscribe(()=>this.calculateWorkingDays()),this.form.get("endDate")?.valueChanges.subscribe(()=>this.calculateWorkingDays())}calculateWorkingDays(){let o=this.form.get("startDate")?.value,e=this.form.get("endDate")?.value;if(o&&e){let t=new Date(o),l=new Date(e);if(l>=t){let _=this.getWorkingDaysBetween(t,l);this.calculatedDays.set(_)}else this.calculatedDays.set(0)}else this.calculatedDays.set(0)}getWorkingDaysBetween(o,e){let t=0,l=new Date(o);for(;l<=e;){let _=l.getDay();_!==0&&_!==6&&t++,l.setDate(l.getDate()+1)}return t}checkEditMode(){let o=this.route.snapshot.paramMap.get("id");o&&o!=="new"&&(this.isEditMode.set(!0),this.loadRequest(+o))}loadRequest(o){this.loading.set(!0),this.remoteWorkService.getById(o).subscribe({next:e=>{this.currentRequest.set(e),this.populateForm(e),this.loading.set(!1)},error:e=>{console.error("Failed to load remote work request:",e),this.notificationService.error(this.i18n.t("portal.failed_to_load_remote_work")),this.loading.set(!1),this.router.navigate(["/portal/remote-work-requests"])}})}populateForm(o){let e=new Date(o.startDate).toISOString().split("T")[0],t=new Date(o.endDate).toISOString().split("T")[0];this.form.patchValue({startDate:e,endDate:t,reason:o.reason||""}),this.calculateWorkingDays()}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched(),this.notificationService.error(this.i18n.t("common.form_validation_error"));return}let o=new Date(this.form.value.startDate);if(new Date(this.form.value.endDate)<o){this.notificationService.error(this.i18n.t("portal.end_date_before_start_date"));return}this.isEditMode()?this.updateRequest():this.createRequest()}createRequest(){this.saving.set(!0);let o=this.authService.currentUser();if(!o||!o.employeeId||!o.id){this.notificationService.error(this.i18n.t("portal.employee_not_found")),this.saving.set(!1);return}let e=this.form.value,t={employeeId:o.employeeId,startDate:e.startDate,endDate:e.endDate,reason:e.reason,createdByUserId:o.id,status:0};this.remoteWorkService.create(t).subscribe({next:()=>{this.notificationService.success(this.i18n.t("portal.remote_work_created")),this.router.navigate(["/portal/remote-work-requests"])},error:l=>{console.error("Failed to create remote work request:",l),this.notificationService.error(this.i18n.t("portal.failed_to_create_remote_work")),this.saving.set(!1)}})}updateRequest(){let o=this.currentRequest();if(!o)return;this.saving.set(!0);let e=this.form.value,t={startDate:e.startDate,endDate:e.endDate,reason:e.reason,status:o.status};this.remoteWorkService.update(o.id,t).subscribe({next:()=>{this.notificationService.success(this.i18n.t("portal.remote_work_updated")),this.router.navigate(["/portal/remote-work-requests"])},error:l=>{console.error("Failed to update remote work request:",l),this.notificationService.error(this.i18n.t("portal.failed_to_update_remote_work")),this.saving.set(!1)}})}onCancel(){this.router.navigate(["/portal/remote-work-requests"])}hasError(o,e){let t=this.form.get(o);return!!(t&&t.hasError(e)&&(t.dirty||t.touched))}getErrorMessage(o){let e=this.form.get(o);if(!e||!e.errors)return"";if(e.hasError("required"))return this.i18n.t("common.field_required");if(e.hasError("maxlength")){let t=e.errors.maxlength.requiredLength;return this.i18n.t("common.field_max_length",{max:t})}return""}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=D({type:n,selectors:[["app-portal-remote-work-request-form"]],decls:2,vars:2,consts:[[3,"message"],[1,"remote-work-request-form"],[3,"title"],["header-actions",""],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"fa-solid","fa-arrow-left","me-1"],[1,"mt-4",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-md-6","mb-3"],["for","startDate",1,"form-label"],[1,"text-danger"],["type","date","id","startDate","formControlName","startDate",1,"form-control"],[1,"invalid-feedback"],["for","endDate",1,"form-label"],["type","date","id","endDate","formControlName","endDate",1,"form-control"],[1,"col-12","mb-3"],["for","reason",1,"form-label"],[1,"text-muted"],["id","reason","formControlName","reason","rows","4","maxlength","500",1,"form-control",3,"placeholder"],[1,"form-text"],[1,"alert","alert-info","mt-3"],[1,"fa-solid","fa-info-circle","me-2"],[1,"form-actions","mt-4"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],["type","button",1,"btn","btn-outline-secondary","ms-2",3,"click","disabled"],[1,"alert","alert-info"],[1,"fa-solid","fa-calendar-days","me-2"],[1,"text-muted","ms-2"]],template:function(e,t){e&1&&(p(0,H,1,1,"app-loading-spinner",0),p(1,$,43,27,"div",1)),e&2&&(u(t.loading()?0:-1),r(),u(t.loading()?-1:1))},dependencies:[M,z,I,E,O,W,T,F,N,L,U,A],styles:[`.remote-work-request-form[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:1.5rem}.form-label[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.5rem;color:var(--bs-body-color)}.form-label[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{margin-left:.25rem}.form-label[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{font-weight:400;font-size:.875rem}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:.375rem;border:1px solid var(--bs-border-color)}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:var(--bs-primary);box-shadow:0 0 0 .25rem #0d6efd40}textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:100px}.alert-info[_ngcontent-%COMP%]{background-color:#0dcaf01a;border-color:#0dcaf033;color:#055160;display:flex;align-items:center}.alert-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem;flex-shrink:0}.form-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;padding-top:1.5rem;border-top:1px solid var(--bs-border-color)}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:120px}.invalid-feedback[_ngcontent-%COMP%]{display:block;margin-top:.25rem;font-size:.875rem}.form-control.is-invalid[_ngcontent-%COMP%]{border-color:var(--bs-danger);padding-right:calc(1.5em + .75rem);background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right calc(.375em + .1875rem) center;background-size:calc(.75em + .375rem) calc(.75em + .375rem)}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem;border-width:.15em}@media (max-width: 768px){.remote-work-request-form[_ngcontent-%COMP%]{padding:1rem}.form-actions[_ngcontent-%COMP%]{flex-direction:column}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}.form-text[_ngcontent-%COMP%]{font-size:.875rem;color:var(--bs-secondary);margin-top:.25rem}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.remote-work-request-form[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 8px #00000026;transition:all .2s ease}.btn-outline-secondary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);transition:all .2s ease}input[type=date][_ngcontent-%COMP%]{position:relative}input[type=date][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator{cursor:pointer;opacity:.6}input[type=date][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator:hover{opacity:1}`]})};export{j as PortalRemoteWorkRequestFormComponent};
