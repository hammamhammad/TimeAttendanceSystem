import{a as J}from"./chunk-BUDDO7QI.js";import{c as u}from"./chunk-65M2O2LF.js";import{a as $}from"./chunk-LK2JNJQF.js";import{b as j,d as L,e as z,f as B,g as q,h as W,q as K,s as U}from"./chunk-RH4QBYEM.js";import{g as D,h as A,m as G}from"./chunk-4DYU65FO.js";import{b as H}from"./chunk-CQWUHIOF.js";import{$a as o,$b as V,Ca as I,Q as x,Ta as h,Ua as P,V as b,W as _,Xa as y,Ya as S,Za as g,_a as r,ab as m,ca as v,eb as M,ec as N,gb as C,ib as p,nb as O,qb as a,ra as i,rb as f,sb as d,ub as T,xb as k,yb as w,zb as R}from"./chunk-LHYYCVNR.js";import{a as F,b as E}from"./chunk-DGAILPFQ.js";var Y=(s,t)=>t.group,Z=(s,t)=>t.id;function ee(s,t){if(s&1&&(r(0,"div",10)(1,"div",12)(2,"span",13),a(3),o()()()),s&2){let e=p();i(3),f(e.t("common.loading"))}}function te(s,t){if(s&1&&(r(0,"div",18),m(1,"i",49),a(2),o()),s&2){let e=p(2);i(2),d(" ",e.error()," ")}}function ie(s,t){if(s&1){let e=M();r(0,"div",53)(1,"div",54)(2,"div",55)(3,"input",56),C("change",function(){let l=b(e).$implicit,c=p(3);return _(c.onTogglePermissionForRole(l))}),o(),r(4,"div",57)(5,"div",58),m(6,"i",59),r(7,"label",60)(8,"small"),a(9),o()(),r(10,"span",61),a(11),o()(),r(12,"p",62),a(13),o()()()()()}if(s&2){let e=t.$implicit,n=p(3);i(),O("bg-primary-subtle",n.isPermissionSelectedForRole(e.id))("border-primary",n.isPermissionSelectedForRole(e.id)),i(2),g("id","permission-"+e.id)("checked",n.isPermissionSelectedForRole(e.id))("disabled",n.submitting()),i(3),g("ngClass",n.getPermissionIcon(e.key)),i(),g("for","permission-"+e.id),i(2),f(n.getPermissionResource(e.key)),i(),g("ngClass",n.getActionBadgeClass(e.key)),i(),d(" ",n.getPermissionAction(e.key)," "),i(2),d(" ",n.getPermissionDescription(e)," ")}}function ne(s,t){if(s&1&&(r(0,"div",42)(1,"h6",50),m(2,"i",51),a(3),r(4,"small",52),a(5),o()(),r(6,"div",23),y(7,ie,14,13,"div",53,Z),o()()),s&2){let e=t.$implicit;i(3),d(" ",e.group," "),i(2),d("(",e.permissions.length," permissions)"),i(2),S(e.permissions)}}function re(s,t){if(s&1&&(r(0,"div",43),m(1,"i",63),r(2,"p",64),a(3),o()()),s&2){let e=p(2);i(3),f(e.t("roles.no_permissions_available"))}}function oe(s,t){s&1&&m(0,"div",47)}function se(s,t){s&1&&m(0,"i",48)}function ae(s,t){if(s&1){let e=M();r(0,"div",11)(1,"div",14)(2,"h5",15),m(3,"i",16),a(4),o()(),r(5,"div",17),h(6,te,3,1,"div",18),r(7,"form",19),C("ngSubmit",function(){b(e);let l=p();return _(l.onSubmit())}),r(8,"div",20)(9,"h6",21),m(10,"i",22),a(11),o(),r(12,"div",23)(13,"div",24)(14,"label",25),a(15),r(16,"span",26),a(17,"*"),o()(),r(18,"input",27),R("ngModelChange",function(l){b(e);let c=p();return w(c.roleForm.name,l)||(c.roleForm.name=l),_(l)}),o()()()(),m(19,"hr"),r(20,"div",20)(21,"div",28)(22,"h6",29),m(23,"i",30),a(24),o(),r(25,"div",31)(26,"button",32),C("click",function(){b(e);let l=p();return _(l.selectAllPermissions())}),m(27,"i",33),a(28),o(),r(29,"button",8),C("click",function(){b(e);let l=p();return _(l.clearAllPermissions())}),m(30,"i",34),a(31),o()()(),r(32,"div",35)(33,"small"),m(34,"i",22),a(35),o()(),r(36,"div",36)(37,"div",37)(38,"span",38),m(39,"i",39),o(),r(40,"input",40),R("ngModelChange",function(l){b(e);let c=p();return w(c.permissionSearchTerm,l)||(c.permissionSearchTerm=l),_(l)}),o()()(),r(41,"div",41),y(42,ne,9,2,"div",42,Y),h(44,re,4,1,"div",43),o()(),r(45,"div",44)(46,"button",8),C("click",function(){b(e);let l=p();return _(l.onCancel())}),m(47,"i",45),a(48),o(),r(49,"button",46),h(50,oe,1,0,"div",47)(51,se,1,0,"i",48),a(52),o()()()()()}if(s&2){let e=p();i(4),d(" ",e.t("roles.role_information")," "),i(2),P(e.error()?6:-1),i(5),d(" ",e.t("roles.basic_information")," "),i(4),d(" ",e.t("roles.role_name")," "),i(3),k("ngModel",e.roleForm.name),g("placeholder",e.t("roles.role_name_placeholder"))("disabled",e.submitting()),i(6),d(" ",e.t("roles.select_permissions")," "),i(2),g("disabled",e.submitting()),i(2),d(" ",e.t("roles.select_all")," "),i(),g("disabled",e.submitting()),i(2),d(" ",e.t("roles.clear_all")," "),i(4),T(" ",e.roleForm.selectedPermissions.size," ",e.t("roles.permissions_selected")," ",e.t("common.of")," ",e.allPermissions().length," "),i(5),k("ngModel",e.permissionSearchTerm),g("placeholder",e.t("roles.search_permissions_placeholder"))("disabled",e.submitting()),i(2),S(e.getFilteredGroupedPermissions()),i(2),P(e.getFilteredGroupedPermissions().length===0?44:-1),i(2),g("disabled",e.submitting()),i(2),d(" ",e.t("common.cancel")," "),i(),g("disabled",!e.roleForm.name.trim()||e.submitting()),i(),P(e.submitting()?50:51),i(2),d(" ",e.submitting()?e.t("roles.creating_role"):e.t("roles.create_role")," ")}}var Q=class s{rolesService=x(J);router=x(D);notificationService=x($);i18n=x(H);loading=v(!1);submitting=v(!1);error=v(null);allPermissions=v([]);groupedPermissions=v([]);roleForm={name:"",selectedPermissions:new Set};permissionSearchTerm="";ngOnInit(){this.loadPermissions()}t(t){return this.i18n.t(t)}loadPermissions(){this.loading.set(!0),this.rolesService.getPermissions().subscribe({next:t=>{this.allPermissions.set(t),this.groupedPermissions.set(this.groupPermissionsByGroup(t)),this.loading.set(!1)},error:t=>{console.error("Failed to load permissions:",t),this.error.set(this.t("roles.failed_to_load_permissions")),this.loading.set(!1),this.notificationService.error(this.t("app.error"),"Failed to load permissions")}})}groupPermissionsByGroup(t){let e=t.reduce((n,l)=>{let c=l.group||"General";return n[c]||(n[c]=[]),n[c].push(l),n},{});return Object.entries(e).map(([n,l])=>({group:n,permissions:l.sort((c,X)=>c.key.localeCompare(X.key))}))}onSubmit(){if(!this.roleForm.name.trim()){this.error.set(this.t("roles.role_name_required"));return}this.submitting.set(!0),this.error.set(null);let t={name:this.roleForm.name.trim(),permissionIds:Array.from(this.roleForm.selectedPermissions)};this.rolesService.createRole(t).subscribe({next:()=>{this.notificationService.success(this.t("app.success"),"Role created successfully"),this.router.navigate(["/roles"])},error:e=>{console.error("Failed to create role:",e),this.error.set(this.getErrorMessage(e)),this.submitting.set(!1),this.notificationService.error(this.t("app.error"),this.getErrorMessage(e))}})}onCancel(){this.router.navigate(["/roles"])}onTogglePermissionForRole(t){this.roleForm.selectedPermissions.has(t.id)?this.roleForm.selectedPermissions.delete(t.id):this.roleForm.selectedPermissions.add(t.id)}isPermissionSelectedForRole(t){return this.roleForm.selectedPermissions.has(t)}selectAllPermissions(){this.allPermissions().forEach(t=>{this.roleForm.selectedPermissions.add(t.id)})}clearAllPermissions(){this.roleForm.selectedPermissions.clear()}getFilteredGroupedPermissions(){if(!this.permissionSearchTerm.trim())return this.groupedPermissions();let t=this.permissionSearchTerm.toLowerCase();return this.groupedPermissions().map(e=>E(F({},e),{permissions:e.permissions.filter(n=>n.key.toLowerCase().includes(t)||n.description&&n.description.toLowerCase().includes(t))})).filter(e=>e.permissions.length>0)}getPermissionIcon(t){let{resource:e}=u.parsePermissionKey(t);return u.getResourceIcon(e)}getPermissionResource(t){let{resource:e}=u.parsePermissionKey(t);return u.getResourceName(e)}getPermissionAction(t){let{action:e}=u.parsePermissionKey(t);return u.getActionName(e)}getActionBadgeClass(t){let{action:e}=u.parsePermissionKey(t);return u.getActionBadgeClass(e)}getPermissionDescription(t){return t.description||this.t("roles.no_description")}getErrorMessage(t){return t?.error?.error?t.error.error:t?.error?.message?t.error.message:this.t("roles.failed_to_create_role")}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=I({type:s,selectors:[["app-create-role"]],decls:20,vars:7,consts:[[1,"container-fluid"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/dashboard"],["routerLink","/roles"],[1,"breadcrumb-item","active"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"fa-solid","fa-arrow-left","me-2"],[1,"d-flex","justify-content-center","py-5"],[1,"card"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"card-header"],[1,"card-title","mb-0"],[1,"fa-solid","fa-user-shield","me-2"],[1,"card-body"],["role","alert",1,"alert","alert-danger"],[3,"ngSubmit"],[1,"mb-4"],[1,"text-primary","mb-3"],[1,"fa-solid","fa-info-circle","me-2"],[1,"row","g-3"],[1,"col-md-6"],[1,"form-label"],[1,"text-danger"],["type","text","name","roleName","required","",1,"form-control",3,"ngModelChange","ngModel","placeholder","disabled"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"mb-0"],[1,"fa-solid","fa-key","me-2","text-primary"],["role","group",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],[1,"fa-solid","fa-check-double","me-1"],[1,"fa-solid","fa-times","me-1"],[1,"alert","alert-info","py-2","px-3","mb-3"],[1,"mb-3"],[1,"input-group"],[1,"input-group-text"],[1,"fa-solid","fa-search"],["type","text","name","permissionSearch",1,"form-control",3,"ngModelChange","ngModel","placeholder","disabled"],[1,"permissions-list","border","rounded","p-3",2,"max-height","500px","overflow-y","auto"],[1,"permission-group","mb-4"],[1,"text-center","py-4"],[1,"d-flex","justify-content-end","gap-2"],[1,"fa-solid","fa-times","me-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"fa-solid","fa-save","me-2"],[1,"fa-solid","fa-exclamation-triangle","me-2"],[1,"fw-bold","text-primary","mb-3","border-bottom","pb-2"],[1,"fas","fa-layer-group","me-2"],[1,"text-muted","fw-normal"],[1,"col-md-6","col-lg-4"],[1,"permission-item","border","rounded","p-3"],[1,"form-check","d-flex","align-items-start"],["type","checkbox",1,"form-check-input","mt-1",3,"change","id","checked","disabled"],[1,"form-check-content","ms-2","flex-grow-1"],[1,"d-flex","align-items-center","mb-1"],[1,"fas","me-2","text-muted",2,"font-size","0.8rem",3,"ngClass"],[1,"form-check-label","fw-medium","me-2",3,"for"],[1,"badge",2,"font-size","0.65rem",3,"ngClass"],[1,"text-muted","small","mb-0",2,"font-size","0.75rem","margin-left","1.5rem"],[1,"fa-solid","fa-key","fa-2x","text-muted","mb-2"],[1,"text-muted","mb-0"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1)(2,"div")(3,"h2"),a(4),o(),r(5,"nav",2)(6,"ol",3)(7,"li",4)(8,"a",5),a(9),o()(),r(10,"li",4)(11,"a",6),a(12),o()(),r(13,"li",7),a(14),o()()()(),r(15,"button",8),C("click",function(){return n.onCancel()}),m(16,"i",9),a(17),o()(),h(18,ee,4,1,"div",10)(19,ae,53,25,"div",11),o()),e&2&&(i(4),f(n.t("roles.create_role")),i(5),f(n.t("dashboard.title")),i(3),f(n.t("roles.title")),i(2),f(n.t("roles.create_role")),i(),g("disabled",n.submitting()),i(2),d(" ",n.t("common.back")," "),i(),P(n.loading()?18:19))},dependencies:[N,V,U,W,j,L,z,K,q,B,G,A],styles:['.permission-item[_ngcontent-%COMP%]{transition:all .2s ease-in-out;cursor:pointer}.permission-item[_ngcontent-%COMP%]:hover{box-shadow:0 2px 4px #0000001a}.permission-item.bg-primary-subtle[_ngcontent-%COMP%]{background-color:var(--bs-primary-bg-subtle)!important}.permission-item.border-primary[_ngcontent-%COMP%]{border-color:var(--bs-primary)!important}.permissions-list[_ngcontent-%COMP%]{background-color:var(--bs-light)}.permission-group[_ngcontent-%COMP%]:last-child{margin-bottom:0!important}.form-check-input[_ngcontent-%COMP%]:checked{background-color:var(--bs-primary);border-color:var(--bs-primary)}.badge[_ngcontent-%COMP%]{font-size:.7rem}.avatar-sm[_ngcontent-%COMP%]{width:2rem;height:2rem;display:flex;align-items:center;justify-content:center}.avatar-title[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:.875rem}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{font-size:.875rem;padding:.25rem .5rem}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}.breadcrumb[_ngcontent-%COMP%]{margin-bottom:0}.breadcrumb-item[_ngcontent-%COMP%] + .breadcrumb-item[_ngcontent-%COMP%]:before{content:">";color:var(--bs-secondary)}.card-header[_ngcontent-%COMP%]{background-color:var(--bs-light);border-bottom:1px solid var(--bs-border-color)}.alert-info[_ngcontent-%COMP%]{background-color:var(--bs-info-bg-subtle);border-color:var(--bs-info-border-subtle);color:var(--bs-info-text-emphasis)}.text-primary[_ngcontent-%COMP%]{color:var(--bs-primary)!important}.btn-outline-primary[_ngcontent-%COMP%]:hover{background-color:var(--bs-primary);border-color:var(--bs-primary)}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background-color:var(--bs-secondary);border-color:var(--bs-secondary)}@media (max-width: 768px){.col-md-6[_ngcontent-%COMP%], .col-lg-4[_ngcontent-%COMP%]{margin-bottom:.75rem}.permission-item[_ngcontent-%COMP%]{padding:1rem}.btn-group-sm[_ngcontent-%COMP%]{flex-direction:column;width:100%}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-bottom:.25rem}}']})};export{Q as CreateRoleComponent};
