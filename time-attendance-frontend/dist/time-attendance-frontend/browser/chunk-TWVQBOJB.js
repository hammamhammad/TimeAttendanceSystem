import{a as U}from"./chunk-5EWIY6BL.js";import{a as D,b as k,c as g,d as w,e as A,h as N,i as T,k as z,l as L,m as q,n as G,o as V,p as R,r as j,t as B}from"./chunk-RH4QBYEM.js";import{b as H}from"./chunk-CQWUHIOF.js";import{$a as i,Ca as M,Ga as p,Ia as C,Q as u,Za as m,_a as r,ab as c,ac as F,bc as E,ca as h,ea as P,ec as S,gb as _,ib as f,nb as v,qb as a,ra as t,rb as s,sb as d,tb as y}from"./chunk-LHYYCVNR.js";import{a as x,b as I,d as O}from"./chunk-DGAILPFQ.js";function $(o,l){if(o&1&&(r(0,"div",40),a(1),i()),o&2){let n=f();t(),d(" ",n.getFieldError("name")," ")}}function J(o,l){if(o&1&&(r(0,"div",40),a(1),i()),o&2){let n=f();t(),d(" ",n.getFieldError("nameAr")," ")}}function K(o,l){if(o&1&&(r(0,"div",40),a(1),i()),o&2){let n=f();t(),d(" ",n.getFieldError("code")," ")}}function Q(o,l){if(o&1&&(r(0,"option",41),a(1),i()),o&2){let n=l.$implicit;m("value",n.id),t(),y(" ",n.path||n.name," (",n.code,") ")}}function W(o,l){if(o&1&&(r(0,"div",40),a(1),i()),o&2){let n=f();t(),d(" ",n.getFieldError("parentDepartmentId")," ")}}function X(o,l){if(o&1&&(r(0,"div",40),a(1),i()),o&2){let n=f();t(),d(" ",n.getFieldError("description")," ")}}function Z(o,l){if(o&1&&(r(0,"div",40),a(1),i()),o&2){let n=f();t(),d(" ",n.getFieldError("descriptionAr")," ")}}function ee(o,l){if(o&1&&(r(0,"div",40),a(1),i()),o&2){let n=f();t(),d(" ",n.getFieldError("managerEmployeeId")," ")}}function te(o,l){if(o&1&&(r(0,"div",40),a(1),i()),o&2){let n=f();t(),d(" ",n.getFieldError("costCenter")," ")}}function ne(o,l){if(o&1&&(r(0,"div",40),a(1),i()),o&2){let n=f();t(),d(" ",n.getFieldError("location")," ")}}function ie(o,l){if(o&1&&(r(0,"div",40),a(1),i()),o&2){let n=f();t(),d(" ",n.getFieldError("phone")," ")}}function oe(o,l){if(o&1&&(r(0,"div",40),a(1),i()),o&2){let n=f();t(),d(" ",n.getFieldError("email")," ")}}function re(o,l){if(o&1&&(r(0,"div",40),a(1),i()),o&2){let n=f();t(),d(" ",n.getFieldError("sortOrder")," ")}}function ae(o,l){o&1&&c(0,"span",42)}function le(o,l){o&1&&c(0,"i",43)}function me(o,l){if(o&1&&(r(0,"div",44)(1,"div",45)(2,"div",46)(3,"span",47),a(4),i()()()()),o&2){let n=f();t(4),d("",n.i18n.t("common.loading"),"...")}}var Y=class o{department=null;branchId=null;parentId=null;isEditMode=!1;save=new C;cancel=new C;i18n=u(H);fb=u(j);departmentsService=u(U);loading=h(!1);saving=h(!1);departments=h([]);form;constructor(){this.form=this.createForm()}ngOnInit(){this.loadDepartments()}ngOnChanges(l){l.department&&this.department&&this.populateForm()}createForm(){return this.fb.group({name:["",[g.required,g.maxLength(100)]],nameAr:["",[g.maxLength(100)]],code:["",[g.required,g.maxLength(20)]],description:["",[g.maxLength(500)]],descriptionAr:["",[g.maxLength(500)]],parentDepartmentId:[null],managerEmployeeId:[null],costCenter:["",[g.maxLength(50)]],location:["",[g.maxLength(100)]],phone:["",[g.maxLength(20)]],email:["",[g.email,g.maxLength(100)]],sortOrder:[0,[g.min(0)]],isActive:[!0]})}populateForm(){this.department&&this.form.patchValue({name:this.department.name,nameAr:this.department.nameAr,code:this.department.code,description:this.department.description,descriptionAr:this.department.descriptionAr,parentDepartmentId:this.department.parentDepartmentId,managerEmployeeId:this.department.managerEmployeeId,costCenter:this.department.costCenter,location:this.department.location,phone:this.department.phone,email:this.department.email,sortOrder:this.department.sortOrder,isActive:this.department.isActive})}loadDepartments(){return O(this,null,function*(){if(this.branchId){this.loading.set(!0);try{let l=yield this.departmentsService.getDepartments({branchId:this.branchId,includeInactive:!1}).toPromise();if(l){let n=this.isEditMode&&this.department?l.filter(e=>e.id!==this.department.id&&!e.path.includes(this.department.name)):l;this.departments.set(n)}}catch(l){console.error("Failed to load departments:",l)}finally{this.loading.set(!1)}}})}onSubmit(){if(this.form.invalid){this.markFormGroupTouched();return}this.saving.set(!0);let l=this.form.value,n=I(x({},l),{branchId:this.branchId,parentDepartmentId:this.parentId||l.parentDepartmentId||null});this.save.emit(n)}onCancel(){this.cancel.emit()}onReset(){this.isEditMode&&this.department?this.populateForm():this.form.reset({isActive:!0,sortOrder:0,parentDepartmentId:this.parentId})}markFormGroupTouched(){Object.keys(this.form.controls).forEach(l=>{let n=this.form.get(l);n&&n.markAsTouched()})}isFieldInvalid(l){let n=this.form.get(l);return!!(n&&n.invalid&&n.touched)}getFieldError(l){let n=this.form.get(l);if(!n||!n.errors||!n.touched)return"";let e=n.errors;return e.required?this.i18n.t("validation.required"):e.maxlength?this.i18n.t("validation.maxLength"):e.email?this.i18n.t("validation.email"):e.min?this.i18n.t("validation.min"):""}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=M({type:o,selectors:[["app-department-form"]],inputs:{department:"department",branchId:"branchId",parentId:"parentId",isEditMode:"isEditMode"},outputs:{save:"save",cancel:"cancel"},features:[P],decls:107,vars:79,consts:[[3,"ngSubmit","formGroup"],[1,"row","g-3"],[1,"col-12"],[1,"section-title"],[1,"fas","fa-info-circle","me-2"],[1,"col-md-6"],[1,"form-label","required"],["type","text","formControlName","name",1,"form-control",3,"placeholder"],["class","invalid-feedback",4,"ngIf"],[1,"form-label"],["type","text","formControlName","nameAr","dir","rtl",1,"form-control",3,"placeholder"],["type","text","formControlName","code",1,"form-control",2,"text-transform","uppercase",3,"placeholder"],["formControlName","parentDepartmentId",1,"form-select",3,"disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-text","text-muted"],["formControlName","description","rows","3",1,"form-control",3,"placeholder"],["formControlName","descriptionAr","rows","3","dir","rtl",1,"form-control",3,"placeholder"],[1,"fas","fa-cog","me-2"],["formControlName","managerEmployeeId",1,"form-select"],["type","text","formControlName","costCenter",1,"form-control",3,"placeholder"],["type","text","formControlName","location",1,"form-control",3,"placeholder"],["type","tel","formControlName","phone",1,"form-control",3,"placeholder"],["type","email","formControlName","email",1,"form-control",3,"placeholder"],["type","number","formControlName","sortOrder","min","0",1,"form-control"],[1,"fas","fa-toggle-on","me-2"],[1,"form-check","form-switch"],["type","checkbox","formControlName","isActive","id","isActiveSwitch",1,"form-check-input"],["for","isActiveSwitch",1,"form-check-label"],[1,"form-actions"],[1,"d-flex","justify-content-between"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"fas","fa-undo","me-2"],[1,"d-flex","gap-2"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],[1,"fas","fa-times","me-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["class","fas fa-save me-2",4,"ngIf"],["class","loading-overlay",4,"ngIf"],[1,"invalid-feedback"],[3,"value"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-save","me-2"],[1,"loading-overlay"],[1,"d-flex","align-items-center","justify-content-center","h-100"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"]],template:function(n,e){n&1&&(r(0,"form",0),_("ngSubmit",function(){return e.onSubmit()}),r(1,"div",1)(2,"div",2)(3,"h6",3),c(4,"i",4),a(5),i()(),r(6,"div",5)(7,"label",6),a(8),i(),c(9,"input",7),p(10,$,2,1,"div",8),i(),r(11,"div",5)(12,"label",9),a(13),i(),c(14,"input",10),p(15,J,2,1,"div",8),i(),r(16,"div",5)(17,"label",6),a(18),i(),c(19,"input",11),p(20,K,2,1,"div",8),i(),r(21,"div",5)(22,"label",9),a(23),i(),r(24,"select",12)(25,"option",13),a(26),i(),p(27,Q,2,3,"option",14),i(),p(28,W,2,1,"div",8),r(29,"small",15),a(30),i()(),r(31,"div",5)(32,"label",9),a(33),i(),c(34,"textarea",16),p(35,X,2,1,"div",8),i(),r(36,"div",5)(37,"label",9),a(38),i(),c(39,"textarea",17),p(40,Z,2,1,"div",8),i(),r(41,"div",2)(42,"h6",3),c(43,"i",18),a(44),i()(),r(45,"div",5)(46,"label",9),a(47),i(),r(48,"select",19)(49,"option",13),a(50),i()(),p(51,ee,2,1,"div",8),r(52,"small",15),a(53),i()(),r(54,"div",5)(55,"label",9),a(56),i(),c(57,"input",20),p(58,te,2,1,"div",8),i(),r(59,"div",5)(60,"label",9),a(61),i(),c(62,"input",21),p(63,ne,2,1,"div",8),i(),r(64,"div",5)(65,"label",9),a(66),i(),c(67,"input",22),p(68,ie,2,1,"div",8),i(),r(69,"div",5)(70,"label",9),a(71),i(),c(72,"input",23),p(73,oe,2,1,"div",8),i(),r(74,"div",5)(75,"label",9),a(76),i(),c(77,"input",24),p(78,re,2,1,"div",8),r(79,"small",15),a(80),i()(),r(81,"div",2)(82,"h6",3),c(83,"i",25),a(84),i()(),r(85,"div",2)(86,"div",26),c(87,"input",27),r(88,"label",28),a(89),i()(),r(90,"small",15),a(91),i()()(),r(92,"div",29)(93,"div",30)(94,"div")(95,"button",31),_("click",function(){return e.onReset()}),c(96,"i",32),a(97),i()(),r(98,"div",33)(99,"button",34),_("click",function(){return e.onCancel()}),c(100,"i",35),a(101),i(),r(102,"button",36),p(103,ae,1,0,"span",37)(104,le,1,0,"i",38),a(105),i()()()()(),p(106,me,5,1,"div",39)),n&2&&(m("formGroup",e.form),t(5),d(" ",e.i18n.t("common.basicInformation")," "),t(3),s(e.i18n.t("department.name")),t(),v("is-invalid",e.isFieldInvalid("name")),m("placeholder",e.i18n.t("department.namePlaceholder")),t(),m("ngIf",e.isFieldInvalid("name")),t(3),s(e.i18n.t("department.nameAr")),t(),v("is-invalid",e.isFieldInvalid("nameAr")),m("placeholder",e.i18n.t("department.nameArPlaceholder")),t(),m("ngIf",e.isFieldInvalid("nameAr")),t(3),s(e.i18n.t("department.code")),t(),v("is-invalid",e.isFieldInvalid("code")),m("placeholder",e.i18n.t("department.codePlaceholder")),t(),m("ngIf",e.isFieldInvalid("code")),t(3),s(e.i18n.t("department.parentDepartment")),t(),v("is-invalid",e.isFieldInvalid("parentDepartmentId")),m("disabled",e.loading()),t(2),s(e.i18n.t("department.selectParent")),t(),m("ngForOf",e.departments()),t(),m("ngIf",e.isFieldInvalid("parentDepartmentId")),t(2),d(" ",e.i18n.t("department.parentDepartmentHelp")," "),t(3),s(e.i18n.t("common.description")),t(),v("is-invalid",e.isFieldInvalid("description")),m("placeholder",e.i18n.t("department.descriptionPlaceholder")),t(),m("ngIf",e.isFieldInvalid("description")),t(3),s(e.i18n.t("department.descriptionAr")),t(),v("is-invalid",e.isFieldInvalid("descriptionAr")),m("placeholder",e.i18n.t("department.descriptionArPlaceholder")),t(),m("ngIf",e.isFieldInvalid("descriptionAr")),t(4),d(" ",e.i18n.t("department.additionalInformation")," "),t(3),s(e.i18n.t("department.manager")),t(),v("is-invalid",e.isFieldInvalid("managerEmployeeId")),t(2),s(e.i18n.t("department.selectManager")),t(),m("ngIf",e.isFieldInvalid("managerEmployeeId")),t(2),d(" ",e.i18n.t("department.managerHelp")," "),t(3),s(e.i18n.t("department.costCenter")),t(),v("is-invalid",e.isFieldInvalid("costCenter")),m("placeholder",e.i18n.t("department.costCenterPlaceholder")),t(),m("ngIf",e.isFieldInvalid("costCenter")),t(3),s(e.i18n.t("department.location")),t(),v("is-invalid",e.isFieldInvalid("location")),m("placeholder",e.i18n.t("department.locationPlaceholder")),t(),m("ngIf",e.isFieldInvalid("location")),t(3),s(e.i18n.t("common.phone")),t(),v("is-invalid",e.isFieldInvalid("phone")),m("placeholder",e.i18n.t("common.phonePlaceholder")),t(),m("ngIf",e.isFieldInvalid("phone")),t(3),s(e.i18n.t("common.email")),t(),v("is-invalid",e.isFieldInvalid("email")),m("placeholder",e.i18n.t("common.emailPlaceholder")),t(),m("ngIf",e.isFieldInvalid("email")),t(3),s(e.i18n.t("common.sortOrder")),t(),v("is-invalid",e.isFieldInvalid("sortOrder")),t(),m("ngIf",e.isFieldInvalid("sortOrder")),t(2),d(" ",e.i18n.t("common.sortOrderHelp")," "),t(4),d(" ",e.i18n.t("common.status")," "),t(5),d(" ",e.i18n.t("department.isActive")," "),t(2),d(" ",e.i18n.t("department.isActiveHelp")," "),t(4),m("disabled",e.saving()),t(2),d(" ",e.i18n.t("common.reset")," "),t(2),m("disabled",e.saving()),t(2),d(" ",e.i18n.t("common.cancel")," "),t(),m("disabled",e.form.invalid||e.saving()),t(),m("ngIf",e.saving()),t(),m("ngIf",!e.saving()),t(),d(" ",e.saving()?e.i18n.t("common.saving"):e.isEditMode?e.i18n.t("common.update"):e.i18n.t("common.save")," "),t(),m("ngIf",e.loading()))},dependencies:[S,F,E,B,N,G,V,k,T,D,q,w,A,R,z,L],styles:[`.section-title[_ngcontent-%COMP%]{color:#495057;font-weight:600;border-bottom:2px solid #e9ecef;padding-bottom:.5rem;margin-bottom:1rem;margin-top:1.5rem;display:flex;align-items:center}.section-title[_ngcontent-%COMP%]:first-child{margin-top:0}.section-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#667eea}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#495057;margin-bottom:.5rem}.form-label.required[_ngcontent-%COMP%]:after{content:" *";color:#dc3545}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;padding:.75rem 1rem;font-size:.9rem;transition:all .3s ease}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#667eea;box-shadow:0 0 0 .2rem #667eea40}.form-control.is-invalid[_ngcontent-%COMP%], .form-select.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545;background-image:none}.form-control.is-invalid[_ngcontent-%COMP%]:focus, .form-select.is-invalid[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #dc354540}textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:80px}.form-check-input[_ngcontent-%COMP%]{border-radius:6px;transition:all .3s ease}.form-check-input[_ngcontent-%COMP%]:checked{background-color:#667eea;border-color:#667eea}.form-check-input[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #667eea40}.form-switch[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{width:2.5rem;border-radius:2rem}.form-switch[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]:checked{background-color:#28a745;border-color:#28a745;background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='%23fff'/%3e%3c/svg%3e")}.form-text[_ngcontent-%COMP%]{font-size:.8rem;color:#6c757d;margin-top:.25rem}.invalid-feedback[_ngcontent-%COMP%]{font-size:.8rem;margin-top:.25rem;display:block}.form-actions[_ngcontent-%COMP%]{margin-top:2rem;padding-top:1.5rem;border-top:1px solid #e9ecef}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:8px;font-weight:500;padding:.75rem 1.5rem;transition:all .3s ease}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);border:none}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 12px #667eea66}.btn-primary[_ngcontent-%COMP%]:disabled{background:#6c757d;opacity:.6;transform:none}.btn-secondary[_ngcontent-%COMP%]{background-color:#6c757d;border-color:#6c757d}.btn-outline-secondary[_ngcontent-%COMP%]{border-color:#6c757d;color:#6c757d}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background-color:#6c757d;border-color:#6c757d}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:#fffc;z-index:1000;border-radius:8px}[dir=rtl][_ngcontent-%COMP%]   .form-control[dir=rtl][_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   .form-select[dir=rtl][_ngcontent-%COMP%]{text-align:right}[dir=rtl][_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{flex-direction:row-reverse}[dir=rtl][_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:.5rem;margin-right:0}@media (max-width: 768px){.form-actions[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:1rem}.form-actions[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%;margin-bottom:.5rem}.section-title[_ngcontent-%COMP%]{font-size:1rem;margin-top:1rem}}@media (max-width: 576px){.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{font-size:1rem}.section-title[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;text-align:center}.section-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-bottom:.25rem}}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.form-actions[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideUp .4s ease-out}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus, .form-check-input[_ngcontent-%COMP%]:focus{outline:none}.form-check-label[_ngcontent-%COMP%]{font-weight:500;color:#495057;cursor:pointer}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{z-index:3}.input-group-text[_ngcontent-%COMP%]{background-color:#f8f9fa;border-color:#e0e0e0;color:#6c757d}.form-select[_ngcontent-%COMP%]{background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");background-position:right .75rem center;background-repeat:no-repeat;background-size:16px 12px}.was-validated[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:valid, .form-control.is-valid[_ngcontent-%COMP%]{border-color:#28a745;background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%2328a745' viewBox='0 0 8 8'%3e%3cpath d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e")}.was-validated[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:valid:focus, .form-control.is-valid[_ngcontent-%COMP%]:focus{border-color:#28a745;box-shadow:0 0 0 .2rem #28a74540}@media print{.form-actions[_ngcontent-%COMP%]{display:none}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border:1px solid #000!important;box-shadow:none!important}.section-title[_ngcontent-%COMP%]{page-break-after:avoid}}`]})};export{Y as a};
