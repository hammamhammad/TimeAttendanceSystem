import{a as oe}from"./chunk-E7KMSY2E.js";import{a as ie}from"./chunk-3OLRZNFC.js";import{a as ne}from"./chunk-46YUKDEL.js";import{a as N}from"./chunk-LPMX3N5X.js";import"./chunk-LDWMK676.js";import{A as Z,b as R,c as q,d as _,e as P,f as j,i as $,j as B,m as G,n as U,o as L,p as H,q as J,r as z,t as K,v as Q,y as X,z as Y}from"./chunk-YQIE4CGE.js";import{a as ee}from"./chunk-JNFDDMIM.js";import"./chunk-ZURD34HZ.js";import{a as te}from"./chunk-GEGVYT7O.js";import"./chunk-A6EM5NV6.js";import{A as h,Cb as D,Da as A,E as g,Fb as W,Ga as l,Gb as V,Ha as m,Ia as f,Ja as M,L as n,Q as T,Ra as I,aa as x,ba as b,ca as O,ea as k,fa as y,fb as F,ga as c,ha as o,ia as r,ja as u,qa as S,sa as C,ua as p,y as v,z as w}from"./chunk-5OFYUWMA.js";import"./chunk-YMDWBF3A.js";var E=(a,e)=>e.value;function ae(a,e){if(a&1&&(o(0,"div",5)(1,"div",7)(2,"div",8)(3,"span",9),l(4,"Loading..."),r()(),o(5,"p",10),l(6),r()()()),a&2){let t=p();n(6),m(t.t("app.loading"))}}function le(a,e){if(a&1&&(o(0,"div",21),l(1),r()),a&2){let t=p(2);n(),m(t.t("workflows.name_required"))}}function se(a,e){if(a&1&&(o(0,"option",24),l(1),r()),a&2){let t=e.$implicit;c("value",t.value),n(),m(t.label)}}function de(a,e){if(a&1){let t=S();o(0,"button",41),C("click",function(){w(t);let s=p(2);return h(s.addStep())}),u(1,"i",42),l(2),r()}if(a&2){let t=p(2);n(2),f(" ",t.t("workflows.add_step")," ")}}function ce(a,e){if(a&1&&(o(0,"div",37),l(1),r()),a&2){let t=p(2);n(),f(" ",t.t("workflows.no_steps")," ")}}function pe(a,e){if(a&1&&l(0),a&2){let t,i=p().$implicit;f(" : ",(t=i.get("name"))==null?null:t.value," ")}}function me(a,e){if(a&1){let t=S();o(0,"div",46)(1,"button",58),C("click",function(){w(t);let s=p().$index,d=p(3);return h(d.moveStepUp(s))}),u(2,"i",59),r(),o(3,"button",58),C("click",function(){w(t);let s=p().$index,d=p(3);return h(d.moveStepDown(s))}),u(4,"i",60),r(),o(5,"button",61),C("click",function(){w(t);let s=p().$index,d=p(3);return h(d.removeStep(s))}),u(6,"i",62),r()()}if(a&2){let t=p().$index,i=p(3);n(),c("title",I(i.t("workflows.move_up")))("disabled",t===0),n(2),c("title",I(i.t("workflows.move_down")))("disabled",t===i.stepsArray.length-1),n(2),c("title",I(i.t("workflows.remove_step")))}}function fe(a,e){if(a&1&&(o(0,"option",24),l(1),r()),a&2){let t=e.$implicit;c("value",t.value),n(),m(t.label)}}function ue(a,e){if(a&1&&(o(0,"option",24),l(1),r()),a&2){let t=e.$implicit;c("value",t.value),n(),m(t.label)}}function _e(a,e){if(a&1&&(o(0,"option",24),l(1),r()),a&2){let t=e.$implicit;c("value",t.value),n(),m(t.label)}}function ve(a,e){if(a&1&&(o(0,"div",43)(1,"div",44)(2,"span",45),l(3),x(4,pe,1,1),r(),x(5,me,7,8,"div",46),r(),o(6,"div",15)(7,"div",16)(8,"div",17)(9,"label",18),l(10),o(11,"span",19),l(12,"*"),r()(),u(13,"input",20),r(),o(14,"div",17)(15,"label",18),l(16),r(),u(17,"input",22),r(),o(18,"div",17)(19,"label",18),l(20),o(21,"span",19),l(22,"*"),r()(),o(23,"select",47),k(24,fe,2,2,"option",24,E),r()(),o(26,"div",17)(27,"label",18),l(28),o(29,"span",19),l(30,"*"),r()(),o(31,"select",48),k(32,ue,2,2,"option",24,E),r()(),o(34,"div",17)(35,"label",18),l(36),r(),u(37,"input",49),o(38,"small",26),l(39),r()(),o(40,"div",17)(41,"label",18),l(42),r(),o(43,"select",50),k(44,_e,2,2,"option",24,E),r(),o(46,"small",26),l(47),r()(),o(48,"div",17)(49,"label",18),l(50),r(),o(51,"textarea",51),l(52,"                        "),r()(),o(53,"div",30)(54,"div",16)(55,"div",52)(56,"div",53),u(57,"input",54),o(58,"label",55),l(59),r()()(),o(60,"div",52)(61,"div",53),u(62,"input",56),o(63,"label",55),l(64),r()()(),o(65,"div",52)(66,"div",53),u(67,"input",57),o(68,"label",55),l(69),r()()()()()()()()),a&2){let t,i=e.$implicit,s=e.$index,d=p(3);c("formGroupName",s),n(3),M(" ",d.t("workflows.step")," ",s+1," "),n(),b((t=i.get("name"))!=null&&t.value?4:-1),n(),b(d.isViewMode()?-1:5),n(5),f(" ",d.t("workflows.step_name")," "),n(3),A("is-invalid",d.isStepFieldInvalid(s,"name")),c("placeholder",d.t("workflows.step_name_placeholder")),n(3),m(d.t("workflows.step_name_ar")),n(),c("placeholder",d.t("workflows.step_name_ar_placeholder")),n(3),f(" ",d.t("workflows.step_type")," "),n(4),y(d.stepTypes),n(4),f(" ",d.t("workflows.approver_type")," "),n(4),y(d.approverTypes),n(4),m(d.t("workflows.timeout_hours")),n(),c("placeholder",d.t("workflows.timeout_hours_placeholder")),n(2),m(d.t("workflows.timeout_hours_hint")),n(3),m(d.t("workflows.timeout_action")),n(2),y(d.timeoutActions),n(3),m(d.t("workflows.timeout_action_hint")),n(3),m(d.t("workflows.approver_instructions")),n(),c("placeholder",d.t("workflows.approver_instructions_placeholder")),n(6),c("id","allowDelegation_"+s),n(),c("for","allowDelegation_"+s),n(),f(" ",d.t("workflows.allow_delegation")," "),n(3),c("id","notifyOnAction_"+s),n(),c("for","notifyOnAction_"+s),n(),f(" ",d.t("workflows.notify_on_action")," "),n(3),c("id","requireCommentsOnReject_"+s),n(),c("for","requireCommentsOnReject_"+s),n(),f(" ",d.t("workflows.require_comments_reject")," ")}}function we(a,e){if(a&1&&(o(0,"div",38),k(1,ve,70,29,"div",43,O),r()),a&2){let t=p(2);n(),y(t.stepsArray.controls)}}function he(a,e){a&1&&u(0,"span",65)}function xe(a,e){if(a&1){let t=S();o(0,"div",39)(1,"button",63),C("click",function(){w(t);let s=p(2);return h(s.onCancel())}),l(2),r(),o(3,"button",64),x(4,he,1,0,"span",65),l(5),r()()}if(a&2){let t=p(2);n(),c("disabled",t.saving()),n(),f(" ",t.t("common.cancel")," "),n(),c("disabled",t.saving()),n(),b(t.saving()?4:-1),n(),f(" ",t.isEditMode()?t.t("common.update"):t.t("common.create")," ")}}function be(a,e){if(a&1){let t=S();o(0,"div",40)(1,"button",66),C("click",function(){w(t);let s=p(2);return h(s.onCancel())}),l(2),r()()}if(a&2){let t=p(2);n(2),f(" ",t.t("common.back")," ")}}function Ce(a,e){if(a&1){let t=S();o(0,"form",11),C("ngSubmit",function(){w(t);let s=p();return h(s.onSubmit())}),o(1,"div",12)(2,"div",13)(3,"h5",14),l(4),r()(),o(5,"div",15)(6,"div",16)(7,"div",17)(8,"label",18),l(9),o(10,"span",19),l(11,"*"),r()(),u(12,"input",20),x(13,le,2,1,"div",21),r(),o(14,"div",17)(15,"label",18),l(16),r(),u(17,"input",22),r(),o(18,"div",17)(19,"label",18),l(20),o(21,"span",19),l(22,"*"),r()(),o(23,"select",23),k(24,se,2,2,"option",24,E),r()(),o(26,"div",17)(27,"label",18),l(28),r(),o(29,"app-searchable-select",25),C("selectionChange",function(s){w(t);let d=p();return h(d.onBranchSelectionChange(s))}),r(),o(30,"small",26),l(31),r()(),o(32,"div",27)(33,"label",18),l(34),r(),o(35,"textarea",28),l(36,"              "),r()(),o(37,"div",27)(38,"label",18),l(39),r(),o(40,"textarea",29),l(41,"              "),r()(),o(42,"div",30)(43,"div",31),u(44,"input",32),o(45,"label",33),l(46),r(),o(47,"small",34),l(48),r()()()()()(),o(49,"div",12)(50,"div",35)(51,"h5",14),l(52),r(),x(53,de,3,1,"button",36),r(),o(54,"div",15),x(55,ce,2,1,"div",37)(56,we,3,0,"div",38),r()(),x(57,xe,6,5,"div",39)(58,be,3,1,"div",40),r()}if(a&2){let t,i=p();c("formGroup",i.form),n(4),m(i.t("workflows.basic_info")),n(5),f(" ",i.t("workflows.name")," "),n(3),A("is-invalid",i.isFieldInvalid("name")),c("placeholder",i.t("workflows.name_placeholder")),n(),b(i.isFieldInvalid("name")?13:-1),n(3),m(i.t("workflows.name_ar")),n(),c("placeholder",i.t("workflows.name_ar_placeholder")),n(3),f(" ",i.t("workflows.entity_type")," "),n(3),A("is-invalid",i.isFieldInvalid("entityType")),n(),y(i.entityTypes),n(4),m(i.t("workflows.branch")),n(),c("options",i.branchSelectOptions())("value",((t=i.form.get("branchId"))==null||t.value==null?null:t.value.toString())||"")("placeholder",i.t("workflows.branch_placeholder"))("searchable",!0)("clearable",!0)("disabled",i.isViewMode()),n(2),m(i.t("workflows.branch_hint")),n(3),m(i.t("workflows.description")),n(),c("placeholder",i.t("workflows.description_placeholder")),n(4),m(i.t("workflows.description_ar")),n(),c("placeholder",i.t("workflows.description_ar_placeholder")),n(6),f(" ",i.t("workflows.is_default")," "),n(2),m(i.t("workflows.is_default_hint")),n(4),m(i.t("workflows.steps")),n(),b(i.isViewMode()?-1:53),n(2),b(i.stepsArray.length===0?55:56),n(2),b(i.isViewMode()?58:57)}}var re=class a{workflowsService=v(oe);branchesService=v(ne);router=v(W);route=v(D);fb=v(X);notificationService=v(ee);i18n=v(te);permissionService=v(N);loading=g(!1);saving=g(!1);isEditMode=g(!1);isViewMode=g(!1);workflowId=g(null);workflow=g(null);branches=g([]);branchSelectOptions=F(()=>this.branches().map(e=>({value:e.id.toString(),label:e.name})));form;entityTypes=this.workflowsService.getEntityTypes();stepTypes=[{value:"Approval",label:"Approval"},{value:"Notification",label:"Notification"},{value:"Validation",label:"Validation"},{value:"Condition",label:"Condition"}];approverTypes=[{value:"DirectManager",label:"Direct Manager"},{value:"DepartmentHead",label:"Department Head"},{value:"Role",label:"Specific Role"},{value:"SpecificUser",label:"Specific User"}];timeoutActions=[{value:"Expire",label:"Expire"},{value:"Escalate",label:"Escalate"},{value:"AutoApprove",label:"Auto Approve"},{value:"AutoReject",label:"Auto Reject"}];pageTitle=F(()=>this.isViewMode()?this.t("workflows.view_workflow"):this.isEditMode()?this.t("workflows.edit_workflow"):this.t("workflows.create_workflow"));ngOnInit(){this.initForm(),this.loadBranches(),this.checkRouteParams()}t(e){return this.i18n.t(e)}initForm(){this.form=this.fb.group({name:["",[_.required,_.maxLength(255)]],nameAr:["",[_.maxLength(255)]],description:["",[_.maxLength(1e3)]],descriptionAr:["",[_.maxLength(1e3)]],entityType:["Vacation",_.required],branchId:[null],isDefault:[!1],steps:this.fb.array([])})}loadBranches(){this.branchesService.getBranchesForDropdown().subscribe({next:e=>{this.branches.set(e)},error:e=>{console.error("Failed to load branches:",e)}})}onBranchSelectionChange(e){let t=e?parseInt(e,10):null;this.form.patchValue({branchId:t})}get stepsArray(){return this.form.get("steps")}checkRouteParams(){let e=this.route.snapshot.paramMap.get("id"),t=this.route.snapshot.url.map(i=>i.path).join("/");e?(this.workflowId.set(parseInt(e,10)),t.includes("view")?this.isViewMode.set(!0):t.includes("edit")&&this.isEditMode.set(!0),this.loadWorkflow()):this.addStep()}loadWorkflow(){let e=this.workflowId();e&&(this.loading.set(!0),this.workflowsService.getWorkflowDefinitionById(e).subscribe({next:t=>{this.workflow.set(t),this.populateForm(t),this.loading.set(!1)},error:t=>{console.error("Failed to load workflow:",t),this.loading.set(!1),this.notificationService.error(this.t("app.error"),this.t("workflows.load_error")),this.router.navigate(["/settings/workflows"])}}))}populateForm(e){for(this.form.patchValue({name:e.name,nameAr:e.nameAr,description:e.description,descriptionAr:e.descriptionAr,entityType:e.entityType,branchId:e.branchId,isDefault:e.isDefault});this.stepsArray.length;)this.stepsArray.removeAt(0);e.steps.sort((t,i)=>t.stepOrder-i.stepOrder).forEach(t=>this.addStep(t)),this.isViewMode()&&this.form.disable()}addStep(e){let t=this.fb.group({stepOrder:[e?.stepOrder??this.stepsArray.length+1],name:[e?.name??"",[_.required,_.maxLength(255)]],nameAr:[e?.nameAr??"",[_.maxLength(255)]],stepType:[e?.stepType??"Approval",_.required],approverType:[e?.approverType??"DirectManager",_.required],approverRoleId:[e?.approverRoleId],approverUserId:[e?.approverUserId],conditionJson:[e?.conditionJson],timeoutHours:[e?.timeoutHours],timeoutAction:[e?.timeoutAction??"Expire"],allowDelegation:[e?.allowDelegation??!0],notifyOnAction:[e?.notifyOnAction??!0],notifyRequesterOnReach:[e?.notifyRequesterOnReach??!0],approverInstructions:[e?.approverInstructions],approverInstructionsAr:[e?.approverInstructionsAr],requireCommentsOnApprove:[e?.requireCommentsOnApprove??!1],requireCommentsOnReject:[e?.requireCommentsOnReject??!0]});this.stepsArray.push(t)}removeStep(e){this.stepsArray.removeAt(e),this.stepsArray.controls.forEach((t,i)=>{t.patchValue({stepOrder:i+1})})}moveStepUp(e){if(e===0)return;let t=this.stepsArray,i=t.at(e);t.removeAt(e),t.insert(e-1,i),t.controls.forEach((s,d)=>{s.patchValue({stepOrder:d+1})})}moveStepDown(e){if(e===this.stepsArray.length-1)return;let t=this.stepsArray,i=t.at(e);t.removeAt(e),t.insert(e+1,i),t.controls.forEach((s,d)=>{s.patchValue({stepOrder:d+1})})}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched(),this.notificationService.warning(this.t("app.validationError"),this.t("app.checkForm"));return}this.saving.set(!0);let e=this.form.value,t=e.steps.map(i=>({stepOrder:i.stepOrder,name:i.name,nameAr:i.nameAr||void 0,stepType:i.stepType,approverType:i.approverType,approverRoleId:i.approverRoleId||void 0,approverUserId:i.approverUserId||void 0,conditionJson:i.conditionJson||void 0,timeoutHours:i.timeoutHours||void 0,timeoutAction:i.timeoutAction,allowDelegation:i.allowDelegation,notifyOnAction:i.notifyOnAction,notifyRequesterOnReach:i.notifyRequesterOnReach,approverInstructions:i.approverInstructions||void 0,approverInstructionsAr:i.approverInstructionsAr||void 0,requireCommentsOnApprove:i.requireCommentsOnApprove,requireCommentsOnReject:i.requireCommentsOnReject}));if(this.isEditMode()&&this.workflowId()){let i={name:e.name,nameAr:e.nameAr||void 0,description:e.description||void 0,descriptionAr:e.descriptionAr||void 0,isDefault:e.isDefault,steps:t};this.workflowsService.updateWorkflowDefinition(this.workflowId(),i).subscribe({next:()=>{this.saving.set(!1),this.notificationService.success(this.t("app.success"),this.t("workflows.update_success")),this.router.navigate(["/settings/workflows"])},error:s=>{console.error("Failed to update workflow:",s),this.saving.set(!1),this.notificationService.error(this.t("app.error"),this.t("workflows.update_error"))}})}else{let i={name:e.name,nameAr:e.nameAr||void 0,description:e.description||void 0,descriptionAr:e.descriptionAr||void 0,entityType:e.entityType,branchId:e.branchId||void 0,isDefault:e.isDefault,steps:t};this.workflowsService.createWorkflowDefinition(i).subscribe({next:()=>{this.saving.set(!1),this.notificationService.success(this.t("app.success"),this.t("workflows.create_success")),this.router.navigate(["/settings/workflows"])},error:s=>{console.error("Failed to create workflow:",s),this.saving.set(!1),this.notificationService.error(this.t("app.error"),this.t("workflows.create_error"))}})}}onCancel(){this.router.navigate(["/settings/workflows"])}isFieldInvalid(e){let t=this.form.get(e);return!!(t&&t.invalid&&t.touched)}isStepFieldInvalid(e,t){let s=this.stepsArray.at(e)?.get(t);return!!(s&&s.invalid&&s.touched)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=T({type:a,selectors:[["app-workflow-form"]],decls:9,vars:3,consts:[[1,"container-fluid","py-4"],[1,"d-flex","align-items-center","mb-4"],["type","button","routerLink","/settings/workflows",1,"btn","btn-outline-secondary","me-3"],[1,"fa-solid","fa-arrow-left","me-1"],[1,"h3","mb-0"],[1,"card"],[3,"formGroup"],[1,"card-body","text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-3","text-muted"],[3,"ngSubmit","formGroup"],[1,"card","mb-4"],[1,"card-header"],[1,"card-title","mb-0"],[1,"card-body"],[1,"row"],[1,"col-md-6","mb-3"],[1,"form-label"],[1,"text-danger"],["type","text","formControlName","name",1,"form-control",3,"placeholder"],[1,"invalid-feedback"],["type","text","formControlName","nameAr","dir","rtl",1,"form-control",3,"placeholder"],["formControlName","entityType",1,"form-select"],[3,"value"],[3,"selectionChange","options","value","placeholder","searchable","clearable","disabled"],[1,"text-muted"],[1,"col-12","mb-3"],["formControlName","description","rows","2",1,"form-control",3,"placeholder"],["formControlName","descriptionAr","rows","2","dir","rtl",1,"form-control",3,"placeholder"],[1,"col-12"],[1,"form-check"],["type","checkbox","id","isDefault","formControlName","isDefault",1,"form-check-input"],["for","isDefault",1,"form-check-label"],[1,"d-block","text-muted"],[1,"card-header","d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-sm","btn-primary"],[1,"alert","alert-info"],["formArrayName","steps"],[1,"d-flex","justify-content-end","gap-2"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-sm","btn-primary",3,"click"],[1,"fa-solid","fa-plus","me-1"],[1,"card","mb-3","border-primary",3,"formGroupName"],[1,"card-header","bg-primary","bg-opacity-10","d-flex","justify-content-between","align-items-center"],[1,"fw-bold"],[1,"btn-group","btn-group-sm"],["formControlName","stepType",1,"form-select"],["formControlName","approverType",1,"form-select"],["type","number","formControlName","timeoutHours","min","0",1,"form-control",3,"placeholder"],["formControlName","timeoutAction",1,"form-select"],["formControlName","approverInstructions","rows","2",1,"form-control",3,"placeholder"],[1,"col-md-4"],[1,"form-check","mb-2"],["type","checkbox","formControlName","allowDelegation",1,"form-check-input",3,"id"],[1,"form-check-label",3,"for"],["type","checkbox","formControlName","notifyOnAction",1,"form-check-input",3,"id"],["type","checkbox","formControlName","requireCommentsOnReject",1,"form-check-input",3,"id"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled","title"],[1,"fa-solid","fa-arrow-up"],[1,"fa-solid","fa-arrow-down"],["type","button",1,"btn","btn-outline-danger",3,"click","title"],[1,"fa-solid","fa-trash"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"spinner-border","spinner-border-sm","me-1"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"div",1)(2,"button",2),u(3,"i",3),l(4),r(),o(5,"h1",4),l(6),r()(),x(7,ae,7,1,"div",5)(8,Ce,59,30,"form",6),r()),t&2&&(n(4),f(" ",i.t("common.back")," "),n(2),m(i.pageTitle()),n(),b(i.loading()?7:8))},dependencies:[Y,$,z,K,q,B,R,J,P,j,Q,Z,G,H,U,L,V,ie],styles:[".card.border-primary[_ngcontent-%COMP%]{border-width:2px}.card-header.bg-primary.bg-opacity-10[_ngcontent-%COMP%]{border-bottom:1px solid rgba(var(--bs-primary-rgb),.2)}.fw-bold[_ngcontent-%COMP%]{font-size:1rem}.form-label[_ngcontent-%COMP%]{font-weight:500}.form-label[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{font-weight:700}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.25rem .5rem}.form-check[_ngcontent-%COMP%]{padding-top:.25rem}textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:60px}small.text-muted[_ngcontent-%COMP%]{font-size:.875rem}@media (max-width: 768px){.btn-group-sm[_ngcontent-%COMP%]{flex-direction:column}.col-md-4[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{margin-bottom:.75rem}}.spinner-border[_ngcontent-%COMP%]{width:2rem;height:2rem}.d-flex.justify-content-end.gap-2[_ngcontent-%COMP%]{padding-top:1rem}"]})};export{re as WorkflowFormComponent};
