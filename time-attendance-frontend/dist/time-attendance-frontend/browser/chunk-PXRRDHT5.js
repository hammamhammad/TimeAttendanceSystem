import{a as ue}from"./chunk-HXSGHCFU.js";import{p as oe,r as se,x as de}from"./chunk-VRETN7JA.js";import{a as me}from"./chunk-UBCI4X5Q.js";import{a as pe}from"./chunk-EYAJMHM7.js";import{a as le}from"./chunk-HHXRLUSQ.js";import{b as re}from"./chunk-WO762DVG.js";import{a as ie,b as ce}from"./chunk-7HHEMKQW.js";import"./chunk-TWXUAMJ4.js";import{$a as x,Ab as T,Bb as s,Bc as W,Cb as d,Cc as ae,Db as D,Ea as k,Eb as U,M as J,Pb as R,Q as K,Qb as Z,Sb as M,Tb as O,W as w,X as P,Xa as h,Ya as g,Yb as y,Za as $,Zb as ee,ab as C,bb as f,cb as r,da as _,db as i,eb as v,g as G,j as V,lb as E,n as H,nb as S,pb as p,qb as Q,rb as X,ta as n,uc as te,v as q,vc as ne,wc as z,x as B,ya as I,yb as Y}from"./chunk-JSQL33QG.js";import{a as j}from"./chunk-DGAILPFQ.js";var be=["*"];function fe(a,t){if(a&1&&(r(0,"div")(1,"div",2)(2,"div",3)(3,"div",4),v(4,"div",5)(5,"div",6)(6,"div",7),i()()()()),a&2){let e=p(2);T(e.getColumnClasses())}}function _e(a,t){if(a&1&&x(0,fe,7,2,"div",1,$),a&2){let e=p();C(e.getSkeletonItems())}}function xe(a,t){if(a&1&&(r(0,"div"),v(1,"app-stat-card",8),i()),a&2){let e=t.$implicit,o=p(2);T(o.getColumnClasses()),n(),f("label",e.label)("value",e.value)("icon",e.icon)("variant",e.variant||"primary")("prefix",e.prefix)("suffix",e.suffix)("subtitle",e.subtitle)("change",e.change)("size",o.cardSize)("borderAccent",e.borderAccent??!0)("clickable",e.clickable??!1)("clickableText",e.clickableText)}}function Ce(a,t){if(a&1&&x(0,xe,2,14,"div",1,$),a&2){let e=p();C(e.stats)}}function ye(a,t){a&1&&(r(0,"div",0)(1,"div",9),v(2,"i",10),r(3,"p",11),s(4,"No statistics available"),i()()())}var A=class a{stats=[];columns=4;loading=!1;gap="md";cardSize="md";getGridClasses(){let t=["stats-grid","row"];switch(this.gap){case"sm":t.push("g-2");break;case"lg":t.push("g-4");break;default:t.push("g-3")}return t.join(" ")}getColumnClasses(){let t=["stats-grid-item"];switch(this.columns){case 2:t.push("col-md-6");break;case 3:t.push("col-md-4");break;case 4:t.push("col-md-6","col-lg-3");break}return t.join(" ")}getSkeletonItems(){return Array(this.columns).fill(0)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=k({type:a,selectors:[["app-stats-grid"]],inputs:{stats:"stats",columns:"columns",loading:"loading",gap:"gap",cardSize:"cardSize"},ngContentSelectors:be,decls:5,vars:3,consts:[[1,"col-12"],[3,"class"],[1,"card","h-100"],[1,"card-body"],[1,"skeleton-loader"],[1,"skeleton-line","skeleton-title"],[1,"skeleton-line","skeleton-value"],[1,"skeleton-line","skeleton-subtitle"],[3,"label","value","icon","variant","prefix","suffix","subtitle","change","size","borderAccent","clickable","clickableText"],[1,"text-center","py-4","text-muted"],[1,"fa-solid","fa-chart-simple","fa-2x","mb-2"],[1,"mb-0"]],template:function(e,o){e&1&&(Q(),r(0,"div"),h(1,_e,2,0)(2,Ce,2,0)(3,ye,5,0,"div",0),X(4),i()),e&2&&(T(o.getGridClasses()),n(),g(o.loading?1:o.stats.length>0?2:3))},dependencies:[z,ue],styles:[".stats-grid[_ngcontent-%COMP%]{margin-bottom:1.5rem}.stats-grid-item[_ngcontent-%COMP%]{margin-bottom:0}.skeleton-loader[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s ease-in-out infinite}.skeleton-line[_ngcontent-%COMP%]{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0,#f0f0f0 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite;border-radius:4px;margin-bottom:.75rem}.skeleton-title[_ngcontent-%COMP%]{height:14px;width:60%}.skeleton-value[_ngcontent-%COMP%]{height:32px;width:40%}.skeleton-subtitle[_ngcontent-%COMP%]{height:12px;width:50%}@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:-200% 0}to{background-position:200% 0}}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.8}}"]})};var N=class a{constructor(t){this.http=t}apiUrl=`${ie.apiUrl}/api/v1/dashboard`;_dashboardData=_(null);_loading=_(!1);_error=_(null);_lastRefresh=_(null);_autoRefresh=_(!1);_refreshInterval=_(30);dashboardData=this._dashboardData.asReadonly();loading=this._loading.asReadonly();error=this._error.asReadonly();lastRefresh=this._lastRefresh.asReadonly();autoRefresh=this._autoRefresh.asReadonly();refreshInterval=this._refreshInterval.asReadonly();dashboardSubject=new G(null);dashboard$=this.dashboardSubject.asObservable();refreshSubscription;getDashboardOverview(t){this._loading.set(!0),this._error.set(null);let e=new W;return t?.branchId&&(e=e.set("branchId",t.branchId.toString())),t?.departmentId&&(e=e.set("departmentId",t.departmentId.toString())),this.http.get(`${this.apiUrl}/overview`,{params:e}).pipe(H(o=>(this._dashboardData.set(o),this._lastRefresh.set(new Date),this._loading.set(!1),this.dashboardSubject.next(o),o)),B(o=>(this._error.set(o.message||"Failed to load dashboard data"),this._loading.set(!1),console.error("Dashboard data loading failed:",o),V({organization:{},humanResources:{},attendance:{},leaves:{},shifts:{},system:{}}))))}getWidgetData(t,e){let o=new W;return e?.branchId&&(o=o.set("branchId",e.branchId.toString())),e?.departmentId&&(o=o.set("departmentId",e.departmentId.toString())),this.http.get(`${this.apiUrl}/widgets/${t}`,{params:o}).pipe(B(l=>(console.error(`Failed to load ${t} widget data:`,l),V(null))))}refreshDashboard(t){this.getDashboardOverview(t).subscribe()}startAutoRefresh(t){t&&this._refreshInterval.set(t),this.stopAutoRefresh(),this._autoRefresh.set(!0),this.refreshSubscription=q(this._refreshInterval()*1e3).subscribe(()=>{this._autoRefresh()&&this.refreshDashboard()})}stopAutoRefresh(){this.refreshSubscription&&(this.refreshSubscription.unsubscribe(),this.refreshSubscription=null),this._autoRefresh.set(!1)}updateRefreshInterval(t){this._refreshInterval.set(t),this._autoRefresh()&&this.startAutoRefresh(t)}clearData(){this._dashboardData.set(null),this._error.set(null),this._lastRefresh.set(null),this.dashboardSubject.next(null)}getTimeSinceLastRefresh(){let t=this._lastRefresh();if(!t)return"Never";let o=new Date().getTime()-t.getTime(),l=Math.floor(o/1e3),m=Math.floor(l/60);return l<60?`${l} seconds ago`:m<60?`${m} minutes ago`:`${Math.floor(m/60)} hours ago`}hasData(){return this._dashboardData()!==null}getCurrentFilters(){return{}}ngOnDestroy(){this.stopAutoRefresh()}static \u0275fac=function(e){return new(e||a)(K(ae))};static \u0275prov=J({token:a,factory:a.\u0275fac,providedIn:"root"})};var De=a=>({username:a}),F=()=>[],L=(a,t)=>t.id,Me=(a,t)=>t.employeeId,Oe=(a,t)=>t.roleName,we=(a,t)=>t.vacationId,Pe=(a,t)=>t.value;function Ie(a,t){if(a&1&&(r(0,"small",6),v(1,"i",18),s(2),i()),a&2){let e=p();n(2),U(" ",e.t("dashboard.last_refresh"),": ",e.getTimeSinceLastRefresh()," ")}}function Ee(a,t){if(a&1&&(r(0,"option",21),s(1),i()),a&2){let e=t.$implicit;f("value",e.id),n(),d(e.name)}}function Re(a,t){if(a&1){let e=E();r(0,"select",19),S("change",function(l){w(e);let m=p();return P(m.updateFilters({branchId:l.target.value?+l.target.value:void 0}))}),r(1,"option",20),s(2),i(),x(3,Ee,2,2,"option",21,L),i()}if(a&2){let e=p();f("value",e.filters().branchId||""),n(2),d(e.t("dashboard.all_branches")),n(),C(e.availableBranches())}}function ke(a,t){if(a&1&&(r(0,"option",21),s(1),i()),a&2){let e=t.$implicit;f("value",e.id),n(),d(e.name)}}function Te(a,t){if(a&1){let e=E();r(0,"select",19),S("change",function(l){w(e);let m=p();return P(m.updateFilters({departmentId:l.target.value?+l.target.value:void 0}))}),r(1,"option",20),s(2),i(),x(3,ke,2,2,"option",21,L),i()}if(a&2){let e=p();f("value",e.filters().departmentId||""),n(2),d(e.t("dashboard.all_departments")),n(),C(e.availableDepartments())}}function ze(a,t){if(a&1&&(r(0,"div",16)(1,"div",22),v(2,"app-loading-spinner",23),i()()),a&2){let e=p();n(2),f("message",e.t("dashboard.loading_comprehensive"))("variant","primary")("centered",!0)}}function Ae(a,t){if(a&1){let e=E();r(0,"div",17),v(1,"i",24),s(2),r(3,"button",25),S("click",function(){w(e);let l=p();return P(l.refreshData())}),s(4),i()()}if(a&2){let e=p();n(2),D(" ",e.error()," "),n(2),D(" ",e.t("common.retry")," ")}}function Ne(a,t){if(a&1&&(r(0,"div",50)(1,"span",51),s(2),i(),r(3,"span",52),s(4),i()()),a&2){let e=t.$implicit;n(2),d(e.employeeName),n(2),d(e.status)}}function Fe(a,t){if(a&1&&(r(0,"div",48)(1,"h5"),s(2),i(),r(3,"div",49),x(4,Ne,5,2,"div",50,Me),i()()),a&2){let e,o=p(3);n(2),d(o.t("dashboard.incomplete_records")),n(2),C(((e=o.dashboardData())==null||e.attendance==null||e.attendance.incompleteRecords==null?null:e.attendance.incompleteRecords.slice(0,5))||R(1,F))}}function je(a,t){if(a&1&&(r(0,"div",31)(1,"div",38)(2,"h3"),v(3,"i",39),s(4),i()(),r(5,"div",40)(6,"div",41)(7,"div",42)(8,"span",43),s(9),i(),r(10,"span",44),s(11),i()(),r(12,"div",42)(13,"span",43),s(14),i(),r(15,"span",45),s(16),i()(),r(17,"div",42)(18,"span",43),s(19),i(),r(20,"span",46),s(21),i()(),r(22,"div",42)(23,"span",43),s(24),i(),r(25,"span",47),s(26),M(27,"number"),i()()(),h(28,Fe,6,2,"div",48),i()()),a&2){let e,o,l,m,c,u=p(2);n(4),d(u.t("dashboard.attendance_overview")),n(5),d(u.t("dashboard.present_today")),n(2),d(((e=u.dashboardData())==null?null:e.attendance.todayPresent)||0),n(3),d(u.t("dashboard.absent_today")),n(2),d(((o=u.dashboardData())==null?null:o.attendance.todayAbsent)||0),n(3),d(u.t("dashboard.late_today")),n(2),d(((l=u.dashboardData())==null?null:l.attendance.todayLate)||0),n(3),d(u.t("dashboard.attendance_rate")),n(2),D("",O(27,10,((m=u.dashboardData())==null?null:m.attendance.attendanceRate)||0,"1.1-1"),"%"),n(2),g(!((c=u.dashboardData())==null||c.attendance==null||c.attendance.incompleteRecords==null)&&c.attendance.incompleteRecords.length?28:-1)}}function Ve(a,t){if(a&1&&(r(0,"div",58)(1,"span",59),s(2),i(),r(3,"span",60),s(4),i(),r(5,"span",61),s(6),M(7,"number"),i()()),a&2){let e=t.$implicit;n(2),d(e.roleName),n(2),d(e.userCount),n(2),D("(",O(7,3,e.percentage,"1.0-0"),"%)")}}function Be(a,t){if(a&1&&(r(0,"div",57)(1,"h5"),s(2),i(),x(3,Ve,8,6,"div",58,Oe),i()),a&2){let e,o=p(3);n(2),d(o.t("dashboard.role_distribution")),n(),C(((e=o.dashboardData())==null||e.humanResources==null||e.humanResources.roleDistribution==null?null:e.humanResources.roleDistribution.slice(0,4))||R(1,F))}}function $e(a,t){if(a&1&&(r(0,"div",32)(1,"div",38)(2,"h3"),v(3,"i",53),s(4),i()(),r(5,"div",40)(6,"div",54)(7,"div",55)(8,"span",43),s(9),i(),r(10,"span",56),s(11),i()(),r(12,"div",55)(13,"span",43),s(14),i(),r(15,"span",44),s(16),i()(),r(17,"div",55)(18,"span",43),s(19),i(),r(20,"span",56),s(21),i()(),r(22,"div",55)(23,"span",43),s(24),i(),r(25,"span",44),s(26),i()()(),h(27,Be,5,2,"div",57),i()()),a&2){let e,o,l,m,c,u=p(2);n(4),d(u.t("dashboard.human_resources")),n(5),d(u.t("dashboard.total_employees")),n(2),d(((e=u.dashboardData())==null?null:e.humanResources.totalEmployees)||0),n(3),d(u.t("dashboard.active_employees")),n(2),d(((o=u.dashboardData())==null?null:o.humanResources.activeEmployees)||0),n(3),d(u.t("dashboard.total_users")),n(2),d(((l=u.dashboardData())==null?null:l.humanResources.totalUsers)||0),n(3),d(u.t("dashboard.active_users")),n(2),d(((m=u.dashboardData())==null?null:m.humanResources.activeUsers)||0),n(),g(!((c=u.dashboardData())==null||c.humanResources==null||c.humanResources.roleDistribution==null)&&c.humanResources.roleDistribution.length?27:-1)}}function Ue(a,t){if(a&1&&(r(0,"div",66)(1,"span",51),s(2),i(),r(3,"span",67),s(4),i(),r(5,"span",68),s(6),M(7,"date"),M(8,"date"),i()()),a&2){let e=t.$implicit;n(2),d(e.employeeName),n(2),d(e.vacationType),n(2),U("",O(7,4,e.startDate,"shortDate")," - ",O(8,7,e.endDate,"shortDate"))}}function We(a,t){if(a&1&&(r(0,"div",65)(1,"h5"),s(2),i(),x(3,Ue,9,10,"div",66,we),i()),a&2){let e,o=p(3);n(2),d(o.t("dashboard.upcoming_vacations")),n(),C(((e=o.dashboardData())==null||e.leaves==null||e.leaves.upcomingVacations==null?null:e.leaves.upcomingVacations.slice(0,3))||R(1,F))}}function Le(a,t){if(a&1&&(r(0,"div",33)(1,"div",38)(2,"h3"),v(3,"i",62),s(4),i()(),r(5,"div",40)(6,"div",63)(7,"div",42)(8,"span",43),s(9),i(),r(10,"span",46),s(11),i()(),r(12,"div",42)(13,"span",43),s(14),i(),r(15,"span",64),s(16),i()(),r(17,"div",42)(18,"span",43),s(19),i(),r(20,"span",44),s(21),i()()(),h(22,We,5,2,"div",65),i()()),a&2){let e,o,l,m,c=p(2);n(4),d(c.t("dashboard.leave_management")),n(5),d(c.t("dashboard.pending_requests")),n(2),d(((e=c.dashboardData())==null?null:e.leaves.pendingRequests)||0),n(3),d(c.t("dashboard.on_leave_today")),n(2),d(((o=c.dashboardData())==null?null:o.leaves.onLeaveToday)||0),n(3),d(c.t("dashboard.approved_today")),n(2),d(((l=c.dashboardData())==null?null:l.leaves.approvedToday)||0),n(),g(!((m=c.dashboardData())==null||m.leaves==null||m.leaves.upcomingVacations==null)&&m.leaves.upcomingVacations.length?22:-1)}}function Ge(a,t){if(a&1&&(r(0,"div",34)(1,"div",38)(2,"h3"),v(3,"i",69),s(4),i()(),r(5,"div",40)(6,"div",70)(7,"div",55)(8,"span",43),s(9),i(),r(10,"span",56),s(11),i()(),r(12,"div",55)(13,"span",43),s(14),i(),r(15,"span",44),s(16),i()(),r(17,"div",55)(18,"span",43),s(19),i(),r(20,"span",56),s(21),i()(),r(22,"div",55)(23,"span",43),s(24),i(),r(25,"span",44),s(26),i()()()()()),a&2){let e,o,l,m,c=p(2);n(4),d(c.t("dashboard.organization_structure")),n(5),d(c.t("dashboard.total_branches")),n(2),d(((e=c.dashboardData())==null?null:e.organization.totalBranches)||0),n(3),d(c.t("dashboard.active_branches")),n(2),d(((o=c.dashboardData())==null?null:o.organization.activeBranches)||0),n(3),d(c.t("dashboard.total_departments")),n(2),d(((l=c.dashboardData())==null?null:l.organization.totalDepartments)||0),n(3),d(c.t("dashboard.active_departments")),n(2),d(((m=c.dashboardData())==null?null:m.organization.activeDepartments)||0)}}function He(a,t){if(a&1&&(r(0,"div",35)(1,"div",38)(2,"h3"),v(3,"i",71),s(4),i()(),r(5,"div",40)(6,"div",72)(7,"div",42)(8,"span",43),s(9),i(),r(10,"span",56),s(11),i()(),r(12,"div",42)(13,"span",43),s(14),i(),r(15,"span",56),s(16),i()(),r(17,"div",42)(18,"span",43),s(19),i(),r(20,"span",44),s(21),i()()()()()),a&2){let e,o,l,m=p(2);n(4),d(m.t("dashboard.shift_management")),n(5),d(m.t("dashboard.active_shifts")),n(2),d(((e=m.dashboardData())==null?null:e.shifts.activeShifts)||0),n(3),d(m.t("dashboard.total_assignments")),n(2),d(((o=m.dashboardData())==null?null:o.shifts.totalShiftAssignments)||0),n(3),d(m.t("dashboard.today_coverage")),n(2),d(((l=m.dashboardData())==null?null:l.shifts.todayCoverage)||0)}}function qe(a,t){if(a&1&&(r(0,"div",76)(1,"span",77),s(2),i(),r(3,"span",78),s(4),M(5,"date"),i()()),a&2){let e=t.$implicit;n(2),d(e.description),n(2),d(O(5,2,e.timestamp,"short"))}}function Je(a,t){if(a&1&&(r(0,"div",75)(1,"h5"),s(2),i(),x(3,qe,6,5,"div",76,L),i()),a&2){let e,o=p(3);n(2),d(o.t("dashboard.recent_activities")),n(),C(((e=o.dashboardData())==null||e.system==null||e.system.recentActivities==null?null:e.system.recentActivities.slice(0,3))||R(1,F))}}function Ke(a,t){if(a&1&&(r(0,"div",36)(1,"div",38)(2,"h3"),v(3,"i",73),s(4),i()(),r(5,"div",40)(6,"div",74)(7,"div",55)(8,"span",43),s(9),i(),r(10,"span",44),s(11),i()(),r(12,"div",55)(13,"span",43),s(14),i(),r(15,"span",56),s(16),i()(),r(17,"div",55)(18,"span",43),s(19),i(),r(20,"span",64),s(21),i()()(),h(22,Je,5,2,"div",75),i()()),a&2){let e,o,l,m,c=p(2);n(4),d(c.t("dashboard.system_health")),n(5),d(c.t("dashboard.active_sessions")),n(2),d(((e=c.dashboardData())==null?null:e.system.activeSessions)||0),n(3),d(c.t("dashboard.today_logins")),n(2),d(((o=c.dashboardData())==null?null:o.system.todayLogins)||0),n(3),d(c.t("dashboard.system_uptime")),n(2),d(((l=c.dashboardData())==null?null:l.system.systemUptime)||"N/A"),n(),g(!((m=c.dashboardData())==null||m.system==null||m.system.recentActivities==null)&&m.system.recentActivities.length?22:-1)}}function Qe(a,t){if(a&1&&(r(0,"option",21),s(1),i()),a&2){let e=t.$implicit;f("value",e.value),n(),d(e.label)}}function Xe(a,t){if(a&1){let e=E();r(0,"div",37)(1,"div",79)(2,"label",80),s(3),i(),r(4,"select",81),S("change",function(l){w(e);let m=p(2);return P(m.updateRefreshInterval(+l.target.value))}),x(5,Qe,2,2,"option",21,Pe),i()()()}if(a&2){let e=p(2);n(3),d(e.t("dashboard.refresh_interval")),n(),f("value",e.dashboardService.refreshInterval()),n(),C(e.refreshIntervals)}}function Ye(a,t){if(a&1&&(r(0,"div",26)(1,"h2",27),s(2),i(),v(3,"app-stats-grid",28),i(),r(4,"div",29)(5,"div",30),h(6,je,29,13,"div",31),h(7,$e,28,10,"div",32),h(8,Le,23,8,"div",33),h(9,Ge,27,9,"div",34),h(10,He,22,7,"div",35),h(11,Ke,23,8,"div",36),i()(),h(12,Xe,7,2,"div",37)),a&2){let e,o,l,m,c,u,b=p();n(2),d(b.t("dashboard.key_metrics")),n(),f("stats",b.dashboardStats())("columns",4)("loading",b.loading()),n(3),g(b.showAttendanceWidget()&&((e=b.dashboardData())!=null&&e.attendance)?6:-1),n(),g(b.showHumanResourcesWidget()&&((o=b.dashboardData())!=null&&o.humanResources)?7:-1),n(),g(b.showVacationWidget()&&((l=b.dashboardData())!=null&&l.leaves)?8:-1),n(),g(b.showOrganizationWidget()&&((m=b.dashboardData())!=null&&m.organization)?9:-1),n(),g(b.showShiftWidget()&&((c=b.dashboardData())!=null&&c.shifts)?10:-1),n(),g(b.showSystemWidget()&&((u=b.dashboardData())!=null&&u.system)?11:-1),n(),g(b.autoRefresh()?12:-1)}}var ge=class a{constructor(t,e,o,l){this.authService=t;this.i18n=e;this.dashboardService=o;this.notificationService=l;this.setupErrorHandling()}currentUser=y(()=>this.authService.currentUser());dashboardData;loading;error;lastRefresh;autoRefresh;dashboardCards=y(()=>{let t=this.dashboardData();return t?[{title:this.t("dashboard.total_employees"),value:t.humanResources?.totalEmployees||0,icon:"fa-solid fa-users",color:"primary",change:this.calculateChange(t.humanResources?.activeEmployees,t.humanResources?.totalEmployees),trend:"up",module:"humanResources"},{title:this.t("dashboard.today_attendance"),value:t.attendance?.todayPresent||0,icon:"fa-solid fa-calendar-check",color:"success",change:t.attendance?.attendanceRate||0,trend:(t.attendance?.attendanceRate||0)>=90?"up":"down",module:"attendance"},{title:this.t("dashboard.pending_vacations"),value:t.leaves?.pendingRequests||0,icon:"fa-solid fa-calendar-times",color:"warning",trend:"stable",module:"leaves"},{title:this.t("dashboard.active_shifts"),value:t.shifts?.activeShifts||0,icon:"fa-solid fa-clock",color:"info",trend:"stable",module:"shifts"},{title:this.t("dashboard.total_branches"),value:t.organization?.totalBranches||0,icon:"fa-solid fa-code-branch",color:"secondary",trend:"stable",module:"organization"},{title:this.t("dashboard.active_users"),value:t.humanResources?.activeUsers||0,icon:"fa-solid fa-user-check",color:"primary",trend:"up",module:"humanResources"},{title:this.t("dashboard.today_late"),value:t.attendance?.todayLate||0,icon:"fa-solid fa-exclamation-triangle",color:"danger",trend:(t.attendance?.todayLate||0)>5?"up":"down",module:"attendance"},{title:this.t("dashboard.active_sessions"),value:t.system?.activeSessions||0,icon:"fa-solid fa-wifi",color:"info",trend:"stable",module:"system"}]:[]});dashboardStats=y(()=>this.dashboardCards().map(e=>({label:e.title,value:e.value,icon:e.icon,variant:this.mapColorToVariant(e.color),change:e.change!==void 0?{value:Math.abs(e.change),type:e.trend==="up"?"increase":e.trend==="down"?"decrease":"neutral",isPercentage:e.module==="attendance"}:void 0})));filters=_({});availableBranches=_([]);availableDepartments=_([]);showOrganizationWidget=y(()=>this.hasPermission("branch.read")||this.hasPermission("department.read"));showHumanResourcesWidget=y(()=>this.hasPermission("user.read")||this.hasPermission("employee.read"));showAttendanceWidget=y(()=>this.hasPermission("attendance.read"));showVacationWidget=y(()=>this.hasPermission("vacation.read"));showShiftWidget=y(()=>this.hasPermission("shift.read"));showSystemWidget=y(()=>this.isSystemAdmin());refreshIntervals=[{value:15,label:"15 seconds"},{value:30,label:"30 seconds"},{value:60,label:"1 minute"},{value:300,label:"5 minutes"},{value:900,label:"15 minutes"}];ngOnInit(){this.dashboardData=this.dashboardService.dashboardData,this.loading=this.dashboardService.loading,this.error=this.dashboardService.error,this.lastRefresh=this.dashboardService.lastRefresh,this.autoRefresh=this.dashboardService.autoRefresh,this.loadDashboardData(),this.loadFilterOptions()}ngOnDestroy(){this.dashboardService.stopAutoRefresh()}loadDashboardData(){let t=this.filters();this.dashboardService.getDashboardOverview(t).subscribe({next:e=>{e.organization?.branchSummaries&&this.availableBranches.set(e.organization.branchSummaries),e.organization?.departmentSummaries&&this.availableDepartments.set(e.organization.departmentSummaries)},error:e=>{this.notificationService.error(this.t("dashboard.load_error")),console.error("Dashboard load failed:",e)}})}refreshData(){this.dashboardService.refreshDashboard(this.filters()),this.notificationService.success(this.t("dashboard.refreshed"))}updateFilters(t){this.filters.update(e=>j(j({},e),t)),this.loadDashboardData()}toggleAutoRefresh(){this.autoRefresh()?(this.dashboardService.stopAutoRefresh(),this.notificationService.info(this.t("dashboard.auto_refresh_disabled"))):(this.dashboardService.startAutoRefresh(),this.notificationService.info(this.t("dashboard.auto_refresh_enabled")))}updateRefreshInterval(t){this.dashboardService.updateRefreshInterval(t),this.autoRefresh()&&this.notificationService.info(this.t("dashboard.refresh_interval_updated"))}getTimeSinceLastRefresh(){return this.dashboardService.getTimeSinceLastRefresh()}t(t,e){return this.i18n.t(t,e)}getCardColorClass(t){return`card-${t}`}getTrendIcon(t){switch(t){case"up":return"fa-solid fa-arrow-up text-success";case"down":return"fa-solid fa-arrow-down text-danger";default:return"fa-solid fa-minus text-muted"}}calculateChange(t,e){return!t||!e||e===0?0:Math.round(t/e*100)}mapColorToVariant(t){return{primary:"primary",success:"success",warning:"warning",danger:"danger",info:"info",secondary:"secondary"}[t]||"primary"}hasPermission(t){return this.currentUser()?.permissions?.includes(t)||this.isSystemAdmin()}isSystemAdmin(){return this.currentUser()?.roles?.includes("SystemAdmin")||!1}setupErrorHandling(){ee(()=>{let t=this.error();t&&this.notificationService.error(t)})}loadFilterOptions(){}exportDashboard(t){this.notificationService.info(this.t("dashboard.export_not_implemented"))}static \u0275fac=function(e){return new(e||a)(I(re),I(ce),I(N),I(le))};static \u0275cmp=k({type:a,selectors:[["app-dashboard"]],decls:23,vars:16,consts:[[1,"dashboard-container"],[3,"title"],[1,"dashboard-controls","mb-4"],[1,"d-flex","justify-content-between","align-items-start"],[1,"welcome-section"],[1,"dashboard-subtitle","mb-0"],[1,"text-muted"],[1,"controls-section"],[1,"d-flex","align-items-center","gap-3"],[1,"btn","btn-outline-primary","btn-sm",3,"click","disabled"],[1,"fa-solid","fa-refresh"],[1,"form-check","form-switch"],["type","checkbox","id","autoRefreshToggle",1,"form-check-input",3,"change","checked"],["for","autoRefreshToggle",1,"form-check-label"],[1,"d-flex","gap-2"],[1,"form-select","form-select-sm",3,"value"],[1,"loading-overlay"],["role","alert",1,"alert","alert-danger"],[1,"fa-solid","fa-clock","me-1"],[1,"form-select","form-select-sm",3,"change","value"],["value",""],[3,"value"],[1,"loading-content"],[3,"message","variant","centered"],[1,"fa-solid","fa-exclamation-triangle","me-2"],[1,"btn","btn-sm","btn-outline-danger","ms-2",3,"click"],[1,"metrics-section"],[1,"section-title"],[3,"stats","columns","loading"],[1,"widgets-section"],[1,"widgets-grid"],[1,"widget","attendance-widget"],[1,"widget","hr-widget"],[1,"widget","vacation-widget"],[1,"widget","organization-widget"],[1,"widget","shift-widget"],[1,"widget","system-widget"],[1,"auto-refresh-settings"],[1,"widget-header"],[1,"fa-solid","fa-calendar-check","me-2"],[1,"widget-content"],[1,"attendance-stats"],[1,"stat-item"],[1,"stat-label"],[1,"stat-value","text-success"],[1,"stat-value","text-danger"],[1,"stat-value","text-warning"],[1,"stat-value","text-primary"],[1,"incomplete-records","mt-3"],[1,"records-list"],[1,"record-item"],[1,"employee-name"],[1,"employee-status","badge","bg-warning"],[1,"fa-solid","fa-users","me-2"],[1,"hr-stats"],[1,"stat-row"],[1,"stat-value"],[1,"role-distribution","mt-3"],[1,"role-item"],[1,"role-name"],[1,"role-count"],[1,"role-percentage"],[1,"fa-solid","fa-calendar-times","me-2"],[1,"vacation-stats"],[1,"stat-value","text-info"],[1,"upcoming-vacations","mt-3"],[1,"vacation-item"],[1,"vacation-type"],[1,"vacation-dates"],[1,"fa-solid","fa-sitemap","me-2"],[1,"org-stats"],[1,"fa-solid","fa-clock","me-2"],[1,"shift-stats"],[1,"fa-solid","fa-server","me-2"],[1,"system-stats"],[1,"recent-activities","mt-3"],[1,"activity-item"],[1,"activity-description"],[1,"activity-time"],[1,"settings-card"],["for","refreshInterval",1,"form-label"],["id","refreshInterval",1,"form-select","form-select-sm",3,"change","value"]],template:function(e,o){if(e&1&&(r(0,"div",0),v(1,"app-page-header",1),r(2,"div",2)(3,"div",3)(4,"div",4)(5,"p",5),s(6),i(),h(7,Ie,3,2,"small",6),i(),r(8,"div",7)(9,"div",8)(10,"button",9),S("click",function(){return o.refreshData()}),v(11,"i",10),s(12),i(),r(13,"div",11)(14,"input",12),S("change",function(){return o.toggleAutoRefresh()}),i(),r(15,"label",13),s(16),i()(),r(17,"div",14),h(18,Re,5,2,"select",15),h(19,Te,5,2,"select",15),i()()()()(),h(20,ze,3,3,"div",16),h(21,Ae,5,2,"div",17),h(22,Ye,13,11),i()),e&2){let l;n(),f("title",o.t("dashboard.title")),n(5),d(o.t("dashboard.welcome",Z(14,De,((l=o.currentUser())==null?null:l.username)||"User"))),n(),g(o.lastRefresh()?7:-1),n(3),f("disabled",o.loading()),n(),Y("fa-spin",o.loading()),n(),D(" ",o.t("dashboard.refresh")," "),n(2),f("checked",o.autoRefresh()),n(2),D(" ",o.t("dashboard.auto_refresh")," "),n(2),g(o.availableBranches().length>1?18:-1),n(),g(o.availableDepartments().length>1?19:-1),n(),g(o.loading()?20:-1),n(),g(o.error()&&!o.loading()?21:-1),n(),g(!o.loading()&&!o.error()?22:-1)}},dependencies:[z,de,oe,se,me,pe,A,ne,te],styles:['.dashboard-container[_ngcontent-%COMP%]{min-height:calc(100vh - 120px);padding:1.5rem;background-color:var(--bs-light)}.dashboard-header[_ngcontent-%COMP%]{background:#fff;color:var(--bs-dark);border-radius:.5rem;padding:2rem;margin-bottom:2rem;border:1px solid rgba(0,0,0,.125);box-shadow:0 .125rem .25rem #00000013}.header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:1.5rem}.title-section[_ngcontent-%COMP%]{flex:1;min-width:200px}.dashboard-title[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;margin-bottom:.5rem;color:var(--bs-primary)}.dashboard-subtitle[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--bs-secondary);margin-bottom:0}.header-controls[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap;align-items:center}.refresh-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.auto-refresh-toggle[_ngcontent-%COMP%]   .form-check-label[_ngcontent-%COMP%]{color:var(--bs-dark);font-weight:500}.filter-section[_ngcontent-%COMP%]{display:flex;gap:.5rem}.refresh-info[_ngcontent-%COMP%]{margin-top:1rem;padding-top:1rem;border-top:1px solid var(--bs-border-color)}.loading-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#ffffffe6;display:flex;align-items:center;justify-content:center;z-index:1050}.loading-content[_ngcontent-%COMP%]{text-align:center;padding:2rem;background:#fff;border-radius:1rem;box-shadow:0 10px 30px #0000001a}.loading-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--bs-secondary);font-weight:500}.metrics-section[_ngcontent-%COMP%]{margin-bottom:2rem}.section-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--bs-dark);margin-bottom:1.5rem;padding-left:1rem;border-left:4px solid var(--bs-primary)}.metrics-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;margin-bottom:2rem}.metric-card[_ngcontent-%COMP%]{background:#fff;border-radius:.5rem;padding:1.5rem;border:1px solid rgba(0,0,0,.125);box-shadow:0 .125rem .25rem #00000013;transition:box-shadow .15s ease-in-out;position:relative;overflow:hidden}.metric-card[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;height:4px;background:var(--accent-color, var(--bs-primary))}.metric-card[_ngcontent-%COMP%]:hover{box-shadow:0 .5rem 1rem #00000026}.metric-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.metric-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;color:#fff;background:var(--accent-color, var(--bs-primary))}.trend-indicator[_ngcontent-%COMP%]{font-size:1.2rem}.metric-value[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:var(--bs-dark);line-height:1;margin-bottom:.5rem}.metric-title[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:var(--bs-secondary);text-transform:uppercase;letter-spacing:.5px;margin-bottom:.5rem}.metric-change[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;color:var(--bs-success)}.card-primary[_ngcontent-%COMP%]{--accent-color: var(--bs-primary)}.card-success[_ngcontent-%COMP%]{--accent-color: var(--bs-success)}.card-info[_ngcontent-%COMP%]{--accent-color: var(--bs-info)}.card-warning[_ngcontent-%COMP%]{--accent-color: var(--bs-warning)}.card-danger[_ngcontent-%COMP%]{--accent-color: var(--bs-danger)}.card-secondary[_ngcontent-%COMP%]{--accent-color: var(--bs-secondary)}.widgets-section[_ngcontent-%COMP%]{margin-bottom:2rem}.widgets-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:2rem}.widget[_ngcontent-%COMP%]{background:#fff;border-radius:.5rem;border:1px solid rgba(0,0,0,.125);box-shadow:0 .125rem .25rem #00000013;overflow:hidden;transition:box-shadow .15s ease-in-out}.widget[_ngcontent-%COMP%]:hover{box-shadow:0 .5rem 1rem #00000026}.widget-header[_ngcontent-%COMP%]{background-color:rgba(var(--bs-primary-rgb),.1);border-bottom:1px solid rgba(var(--bs-primary-rgb),.2);padding:1.5rem}.widget-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.2rem;font-weight:600;color:var(--bs-dark)}.widget-content[_ngcontent-%COMP%]{padding:1.5rem}.attendance-stats[_ngcontent-%COMP%], .vacation-stats[_ngcontent-%COMP%], .shift-stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:1rem;margin-bottom:1.5rem}.stat-item[_ngcontent-%COMP%]{text-align:center;padding:1rem;background:#f8f9fa;border-radius:.5rem}.stat-label[_ngcontent-%COMP%]{display:block;font-size:.8rem;font-weight:600;color:var(--bs-secondary);text-transform:uppercase;letter-spacing:.5px;margin-bottom:.5rem}.stat-value[_ngcontent-%COMP%]{display:block;font-size:1.8rem;font-weight:700;color:var(--bs-dark)}.hr-stats[_ngcontent-%COMP%], .org-stats[_ngcontent-%COMP%], .system-stats[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.stat-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;background:#f8f9fa;border-radius:.5rem}.stat-row[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.9rem;font-weight:500;color:var(--bs-dark);text-transform:none;letter-spacing:normal;margin:0}.stat-row[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600}.records-list[_ngcontent-%COMP%], .recent-activities[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto}.record-item[_ngcontent-%COMP%], .activity-item[_ngcontent-%COMP%], .vacation-item[_ngcontent-%COMP%], .role-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;border-bottom:1px solid rgba(0,0,0,.05);gap:1rem}.record-item[_ngcontent-%COMP%]:last-child, .activity-item[_ngcontent-%COMP%]:last-child, .vacation-item[_ngcontent-%COMP%]:last-child, .role-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.employee-name[_ngcontent-%COMP%], .activity-description[_ngcontent-%COMP%], .role-name[_ngcontent-%COMP%]{font-weight:500;color:var(--bs-dark);flex:1}.employee-status[_ngcontent-%COMP%]{font-size:.75rem}.vacation-type[_ngcontent-%COMP%], .vacation-dates[_ngcontent-%COMP%], .activity-time[_ngcontent-%COMP%], .role-percentage[_ngcontent-%COMP%]{font-size:.85rem;color:var(--bs-secondary)}.role-count[_ngcontent-%COMP%]{font-weight:600;color:var(--bs-primary)}.auto-refresh-settings[_ngcontent-%COMP%]{position:fixed;bottom:2rem;right:2rem;z-index:1000}.settings-card[_ngcontent-%COMP%]{background:#fff;border-radius:.5rem;padding:1rem;box-shadow:0 5px 15px #0000001a;border:1px solid rgba(0,0,0,.05);min-width:200px}.settings-card[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;color:var(--bs-dark);margin-bottom:.5rem}@media (max-width: 1200px){.metrics-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(250px,1fr))}.widgets-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(350px,1fr))}}@media (max-width: 768px){.dashboard-container[_ngcontent-%COMP%]{padding:1rem}.dashboard-header[_ngcontent-%COMP%]{padding:1.5rem}.header-content[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.dashboard-title[_ngcontent-%COMP%]{font-size:2rem}.header-controls[_ngcontent-%COMP%]{width:100%;justify-content:space-between}.metrics-grid[_ngcontent-%COMP%], .widgets-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1rem}.metric-card[_ngcontent-%COMP%]{padding:1rem}.metric-value[_ngcontent-%COMP%]{font-size:2rem}.attendance-stats[_ngcontent-%COMP%], .vacation-stats[_ngcontent-%COMP%], .shift-stats[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:.5rem}.stat-item[_ngcontent-%COMP%]{padding:.75rem}.stat-value[_ngcontent-%COMP%]{font-size:1.5rem}.auto-refresh-settings[_ngcontent-%COMP%]{position:relative;bottom:auto;right:auto;margin-top:2rem}}@media (max-width: 480px){.dashboard-title[_ngcontent-%COMP%]{font-size:1.5rem}.header-controls[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.refresh-section[_ngcontent-%COMP%]{justify-content:space-between}.filter-section[_ngcontent-%COMP%]{flex-direction:column}.attendance-stats[_ngcontent-%COMP%], .vacation-stats[_ngcontent-%COMP%], .shift-stats[_ngcontent-%COMP%]{grid-template-columns:1fr}.stat-row[_ngcontent-%COMP%]{flex-direction:column;text-align:center;gap:.5rem}.record-item[_ngcontent-%COMP%], .activity-item[_ngcontent-%COMP%], .vacation-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}}[_ngcontent-%COMP%]:root[dir=rtl]   .section-title[_ngcontent-%COMP%]{padding-right:1rem;padding-left:0;border-right:4px solid var(--bs-primary);border-left:none}[_ngcontent-%COMP%]:root[dir=rtl]   .me-1[_ngcontent-%COMP%]{margin-left:.25rem!important;margin-right:0!important}[_ngcontent-%COMP%]:root[dir=rtl]   .me-2[_ngcontent-%COMP%]{margin-left:.5rem!important;margin-right:0!important}[_ngcontent-%COMP%]:root[dir=rtl]   .ms-2[_ngcontent-%COMP%]{margin-right:.5rem!important;margin-left:0!important}[_ngcontent-%COMP%]:root[dir=rtl]   .auto-refresh-settings[_ngcontent-%COMP%]{right:auto;left:2rem}.metric-card[_ngcontent-%COMP%]:focus, .widget[_ngcontent-%COMP%]:focus{outline:2px solid var(--bs-primary);outline-offset:2px}@media (prefers-reduced-motion: reduce){.metric-card[_ngcontent-%COMP%], .widget[_ngcontent-%COMP%]{animation:none}.metric-card[_ngcontent-%COMP%]:hover, .widget[_ngcontent-%COMP%]:hover{transform:none}.fa-spin[_ngcontent-%COMP%]{animation:none}}']})};export{ge as DashboardComponent};
