import{a as z}from"./chunk-E7KMSY2E.js";import{a as $}from"./chunk-VPCY7LU7.js";import"./chunk-OCNPGNI4.js";import{a as R}from"./chunk-KREF7F7A.js";import{a as L}from"./chunk-LPMX3N5X.js";import"./chunk-LDWMK676.js";import"./chunk-IE5XUEO5.js";import{a as F}from"./chunk-C3GHRZ52.js";import{r as A,t as I,z as x}from"./chunk-YQIE4CGE.js";import{a as M}from"./chunk-JNFDDMIM.js";import"./chunk-ZURD34HZ.js";import{a as N}from"./chunk-GEGVYT7O.js";import"./chunk-A6EM5NV6.js";import{A as k,E as d,Fb as O,Ga as c,Ha as m,Ia as C,L as o,Q as T,aa as y,ba as _,ea as D,fa as P,fb as w,ga as p,ha as n,ia as a,ja as h,qa as S,sa as u,ua as g,y as f,z as v}from"./chunk-5OFYUWMA.js";import{a as W,b as E,e as b}from"./chunk-YMDWBF3A.js";var V=(s,e)=>e.value;function H(s,e){if(s&1&&(n(0,"option",9),c(1),a()),s&2){let t=e.$implicit;p("value",t.value),o(),m(t.label)}}function B(s,e){if(s&1){let t=S();n(0,"button",17),u("click",function(){v(t);let r=g();return k(r.onClearFilters())}),h(1,"i",18),c(2),a()}if(s&2){let t=g();o(2),C(" ",t.t("common.clear_filters")," ")}}function U(s,e){if(s&1){let t=S();n(0,"button",19),u("click",function(){v(t);let r=g();return k(r.onCreateWorkflow())}),h(1,"i",20),c(2),a()}if(s&2){let t=g();o(2),C(" ",t.t("workflows.create_workflow")," ")}}var K=class s{workflowsService=f(z);router=f(O);notificationService=f(M);confirmationService=f(R);i18n=f(N);permissionService=f(L);PERMISSIONS={WORKFLOW_CREATE:"workflow.create",WORKFLOW_READ:"workflow.read",WORKFLOW_UPDATE:"workflow.update",WORKFLOW_DELETE:"workflow.delete"};loading=d(!1);workflows=d([]);totalCount=d(0);currentPage=d(1);pageSize=d(10);totalPages=d(0);selectedEntityType=d(void 0);selectedActiveStatus=d(void 0);entityTypes=this.workflowsService.getEntityTypes();tableColumns=w(()=>[{key:"name",label:this.t("workflows.name"),sortable:!0,width:"200px",priority:"high",mobileLabel:this.t("workflows.name")},{key:"entityTypeDisplay",label:this.t("workflows.entity_type"),sortable:!1,width:"150px",priority:"high",mobileLabel:this.t("workflows.entity_type"),renderHtml:!0},{key:"scope",label:this.t("workflows.scope"),sortable:!1,width:"150px",priority:"medium",mobileLabel:this.t("workflows.scope"),renderHtml:!0},{key:"stepsCount",label:this.t("workflows.steps_count"),sortable:!1,width:"100px",align:"center",priority:"medium",mobileLabel:this.t("workflows.steps_count")},{key:"isDefault",label:this.t("workflows.default"),sortable:!1,width:"100px",align:"center",priority:"low",hideOnMobile:!0,mobileLabel:this.t("workflows.default"),renderHtml:!0},{key:"status",label:this.t("common.status"),sortable:!1,width:"100px",align:"center",priority:"high",mobileLabel:this.t("common.status"),renderHtml:!0},{key:"createdAt",label:this.t("common.created"),sortable:!0,width:"150px",priority:"low",hideOnMobile:!0,mobileLabel:this.t("common.created")}]);tableActions=w(()=>[{key:"view",label:this.t("common.view"),icon:"fa-eye",color:"primary",condition:()=>this.permissionService.has(this.PERMISSIONS.WORKFLOW_READ)},{key:"edit",label:this.t("common.edit"),icon:"fa-edit",color:"secondary",condition:()=>this.permissionService.has(this.PERMISSIONS.WORKFLOW_UPDATE)},{key:"toggle",label:this.t("workflows.toggle_status"),icon:"fa-toggle-on",color:"warning",condition:()=>this.permissionService.has(this.PERMISSIONS.WORKFLOW_UPDATE)},{key:"delete",label:this.t("common.delete"),icon:"fa-trash",color:"danger",condition:()=>this.permissionService.has(this.PERMISSIONS.WORKFLOW_DELETE)}]);tableData=w(()=>this.workflows().map(e=>E(W({},e),{entityTypeDisplay:this.formatEntityType(e.entityType),scope:this.formatScope(e),stepsCount:e.stepCount||e.steps?.length||0,isDefault:this.formatBoolean(e.isDefault),status:this.formatStatus(e),createdAt:this.formatDate(e.createdAt)})));ngOnInit(){this.loadWorkflows()}t(e){return this.i18n.t(e)}loadWorkflows(){this.loading.set(!0),this.workflowsService.getWorkflowDefinitions(this.currentPage(),this.pageSize(),this.selectedEntityType(),void 0,this.selectedActiveStatus()).subscribe({next:e=>{e&&e.items?(this.workflows.set(e.items),this.totalCount.set(e.totalCount),this.totalPages.set(e.totalPages)):(this.workflows.set([]),this.totalCount.set(0),this.totalPages.set(0)),this.loading.set(!1)},error:e=>{console.error("Failed to load workflows:",e),this.loading.set(!1),this.notificationService.error(this.t("app.error"),this.t("workflows.load_error"))}})}formatDate(e){if(!e)return"-";let t=new Date(e);return isNaN(t.getTime())?"-":t.toLocaleDateString(this.i18n.getCurrentLocale(),{year:"numeric",month:"short",day:"numeric"})}formatEntityType(e){return`<span class="badge bg-primary">${this.workflowsService.getEntityTypeDisplayName(e)}</span>`}formatScope(e){let t=e.branchId===null||e.branchId===void 0?this.t("workflows.organization_wide"):e.branchName||`Branch ${e.branchId}`;return`<span class="${e.branchId===null||e.branchId===void 0?"badge bg-success":"badge bg-info"}">${t}</span>`}formatBoolean(e){let t=e?this.t("common.yes"):this.t("common.no");return`<span class="${e?"badge bg-success":"badge bg-secondary"}">${t}</span>`}formatStatus(e){let t=e.isActive?this.t("common.active"):this.t("common.inactive");return`<span class="${e.isActive?"badge bg-success":"badge bg-light text-dark border"}">${t}</span>`}onActionClick(e){let{action:t,item:i}=e;switch(t){case"view":this.onViewWorkflow(i);break;case"edit":this.onEditWorkflow(i);break;case"toggle":this.onToggleStatus(i);break;case"delete":this.onDeleteWorkflow(i);break;default:console.warn("Unknown action:",t)}}onPageChange(e){this.currentPage.set(e),this.loadWorkflows()}onPageSizeChange(e){this.pageSize.set(e),this.currentPage.set(1),this.loadWorkflows()}onEntityTypeChange(e){let t=e.target.value;this.selectedEntityType.set(t||void 0),this.currentPage.set(1),this.loadWorkflows()}onStatusChange(e){let t=e.target.value;this.selectedActiveStatus.set(t==="true"?!0:t==="false"?!1:void 0),this.currentPage.set(1),this.loadWorkflows()}onClearFilters(){this.selectedEntityType.set(void 0),this.selectedActiveStatus.set(void 0),this.currentPage.set(1),this.loadWorkflows()}hasActiveFilters(){return this.selectedEntityType()!==void 0||this.selectedActiveStatus()!==void 0}onCreateWorkflow(){this.router.navigate(["/settings/workflows/create"])}onViewWorkflow(e){this.router.navigate(["/settings/workflows",e.id,"view"])}onEditWorkflow(e){this.router.navigate(["/settings/workflows",e.id,"edit"])}onToggleStatus(e){return b(this,null,function*(){let t=e.isActive?"deactivate":"activate";(yield this.confirmationService.confirm({title:this.t(`workflows.${t}_title`),message:this.t(`workflows.confirm_${t}`),confirmText:this.t(`workflows.${t}`),cancelText:this.t("common.cancel"),confirmButtonClass:e.isActive?"btn-warning":"btn-success",icon:"fa-toggle-on",iconClass:e.isActive?"text-warning":"text-success"})).confirmed&&(e.isActive?this.workflowsService.deactivateWorkflowDefinition(e.id):this.workflowsService.activateWorkflowDefinition(e.id)).subscribe({next:()=>{this.loadWorkflows(),this.notificationService.success(this.t("app.success"),this.t(`workflows.${t}_success`))},error:l=>{console.error(`Failed to ${t} workflow:`,l),this.notificationService.error(this.t("app.error"),this.t(`workflows.${t}_error`))}})})}onDeleteWorkflow(e){return b(this,null,function*(){(yield this.confirmationService.confirm({title:this.t("workflows.delete_title"),message:this.t("workflows.confirm_delete"),confirmText:this.t("common.delete"),cancelText:this.t("common.cancel"),confirmButtonClass:"btn-danger",icon:"fa-trash",iconClass:"text-danger"})).confirmed&&this.workflowsService.deleteWorkflowDefinition(e.id).subscribe({next:()=>{this.loadWorkflows(),this.notificationService.success(this.t("app.success"),this.t("workflows.delete_success"))},error:i=>{console.error("Failed to delete workflow:",i),this.notificationService.error(this.t("app.error"),this.t("workflows.delete_error"))}})})}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=T({type:s,selectors:[["app-workflow-list"]],decls:30,vars:19,consts:[[1,"container-fluid","py-4"],[3,"title"],[1,"card","mb-4"],[1,"card-body"],[1,"row","g-3","align-items-end"],[1,"col-md-3"],[1,"form-label"],[1,"form-select",3,"change","value"],["value",""],[3,"value"],["value","true"],["value","false"],["type","button",1,"btn","btn-outline-secondary"],[1,"col-md-3","text-end"],["type","button",1,"btn","btn-primary"],[1,"card"],[3,"pageChange","pageSizeChange","actionClick","columns","data","loading","totalItems","currentPage","pageSize","actions","emptyMessage"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fa-solid","fa-times","me-1"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa-solid","fa-plus","me-1"]],template:function(t,i){if(t&1&&(n(0,"div",0),h(1,"app-page-header",1),n(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"label",6),c(7),a(),n(8,"select",7),u("change",function(l){return i.onEntityTypeChange(l)}),n(9,"option",8),c(10),a(),D(11,H,2,2,"option",9,V),a()(),n(13,"div",5)(14,"label",6),c(15),a(),n(16,"select",7),u("change",function(l){return i.onStatusChange(l)}),n(17,"option",8),c(18),a(),n(19,"option",10),c(20),a(),n(21,"option",11),c(22),a()()(),n(23,"div",5),y(24,B,3,1,"button",12),a(),n(25,"div",13),y(26,U,3,1,"button",14),a()()()(),n(27,"div",15)(28,"div",3)(29,"app-data-table",16),u("pageChange",function(l){return i.onPageChange(l)})("pageSizeChange",function(l){return i.onPageSizeChange(l)})("actionClick",function(l){return i.onActionClick(l)}),a()()()()),t&2){let r;o(),p("title",i.t("workflows.title")),o(6),m(i.t("workflows.filter_entity_type")),o(),p("value",i.selectedEntityType()||""),o(2),m(i.t("common.all")),o(),P(i.entityTypes),o(4),m(i.t("workflows.filter_status")),o(),p("value",i.selectedActiveStatus()===void 0?"":(r=i.selectedActiveStatus())==null?null:r.toString()),o(2),m(i.t("common.all")),o(2),m(i.t("common.active")),o(2),m(i.t("common.inactive")),o(2),_(i.hasActiveFilters()?24:-1),o(2),_(i.permissionService.has(i.PERMISSIONS.WORKFLOW_CREATE)?26:-1),o(3),p("columns",i.tableColumns())("data",i.tableData())("loading",i.loading())("totalItems",i.totalCount())("currentPage",i.currentPage())("pageSize",i.pageSize())("actions",i.tableActions())("emptyMessage",i.t("workflows.no_workflows"))}},dependencies:[x,A,I,$,F],styles:[".badge[_ngcontent-%COMP%]{font-weight:500}.card[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}@media (max-width: 768px){.row.g-3[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:.5rem}}"]})};export{K as WorkflowListComponent};
