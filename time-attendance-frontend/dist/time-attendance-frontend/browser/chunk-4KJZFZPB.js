import{a as $}from"./chunk-MRHL7QNZ.js";import{a as k}from"./chunk-I575RJ3N.js";import{a as T}from"./chunk-J3GNOZZE.js";import{a as A}from"./chunk-GFZWVZDY.js";import{a as O}from"./chunk-MPEAAPTS.js";import{a as c,b as p}from"./chunk-Y62N6K5S.js";import{a as P}from"./chunk-EYAJMHM7.js";import"./chunk-TZ2XIVGW.js";import{a as V}from"./chunk-TXT7NU7Z.js";import{b as L}from"./chunk-RCBJJ7UY.js";import{d as D,g as B}from"./chunk-TWXUAMJ4.js";import{Bb as m,Cb as _,Db as g,Ea as w,Ia as x,R as v,W as y,X as U,Xa as S,Ya as C,Yb as f,bb as u,cb as s,da as h,db as a,eb as l,lb as R,nb as N,pb as d,ta as i,wc as M}from"./chunk-JSQL33QG.js";import"./chunk-DGAILPFQ.js";function j(n,e){if(n&1&&(s(0,"div",2),l(1,"app-loading-spinner",5),a()),n&2){let t=d();i(),u("message",t.t("common.loading"))("centered",!0)}}function H(n,e){if(n&1&&l(0,"i",14),n&2){let t=d(2);u("title",t.t("users.must_change_password"))}}function K(n,e){if(n&1){let t=R();s(0,"button",28),N("click",function(){y(t);let b=d(2);return U(b.onManageRoles())}),l(1,"i",29),m(2),a()}if(n&2){let t=d(2);i(2),g(" ",t.t("users.manage_roles")," ")}}function W(n,e){if(n&1&&(s(0,"button",26),l(1,"i",31),m(2),a()),n&2){let t=d(3);i(2),g(" ",t.t("users.lock_account")," ")}}function G(n,e){if(n&1&&x(0,W,3,1,"button",30),n&2){let t=d(2);u("appHasPermission",t.PERMISSIONS.USER_LOCK)}}function q(n,e){if(n&1&&(s(0,"button",27),l(1,"i",33),m(2),a()),n&2){let t=d(3);i(2),g(" ",t.t("users.unlock_account")," ")}}function z(n,e){if(n&1&&x(0,q,3,1,"button",32),n&2){let t=d(2);u("appHasPermission",t.PERMISSIONS.USER_UNLOCK)}}function J(n,e){if(n&1&&(s(0,"div",3)(1,"div",6)(2,"div",7)(3,"div",8)(4,"h5",9)(5,"div",10)(6,"div",11)(7,"div",12),m(8),a()(),s(9,"div")(10,"div",13),m(11),S(12,H,1,1,"i",14),a(),s(13,"small",15),m(14),a()()()()(),s(15,"div",16)(16,"div",3)(17,"div",17),l(18,"app-definition-list",18),a(),s(19,"div",17),l(20,"app-definition-list",18),a()()()()(),s(21,"div",19)(22,"div",7)(23,"div",8)(24,"h6",9),m(25),a()(),s(26,"div",16)(27,"div",20)(28,"h6",21),m(29),a(),l(30,"app-badge-list",22),a(),s(31,"div")(32,"h6",21),m(33),a(),l(34,"app-badge-list",22),a()()(),s(35,"div",23)(36,"div",8)(37,"h6",9),m(38),a()(),s(39,"div",16)(40,"div",24),x(41,K,3,1,"button",25),S(42,G,1,1,"button",26)(43,z,1,1,"button",27),a()()()()()),n&2){let t,o,b,E,I,r=d();i(8),g(" ",(((t=r.user())==null||t.username==null?null:t.username.charAt(0))||"")==null?null:(((t=t)==null||t.username==null?null:t.username.charAt(0))||"").toUpperCase()," "),i(3),g(" ",(o=r.user())==null?null:o.username," "),i(),C((b=r.user())!=null&&b.mustChangePassword?12:-1),i(2),_((E=r.user())==null?null:E.email),i(4),u("items",r.basicInfoItems())("labelWidth","4")("valueWidth","8"),i(2),u("items",r.statusInfoItems())("labelWidth","4")("valueWidth","8"),i(5),_(r.t("users.roles_and_access")),i(4),_(r.t("users.roles")),i(),u("items",r.roleBadges())("gap","sm")("emptyMessage",r.t("users.no_roles")),i(3),_(r.t("users.branches")),i(),u("items",r.branchBadges())("gap","sm")("emptyMessage",r.t("users.all_branches")),i(4),_(r.t("common.actions")),i(3),u("appHasPermission",r.PERMISSIONS.USER_ASSIGN_ROLE),i(),C((I=r.user())!=null&&I.isActive?42:43)}}function Q(n,e){if(n&1&&(s(0,"div",4),l(1,"i",34),m(2),a()),n&2){let t=d();i(2),g(" ",t.error()||t.t("users.user_not_found")," ")}}var F=class n{router=v(B);route=v(D);usersService=v(V);i18n=v(L);permissionService=v(O);loading=h(!1);error=h(null);user=h(null);userId=0;PERMISSIONS={USER_UPDATE:`${p.USER}.${c.UPDATE}`,USER_DELETE:`${p.USER}.${c.DELETE}`,USER_LOCK:`${p.USER}.${c.LOCK}`,USER_UNLOCK:`${p.USER}.${c.UNLOCK}`,USER_ASSIGN_ROLE:`${p.USER}.${c.ASSIGN_ROLE}`,USER_REMOVE_ROLE:`${p.USER}.${c.REMOVE_ROLE}`,USER_MANAGE:`${p.USER}.${c.MANAGE}`};ngOnInit(){this.userId=+this.route.snapshot.params.id,this.userId?this.loadUser():this.router.navigate(["/users"])}loadUser(){this.loading.set(!0),this.usersService.getUserById(this.userId).subscribe({next:e=>{this.user.set(e),this.loading.set(!1)},error:e=>{this.error.set("Failed to load user"),this.loading.set(!1),console.error("Error loading user:",e)}})}onManageRoles(){console.log("Manage roles for user:",this.userId)}isUserLocked(e){return e?new Date(e)>new Date:!1}formatDate(e){return new Date(e).toLocaleDateString()}t(e){return this.i18n.t(e)}getRoleName(e){return typeof e=="string"?e:e&&typeof e=="object"&&e.name?e.name:e&&typeof e=="object"&&e.roleName?e.roleName:String(e)||"Unknown Role"}getBranchName(e){return typeof e=="string"?e:e&&typeof e=="object"&&e.name?e.name:e&&typeof e=="object"&&e.branchName?e.branchName:String(e)||"Unknown Branch"}roleBadges=f(()=>{let e=this.user();return!e?.roles||e.roles.length===0?[]:e.roles.map((t,o)=>({id:o,label:this.getRoleName(t),variant:"info"}))});branchBadges=f(()=>{let e=this.user();return!e?.branches||e.branches.length===0?[]:e.branches.map((t,o)=>({id:o,label:this.getBranchName(t),variant:"light"}))});userStatusBadge=f(()=>{let e=this.user();return this.isUserLocked(e?.lockoutEndUtc)?{label:this.t("users.locked"),variant:"danger"}:e?.isActive?{label:this.t("common.active"),variant:"success"}:{label:this.t("common.inactive"),variant:"light"}});twoFactorBadge=f(()=>this.user()?.twoFactorEnabled?{label:this.t("common.enabled"),variant:"success"}:{label:this.t("common.disabled"),variant:"light"});basicInfoItems=f(()=>{let e=this.user();if(!e)return[];let t=e.preferredLanguage==="ar"?this.t("common.language_arabic"):this.t("common.language_english");return[{label:this.t("users.username"),value:e.username},{label:this.t("users.email"),value:e.email},{label:this.t("users.phone"),value:e.phone||"-"},{label:this.t("users.language"),value:t}]});statusInfoItems=f(()=>{let e=this.user();return e?[{label:this.t("common.status"),value:this.userStatusBadge().label,type:"badge",badgeVariant:this.userStatusBadge().variant},{label:this.t("users.created_at"),value:e.createdAtUtc,type:"date"},{label:this.t("users.two_factor"),value:this.twoFactorBadge().label,type:"badge",badgeVariant:this.twoFactorBadge().variant},{label:this.t("users.login_attempts"),value:String(e.accessFailedCount||0)}]:[]});static \u0275fac=function(t){return new(t||n)};static \u0275cmp=w({type:n,selectors:[["app-view-user"]],decls:5,vars:4,consts:[[1,"container-fluid"],["mode","view","moduleName","users","moduleRoute","users",3,"title","entityId","loading"],[1,"d-flex","justify-content-center","py-5"],[1,"row"],[1,"alert","alert-danger"],[3,"message","centered"],[1,"col-lg-8"],[1,"card"],[1,"card-header"],[1,"card-title","mb-0"],[1,"d-flex","align-items-center"],[1,"avatar-sm","me-3"],[1,"avatar-title","bg-primary-subtle","text-primary","rounded-circle"],[1,"fw-medium"],[1,"fa-solid","fa-exclamation-triangle","text-warning","ms-2",3,"title"],[1,"text-muted"],[1,"card-body"],[1,"col-md-6"],[3,"items","labelWidth","valueWidth"],[1,"col-lg-4"],[1,"mb-3"],[1,"fw-semibold"],[3,"items","gap","emptyMessage"],[1,"card","mt-3"],[1,"d-grid","gap-2"],["type","button","class","btn btn-outline-info",3,"click",4,"appHasPermission"],["type","button",1,"btn","btn-outline-warning"],["type","button",1,"btn","btn-outline-success"],["type","button",1,"btn","btn-outline-info",3,"click"],[1,"fa-solid","fa-user-tag","me-2"],["type","button","class","btn btn-outline-warning",4,"appHasPermission"],[1,"fa-solid","fa-lock","me-2"],["type","button","class","btn btn-outline-success",4,"appHasPermission"],[1,"fa-solid","fa-unlock","me-2"],[1,"fa-solid","fa-exclamation-triangle","me-2"]],template:function(t,o){t&1&&(s(0,"div",0),l(1,"app-form-header",1),S(2,j,2,2,"div",2)(3,J,44,22,"div",3)(4,Q,3,1,"div",4),a()),t&2&&(i(),u("title",o.t("users.view_details"))("entityId",o.userId)("loading",o.loading()),i(),C(o.loading()?2:o.user()?3:4))},dependencies:[M,A,k,P,T,$],styles:[".avatar-sm[_ngcontent-%COMP%]{width:2.5rem;height:2.5rem;display:flex;align-items:center;justify-content:center}.avatar-title[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-weight:600}"]})};export{F as ViewUserComponent};
