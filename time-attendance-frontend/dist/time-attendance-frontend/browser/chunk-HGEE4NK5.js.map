{
  "version": 3,
  "sources": ["src/app/pages/approvals/approvals.service.ts"],
  "sourcesContent": ["import { Injectable, inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { environment } from '../../../environments/environment';\r\nimport {\r\n  WorkflowEntityType,\r\n  ApprovalAction,\r\n  PendingApproval,\r\n  ApprovalHistoryItem,\r\n  ApprovalDelegation,\r\n  ApprovalActionRequest,\r\n  DelegateApprovalRequest,\r\n  CreateDelegationRequest,\r\n  PagedWorkflowResponse\r\n} from '../../shared/models/workflow.model';\r\n\r\n/**\r\n * API response wrapper (matches backend Result<T> structure)\r\n */\r\ninterface ApiResponse<T> {\r\n  value: T;\r\n  isSuccess: boolean;\r\n  isFailure: boolean;\r\n  error?: string;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ApprovalsService {\r\n  private http = inject(HttpClient);\r\n  private baseUrl = `${environment.apiUrl}/api/v1/approvals`;\r\n\r\n  /**\r\n   * Get pending approvals for current user\r\n   */\r\n  getPendingApprovals(\r\n    page: number = 1,\r\n    pageSize: number = 10,\r\n    entityType?: WorkflowEntityType | null,\r\n    isOverdue?: boolean | null\r\n  ): Observable<PagedWorkflowResponse<PendingApproval>> {\r\n    let params = new HttpParams()\r\n      .set('page', page.toString())\r\n      .set('pageSize', pageSize.toString());\r\n\r\n    if (entityType !== null && entityType !== undefined) {\r\n      params = params.set('entityType', entityType);\r\n    }\r\n\r\n    if (isOverdue !== null && isOverdue !== undefined) {\r\n      params = params.set('isOverdue', isOverdue.toString());\r\n    }\r\n\r\n    return this.http.get<ApiResponse<PagedWorkflowResponse<PendingApproval>>>(`${this.baseUrl}/pending`, { params })\r\n      .pipe(\r\n        map(response => response.value)\r\n      );\r\n  }\r\n\r\n  /**\r\n   * Get approval history for current user\r\n   */\r\n  getApprovalHistory(filters: {\r\n    page: number;\r\n    pageSize: number;\r\n    entityType?: string | null;\r\n    action?: string | null;\r\n    dateFrom?: string | null;\r\n    dateTo?: string | null;\r\n  }): Observable<PagedWorkflowResponse<ApprovalHistoryItem>> {\r\n    let params = new HttpParams()\r\n      .set('page', filters.page.toString())\r\n      .set('pageSize', filters.pageSize.toString());\r\n\r\n    if (filters.entityType) {\r\n      params = params.set('entityType', filters.entityType);\r\n    }\r\n\r\n    if (filters.action) {\r\n      params = params.set('action', filters.action);\r\n    }\r\n\r\n    if (filters.dateFrom) {\r\n      params = params.set('dateFrom', filters.dateFrom);\r\n    }\r\n\r\n    if (filters.dateTo) {\r\n      params = params.set('dateTo', filters.dateTo);\r\n    }\r\n\r\n    return this.http.get<ApiResponse<PagedWorkflowResponse<ApprovalHistoryItem>>>(`${this.baseUrl}/history`, { params })\r\n      .pipe(\r\n        map(response => response.value)\r\n      );\r\n  }\r\n\r\n  /**\r\n   * Approve a workflow step\r\n   */\r\n  approveStep(workflowInstanceId: number, request: ApprovalActionRequest): Observable<void> {\r\n    return this.http.post<ApiResponse<void>>(`${this.baseUrl}/${workflowInstanceId}/approve`, request)\r\n      .pipe(\r\n        map(() => void 0)\r\n      );\r\n  }\r\n\r\n  /**\r\n   * Reject a workflow step\r\n   */\r\n  rejectStep(workflowInstanceId: number, request: ApprovalActionRequest): Observable<void> {\r\n    return this.http.post<ApiResponse<void>>(`${this.baseUrl}/${workflowInstanceId}/reject`, request)\r\n      .pipe(\r\n        map(() => void 0)\r\n      );\r\n  }\r\n\r\n  /**\r\n   * Delegate a workflow step to another user\r\n   */\r\n  delegateStep(workflowInstanceId: number, request: DelegateApprovalRequest): Observable<void> {\r\n    return this.http.post<ApiResponse<void>>(`${this.baseUrl}/${workflowInstanceId}/delegate`, request)\r\n      .pipe(\r\n        map(() => void 0)\r\n      );\r\n  }\r\n\r\n  /**\r\n   * Cancel a workflow\r\n   */\r\n  cancelWorkflow(workflowInstanceId: number, reason?: string): Observable<void> {\r\n    return this.http.post<ApiResponse<void>>(`${this.baseUrl}/${workflowInstanceId}/cancel`, { reason })\r\n      .pipe(\r\n        map(() => void 0)\r\n      );\r\n  }\r\n\r\n  /**\r\n   * Create a new approval delegation\r\n   */\r\n  createDelegation(request: CreateDelegationRequest): Observable<number> {\r\n    return this.http.post<ApiResponse<number>>(`${this.baseUrl}/delegations`, request)\r\n      .pipe(\r\n        map(response => response.value)\r\n      );\r\n  }\r\n\r\n  /**\r\n   * Delete an approval delegation\r\n   */\r\n  deleteDelegation(id: number): Observable<void> {\r\n    return this.http.delete<ApiResponse<void>>(`${this.baseUrl}/delegations/${id}`)\r\n      .pipe(\r\n        map(() => void 0)\r\n      );\r\n  }\r\n\r\n  /**\r\n   * Get entity type display name\r\n   */\r\n  getEntityTypeDisplayName(entityType: WorkflowEntityType): string {\r\n    const displayNames: Record<WorkflowEntityType, string> = {\r\n      'Vacation': 'Vacation Request',\r\n      'Excuse': 'Excuse Request',\r\n      'RemoteWork': 'Remote Work Request',\r\n      'Overtime': 'Overtime Request',\r\n      'Timesheet': 'Timesheet',\r\n      'AttendanceCorrection': 'Attendance Correction',\r\n      'FingerprintRequest': 'Fingerprint Request'\r\n    };\r\n    return displayNames[entityType] || entityType;\r\n  }\r\n\r\n  /**\r\n   * Get action display name\r\n   */\r\n  getActionDisplayName(action: ApprovalAction): string {\r\n    const displayNames: Record<ApprovalAction, string> = {\r\n      'Approved': 'Approved',\r\n      'Rejected': 'Rejected',\r\n      'Delegated': 'Delegated',\r\n      'Skipped': 'Skipped',\r\n      'TimedOut': 'Timed Out'\r\n    };\r\n    return displayNames[action] || action;\r\n  }\r\n\r\n  /**\r\n   * Get action badge class\r\n   */\r\n  getActionBadgeClass(action: ApprovalAction): string {\r\n    const classes: Record<ApprovalAction, string> = {\r\n      'Approved': 'bg-success',\r\n      'Rejected': 'bg-danger',\r\n      'Delegated': 'bg-info',\r\n      'Skipped': 'bg-secondary',\r\n      'TimedOut': 'bg-warning text-dark'\r\n    };\r\n    return classes[action] || 'bg-secondary';\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AA8BM,IAAO,oBAAP,MAAO,kBAAgB;EACnB,OAAO,OAAO,UAAU;EACxB,UAAU,GAAG,YAAY,MAAM;;;;EAKvC,oBACE,OAAe,GACf,WAAmB,IACnB,YACA,WAA0B;AAE1B,QAAI,SAAS,IAAI,WAAU,EACxB,IAAI,QAAQ,KAAK,SAAQ,CAAE,EAC3B,IAAI,YAAY,SAAS,SAAQ,CAAE;AAEtC,QAAI,eAAe,QAAQ,eAAe,QAAW;AACnD,eAAS,OAAO,IAAI,cAAc,UAAU;IAC9C;AAEA,QAAI,cAAc,QAAQ,cAAc,QAAW;AACjD,eAAS,OAAO,IAAI,aAAa,UAAU,SAAQ,CAAE;IACvD;AAEA,WAAO,KAAK,KAAK,IAAyD,GAAG,KAAK,OAAO,YAAY,EAAE,OAAM,CAAE,EAC5G,KACC,IAAI,cAAY,SAAS,KAAK,CAAC;EAErC;;;;EAKA,mBAAmB,SAOlB;AACC,QAAI,SAAS,IAAI,WAAU,EACxB,IAAI,QAAQ,QAAQ,KAAK,SAAQ,CAAE,EACnC,IAAI,YAAY,QAAQ,SAAS,SAAQ,CAAE;AAE9C,QAAI,QAAQ,YAAY;AACtB,eAAS,OAAO,IAAI,cAAc,QAAQ,UAAU;IACtD;AAEA,QAAI,QAAQ,QAAQ;AAClB,eAAS,OAAO,IAAI,UAAU,QAAQ,MAAM;IAC9C;AAEA,QAAI,QAAQ,UAAU;AACpB,eAAS,OAAO,IAAI,YAAY,QAAQ,QAAQ;IAClD;AAEA,QAAI,QAAQ,QAAQ;AAClB,eAAS,OAAO,IAAI,UAAU,QAAQ,MAAM;IAC9C;AAEA,WAAO,KAAK,KAAK,IAA6D,GAAG,KAAK,OAAO,YAAY,EAAE,OAAM,CAAE,EAChH,KACC,IAAI,cAAY,SAAS,KAAK,CAAC;EAErC;;;;EAKA,YAAY,oBAA4B,SAA8B;AACpE,WAAO,KAAK,KAAK,KAAwB,GAAG,KAAK,OAAO,IAAI,kBAAkB,YAAY,OAAO,EAC9F,KACC,IAAI,MAAM,MAAM,CAAC;EAEvB;;;;EAKA,WAAW,oBAA4B,SAA8B;AACnE,WAAO,KAAK,KAAK,KAAwB,GAAG,KAAK,OAAO,IAAI,kBAAkB,WAAW,OAAO,EAC7F,KACC,IAAI,MAAM,MAAM,CAAC;EAEvB;;;;EAKA,aAAa,oBAA4B,SAAgC;AACvE,WAAO,KAAK,KAAK,KAAwB,GAAG,KAAK,OAAO,IAAI,kBAAkB,aAAa,OAAO,EAC/F,KACC,IAAI,MAAM,MAAM,CAAC;EAEvB;;;;EAKA,eAAe,oBAA4B,QAAe;AACxD,WAAO,KAAK,KAAK,KAAwB,GAAG,KAAK,OAAO,IAAI,kBAAkB,WAAW,EAAE,OAAM,CAAE,EAChG,KACC,IAAI,MAAM,MAAM,CAAC;EAEvB;;;;EAKA,iBAAiB,SAAgC;AAC/C,WAAO,KAAK,KAAK,KAA0B,GAAG,KAAK,OAAO,gBAAgB,OAAO,EAC9E,KACC,IAAI,cAAY,SAAS,KAAK,CAAC;EAErC;;;;EAKA,iBAAiB,IAAU;AACzB,WAAO,KAAK,KAAK,OAA0B,GAAG,KAAK,OAAO,gBAAgB,EAAE,EAAE,EAC3E,KACC,IAAI,MAAM,MAAM,CAAC;EAEvB;;;;EAKA,yBAAyB,YAA8B;AACrD,UAAM,eAAmD;MACvD,YAAY;MACZ,UAAU;MACV,cAAc;MACd,YAAY;MACZ,aAAa;MACb,wBAAwB;MACxB,sBAAsB;;AAExB,WAAO,aAAa,UAAU,KAAK;EACrC;;;;EAKA,qBAAqB,QAAsB;AACzC,UAAM,eAA+C;MACnD,YAAY;MACZ,YAAY;MACZ,aAAa;MACb,WAAW;MACX,YAAY;;AAEd,WAAO,aAAa,MAAM,KAAK;EACjC;;;;EAKA,oBAAoB,QAAsB;AACxC,UAAM,UAA0C;MAC9C,YAAY;MACZ,YAAY;MACZ,aAAa;MACb,WAAW;MACX,YAAY;;AAEd,WAAO,QAAQ,MAAM,KAAK;EAC5B;;AA1K2B;cAAhB;mCAAA,mBAAgB;AAAA;cAAhB,uFAAA,mBAAgB,SAAhB,kBAAgB,WAAA,YAFf,OAAM,CAAA;AAEd,IAAO,mBAAP;;sEAAO,kBAAgB,CAAA;UAH5B;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
