{
  "version": 3,
  "sources": ["src/app/pages/departments/departments.service.ts"],
  "sourcesContent": ["import { Injectable, inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { environment } from '../../../environments/environment';\r\nimport { \r\n  DepartmentDto, \r\n  CreateDepartmentRequest, \r\n  UpdateDepartmentRequest, \r\n  DepartmentFilter \r\n} from '../../shared/models/department.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DepartmentsService {\r\n  private http = inject(HttpClient);\r\n  private readonly baseUrl = `${environment.apiUrl}/api/v1/departments`;\r\n\r\n  getDepartments(filter: DepartmentFilter = {}): Observable<DepartmentDto[]> {\r\n    let params = new HttpParams();\r\n    \r\n    if (filter.branchId !== undefined && filter.branchId !== null) {\r\n      params = params.set('branchId', filter.branchId.toString());\r\n    }\r\n    if (filter.includeTree !== undefined) {\r\n      params = params.set('includeTree', filter.includeTree.toString());\r\n    }\r\n    if (filter.isActive !== undefined) {\r\n      params = params.set('isActive', filter.isActive.toString());\r\n    }\r\n    if (filter.search) {\r\n      params = params.set('search', filter.search);\r\n    }\r\n    if (filter.parentDepartmentId !== undefined) {\r\n      params = params.set('parentDepartmentId', filter.parentDepartmentId.toString());\r\n    }\r\n    if (filter.includeInactive !== undefined) {\r\n      params = params.set('includeInactive', filter.includeInactive.toString());\r\n    }\r\n\r\n    return this.http.get<DepartmentDto[]>(this.baseUrl, { params });\r\n  }\r\n\r\n  getDepartmentTree(branchId?: number): Observable<DepartmentDto[]> {\r\n    return this.getDepartments({\r\n      branchId,\r\n      includeTree: true,\r\n      isActive: true\r\n    });\r\n  }\r\n\r\n  getDepartmentById(id: number): Observable<DepartmentDto> {\r\n    return this.http.get<DepartmentDto>(`${this.baseUrl}/${id}`);\r\n  }\r\n\r\n  createDepartment(department: CreateDepartmentRequest): Observable<{ id: number }> {\r\n    return this.http.post<{ id: number }>(this.baseUrl, department);\r\n  }\r\n\r\n  updateDepartment(id: number, department: UpdateDepartmentRequest): Observable<void> {\r\n    return this.http.put<void>(`${this.baseUrl}/${id}`, department);\r\n  }\r\n\r\n  deleteDepartment(id: number): Observable<void> {\r\n    return this.http.delete<void>(`${this.baseUrl}/${id}`);\r\n  }\r\n\r\n  // Helper method to flatten tree structure for table view\r\n  flattenDepartmentTree(departments: DepartmentDto[]): DepartmentDto[] {\r\n    const result: DepartmentDto[] = [];\r\n    \r\n    const flatten = (items: DepartmentDto[], level: number = 0) => {\r\n      for (const item of items) {\r\n        result.push({ ...item, level });\r\n        if (item.children && item.children.length > 0) {\r\n          flatten(item.children, level + 1);\r\n        }\r\n      }\r\n    };\r\n    \r\n    flatten(departments);\r\n    return result;\r\n  }\r\n\r\n  // Helper method to build department path\r\n  buildDepartmentPath(departmentId: number, allDepartments: DepartmentDto[]): string {\r\n    const department = allDepartments.find(d => d.id === departmentId);\r\n    if (!department) return '';\r\n    \r\n    if (!department.parentDepartmentId) {\r\n      return department.name;\r\n    }\r\n    \r\n    const parentPath = this.buildDepartmentPath(department.parentDepartmentId, allDepartments);\r\n    return `${parentPath} > ${department.name}`;\r\n  }\r\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAcM,IAAO,sBAAP,MAAO,oBAAkB;EACrB,OAAO,OAAO,UAAU;EACf,UAAU,GAAG,YAAY,MAAM;EAEhD,eAAe,SAA2B,CAAA,GAAE;AAC1C,QAAI,SAAS,IAAI,WAAU;AAE3B,QAAI,OAAO,aAAa,UAAa,OAAO,aAAa,MAAM;AAC7D,eAAS,OAAO,IAAI,YAAY,OAAO,SAAS,SAAQ,CAAE;IAC5D;AACA,QAAI,OAAO,gBAAgB,QAAW;AACpC,eAAS,OAAO,IAAI,eAAe,OAAO,YAAY,SAAQ,CAAE;IAClE;AACA,QAAI,OAAO,aAAa,QAAW;AACjC,eAAS,OAAO,IAAI,YAAY,OAAO,SAAS,SAAQ,CAAE;IAC5D;AACA,QAAI,OAAO,QAAQ;AACjB,eAAS,OAAO,IAAI,UAAU,OAAO,MAAM;IAC7C;AACA,QAAI,OAAO,uBAAuB,QAAW;AAC3C,eAAS,OAAO,IAAI,sBAAsB,OAAO,mBAAmB,SAAQ,CAAE;IAChF;AACA,QAAI,OAAO,oBAAoB,QAAW;AACxC,eAAS,OAAO,IAAI,mBAAmB,OAAO,gBAAgB,SAAQ,CAAE;IAC1E;AAEA,WAAO,KAAK,KAAK,IAAqB,KAAK,SAAS,EAAE,OAAM,CAAE;EAChE;EAEA,kBAAkB,UAAiB;AACjC,WAAO,KAAK,eAAe;MACzB;MACA,aAAa;MACb,UAAU;KACX;EACH;EAEA,kBAAkB,IAAU;AAC1B,WAAO,KAAK,KAAK,IAAmB,GAAG,KAAK,OAAO,IAAI,EAAE,EAAE;EAC7D;EAEA,iBAAiB,YAAmC;AAClD,WAAO,KAAK,KAAK,KAAqB,KAAK,SAAS,UAAU;EAChE;EAEA,iBAAiB,IAAY,YAAmC;AAC9D,WAAO,KAAK,KAAK,IAAU,GAAG,KAAK,OAAO,IAAI,EAAE,IAAI,UAAU;EAChE;EAEA,iBAAiB,IAAU;AACzB,WAAO,KAAK,KAAK,OAAa,GAAG,KAAK,OAAO,IAAI,EAAE,EAAE;EACvD;;EAGA,sBAAsB,aAA4B;AAChD,UAAM,SAA0B,CAAA;AAEhC,UAAM,UAAU,wBAAC,OAAwB,QAAgB,MAAK;AAC5D,iBAAW,QAAQ,OAAO;AACxB,eAAO,KAAK,iCAAK,OAAL,EAAW,MAAK,EAAE;AAC9B,YAAI,KAAK,YAAY,KAAK,SAAS,SAAS,GAAG;AAC7C,kBAAQ,KAAK,UAAU,QAAQ,CAAC;QAClC;MACF;IACF,GAPgB;AAShB,YAAQ,WAAW;AACnB,WAAO;EACT;;EAGA,oBAAoB,cAAsB,gBAA+B;AACvE,UAAM,aAAa,eAAe,KAAK,OAAK,EAAE,OAAO,YAAY;AACjE,QAAI,CAAC;AAAY,aAAO;AAExB,QAAI,CAAC,WAAW,oBAAoB;AAClC,aAAO,WAAW;IACpB;AAEA,UAAM,aAAa,KAAK,oBAAoB,WAAW,oBAAoB,cAAc;AACzF,WAAO,GAAG,UAAU,MAAM,WAAW,IAAI;EAC3C;;AAjF6B;cAAlB;mCAAA,qBAAkB;AAAA;cAAlB,yFAAA,qBAAkB,SAAlB,oBAAkB,WAAA,YAFjB,OAAM,CAAA;AAEd,IAAO,qBAAP;;sEAAO,oBAAkB,CAAA;UAH9B;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
