import{a as pe}from"./chunk-FDL2CFXM.js";import{a as ue}from"./chunk-RQBJFQCN.js";import{a as de}from"./chunk-K7WTKFJQ.js";import{a as N}from"./chunk-RPZ7FJDY.js";import{a as me}from"./chunk-NPDCAEA6.js";import"./chunk-QW24EDIR.js";import"./chunk-QXVLGI72.js";import"./chunk-HUSARQNL.js";import{a as se}from"./chunk-H5EPUHY6.js";import{a as K}from"./chunk-N7S3JMGU.js";import{a as k,b as S}from"./chunk-Y62N6K5S.js";import{b as Q,c as Y,d as M,e as W,f as J,i as X,k as Z,m as ee,n as te,o as ne,p as ie,r as oe,w as ae,x as re,y as le}from"./chunk-VRETN7JA.js";import"./chunk-GRQ6RO47.js";import{a as ce}from"./chunk-UBCI4X5Q.js";import"./chunk-EYAJMHM7.js";import{a as A}from"./chunk-HHXRLUSQ.js";import"./chunk-UWVH5K3J.js";import{b as D}from"./chunk-RUY4WPQA.js";import{g as H}from"./chunk-TWXUAMJ4.js";import{$a as T,Bb as l,Cb as p,Db as m,Ea as E,Eb as q,Ia as U,Ka as R,Pb as L,R as h,Ub as G,W as C,X as y,Xa as g,Ya as _,Yb as w,ab as O,bb as d,cb as r,da as v,db as a,eb as f,lb as P,nb as b,nc as j,pb as c,ta as o,wc as I,yb as x}from"./chunk-JSQL33QG.js";import{a as F,b as $}from"./chunk-DGAILPFQ.js";var z=(i,e)=>e.id;function be(i,e){if(i&1&&(r(0,"option",17),l(1),a()),i&2){let t=e.$implicit;d("value",t.id),o(),p(t.name)}}function he(i,e){if(i&1&&(r(0,"div",18),l(1),a()),i&2){let t=c(2);o(),m(" ",t.getErrorMessage("branchId")," ")}}function Ce(i,e){if(i&1){let t=P();r(0,"div",4)(1,"label",5),l(2),a(),r(3,"select",34),b("change",function(){C(t);let s=c();return y(s.onTargetChange())}),r(4,"option",16),l(5),a(),T(6,be,2,2,"option",17,z),a(),g(8,he,2,1,"div",18),a()}if(i&2){let t=c();o(2),m("",t.i18n.t("employee_vacations.select_branch")," *"),o(),x("is-invalid",t.hasError("branchId")),o(2),p(t.i18n.t("employee_vacations.select_branch_placeholder")),o(),O(t.branches()),o(2),_(t.hasError("branchId")?8:-1)}}function ye(i,e){if(i&1&&(r(0,"option",17),l(1),a()),i&2){let t=e.$implicit;d("value",t.id),o(),p(t.name)}}function Ve(i,e){if(i&1&&(r(0,"div",18),l(1),a()),i&2){let t=c(2);o(),m(" ",t.getErrorMessage("departmentId")," ")}}function xe(i,e){if(i&1){let t=P();r(0,"div",4)(1,"label",5),l(2),a(),r(3,"select",35),b("change",function(){C(t);let s=c();return y(s.onTargetChange())}),r(4,"option",16),l(5),a(),T(6,ye,2,2,"option",17,z),a(),g(8,Ve,2,1,"div",18),a()}if(i&2){let t=c();o(2),m("",t.i18n.t("employee_vacations.select_department")," *"),o(),x("is-invalid",t.hasError("departmentId")),o(2),p(t.i18n.t("employee_vacations.select_department_placeholder")),o(),O(t.departments()),o(2),_(t.hasError("departmentId")?8:-1)}}function Me(i,e){if(i&1&&(f(0,"div",32),r(1,"span"),l(2),a()),i&2){let t=c(2);o(2),p(t.i18n.t("employee_vacations.loading_preview"))}}function ke(i,e){if(i&1&&(f(0,"i",37),r(1,"span"),l(2),a()),i&2){let t=c(2);o(2),m(" ",t.i18n.t("employee_vacations.employees_affected").replace("{{count}}",(t.previewEmployeeCount()||0).toString())," ")}}function Se(i,e){if(i&1&&(r(0,"div",13)(1,"div",36),g(2,Me,3,1)(3,ke,3,1),a()()),i&2){let t=c();o(2),_(t.loadingPreview()?2:3)}}function Pe(i,e){if(i&1&&(r(0,"option",17),l(1),a()),i&2){let t=e.$implicit;d("value",t.id),o(),p(t.name)}}function Ee(i,e){if(i&1&&(r(0,"div",18),l(1),a()),i&2){let t=c();o(),m(" ",t.getErrorMessage("vacationTypeId")," ")}}function Te(i,e){if(i&1&&(r(0,"div",18),l(1),a()),i&2){let t=c();o(),m(" ",t.getErrorMessage("startDate")," ")}}function Oe(i,e){if(i&1&&(r(0,"div",18),l(1),a()),i&2){let t=c();o(),m(" ",t.getErrorMessage("endDate")," ")}}function we(i,e){i&1&&f(0,"span",32)}var ge=(t=>(t[t.Branch=1]="Branch",t[t.Department=2]="Department",t))(ge||{}),B=class i{fb=h(ae);notificationService=h(A);employeeVacationsService=h(N);i18n=h(D);modalClose=new R;bulkVacationCreated=new R;isVisible=v(!1);loading=v(!1);submitting=v(!1);bulkVacationForm;vacationTypes=v([]);branches=v([]);departments=v([]);previewEmployeeCount=v(null);loadingPreview=v(!1);BulkAssignmentType=ge;constructor(){this.bulkVacationForm=this.createForm()}ngOnInit(){this.loadVacationTypes(),this.loadBranches(),this.loadDepartments()}createForm(){return this.fb.group({vacationTypeId:[null,[M.required]],startDate:["",[M.required]],endDate:["",[M.required]],assignmentType:[1,[M.required]],branchId:[null],departmentId:[null],isApproved:[!0],notes:[""]})}loadVacationTypes(){this.employeeVacationsService.getVacationTypes().subscribe({next:e=>{this.vacationTypes.set(e)},error:e=>{console.error("Failed to load vacation types:",e)}})}loadBranches(){this.employeeVacationsService.getBranches().subscribe({next:e=>{this.branches.set(e)},error:e=>{console.error("Failed to load branches:",e)}})}loadDepartments(){this.employeeVacationsService.getDepartments().subscribe({next:e=>{this.departments.set(e)},error:e=>{console.error("Failed to load departments:",e)}})}openModal(){this.resetForm(),this.previewEmployeeCount.set(null),this.isVisible.set(!0)}closeModal(){this.isVisible.set(!1),this.resetForm(),this.modalClose.emit()}resetForm(){this.bulkVacationForm.reset({assignmentType:1,isApproved:!0}),this.previewEmployeeCount.set(null)}onAssignmentTypeChange(){let e=this.bulkVacationForm.get("assignmentType")?.value;this.bulkVacationForm.patchValue({branchId:null,departmentId:null});let t=this.bulkVacationForm.get("branchId"),n=this.bulkVacationForm.get("departmentId");e===1?(t?.setValidators([M.required]),n?.clearValidators()):e===2&&(n?.setValidators([M.required]),t?.clearValidators()),t?.updateValueAndValidity(),n?.updateValueAndValidity(),this.previewEmployeeCount.set(null)}onTargetChange(){this.updatePreview()}updatePreview(){let e=this.bulkVacationForm.value;if(!this.isValidForPreview(e)){this.previewEmployeeCount.set(null);return}this.loadingPreview.set(!0);let t={assignmentType:e.assignmentType,branchId:e.assignmentType===1?e.branchId:void 0,departmentId:e.assignmentType===2?e.departmentId:void 0};this.employeeVacationsService.getEmployeeCountPreview(t).subscribe({next:n=>{this.previewEmployeeCount.set(n),this.loadingPreview.set(!1)},error:n=>{console.error("Failed to load preview:",n),this.previewEmployeeCount.set(null),this.loadingPreview.set(!1)}})}isValidForPreview(e){return e.assignmentType===1?e.branchId!=null:e.assignmentType===2?e.departmentId!=null:!1}onSubmit(){if(this.bulkVacationForm.invalid){this.markFormGroupTouched();return}this.submitting.set(!0);let e=this.bulkVacationForm.value,t={vacationTypeId:e.vacationTypeId,startDate:e.startDate,endDate:e.endDate,assignmentType:e.assignmentType,branchId:e.assignmentType===1?e.branchId:void 0,departmentId:e.assignmentType===2?e.departmentId:void 0,isApproved:e.isApproved,notes:e.notes||void 0};this.employeeVacationsService.createBulkVacations(t).subscribe({next:n=>{this.submitting.set(!1),this.handleBulkCreationResult(n),this.closeModal(),this.bulkVacationCreated.emit()},error:n=>{this.submitting.set(!1);let s=n.error?.message||this.i18n.t("employee_vacations.errors.bulk_create_failed");this.notificationService.error(this.i18n.t("app.error"),s)}})}handleBulkCreationResult(e){e.isCompleteSuccess?this.notificationService.success(this.i18n.t("app.success"),this.i18n.t("employee_vacations.bulk_create_success").replace("{{count}}",e.vacationsCreated.toString())):this.notificationService.warning(this.i18n.t("app.partial_success"),this.i18n.t("employee_vacations.bulk_create_partial").replace("{{created}}",e.vacationsCreated.toString()).replace("{{skipped}}",e.employeesSkipped.toString()))}markFormGroupTouched(){Object.keys(this.bulkVacationForm.controls).forEach(e=>{this.bulkVacationForm.get(e)?.markAsTouched()})}hasError(e){let t=this.bulkVacationForm.get(e);return!!(t&&t.invalid&&(t.dirty||t.touched))}getErrorMessage(e){let t=this.bulkVacationForm.get(e);return t?.errors&&t.errors.required?this.i18n.t("validation.required"):""}getAssignmentTypeName(e){return e===1?this.i18n.t("employee_vacations.branch"):this.i18n.t("employee_vacations.department")}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=E({type:i,selectors:[["app-bulk-vacation-modal"]],outputs:{modalClose:"modalClose",bulkVacationCreated:"bulkVacationCreated"},decls:69,vars:40,consts:[[3,"close","show","title","size","centered","loading"],[1,"modal-body"],[3,"ngSubmit","formGroup"],[1,"row","mb-3"],[1,"col-12"],[1,"form-label"],["role","group",1,"btn-group","w-100"],["type","radio","id","assignmentType-branch","formControlName","assignmentType",1,"btn-check",3,"change","value"],["for","assignmentType-branch",1,"btn","btn-outline-primary"],[1,"fas","fa-building","me-2"],["type","radio","id","assignmentType-department","formControlName","assignmentType",1,"btn-check",3,"change","value"],["for","assignmentType-department",1,"btn","btn-outline-primary"],[1,"fas","fa-sitemap","me-2"],[1,"alert","alert-info","mb-3"],[1,"col-md-6"],["formControlName","vacationTypeId",1,"form-select"],["value",""],[3,"value"],[1,"invalid-feedback"],[1,"form-check","form-switch","mt-2"],["type","checkbox","id","isApproved","formControlName","isApproved",1,"form-check-input"],["for","isApproved",1,"form-check-label"],["type","date","formControlName","startDate",1,"form-control"],["type","date","formControlName","endDate",1,"form-control"],["rows","3","formControlName","notes",1,"form-control",3,"placeholder"],[1,"alert","alert-warning"],[1,"d-flex","align-items-start"],[1,"fas","fa-exclamation-triangle","me-2","mt-1"],[1,"mb-0","mt-1"],["modal-footer","",1,"d-flex","gap-2","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"click","disabled"],["role","status",1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-plus-circle","me-2"],["formControlName","branchId",1,"form-select",3,"change"],["formControlName","departmentId",1,"form-select",3,"change"],[1,"d-flex","align-items-center"],[1,"fas","fa-info-circle","me-2"]],template:function(t,n){if(t&1&&(r(0,"app-modal-wrapper",0),b("close",function(){return n.closeModal()}),r(1,"div",1)(2,"form",2),b("ngSubmit",function(){return n.onSubmit()}),r(3,"div",3)(4,"div",4)(5,"label",5),l(6),a(),r(7,"div",6)(8,"input",7),b("change",function(){return n.onAssignmentTypeChange()}),a(),r(9,"label",8),f(10,"i",9),l(11),a(),r(12,"input",10),b("change",function(){return n.onAssignmentTypeChange()}),a(),r(13,"label",11),f(14,"i",12),l(15),a()()()(),r(16,"div",3),g(17,Ce,9,5,"div",4),g(18,xe,9,5,"div",4),a(),g(19,Se,4,1,"div",13),r(20,"div",3)(21,"div",14)(22,"label",5),l(23),a(),r(24,"select",15)(25,"option",16),l(26),a(),T(27,Pe,2,2,"option",17,z),a(),g(29,Ee,2,1,"div",18),a(),r(30,"div",14)(31,"label",5),l(32),a(),r(33,"div",19),f(34,"input",20),r(35,"label",21),l(36),a()()()(),r(37,"div",3)(38,"div",14)(39,"label",5),l(40),a(),f(41,"input",22),g(42,Te,2,1,"div",18),a(),r(43,"div",14)(44,"label",5),l(45),a(),f(46,"input",23),g(47,Oe,2,1,"div",18),a()(),r(48,"div",3)(49,"div",4)(50,"label",5),l(51),a(),r(52,"textarea",24),l(53,"                "),a()()(),r(54,"div",25)(55,"div",26),f(56,"i",27),r(57,"div")(58,"strong"),l(59),a(),r(60,"p",28),l(61),a()()()()()(),r(62,"div",29)(63,"button",30),b("click",function(){return n.closeModal()}),l(64),a(),r(65,"button",31),b("click",function(){return n.onSubmit()}),g(66,we,1,0,"span",32),f(67,"i",33),l(68),a()()()),t&2){let s,u;d("show",n.isVisible())("title",n.i18n.t("employee_vacations.bulk_assignment"))("size","lg")("centered",!0)("loading",n.submitting()),o(2),d("formGroup",n.bulkVacationForm),o(4),m("",n.i18n.t("employee_vacations.assignment_type")," *"),o(2),d("value",n.BulkAssignmentType.Branch),o(3),m(" ",n.i18n.t("employee_vacations.branch")," "),o(),d("value",n.BulkAssignmentType.Department),o(3),m(" ",n.i18n.t("employee_vacations.department")," "),o(2),_(((s=n.bulkVacationForm.get("assignmentType"))==null?null:s.value)===n.BulkAssignmentType.Branch?17:-1),o(),_(((u=n.bulkVacationForm.get("assignmentType"))==null?null:u.value)===n.BulkAssignmentType.Department?18:-1),o(),_(n.previewEmployeeCount()!==null||n.loadingPreview()?19:-1),o(4),m("",n.i18n.t("employee_vacations.vacation_type")," *"),o(),x("is-invalid",n.hasError("vacationTypeId")),o(2),p(n.i18n.t("employee_vacations.select_vacation_type")),o(),O(n.vacationTypes()),o(2),_(n.hasError("vacationTypeId")?29:-1),o(3),p(n.i18n.t("employee_vacations.approval_status")),o(4),m(" ",n.i18n.t("employee_vacations.auto_approve")," "),o(4),m("",n.i18n.t("employee_vacations.start_date")," *"),o(),x("is-invalid",n.hasError("startDate")),o(),_(n.hasError("startDate")?42:-1),o(3),m("",n.i18n.t("employee_vacations.end_date")," *"),o(),x("is-invalid",n.hasError("endDate")),o(),_(n.hasError("endDate")?47:-1),o(4),p(n.i18n.t("employee_vacations.notes")),o(),d("placeholder",n.i18n.t("employee_vacations.notes_placeholder")),o(7),p(n.i18n.t("employee_vacations.bulk_warning_title")),o(2),p(n.i18n.t("employee_vacations.bulk_warning_message")),o(2),d("disabled",n.submitting()),o(),m(" ",n.i18n.t("common.cancel")," "),o(),d("disabled",n.bulkVacationForm.invalid||n.submitting()),o(),_(n.submitting()?66:-1),o(),x("d-none",n.submitting()),o(),m(" ",n.i18n.t("employee_vacations.create_bulk_vacations")," ")}},dependencies:[I,re,X,ie,oe,Y,Q,ne,Z,W,J,le,ee,te,pe],styles:[".modal-content[_ngcontent-%COMP%]{box-shadow:0 .5rem 1rem #00000026;border:none;border-radius:.5rem}.modal-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-bottom:none;border-radius:.5rem .5rem 0 0;padding:1.25rem 1.5rem}.modal-header[_ngcontent-%COMP%]   .modal-title[_ngcontent-%COMP%]{font-weight:600;font-size:1.1rem}.modal-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]{filter:invert(1);opacity:.8}.modal-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]:hover{opacity:1}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-footer[_ngcontent-%COMP%]{padding:1rem 1.5rem;border-top:1px solid #e9ecef;background-color:#f8f9fa;border-radius:0 0 .5rem .5rem}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#495057;margin-bottom:.5rem}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border:1px solid #ced4da;border-radius:.375rem;padding:.625rem .75rem;font-size:.875rem;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#667eea;outline:0;box-shadow:0 0 0 .2rem #667eea40}.btn-group[_ngcontent-%COMP%]   .btn-check[_ngcontent-%COMP%]:checked + .btn[_ngcontent-%COMP%]{background-color:#667eea;border-color:#667eea;color:#fff}.btn-group[_ngcontent-%COMP%]   .btn-outline-primary[_ngcontent-%COMP%]{border-color:#667eea;color:#667eea;font-weight:500}.btn-group[_ngcontent-%COMP%]   .btn-outline-primary[_ngcontent-%COMP%]:hover{background-color:#667eea;border-color:#667eea;color:#fff}.alert[_ngcontent-%COMP%]{border:none;border-radius:.5rem;padding:1rem;margin-bottom:1rem}.alert-info[_ngcontent-%COMP%]{background:linear-gradient(135deg,#d1ecf1,#bee5eb);color:#0c5460;border-left:4px solid #17a2b8}.alert-warning[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fff3cd,#ffeaa7);color:#856404;border-left:4px solid #ffc107}.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545}.invalid-feedback[_ngcontent-%COMP%]{display:block;width:100%;margin-top:.25rem;font-size:.875em;color:#dc3545}.form-check-input[_ngcontent-%COMP%]:checked{background-color:#667eea;border-color:#667eea}.form-check-input[_ngcontent-%COMP%]:focus{border-color:#667eea;outline:0;box-shadow:0 0 0 .25rem #667eea40}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);border:none;font-weight:500;padding:.625rem 1.25rem;border-radius:.375rem;transition:all .15s ease-in-out}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#5a6fd8,#6a4190);transform:translateY(-1px);box-shadow:0 .25rem .5rem #667eea4d}.btn-primary[_ngcontent-%COMP%]:disabled{background:linear-gradient(135deg,#9ca3af,#a3a3a3);border:none;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{background-color:#6c757d;border-color:#6c757d;color:#fff;font-weight:500;padding:.625rem 1.25rem;border-radius:.375rem;transition:all .15s ease-in-out}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#5a6268;border-color:#545b62;transform:translateY(-1px)}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}.loading-preview[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:#6c757d;font-size:.875rem}.preview-info[_ngcontent-%COMP%]{background:linear-gradient(135deg,#e3f2fd,#bbdefb);border:1px solid #2196f3;border-radius:.5rem;padding:.75rem 1rem;margin-bottom:1rem}.preview-info[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%]{color:#2196f3}@media (max-width: 768px){.modal-dialog[_ngcontent-%COMP%]{margin:1rem;max-width:calc(100% - 2rem)}.modal-body[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]{padding:1rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{font-size:.875rem;padding:.5rem .75rem}}.btn[_ngcontent-%COMP%]:focus{outline:2px solid #667eea;outline-offset:2px}*[_ngcontent-%COMP%]{transition:all .15s ease-in-out}"]})};var Ie=()=>[];function Ae(i,e){if(i&1&&(r(0,"div",7)(1,"div",12)(2,"div",13),l(3),a()(),r(4,"div")(5,"div",8),l(6),a(),r(7,"small",14),l(8),a()()()),i&2){let t=c().$implicit,n=c();o(3),m(" ",n.getInitials(t.employeeName)," "),o(3),p(t.employeeName),o(2),p(t.employeeNumber)}}function De(i,e){if(i&1&&(r(0,"span",8),l(1),a()),i&2){let t=c().$implicit;o(),p(t.vacationTypeName)}}function Ne(i,e){if(i&1&&l(0),i&2){let t=c().$implicit,n=c();m(" ",n.formatDate(t.startDate)," ")}}function Be(i,e){if(i&1&&l(0),i&2){let t=c().$implicit,n=c();m(" ",n.formatDate(t.endDate)," ")}}function Fe(i,e){if(i&1&&(r(0,"span",9),l(1),a()),i&2){let t=c().$implicit,n=c();o(),q(" ",t.totalDays," ",t.totalDays===1?n.i18n.t("common.day"):n.i18n.t("common.days")," ")}}function Re(i,e){if(i&1&&f(0,"app-status-badge",10),i&2){let t=c().$implicit,n=c();d("status",t.isApproved?"success":"warning")("label",t.isApproved?n.i18n.t("employee_vacations.approved"):n.i18n.t("employee_vacations.pending"))}}function ze(i,e){if(i&1&&(r(0,"span",11),l(1),a()),i&2){let t=c().$implicit,n=c();d("ngClass",n.getCurrentStatusClass(t)),o(),m(" ",n.getCurrentStatusLabel(t)," ")}}function $e(i,e){if(i&1&&l(0),i&2){let t=c(2).$implicit;m(" ",t.notes," ")}}function Ue(i,e){i&1&&(r(0,"span",14),l(1,"-"),a())}function qe(i,e){if(i&1&&g(0,$e,1,1)(1,Ue,2,0,"span",14),i&2){let t=c().$implicit;_(t.notes?0:1)}}function Le(i,e){if(i&1&&l(0),i&2){let t=c(),n=t.$implicit,s=t.column;m(" ",n[s.key]," ")}}function Ge(i,e){if(i&1&&g(0,Ae,9,3,"div",7)(1,De,2,1,"span",8)(2,Ne,1,1)(3,Be,1,1)(4,Fe,2,2,"span",9)(5,Re,1,2,"app-status-badge",10)(6,ze,2,2,"span",11)(7,qe,2,1)(8,Le,1,1),i&2){let t=e.column;_(t.key==="employee"?0:t.key==="vacationType"?1:t.key==="startDate"?2:t.key==="endDate"?3:t.key==="totalDays"?4:t.key==="status"?5:t.key==="currentStatus"?6:t.key==="notes"?7:8)}}var _e=class i{employeeVacationsService=h(N);notificationService=h(A);confirmationService=h(se);router=h(H);i18n=h(D);permissionService=h(K);currentPage=v(1);pageSize=v(10);currentFilters=v({});vacations=this.employeeVacationsService.vacations;loading=this.employeeVacationsService.loading;pagedResult=this.employeeVacationsService.pagedResult;totalItems=w(()=>this.pagedResult()?.totalCount??0);totalPages=w(()=>{let e=this.pagedResult();return!e||e.pageSize===0?1:Math.ceil(e.totalCount/e.pageSize)});PERMISSIONS={VACATION_READ:`${S.VACATION}.${k.READ}`,VACATION_CREATE:`${S.VACATION}.${k.CREATE}`,VACATION_UPDATE:`${S.VACATION}.${k.UPDATE}`,VACATION_DELETE:`${S.VACATION}.${k.DELETE}`,VACATION_BULK_CREATE:`${S.VACATION}.${k.BULK_CREATE}`};tableColumns=[{key:"employee",label:this.i18n.t("employee_vacations.employee"),sortable:!0,width:"20%",priority:"high"},{key:"vacationType",label:this.i18n.t("employee_vacations.vacation_type"),sortable:!0,width:"15%",priority:"high"},{key:"startDate",label:this.i18n.t("employee_vacations.start_date"),sortable:!0,width:"12%",priority:"medium"},{key:"endDate",label:this.i18n.t("employee_vacations.end_date"),sortable:!0,width:"12%",priority:"medium"},{key:"totalDays",label:this.i18n.t("employee_vacations.total_days"),sortable:!0,width:"10%",align:"center",priority:"low"},{key:"status",label:this.i18n.t("employee_vacations.approval_status"),sortable:!0,width:"12%",align:"center",priority:"high"},{key:"currentStatus",label:this.i18n.t("employee_vacations.current_status"),width:"12%",align:"center",priority:"low"},{key:"notes",label:this.i18n.t("employee_vacations.notes"),width:"15%",priority:"low"}];tableActions=w(()=>{let e=[];return this.permissionService.has(this.PERMISSIONS.VACATION_READ)&&e.push({key:"view",label:this.i18n.t("common.view"),icon:"fa-eye",color:"info"}),this.permissionService.has(this.PERMISSIONS.VACATION_UPDATE)&&(e.push({key:"edit",label:this.i18n.t("common.edit"),icon:"fa-edit",color:"primary"}),e.push({key:"toggleStatus",label:this.i18n.t("employee_vacations.toggle_status"),icon:"fa-toggle-on",color:"warning"})),this.permissionService.has(this.PERMISSIONS.VACATION_DELETE)&&e.push({key:"delete",label:this.i18n.t("common.delete"),icon:"fa-trash",color:"danger"}),e});constructor(){this.loadVacations()}loadVacations(){if(!this.permissionService.has(this.PERMISSIONS.VACATION_READ)){this.notificationService.error(this.i18n.t("common.errors.insufficient_permissions"));return}let e=F({page:this.currentPage(),pageSize:this.pageSize()},this.currentFilters());this.employeeVacationsService.getVacations(e).subscribe({error:t=>{this.notificationService.error(this.i18n.t("employee_vacations.errors.load_failed")),console.error("Failed to load employee vacations:",t)}})}onSearchChange(e){this.currentFilters.update(t=>$(F({},t),{searchTerm:e||void 0})),this.currentPage.set(1),this.loadVacations()}onFiltersChange(e){this.currentFilters.set(e),this.currentPage.set(1),this.loadVacations()}onRefreshData(){this.currentFilters.set({}),this.currentPage.set(1),this.loadVacations()}onPageChange(e){this.currentPage.set(e),this.loadVacations()}onPageSizeChange(e){this.pageSize.set(e),this.currentPage.set(1),this.loadVacations()}onAddVacation(){if(!this.permissionService.has(this.PERMISSIONS.VACATION_CREATE)){this.notificationService.error(this.i18n.t("common.errors.insufficient_permissions"));return}this.router.navigate(["/employee-vacations/create"])}onViewVacation(e){this.router.navigate(["/employee-vacations",e.id,"view"])}onEditVacation(e){if(!this.permissionService.has(this.PERMISSIONS.VACATION_UPDATE)){this.notificationService.error(this.i18n.t("common.errors.insufficient_permissions"));return}this.router.navigate(["/employee-vacations",e.id,"edit"])}onToggleStatus(e){if(!this.permissionService.has(this.PERMISSIONS.VACATION_UPDATE)){this.notificationService.error(this.i18n.t("common.errors.insufficient_permissions"));return}let t=e.isApproved?"reject":"approve",n=this.i18n.t(`employee_vacations.confirm_${t}`).replace("{{employee}}",e.employeeName);this.confirmationService.confirm({title:this.i18n.t(`employee_vacations.${t}_vacation`),message:n,confirmText:this.i18n.t(`common.${t}`),cancelText:this.i18n.t("common.cancel"),confirmButtonClass:t==="approve"?"btn-success":"btn-warning"}).then(s=>{s.confirmed&&this.employeeVacationsService.toggleVacationStatus(e.id).subscribe({next:()=>{let u=e.isApproved?this.i18n.t("employee_vacations.success.rejected"):this.i18n.t("employee_vacations.success.approved");this.notificationService.success(u)},error:u=>{console.error("Failed to toggle vacation status:",u),this.notificationService.error(this.i18n.t("employee_vacations.errors.status_toggle_failed"))}})})}onDeleteVacation(e){if(!this.permissionService.has(this.PERMISSIONS.VACATION_DELETE)){this.notificationService.error(this.i18n.t("common.errors.insufficient_permissions"));return}this.confirmationService.confirm({title:this.i18n.t("employee_vacations.delete_vacation"),message:this.i18n.t("employee_vacations.confirm_delete").replace("{{employee}}",e.employeeName),confirmText:this.i18n.t("common.delete"),cancelText:this.i18n.t("common.cancel"),confirmButtonClass:"btn-danger"}).then(t=>{t.confirmed&&this.employeeVacationsService.deleteVacation(e.id).subscribe({next:()=>{this.notificationService.success(this.i18n.t("employee_vacations.success.deleted"))},error:n=>{console.error("Failed to delete vacation:",n),this.notificationService.error(this.i18n.t("employee_vacations.errors.delete_failed"))}})})}onBulkAssignVacation(){if(!this.permissionService.has(this.PERMISSIONS.VACATION_BULK_CREATE)){this.notificationService.error(this.i18n.t("common.errors.insufficient_permissions"));return}this.router.navigate(["/employee-vacations/bulk-create"])}onBulkVacationCreated(){this.loadVacations()}onActionClick(e){let{action:t,item:n}=e;switch(t){case"view":this.onViewVacation(n);break;case"edit":this.onEditVacation(n);break;case"delete":this.onDeleteVacation(n);break;case"toggleStatus":this.onToggleStatus(n);break}}getInitials(e){if(!e)return"";let t=e.trim().split(" ");return t.length>=2?t[0].charAt(0).toUpperCase()+t[t.length-1].charAt(0).toUpperCase():e.charAt(0).toUpperCase()}getCurrentStatusLabel(e){return e.isCurrentlyActive?this.i18n.t("employee_vacations.active"):e.isUpcoming?this.i18n.t("employee_vacations.upcoming"):this.isVacationPeriodActive(e)&&!e.isApproved?this.i18n.t("employee_vacations.pending"):this.i18n.t("employee_vacations.past")}getCurrentStatusClass(e){return e.isCurrentlyActive?"bg-success":e.isUpcoming?"bg-info":this.isVacationPeriodActive(e)&&!e.isApproved?"bg-warning":"bg-light text-dark border"}isVacationPeriodActive(e){let t=new Date,n=new Date(e.startDate),s=new Date(e.endDate);return t.setHours(0,0,0,0),n.setHours(0,0,0,0),s.setHours(0,0,0,0),n<=t&&s>=t}formatDate(e){return e?new Date(e).toLocaleDateString():""}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=E({type:i,selectors:[["app-employee-vacations"]],decls:8,vars:15,consts:[["cellTemplate",""],["bulkVacationModal",""],[1,"app-list-page"],[3,"title"],["moduleName","employee-vacations",3,"searchChange","filtersChange","add","refresh","refreshing"],[3,"actionClick","pageChange","pageSizeChange","data","columns","actions","currentPage","totalPages","totalItems","pageSize","loading","emptyTitle","emptyMessage","showPagination","responsiveMode"],[3,"bulkVacationCreated"],[1,"d-flex","align-items-center"],[1,"fw-medium"],[1,"badge","bg-secondary"],[3,"status","label"],[1,"badge",3,"ngClass"],[1,"avatar-sm","me-2"],[1,"avatar-initial","bg-primary","text-white","rounded-circle"],[1,"text-muted"]],template:function(t,n){if(t&1){let s=P();r(0,"div",2),f(1,"app-page-header",3),r(2,"app-unified-filter",4),b("searchChange",function(V){return C(s),y(n.onSearchChange(V))})("filtersChange",function(V){return C(s),y(n.onFiltersChange(V))})("add",function(){return C(s),y(n.onAddVacation())})("refresh",function(){return C(s),y(n.onRefreshData())}),a(),r(3,"app-data-table",5),b("actionClick",function(V){return C(s),y(n.onActionClick(V))})("pageChange",function(V){return C(s),y(n.onPageChange(V))})("pageSizeChange",function(V){return C(s),y(n.onPageSizeChange(V))}),U(4,Ge,9,1,"ng-template",null,0,G),a(),r(6,"app-bulk-vacation-modal",6,1),b("bulkVacationCreated",function(){return C(s),y(n.onBulkVacationCreated())}),a()()}t&2&&(o(),d("title",n.i18n.t("employee_vacations.title")),o(),d("refreshing",n.loading()),o(),d("data",n.vacations()||L(14,Ie))("columns",n.tableColumns)("actions",n.tableActions())("currentPage",n.currentPage())("totalPages",n.totalPages())("totalItems",n.totalItems())("pageSize",n.pageSize())("loading",n.loading)("emptyTitle",n.i18n.t("employee_vacations.no_vacations_found"))("emptyMessage",n.i18n.t("employee_vacations.no_vacations_message"))("showPagination",!0)("responsiveMode","auto"))},dependencies:[I,j,ue,me,B,ce,de],styles:[".table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f8f9fa;border-top:none;font-weight:600;color:#495057}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.75rem}.modal[_ngcontent-%COMP%]{background-color:#00000080}.badge[_ngcontent-%COMP%]{font-size:.75em}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#495057}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid #dee2e6}.pagination[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:0}.search-filters[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%], .search-filters[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]{border-radius:.375rem}.vacation-status.approved[_ngcontent-%COMP%]{color:#198754}.vacation-status.pending[_ngcontent-%COMP%]{color:#ffc107}.vacation-status.active[_ngcontent-%COMP%]{color:#0d6efd}.vacation-status.upcoming[_ngcontent-%COMP%]{color:#6f42c1}.vacation-status.completed[_ngcontent-%COMP%]{color:#6c757d}.avatar-sm[_ngcontent-%COMP%]{width:2rem;height:2rem}.avatar-initial[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:.875rem;font-weight:600;border-radius:50%}.modal-dialog[_ngcontent-%COMP%]{margin:1.75rem auto;max-width:800px}.modal-content[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 10px 25px #00000026}.modal-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid #dee2e6;border-radius:8px 8px 0 0}.modal-title[_ngcontent-%COMP%]{font-weight:600;color:#2c3e50}.modal-body[_ngcontent-%COMP%]{padding:2rem}.modal-footer[_ngcontent-%COMP%]{background-color:#f8f9fa;border-top:1px solid #dee2e6;border-radius:0 0 8px 8px}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:6px;border:1px solid #ced4da;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#80bdff;box-shadow:0 0 0 .2rem #007bff40}.form-control.is-invalid[_ngcontent-%COMP%], .form-select.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545;box-shadow:0 0 0 .2rem #dc354540}.invalid-feedback[_ngcontent-%COMP%]{display:block;font-size:.875rem;color:#dc3545;margin-top:.25rem}.btn[_ngcontent-%COMP%]{border-radius:6px;font-weight:500;transition:all .15s ease-in-out}.btn-primary[_ngcontent-%COMP%]{background-color:#007bff;border-color:#007bff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0056b3;border-color:#0056b3}.btn-secondary[_ngcontent-%COMP%]{background-color:#6c757d;border-color:#6c757d}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#545b62;border-color:#545b62}.btn[_ngcontent-%COMP%]:disabled{opacity:.65;cursor:not-allowed}.text-danger[_ngcontent-%COMP%]{color:#dc3545!important}.text-muted[_ngcontent-%COMP%]{color:#6c757d!important}.bg-success[_ngcontent-%COMP%]{background-color:#28a745!important;color:#fff}.bg-warning[_ngcontent-%COMP%]{background-color:#ffc107!important;color:#212529}.bg-info[_ngcontent-%COMP%]{background-color:#17a2b8!important;color:#fff}.bg-light[_ngcontent-%COMP%]{background-color:#f8f9fa!important;color:#495057}.bg-secondary[_ngcontent-%COMP%]{background-color:#6c757d!important;color:#fff}.bg-danger[_ngcontent-%COMP%]{background-color:#dc3545!important;color:#fff}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}@media (max-width: 768px){.table-responsive[_ngcontent-%COMP%]{font-size:.875rem}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.125rem .25rem}.modal-lg[_ngcontent-%COMP%]{max-width:95%}.avatar-sm[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem}.avatar-initial[_ngcontent-%COMP%]{font-size:.75rem}}.modal.fade.show[_ngcontent-%COMP%], .modal-backdrop.fade.show[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .15s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}"]})};export{_e as EmployeeVacationsComponent};
