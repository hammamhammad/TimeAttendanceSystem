import{a as oe,b as se}from"./chunk-UH52J5H4.js";import"./chunk-ASABUVRV.js";import{a as ae}from"./chunk-JTZMRZUG.js";import{a as re}from"./chunk-O25DOBT4.js";import{a as E}from"./chunk-GC2ZOSF6.js";import{a as h,b}from"./chunk-5BLMYARA.js";import{a as ie}from"./chunk-XHCMPEHM.js";import"./chunk-O7VLIHRG.js";import{a as N}from"./chunk-ULW7HO4H.js";import"./chunk-UWMUXUZF.js";import{b as w}from"./chunk-MCSGSJCX.js";import{C as r,H as M,L as v,M as u,Ma as Y,Pa as T,R as y,S as O,U as J,V as L,Va as Z,W as B,Wa as A,X as d,Xa as ee,Y as a,Ya as te,Z as o,_ as S,ab as P,ca as K,da as Q,fa as k,ha as C,ja as s,lb as ne,pa as I,ra as W,s as p,sa as m,t as x,ta as _,u as U,ua as f,va as X,y as g,z as q}from"./chunk-H3A4D7EH.js";import{a as D,b as H,d as j}from"./chunk-DGAILPFQ.js";var ce=(n,t)=>t.id;function de(n,t){if(n&1&&(a(0,"div",8),S(1,"i",23),m(2),o()),n&2){let e=s(2);r(2),f(" ",e.error()," ")}}function ge(n,t){if(n&1&&(a(0,"span",24),m(1),o()),n&2){let e=t.$implicit;r(),_(e)}}function pe(n,t){if(n&1&&(a(0,"div",17),L(1,ge,2,1,"span",24,J),o()),n&2){let e=s(2);r(),B(e.user.roles)}}function _e(n,t){if(n&1&&(a(0,"p",14),m(1),o()),n&2){let e=s(2);r(),_(e.t("users.no_roles"))}}function ue(n,t){if(n&1&&(a(0,"div",27)(1,"div",29)(2,"span",30),m(3),o()(),a(4,"p",31),m(5),o()()),n&2){let e=s(3);r(3),_(e.t("common.loading")),r(2),_(e.t("users.updating_roles"))}}function he(n,t){if(n&1){let e=k();a(0,"input",40),C("change",function(){x(e);let c=s().$implicit,l=s(4);return U(l.onToggleRole(c))}),o()}if(n&2){let e=s().$implicit,i=s(4);d("id","role-"+e.id)("checked",i.isRoleAssigned(e.id))("disabled",i.loading())}}function be(n,t){if(n&1&&(a(0,"p",39),m(1),o()),n&2){let e=s().$implicit,i=s(4);r(),f(" ",i.getRoleDescription(e)," ")}}function fe(n,t){if(n&1&&(a(0,"div",33)(1,"div",34),v(2,he,1,3,"input",35),a(3,"div",36)(4,"label",37)(5,"span",38),m(6),o()(),y(7,be,2,1,"p",39),o()()()),n&2){let e=t.$implicit,i=s(4);I("loading",i.loading()),r(2),d("appHasPermission",i.PERMISSIONS.USER_ASSIGN_ROLE),r(2),d("for","role-"+e.id),r(),W(i.getRoleBadgeClass(e)),r(),f(" ",e.name," "),r(),O(i.getRoleDescription(e)?7:-1)}}function Ce(n,t){if(n&1&&(a(0,"div",28),L(1,fe,8,8,"div",32,ce),o()),n&2){let e=s(3);r(),B(e.availableRoles())}}function ve(n,t){if(n&1&&(a(0,"div",25)(1,"h6",26),m(2),o(),y(3,ue,6,2,"div",27)(4,Ce,3,0,"div",28),o()),n&2){let e=s(2);r(2),_(e.t("users.available_roles")),r(),O(e.loading()?3:4)}}function Se(n,t){if(n&1&&(a(0,"div",41),S(1,"i",42),a(2,"small"),m(3),o()()),n&2){let e=s(2);r(3),_(e.t("users.role_management_help"))}}function xe(n,t){if(n&1&&(a(0,"div",43),S(1,"i",44),a(2,"small"),m(3),o()()),n&2){let e=s(2);r(3),_(e.t("users.no_role_assignment_permission"))}}function Ue(n,t){if(n&1){let e=k();a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h5",4),S(5,"i",5),m(6),o(),a(7,"button",6),C("click",function(){x(e);let c=s();return U(c.closeModal())}),o()(),a(8,"div",7),y(9,de,3,1,"div",8),a(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12),m(14),o()(),a(15,"div")(16,"h6",13),m(17),o(),a(18,"p",14),m(19),o()()()(),a(20,"div",15)(21,"h6",16),m(22),o(),y(23,pe,3,0,"div",17)(24,_e,2,1,"p",14),o(),v(25,ve,5,2,"div",18)(26,Se,4,1,"div",19)(27,xe,4,1,"div",20),o(),a(28,"div",21)(29,"button",22),C("click",function(){x(e);let c=s();return U(c.closeModal())}),m(30),o()()()()()}if(n&2){let e=s();r(6),f(" ",e.t("users.manage_roles")," "),r(3),O(e.error()?9:-1),r(5),f(" ",e.user.username.charAt(0).toUpperCase()," "),r(3),_(e.user.username),r(2),_(e.user.email),r(3),_(e.t("users.current_roles")),r(),O(e.user.roles.length>0?23:24),r(2),d("appHasPermission",e.PERMISSIONS.USER_ASSIGN_ROLE),r(),d("appHasPermission",e.PERMISSIONS.USER_ASSIGN_ROLE),r(),d("ngIf",!e.permissionService.has(e.PERMISSIONS.USER_ASSIGN_ROLE)),r(3),f(" ",e.t("common.close")," ")}}var F=class n{user=null;show=!1;showChange=new u;rolesUpdated=new u;usersService=p(N);i18n=p(w);permissionService=p(E);PERMISSIONS={USER_ASSIGN_ROLE:`${b.USER}.${h.ASSIGN_ROLE}`,USER_MANAGE:`${b.USER}.${h.MANAGE}`};loading=g(!1);error=g("");availableRoles=g([{id:1,name:"SystemAdmin",description:"Full system access with all permissions"},{id:2,name:"Admin",description:"Administrative access to employee and role management"},{id:3,name:"HROperation",description:"HR operations with employee management access"},{id:4,name:"User",description:"Basic user access with read-only permissions"}]);userRoleIds=T(()=>this.user?this.user.roles.map(t=>this.availableRoles().find(i=>i.name===t)?.id||0).filter(t=>t>0):[]);ngOnInit(){}t(t){return this.i18n.t(t)}isRoleAssigned(t){return this.userRoleIds().includes(t)}onToggleRole(t){if(!this.user)return;this.loading.set(!0),this.error.set(""),this.isRoleAssigned(t.id)?this.removeRole(t.id):this.assignRole(t.id)}assignRole(t){if(!this.user)return;let e={roleId:t};this.usersService.assignRole(this.user.id,e).subscribe({next:()=>{this.refreshUserData()},error:i=>{this.loading.set(!1),this.error.set(this.getErrorMessage(i))}})}removeRole(t){this.user&&this.usersService.removeRole(this.user.id,t).subscribe({next:()=>{this.refreshUserData()},error:e=>{this.loading.set(!1),this.error.set(this.getErrorMessage(e))}})}refreshUserData(){this.user&&this.usersService.getUserById(this.user.id).subscribe({next:t=>{this.loading.set(!1),this.rolesUpdated.emit(t)},error:t=>{this.loading.set(!1),this.error.set(this.getErrorMessage(t))}})}closeModal(){this.show=!1,this.showChange.emit(!1),this.error.set("")}getErrorMessage(t){return t?.error?.error?t.error.error:this.t("errors.unknown")}getRoleDescription(t){return t.description||""}getRoleBadgeClass(t){return{SystemAdmin:"bg-danger",Admin:"bg-warning",HROperation:"bg-info",User:"bg-secondary"}[t.name]||"bg-primary"}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=M({type:n,selectors:[["app-role-management"]],inputs:{user:"user",show:"show"},outputs:{showChange:"showChange",rolesUpdated:"rolesUpdated"},decls:1,vars:1,consts:[["tabindex","-1",1,"modal","fade","show","d-block",2,"background-color","rgba(0,0,0,0.5)"],[1,"modal-dialog","modal-md"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"fa-solid","fa-user-tag","me-2"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["role","alert",1,"alert","alert-danger"],[1,"user-info","mb-4"],[1,"d-flex","align-items-center"],[1,"avatar-md","me-3"],[1,"avatar-title","bg-primary-subtle","text-primary","rounded-circle"],[1,"mb-1"],[1,"text-muted","mb-0"],[1,"current-roles","mb-4"],[1,"mb-2"],[1,"d-flex","flex-wrap","gap-2"],["class","available-roles",4,"appHasPermission"],["class","alert alert-info mt-3","role","alert",4,"appHasPermission"],["class","alert alert-warning mt-3","role","alert",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fa-solid","fa-exclamation-triangle","me-2"],[1,"badge","bg-primary"],[1,"available-roles"],[1,"mb-3"],[1,"text-center","py-3"],[1,"roles-list"],["role","status",1,"spinner-border","spinner-border-sm","text-primary"],[1,"visually-hidden"],[1,"text-muted","mt-2","mb-0"],[1,"role-item",3,"loading"],[1,"role-item"],[1,"form-check","d-flex","align-items-start"],["class","form-check-input mt-1","type","checkbox",3,"id","checked","disabled","change",4,"appHasPermission"],[1,"form-check-content","ms-2","flex-grow-1"],[1,"form-check-label","fw-medium",3,"for"],[1,"badge","me-2"],[1,"text-muted","small","mb-0"],["type","checkbox",1,"form-check-input","mt-1",3,"change","id","checked","disabled"],["role","alert",1,"alert","alert-info","mt-3"],[1,"fa-solid","fa-info-circle","me-2"],["role","alert",1,"alert","alert-warning","mt-3"],[1,"fa-solid","fa-lock","me-2"]],template:function(e,i){e&1&&y(0,Ue,31,11,"div",0),e&2&&O(i.show&&i.user?0:-1)},dependencies:[P,A,ae],styles:[".modal.show[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .15s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.modal-content[_ngcontent-%COMP%]{border:none;box-shadow:0 .5rem 1rem #00000026;border-radius:.5rem}.modal-header[_ngcontent-%COMP%]{background-color:var(--bs-light);border-bottom:1px solid var(--bs-border-color);border-radius:.5rem .5rem 0 0}.modal-title[_ngcontent-%COMP%]{font-weight:600;color:var(--bs-dark)}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-footer[_ngcontent-%COMP%]{background-color:var(--bs-light);border-top:1px solid var(--bs-border-color);border-radius:0 0 .5rem .5rem}.avatar-md[_ngcontent-%COMP%]{width:48px;height:48px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.avatar-title[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.25rem;font-weight:600}.user-info[_ngcontent-%COMP%]{padding:1rem;background-color:var(--bs-light);border-radius:.5rem;border:1px solid var(--bs-border-color)}.current-roles[_ngcontent-%COMP%]{padding:1rem;background-color:var(--bs-primary-bg-subtle);border-radius:.5rem;border:1px solid var(--bs-primary-border-subtle)}.roles-list[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.role-item[_ngcontent-%COMP%]{padding:1rem;border:1px solid var(--bs-border-color);border-radius:.5rem;margin-bottom:.5rem;background-color:var(--bs-white);transition:all .2s ease}.role-item[_ngcontent-%COMP%]:hover{background-color:var(--bs-light);border-color:var(--bs-primary-border-subtle)}.role-item.loading[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.form-check[_ngcontent-%COMP%]{margin-bottom:0}.form-check-input[_ngcontent-%COMP%]{margin-top:.125rem}.form-check-input[_ngcontent-%COMP%]:checked{background-color:var(--bs-primary);border-color:var(--bs-primary)}.form-check-content[_ngcontent-%COMP%]{min-width:0}.form-check-label[_ngcontent-%COMP%]{margin-bottom:.25rem;cursor:pointer;line-height:1.2}.badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.375rem .75rem}.alert[_ngcontent-%COMP%]{border:none;border-radius:.5rem}.alert-danger[_ngcontent-%COMP%]{background-color:var(--bs-danger-bg-subtle);color:var(--bs-danger-text);border-left:4px solid var(--bs-danger)}.alert-info[_ngcontent-%COMP%]{background-color:var(--bs-info-bg-subtle);color:var(--bs-info-text);border-left:4px solid var(--bs-info)}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}h6[_ngcontent-%COMP%]{font-weight:600;color:var(--bs-dark)}.text-muted[_ngcontent-%COMP%]{color:var(--bs-secondary)!important}.small[_ngcontent-%COMP%]{font-size:.875rem}.bg-danger[_ngcontent-%COMP%]{background-color:var(--bs-danger)!important}.bg-warning[_ngcontent-%COMP%]{background-color:var(--bs-warning)!important;color:var(--bs-dark)!important}.bg-info[_ngcontent-%COMP%]{background-color:var(--bs-info)!important}.bg-secondary[_ngcontent-%COMP%]{background-color:var(--bs-secondary)!important}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--bs-light);border-radius:3px}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--bs-secondary);border-radius:3px}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--bs-dark)}[dir=rtl][_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{margin-left:0;margin-right:-1.5em}[dir=rtl][_ngcontent-%COMP%]   .form-check-content[_ngcontent-%COMP%]{margin-right:.5rem;margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .avatar-md[_ngcontent-%COMP%]{margin-right:0;margin-left:.75rem}@media (max-width: 768px){.modal-dialog[_ngcontent-%COMP%]{margin:1rem;max-width:none}.modal-body[_ngcontent-%COMP%]{padding:1rem}.user-info[_ngcontent-%COMP%], .current-roles[_ngcontent-%COMP%], .role-item[_ngcontent-%COMP%]{padding:.75rem}.avatar-md[_ngcontent-%COMP%]{width:40px;height:40px}.avatar-title[_ngcontent-%COMP%]{font-size:1rem}}.form-check-input[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem rgba(var(--bs-primary-rgb),.25)}@keyframes _ngcontent-%COMP%_pulse{0%{opacity:1}50%{opacity:.5}to{opacity:1}}.loading[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s ease-in-out infinite}"]})};var $=class n{i18n=p(w);showAddButton=!0;addButtonText="Add User";availableRoles=g([]);searchChange=new u;filtersChange=new u;addUser=new u;filterFields=g([]);ngOnInit(){this.setupFilterFields()}ngOnChanges(){this.setupFilterFields()}setupFilterFields(){let t=[{value:"",label:this.i18n.t("common.all")},...this.availableRoles().map(i=>({value:i.id.toString(),label:i.name}))],e=[{value:"",label:this.i18n.t("common.all")},{value:"true",label:this.i18n.t("common.active")},{value:"false",label:this.i18n.t("common.inactive")}];this.filterFields.set([{key:"roleId",label:"Role",type:"select",options:t},{key:"isActive",label:"Status",type:"select",options:e}])}onSearch(t){this.searchChange.emit(t)}onFilterChange(t){this.filtersChange.emit(t)}onAdd(){this.addUser.emit()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=M({type:n,selectors:[["app-user-filters"]],inputs:{showAddButton:"showAddButton",addButtonText:"addButtonText",availableRoles:"availableRoles"},outputs:{searchChange:"searchChange",filtersChange:"filtersChange",addUser:"addUser"},features:[q],decls:1,vars:4,consts:[[3,"search","filterChange","add","filterFields","showAddButton","addButtonText","searchPlaceholder"]],template:function(e,i){e&1&&(a(0,"app-search-filter",0),C("search",function(l){return i.onSearch(l)})("filterChange",function(l){return i.onFilterChange(l)})("add",function(){return i.onAdd()}),o()),e&2&&d("filterFields",i.filterFields())("showAddButton",i.showAddButton)("addButtonText",i.addButtonText)("searchPlaceholder","Search users...")},dependencies:[P,oe],encapsulation:2})};function Me(n,t){if(n&1&&(a(0,"div",7)(1,"div",8)(2,"div",9),m(3),o()(),a(4,"div")(5,"div",10),m(6),o(),a(7,"small",11),m(8),o()()()),n&2){let e=s().$implicit,i=s();r(3),f(" ",i.getInitials(e.firstName,e.lastName)," "),r(3),X("",e.firstName," ",e.lastName),r(2),_(e.email)}}function Pe(n,t){n&1&&(a(0,"span",13),S(1,"i",14),o())}function we(n,t){if(n&1&&(a(0,"span",10),m(1),v(2,Pe,2,0,"span",12),o()),n&2){let e=s().$implicit,i=s();r(),f(" ",e.username," "),r(),d("ngIf",i.isSystemAdmin(e))}}function Re(n,t){if(n&1&&(a(0,"span",17),m(1),o()),n&2){let e=t.$implicit;r(),f(" ",e," ")}}function ye(n,t){n&1&&(a(0,"span",11),m(1,"No roles assigned"),o())}function Oe(n,t){if(n&1&&(a(0,"div"),v(1,Re,2,1,"span",15)(2,ye,2,0,"span",16),o()),n&2){let e=s().$implicit;r(),d("ngForOf",e.roles),r(),d("ngIf",e.roles.length===0)}}function Ee(n,t){if(n&1&&(a(0,"span",18),S(1,"i",19),m(2),o()),n&2){let e=s().$implicit;I("bg-success",e.isActive)("bg-danger",!e.isActive),r(),I("fa-check-circle",e.isActive)("fa-times-circle",!e.isActive),r(),f(" ",e.isActive?"Active":"Inactive"," ")}}function ke(n,t){n&1&&(a(0,"span",22),S(1,"i",23),m(2," Locked "),o())}function Ie(n,t){n&1&&(a(0,"span",24),S(1,"i",25),m(2," Unlocked "),o())}function Te(n,t){if(n&1&&(a(0,"span"),v(1,ke,3,0,"span",20)(2,Ie,3,0,"span",21),o()),n&2){let e=s().$implicit,i=s();r(),d("ngIf",i.isUserLocked(e.lockoutEndUtc)),r(),d("ngIf",!i.isUserLocked(e.lockoutEndUtc))}}function De(n,t){if(n&1&&(a(0,"span"),m(1),o()),n&2){let e=s().$implicit,i=s();r(),f(" ",i.formatDate(e.createdAt)," ")}}function Ae(n,t){if(n&1&&(a(0,"span"),m(1),o()),n&2){let e=s(2).$implicit,i=s();r(),_(i.formatDate(e.lastLoginAt))}}function Ne(n,t){n&1&&(a(0,"span",11),m(1,"Never"),o())}function Fe(n,t){if(n&1&&(a(0,"span"),v(1,Ae,2,1,"span",26)(2,Ne,2,0,"span",16),o()),n&2){let e=s().$implicit;r(),d("ngIf",e.lastLoginAt),r(),d("ngIf",!e.lastLoginAt)}}function $e(n,t){if(n&1&&(K(0,2),v(1,Me,9,4,"div",3)(2,we,3,2,"span",4)(3,Oe,3,2,"div",5)(4,Ee,3,9,"span",6)(5,Te,3,2,"span",5)(6,De,2,1,"span",5)(7,Fe,3,2,"span",5),Q()),n&2){let e=t.column;d("ngSwitch",e.key),r(),d("ngSwitchCase","user"),r(),d("ngSwitchCase","username"),r(),d("ngSwitchCase","roles"),r(),d("ngSwitchCase","status"),r(),d("ngSwitchCase","lockStatus"),r(),d("ngSwitchCase","created"),r(),d("ngSwitchCase","lastLogin")}}var z=class n{i18n=p(w);permissionService=p(E);users=[];loading=g(!1);currentPage=g(1);totalPages=g(1);totalItems=g(0);pageSize=g(10);viewUser=new u;editUser=new u;deleteUser=new u;manageRoles=new u;pageChange=new u;pageSizeChange=new u;selectionChange=new u;columns=[{key:"user",label:"User",width:"250px"},{key:"username",label:"Username",width:"150px"},{key:"roles",label:"Roles",width:"200px"},{key:"status",label:"Status",width:"100px",align:"center"},{key:"lockStatus",label:"Access",width:"100px",align:"center"},{key:"created",label:"Created",width:"120px"},{key:"lastLogin",label:"Last Login",width:"120px"}];get actions(){let t=[];return this.permissionService.has(`${b.USER}.${h.READ}`)&&t.push({key:"view",label:"View",icon:"fa-eye",color:"info"}),this.permissionService.has(`${b.USER}.${h.UPDATE}`)&&(t.push({key:"edit",label:"Edit",icon:"fa-edit",color:"primary",condition:e=>this.canEditUser(e)}),t.push({key:"manageRoles",label:"Manage Roles",icon:"fa-user-tag",color:"warning",condition:e=>this.canEditUser(e)})),this.permissionService.has(`${b.USER}.${h.DELETE}`)&&t.push({key:"delete",label:"Delete",icon:"fa-trash",color:"danger",condition:e=>this.canDeleteUser(e)}),t}onActionClick(t){let{action:e,item:i}=t;switch(e){case"view":this.viewUser.emit(i);break;case"edit":this.editUser.emit(i);break;case"delete":this.deleteUser.emit(i);break;case"manageRoles":this.manageRoles.emit(i);break}}onPageChange(t){this.pageChange.emit(t)}onPageSizeChange(t){this.pageSizeChange.emit(t)}onSelectionChange(t){this.selectionChange.emit(t)}getInitials(t,e){let i=t?t.charAt(0).toUpperCase():"",c=e?e.charAt(0).toUpperCase():"";return i+c}isSystemAdmin(t){return t.username.toLowerCase()==="systemadmin"}canEditUser(t){return!this.isSystemAdmin(t)}canDeleteUser(t){return!this.isSystemAdmin(t)}isUserLocked(t){return t?new Date(t)>new Date:!1}formatDate(t){return new Date(t).toLocaleDateString(this.i18n.getCurrentLocale(),{year:"numeric",month:"short",day:"numeric"})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=M({type:n,selectors:[["app-user-table"]],inputs:{users:"users",loading:"loading",currentPage:"currentPage",totalPages:"totalPages",totalItems:"totalItems",pageSize:"pageSize"},outputs:{viewUser:"viewUser",editUser:"editUser",deleteUser:"deleteUser",manageRoles:"manageRoles",pageChange:"pageChange",pageSizeChange:"pageSizeChange",selectionChange:"selectionChange"},decls:3,vars:11,consts:[["cellTemplate",""],[3,"actionClick","pageChange","pageSizeChange","selectionChange","data","columns","actions","loading","currentPage","totalPages","totalItems","pageSize","allowSelection","emptyMessage","emptyTitle"],[3,"ngSwitch"],["class","d-flex align-items-center",4,"ngSwitchCase"],["class","fw-medium",4,"ngSwitchCase"],[4,"ngSwitchCase"],["class","badge",3,"bg-success","bg-danger",4,"ngSwitchCase"],[1,"d-flex","align-items-center"],[1,"avatar-sm","me-2"],[1,"avatar-initial","bg-primary","text-white","rounded-circle"],[1,"fw-medium"],[1,"text-muted"],["class","badge bg-warning text-dark ms-1","title","System Administrator",4,"ngIf"],["title","System Administrator",1,"badge","bg-warning","text-dark","ms-1"],[1,"fas","fa-crown"],["class","badge bg-secondary me-1",4,"ngFor","ngForOf"],["class","text-muted",4,"ngIf"],[1,"badge","bg-secondary","me-1"],[1,"badge"],[1,"fas"],["class","badge bg-warning",4,"ngIf"],["class","text-success",4,"ngIf"],[1,"badge","bg-warning"],[1,"fas","fa-lock"],[1,"text-success"],[1,"fas","fa-unlock"],[4,"ngIf"]],template:function(e,i){if(e&1){let c=k();a(0,"app-data-table",1),C("actionClick",function(R){return x(c),U(i.onActionClick(R))})("pageChange",function(R){return x(c),U(i.onPageChange(R))})("pageSizeChange",function(R){return x(c),U(i.onPageSizeChange(R))})("selectionChange",function(R){return x(c),U(i.onSelectionChange(R))}),v(1,$e,8,8,"ng-template",null,0,Y),o()}e&2&&d("data",i.users)("columns",i.columns)("actions",i.actions)("loading",i.loading)("currentPage",i.currentPage)("totalPages",i.totalPages)("totalItems",i.totalItems)("pageSize",i.pageSize)("allowSelection",!0)("emptyMessage","No users found")("emptyTitle","No Users")},dependencies:[P,Z,A,ee,te,se],styles:[".avatar-sm[_ngcontent-%COMP%]{width:2rem;height:2rem}.avatar-initial[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:.875rem;font-weight:600}"]})};var le=class n{usersService=p(N);notificationService=p(ie);confirmationService=p(re);router=p(ne);i18n=p(w);permissionService=p(E);loading=g(!1);users=g([]);pagedResult=g(null);currentPage=g(1);pageSize=g(10);currentFilter={};showRoleManagement=g(!1);selectedUser=g(null);availableRoles=g([{id:1,name:"SystemAdmin"},{id:2,name:"Admin"},{id:3,name:"HROperation"},{id:4,name:"User"}]);totalPages=T(()=>this.pagedResult()?.totalPages||1);totalItems=T(()=>this.pagedResult()?.totalItems||0);totalPagesSignal=g(1);totalItemsSignal=g(0);PERMISSIONS={USER_CREATE:`${b.USER}.${h.CREATE}`,USER_READ:`${b.USER}.${h.READ}`,USER_UPDATE:`${b.USER}.${h.UPDATE}`,USER_DELETE:`${b.USER}.${h.DELETE}`,USER_ASSIGN_ROLE:`${b.USER}.${h.ASSIGN_ROLE}`,USER_REMOVE_ROLE:`${b.USER}.${h.REMOVE_ROLE}`,USER_MANAGE:`${b.USER}.${h.MANAGE}`};ngOnInit(){this.loadUsers()}loadUsers(){this.loading.set(!0);let t=D({page:this.currentPage(),pageSize:this.pageSize()},this.currentFilter);this.usersService.getUsers(t).subscribe({next:e=>{this.pagedResult.set(e),this.users.set(e.items),this.totalPagesSignal.set(e.totalPages),this.totalItemsSignal.set(e.totalItems),this.loading.set(!1)},error:e=>{console.error("Failed to load users:",e),this.loading.set(!1),this.notificationService.error(this.i18n.t("errors.server"),this.i18n.t("errors.network"))}})}onSearchChange(t){this.currentFilter=H(D({},this.currentFilter),{search:t}),this.currentPage.set(1),this.loadUsers()}onFiltersChange(t){this.currentFilter=D({},t),this.currentPage.set(1),this.loadUsers()}onAddUser(){this.router.navigate(["/users/create"])}onViewUser(t){this.router.navigate(["/users",t.id,"view"])}onEditUser(t){this.router.navigate(["/users",t.id,"edit"])}onDeleteUser(t){return j(this,null,function*(){let e=this.i18n.t("users.confirm_delete_user").replace("{{username}}",t.username);(yield this.confirmationService.confirm({title:this.i18n.t("users.delete_user"),message:e,confirmText:this.i18n.t("common.delete"),cancelText:this.i18n.t("common.cancel"),confirmButtonClass:"btn-danger",icon:"fa-trash",iconClass:"text-danger"})).confirmed&&this.usersService.deleteUser(t.id).subscribe({next:()=>{this.loadUsers(),this.notificationService.success(this.i18n.t("app.success"),this.i18n.t("users.user_deleted"))},error:c=>{let l=this.i18n.t("errors.server");c.error&&c.error.error&&(l=c.error.error),this.notificationService.error(this.i18n.t("app.error"),l)}})})}onManageRoles(t){this.selectedUser.set(t),this.showRoleManagement.set(!0)}onPageChange(t){this.currentPage.set(t),this.loadUsers()}onPageSizeChange(t){this.pageSize.set(t),this.currentPage.set(1),this.loadUsers()}onSelectionChange(t){console.log("Selected users:",t)}onRolesUpdated(t){this.loadUsers(),this.notificationService.success(this.i18n.t("app.success"),"User roles updated successfully")}onCloseRoleManagement(){this.showRoleManagement.set(!1),this.selectedUser.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=M({type:n,selectors:[["app-users"]],decls:7,vars:12,consts:[[1,"users-page"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[3,"searchChange","filtersChange","addUser","showAddButton","addButtonText","availableRoles"],[3,"viewUser","editUser","deleteUser","manageRoles","pageChange","pageSizeChange","selectionChange","users","loading","currentPage","totalPages","totalItems","pageSize"],[3,"showChange","rolesUpdated","user","show"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"h2"),m(3),o()(),a(4,"app-user-filters",2),C("searchChange",function(l){return i.onSearchChange(l)})("filtersChange",function(l){return i.onFiltersChange(l)})("addUser",function(){return i.onAddUser()}),o(),a(5,"app-user-table",3),C("viewUser",function(l){return i.onViewUser(l)})("editUser",function(l){return i.onEditUser(l)})("deleteUser",function(l){return i.onDeleteUser(l)})("manageRoles",function(l){return i.onManageRoles(l)})("pageChange",function(l){return i.onPageChange(l)})("pageSizeChange",function(l){return i.onPageSizeChange(l)})("selectionChange",function(l){return i.onSelectionChange(l)}),o(),a(6,"app-role-management",4),C("showChange",function(){return i.onCloseRoleManagement()})("rolesUpdated",function(l){return i.onRolesUpdated(l)}),o()()),e&2&&(r(3),_(i.i18n.t("users.title")),r(),d("showAddButton",i.permissionService.has(i.PERMISSIONS.USER_CREATE))("addButtonText",i.i18n.t("users.create_user"))("availableRoles",i.availableRoles),r(),d("users",i.users())("loading",i.loading)("currentPage",i.currentPage)("totalPages",i.totalPagesSignal)("totalItems",i.totalItemsSignal)("pageSize",i.pageSize),r(),d("user",i.selectedUser())("show",i.showRoleManagement()))},dependencies:[P,F,$,z],styles:[".users-page[_ngcontent-%COMP%]{padding:0}.avatar-sm[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.avatar-title[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:600}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.badge[_ngcontent-%COMP%]{font-size:.75rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:.25rem!important;margin-right:2px}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}.modal.show[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .15s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.table-responsive[_ngcontent-%COMP%]{border-radius:.375rem}.pagination[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{color:var(--bs-primary);border-color:var(--bs-border-color)}.pagination[_ngcontent-%COMP%]   .page-item.active[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{background-color:var(--bs-primary);border-color:var(--bs-primary)}.form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.input-group-text[_ngcontent-%COMP%]{background-color:var(--bs-light);border-color:var(--bs-border-color)}.card[_ngcontent-%COMP%]{box-shadow:0 .125rem .25rem #00000013;border:1px solid var(--bs-border-color)}.card-body[_ngcontent-%COMP%]{padding:1.5rem}.spinner-border[_ngcontent-%COMP%]{width:2rem;height:2rem}[dir=rtl][_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:0;margin-left:2px}[dir=rtl][_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .avatar-sm[_ngcontent-%COMP%]{margin-right:0;margin-left:.5rem}@media (max-width: 768px){.btn-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:0;width:100%}.table-responsive[_ngcontent-%COMP%]{font-size:.875rem}.badge[_ngcontent-%COMP%]{font-size:.7rem}}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar{height:8px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--bs-light);border-radius:4px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--bs-secondary);border-radius:4px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--bs-dark)}"]})};export{le as UsersComponent};
