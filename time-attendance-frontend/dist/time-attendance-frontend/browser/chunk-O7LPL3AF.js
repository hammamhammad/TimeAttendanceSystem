import{a as f}from"./chunk-3VZ5QHEY.js";import{g}from"./chunk-TWXUAMJ4.js";import{Cc as m,J as a,M as c,Q as l,Yb as p,da as h,g as u,k as i,x as n}from"./chunk-JSQL33QG.js";var o={baseUrl:f.apiUrl||"http://localhost:5000",endpoints:{auth:{login:"/api/v1/auth/login",refresh:"/api/v1/auth/refresh",logout:"/api/v1/auth/logout",profile:"/api/v1/auth/profile",changePassword:"/api/v1/auth/change-password"},users:{list:"/api/users",create:"/api/users",update:t=>`/api/users/${t}`,delete:t=>`/api/users/${t}`,get:t=>`/api/users/${t}`},employees:{list:"/api/employees",create:"/api/employees",update:t=>`/api/employees/${t}`,delete:t=>`/api/employees/${t}`,get:t=>`/api/employees/${t}`},departments:{list:"/api/departments"},branches:{list:"/api/branches"}}};var d=class t{constructor(e,r){this.http=e;this.router=r}TOKEN_KEY="access_token";REFRESH_TOKEN_KEY="refresh_token";USER_KEY="current_user";currentUserSubject=new u(this.getUserFromStorage());currentUser$=this.currentUserSubject.asObservable();currentUser=h(this.getUserFromStorage());isAuthenticated=p(()=>!!this.currentUser());isAdmin=p(()=>this.currentUser()?.roles?.includes("Admin")||this.currentUser()?.roles?.includes("SystemAdmin")||!1);login(e){return this.http.post(`${o.baseUrl}${o.endpoints.auth.login}`,{username:e.username,password:e.password,deviceInfo:e.deviceInfo,rememberMe:e.rememberMe||!1}).pipe(a(r=>{this.setSession(r)}),n(r=>(console.error("Login failed:",r),i(()=>r))))}logout(){this.clearSession(),this.router.navigate(["/login"])}refreshToken(){let e=this.getRefreshToken();if(!e)return i(()=>new Error("No refresh token available"));let r={refreshToken:e};return this.http.post(`${o.baseUrl}${o.endpoints.auth.refresh}`,r).pipe(a(s=>{s.refreshToken&&this.updateTokens(s.accessToken,s.refreshToken)}),n(s=>(console.error("Token refresh failed:",s),this.logout(),i(()=>s))))}getAccessToken(){return localStorage.getItem(this.TOKEN_KEY)}getRefreshToken(){return localStorage.getItem(this.REFRESH_TOKEN_KEY)}isTokenExpired(){let e=this.getAccessToken();if(!e)return!0;try{let s=JSON.parse(atob(e.split(".")[1])).exp*1e3;return Date.now()>=s}catch{return!0}}setSession(e){localStorage.setItem(this.TOKEN_KEY,e.accessToken),e.refreshToken&&localStorage.setItem(this.REFRESH_TOKEN_KEY,e.refreshToken),localStorage.setItem(this.USER_KEY,JSON.stringify(e.user)),this.currentUser.set(e.user),this.currentUserSubject.next(e.user)}updateTokens(e,r){localStorage.setItem(this.TOKEN_KEY,e),localStorage.setItem(this.REFRESH_TOKEN_KEY,r)}clearSession(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.REFRESH_TOKEN_KEY),localStorage.removeItem(this.USER_KEY),this.currentUser.set(null),this.currentUserSubject.next(null)}getUserFromStorage(){try{let e=localStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}catch{return null}}isSystemAdmin(){return this.currentUser()?.roles?.includes("SystemAdmin")||!1}static \u0275fac=function(r){return new(r||t)(l(m),l(g))};static \u0275prov=c({token:t,factory:t.\u0275fac,providedIn:"root"})};export{o as a,d as b};
