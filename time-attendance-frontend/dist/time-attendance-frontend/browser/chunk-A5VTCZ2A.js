import{a as X}from"./chunk-6GOUAYRY.js";import{a as K}from"./chunk-U2ZTVJM6.js";import{a as Q}from"./chunk-EHNHB6RU.js";import"./chunk-QHBTYDS6.js";import{a as G}from"./chunk-7TWIWOLV.js";import{a as V}from"./chunk-4335LQ3A.js";import"./chunk-LDWMK676.js";import"./chunk-HCDX4O2L.js";import{a as J}from"./chunk-6B6T6MZ3.js";import{c as W,e as j,h as z,j as L,r as U,t as F,w as B,z as R}from"./chunk-HF7V7ZC6.js";import{a as H}from"./chunk-RUOWTK24.js";import"./chunk-HZR4WXEY.js";import{g as q}from"./chunk-O3U3HUCY.js";import{a as $}from"./chunk-77FC2LKR.js";import"./chunk-A6EM5NV6.js";import{$a as h,Bc as N,Eb as r,Fb as p,Gb as v,Ha as k,Mb as x,Nb as S,Ob as P,T as b,Y as f,Z as y,_a as g,cb as I,db as D,dc as C,eb as u,fa as c,fb as o,gb as a,hb as A,ob as w,qb as _,sb as m,uc as O,wa as i}from"./chunk-IGEIB4M6.js";import{a as M,b as E,e as T}from"./chunk-YMDWBF3A.js";var Z=(l,t)=>t.value;function ee(l,t){if(l&1&&(o(0,"option",9),r(1),a()),l&2){let e=t.$implicit;u("value",e.value),i(),p(e.label)}}function te(l,t){if(l&1){let e=w();o(0,"button",29),_("click",function(){f(e);let s=m();return y(s.onClearFilters())}),A(1,"i",30),r(2),a()}if(l&2){let e=m();i(2),v(" ",e.t("common.clear_filters")," ")}}function ne(l,t){if(l&1&&(o(0,"p",44)(1,"strong"),r(2),a(),r(3),a()),l&2){let e=m(3);i(2),v("",e.t("approvals.description"),":"),i(),v(" ",e.selectedApproval().entityDescription," ")}}function ie(l,t){if(l&1&&(o(0,"div",33)(1,"h6",42),r(2),a(),o(3,"p",43)(4,"strong"),r(5),a(),r(6),a(),o(7,"p",43)(8,"strong"),r(9),a(),r(10),a(),g(11,ne,4,2,"p",44),a()),l&2){let e=m(2);i(2),p(e.t("approvals.request_summary")),i(3),v("",e.t("approvals.request_type"),":"),i(),v(" ",e.selectedApproval().workflowDefinitionName," "),i(3),v("",e.t("approvals.requested_by"),":"),i(),v(" ",e.selectedApproval().requestedByName," "),i(),h(e.selectedApproval().entityDescription?11:-1)}}function ae(l,t){l&1&&(o(0,"span",35),r(1,"*"),a())}function oe(l,t){if(l&1&&(o(0,"small",37),r(1),a()),l&2){let e=m(2);i(),p(e.t("approvals.comments_required_reject"))}}function re(l,t){if(l&1){let e=w();o(0,"div",34)(1,"label",6),r(2),o(3,"span",35),r(4,"*"),a()(),o(5,"input",45),P("ngModelChange",function(s){f(e);let d=m(2);return S(d.delegateUserId,s)||(d.delegateUserId=s),y(s)}),a(),o(6,"small",37),r(7),a()()}if(l&2){let e=m(2);i(2),v(" ",e.t("approvals.delegate_to")," "),i(3),u("placeholder",e.t("approvals.enter_user_id")),x("ngModel",e.delegateUserId),i(2),p(e.t("approvals.delegate_user_hint"))}}function le(l,t){l&1&&A(0,"span",41)}function se(l,t){if(l&1){let e=w();o(0,"app-modal-wrapper",31),_("close",function(){f(e);let s=m();return y(s.closeApprovalModal())}),o(1,"div",32),g(2,ie,12,6,"div",33),o(3,"div",34)(4,"label",6),r(5),g(6,ae,2,0,"span",35),a(),o(7,"textarea",36),P("ngModelChange",function(s){f(e);let d=m();return S(d.comments,s)||(d.comments=s),y(s)}),r(8,"        "),a(),g(9,oe,2,1,"small",37),a(),g(10,re,8,4,"div",34),a(),o(11,"div",38)(12,"button",39),_("click",function(){f(e);let s=m();return y(s.closeApprovalModal())}),r(13),a(),o(14,"button",40),_("click",function(){f(e);let s=m();return y(s.submitApproval())}),g(15,le,1,0,"span",41),r(16),a()()()}if(l&2){let e=m();u("title",e.getModalTitle())("show",e.showApprovalModal()),i(2),h(e.selectedApproval()?2:-1),i(3),v(" ",e.t("approvals.comments")," "),i(),h(e.approvalAction()==="reject"?6:-1),i(),u("placeholder",e.t("approvals.comments_placeholder")),x("ngModel",e.comments),u("required",e.approvalAction()==="reject"),i(2),h(e.approvalAction()==="reject"?9:-1),i(),h(e.approvalAction()==="delegate"?10:-1),i(2),u("disabled",e.processing()),i(),v(" ",e.t("common.cancel")," "),i(),u("ngClass",e.getSubmitButtonClass())("disabled",e.processing()),i(),h(e.processing()?15:-1),i(),v(" ",e.t("approvals."+e.approvalAction())," ")}}var Y=class l{approvalsService=b(X);router=b(q);notificationService=b(H);confirmationService=b(G);i18n=b($);permissionService=b(V);loading=c(!1);approvals=c([]);totalCount=c(0);currentPage=c(1);pageSize=c(10);totalPages=c(0);selectedEntityType=c(void 0);selectedOverdue=c(void 0);showApprovalModal=c(!1);selectedApproval=c(null);approvalAction=c("approve");comments=c("");delegateUserId=c(void 0);processing=c(!1);entityTypes=C(()=>[{value:"Vacation",label:this.t("approvals.vacation_request")},{value:"Excuse",label:this.t("approvals.excuse_request")},{value:"RemoteWork",label:this.t("approvals.remote_work_request")},{value:"Overtime",label:this.t("approvals.overtime_request")},{value:"Timesheet",label:this.t("approvals.timesheet")},{value:"AttendanceCorrection",label:this.t("approvals.attendance_correction")}]);tableColumns=C(()=>[{key:"entityTypeDisplay",label:this.t("approvals.request_type"),sortable:!1,width:"150px",priority:"high",mobileLabel:this.t("approvals.request_type"),renderHtml:!0},{key:"requestedByName",label:this.t("approvals.requested_by"),sortable:!0,width:"150px",priority:"high",mobileLabel:this.t("approvals.requested_by")},{key:"entityDescription",label:this.t("approvals.description"),sortable:!1,width:"200px",priority:"medium",mobileLabel:this.t("approvals.description")},{key:"currentStepName",label:this.t("approvals.current_step"),sortable:!1,width:"150px",priority:"medium",mobileLabel:this.t("approvals.current_step")},{key:"requestedAtDisplay",label:this.t("approvals.requested_at"),sortable:!0,width:"150px",priority:"low",hideOnMobile:!0,mobileLabel:this.t("approvals.requested_at")},{key:"overdueStatus",label:this.t("approvals.status"),sortable:!1,width:"100px",align:"center",priority:"high",mobileLabel:this.t("approvals.status"),renderHtml:!0}]);tableActions=C(()=>[{key:"approve",label:this.t("approvals.approve"),icon:"fa-check",color:"success",condition:()=>!0},{key:"reject",label:this.t("approvals.reject"),icon:"fa-times",color:"danger",condition:()=>!0},{key:"delegate",label:this.t("approvals.delegate"),icon:"fa-share",color:"info",condition:t=>t.allowDelegation},{key:"view",label:this.t("common.view"),icon:"fa-eye",color:"primary",condition:()=>!0}]);tableData=C(()=>this.approvals().map(t=>E(M({},t),{entityTypeDisplay:this.formatEntityType(t.entityType),requestedAtDisplay:this.formatDate(t.requestedAt),overdueStatus:this.formatOverdueStatus(t)})));overdueCount=C(()=>this.approvals().filter(t=>t.isOverdue).length);onTimeCount=C(()=>this.approvals().filter(t=>!t.isOverdue).length);ngOnInit(){this.loadApprovals()}t(t){return this.i18n.t(t)}loadApprovals(){this.loading.set(!0),this.approvalsService.getPendingApprovals(this.currentPage(),this.pageSize(),this.selectedEntityType(),this.selectedOverdue()).subscribe({next:t=>{t&&t.items?(this.approvals.set(t.items),this.totalCount.set(t.totalCount),this.totalPages.set(t.totalPages)):(this.approvals.set([]),this.totalCount.set(0),this.totalPages.set(0)),this.loading.set(!1)},error:t=>{console.error("Failed to load pending approvals:",t),this.loading.set(!1),this.notificationService.error(this.t("app.error"),this.t("approvals.load_error"))}})}formatDate(t){return new Date(t).toLocaleDateString(this.i18n.getCurrentLocale(),{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}formatEntityType(t){let e="";switch(t){case"Vacation":e="vacation_request";break;case"Excuse":e="excuse_request";break;case"RemoteWork":e="remote_work_request";break;case"Overtime":e="overtime_request";break;case"Timesheet":e="timesheet";break;case"AttendanceCorrection":e="attendance_correction";break;default:return t}return`<span class="badge bg-primary">${this.t(`approvals.${e}`)}</span>`}formatOverdueStatus(t){return t.isOverdue?`<span class="badge bg-danger">${this.t("approvals.overdue")}</span>`:`<span class="badge bg-warning text-dark">${this.t("approvals.pending")}</span>`}onActionClick(t){let{action:e,item:n}=t;switch(e){case"approve":this.openApprovalModal(n,"approve");break;case"reject":this.openApprovalModal(n,"reject");break;case"delegate":this.openApprovalModal(n,"delegate");break;case"view":this.viewEntityDetails(n);break;default:console.warn("Unknown action:",e)}}openApprovalModal(t,e){this.selectedApproval.set(t),this.approvalAction.set(e),this.comments.set(""),this.delegateUserId.set(void 0),this.showApprovalModal.set(!0)}closeApprovalModal(){this.showApprovalModal.set(!1),this.selectedApproval.set(null),this.comments.set(""),this.delegateUserId.set(void 0)}submitApproval(){return T(this,null,function*(){let t=this.selectedApproval();if(t){if(this.approvalAction()==="reject"&&!this.comments().trim()){this.notificationService.warning(this.t("app.warning"),this.t("approvals.comments_required_reject"));return}if(this.approvalAction()==="delegate"&&!this.delegateUserId()){this.notificationService.warning(this.t("app.warning"),this.t("approvals.delegate_user_required"));return}this.processing.set(!0);try{switch(this.approvalAction()){case"approve":yield this.approvalsService.approveStep(t.workflowInstanceId,{comments:this.comments()||void 0}).toPromise(),this.notificationService.success(this.t("app.success"),this.t("approvals.approve_success"));break;case"reject":yield this.approvalsService.rejectStep(t.workflowInstanceId,{comments:this.comments()}).toPromise(),this.notificationService.success(this.t("app.success"),this.t("approvals.reject_success"));break;case"delegate":yield this.approvalsService.delegateStep(t.workflowInstanceId,{delegateToUserId:this.delegateUserId(),comments:this.comments()||void 0}).toPromise(),this.notificationService.success(this.t("app.success"),this.t("approvals.delegate_success"));break}this.closeApprovalModal(),this.loadApprovals()}catch(e){console.error("Failed to process approval:",e),this.notificationService.error(this.t("app.error"),this.t(`approvals.${this.approvalAction()}_error`))}finally{this.processing.set(!1)}}})}viewEntityDetails(t){let n={Vacation:"/employee-vacations",Excuse:"/employee-excuses",RemoteWork:"/remote-work",Overtime:"/overtime-requests",Timesheet:"/timesheets",AttendanceCorrection:"/attendance-corrections"}[t.entityType];n&&this.router.navigate([n,t.entityId,"view"])}onPageChange(t){this.currentPage.set(t),this.loadApprovals()}onPageSizeChange(t){this.pageSize.set(t),this.currentPage.set(1),this.loadApprovals()}onEntityTypeChange(t){let e=t.target.value;this.selectedEntityType.set(e||void 0),this.currentPage.set(1),this.loadApprovals()}onOverdueChange(t){let e=t.target.value;this.selectedOverdue.set(e==="true"?!0:e==="false"?!1:void 0),this.currentPage.set(1),this.loadApprovals()}onClearFilters(){this.selectedEntityType.set(void 0),this.selectedOverdue.set(void 0),this.currentPage.set(1),this.loadApprovals()}hasActiveFilters(){return this.selectedEntityType()!==void 0||this.selectedOverdue()!==void 0}getModalTitle(){switch(this.approvalAction()){case"approve":return this.t("approvals.approve_request");case"reject":return this.t("approvals.reject_request");case"delegate":return this.t("approvals.delegate_request");default:return""}}getSubmitButtonClass(){switch(this.approvalAction()){case"approve":return"btn-success";case"reject":return"btn-danger";case"delegate":return"btn-info";default:return"btn-primary"}}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=k({type:l,selectors:[["app-pending-approvals"]],decls:55,vars:26,consts:[[1,"container-fluid","py-4"],[3,"title"],[1,"card","mb-4"],[1,"card-body"],[1,"row","g-3","align-items-end"],[1,"col-md-3"],[1,"form-label"],[1,"form-select",3,"change","value"],["value",""],[3,"value"],["value","true"],["value","false"],["type","button",1,"btn","btn-outline-secondary"],[1,"col-md-3","text-end"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"fa-solid","fa-refresh","me-1"],[1,"row","mb-4"],[1,"col-md-4"],[1,"card","bg-warning","bg-opacity-10","border-warning"],[1,"card-body","text-center"],[1,"text-warning","mb-1"],[1,"text-muted","mb-0"],[1,"card","bg-danger","bg-opacity-10","border-danger"],[1,"text-danger","mb-1"],[1,"card","bg-info","bg-opacity-10","border-info"],[1,"text-info","mb-1"],[1,"card"],[3,"pageChange","pageSizeChange","actionClick","columns","data","loading","totalItems","currentPage","pageSize","actions","emptyMessage"],[3,"title","show"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fa-solid","fa-times","me-1"],[3,"close","title","show"],[1,"modal-body"],[1,"alert","alert-info"],[1,"mb-3"],[1,"text-danger"],["rows","3",1,"form-control",3,"ngModelChange","placeholder","ngModel","required"],[1,"text-muted"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","button",1,"btn",3,"click","ngClass","disabled"],[1,"spinner-border","spinner-border-sm","me-1"],[1,"alert-heading"],[1,"mb-1"],[1,"mb-0"],["type","number","required","",1,"form-control",3,"ngModelChange","placeholder","ngModel"]],template:function(e,n){if(e&1&&(o(0,"div",0),A(1,"app-page-header",1),o(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"label",6),r(7),a(),o(8,"select",7),_("change",function(d){return n.onEntityTypeChange(d)}),o(9,"option",8),r(10),a(),I(11,ee,2,2,"option",9,Z),a()(),o(13,"div",5)(14,"label",6),r(15),a(),o(16,"select",7),_("change",function(d){return n.onOverdueChange(d)}),o(17,"option",8),r(18),a(),o(19,"option",10),r(20),a(),o(21,"option",11),r(22),a()()(),o(23,"div",5),g(24,te,3,1,"button",12),a(),o(25,"div",13)(26,"button",14),_("click",function(){return n.loadApprovals()}),A(27,"i",15),r(28),a()()()()(),o(29,"div",16)(30,"div",17)(31,"div",18)(32,"div",19)(33,"h3",20),r(34),a(),o(35,"p",21),r(36),a()()()(),o(37,"div",17)(38,"div",22)(39,"div",19)(40,"h3",23),r(41),a(),o(42,"p",21),r(43),a()()()(),o(44,"div",17)(45,"div",24)(46,"div",19)(47,"h3",25),r(48),a(),o(49,"p",21),r(50),a()()()()(),o(51,"div",26)(52,"div",3)(53,"app-data-table",27),_("pageChange",function(d){return n.onPageChange(d)})("pageSizeChange",function(d){return n.onPageSizeChange(d)})("actionClick",function(d){return n.onActionClick(d)}),a()()()(),g(54,se,17,16,"app-modal-wrapper",28)),e&2){let s;i(),u("title",n.t("approvals.pending_title")),i(6),p(n.t("approvals.request_type")),i(),u("value",n.selectedEntityType()||""),i(2),p(n.t("common.all")),i(),D(n.entityTypes()),i(4),p(n.t("approvals.status")),i(),u("value",n.selectedOverdue()===void 0?"":(s=n.selectedOverdue())==null?null:s.toString()),i(2),p(n.t("common.all")),i(2),p(n.t("approvals.overdue_only")),i(2),p(n.t("approvals.on_time")),i(2),h(n.hasActiveFilters()?24:-1),i(4),v(" ",n.t("common.refresh")," "),i(6),p(n.totalCount()),i(2),p(n.t("approvals.total_pending")),i(5),p(n.overdueCount()),i(2),p(n.t("approvals.overdue_count")),i(5),p(n.onTimeCount()),i(2),p(n.t("approvals.on_time_count")),i(3),u("columns",n.tableColumns())("data",n.tableData())("loading",n.loading())("totalItems",n.totalCount())("currentPage",n.currentPage())("pageSize",n.pageSize())("actions",n.tableActions())("emptyMessage",n.t("approvals.no_pending_approvals")),i(),h(n.showApprovalModal()?54:-1)}},dependencies:[N,O,R,U,F,W,L,j,B,z,Q,J,K],styles:[".badge[_ngcontent-%COMP%]{font-weight:500}.card.bg-warning.bg-opacity-10[_ngcontent-%COMP%], .card.bg-danger.bg-opacity-10[_ngcontent-%COMP%], .card.bg-info.bg-opacity-10[_ngcontent-%COMP%]{border-width:2px}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:2rem;font-weight:600}.card[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.modal-body[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]{margin-bottom:1rem}.modal-body[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-bottom:.75rem}@media (max-width: 768px){.row.g-3[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:.5rem}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem}}"]})};export{Y as PendingApprovalsComponent};
