import{a as x}from"./chunk-4AU4XR4J.js";import{a as B}from"./chunk-5ND4FORV.js";import{a as q}from"./chunk-VPCY7LU7.js";import{a as F}from"./chunk-MRSJZ7DK.js";import"./chunk-OCNPGNI4.js";import"./chunk-BSEKTODI.js";import"./chunk-HUSARQNL.js";import"./chunk-QXVLGI72.js";import"./chunk-LDWMK676.js";import"./chunk-IE5XUEO5.js";import{a as z}from"./chunk-C3GHRZ52.js";import"./chunk-YQIE4CGE.js";import{a as V}from"./chunk-JNFDDMIM.js";import{a as D}from"./chunk-GEGVYT7O.js";import{a as k}from"./chunk-A6EM5NV6.js";import{A as N,E as l,Ga as p,Ha as b,Ia as M,L as i,Q as f,aa as y,ba as _,fb as d,ga as r,ha as s,hb as P,ia as o,ib as w,ja as h,qa as T,sa as m,u as U,ua as v,wb as R,xb as E,y as c,z as I}from"./chunk-5OFYUWMA.js";import{a as S,b as L}from"./chunk-YMDWBF3A.js";var A=class n{http=c(E);apiUrl=`${k.apiUrl}/api/v1/audit-logs`;getAuditLogs(e={}){let t=new R;return e.startDate&&(t=t.set("startDate",e.startDate)),e.endDate&&(t=t.set("endDate",e.endDate)),e.actions&&e.actions.length>0&&(t=t.set("actions",e.actions.join(","))),e.entityName&&(t=t.set("entityName",e.entityName)),e.actorUserId&&(t=t.set("actorUserId",e.actorUserId.toString())),e.searchTerm&&(t=t.set("searchTerm",e.searchTerm)),e.pageNumber&&(t=t.set("pageNumber",e.pageNumber.toString())),e.pageSize&&(t=t.set("pageSize",e.pageSize.toString())),e.sortBy&&(t=t.set("sortBy",e.sortBy)),e.sortDirection&&(t=t.set("sortDirection",e.sortDirection)),this.http.get(this.apiUrl,{params:t})}getEntityNames(){return["User","Employee","Shift","ShiftAssignment","VacationType","VacationRequest","Branch","Department","AttendanceRecord","PublicHoliday","ExcusePolicy","OvertimeConfiguration","Settings"]}getAuditActions(){return[{value:"Login",label:"Login"},{value:"Logout",label:"Logout"},{value:"LogoutAllDevices",label:"Logout All Devices"},{value:"TokenRefresh",label:"Token Refresh"},{value:"PasswordChange",label:"Password Change"},{value:"PasswordReset",label:"Password Reset"},{value:"PasswordResetRequest",label:"Password Reset Request"},{value:"AccountLockout",label:"Account Lockout"},{value:"AccountUnlock",label:"Account Unlock"},{value:"TwoFactorEnabled",label:"Two-Factor Enabled"},{value:"TwoFactorDisabled",label:"Two-Factor Disabled"},{value:"TwoFactorVerified",label:"Two-Factor Verified"},{value:"SessionCreated",label:"Session Created"},{value:"SessionTerminated",label:"Session Terminated"},{value:"SessionExpired",label:"Session Expired"},{value:"UserCreated",label:"User Created"},{value:"UserUpdated",label:"User Updated"},{value:"UserDeleted",label:"User Deleted"},{value:"UserActivated",label:"User Activated"},{value:"UserDeactivated",label:"User Deactivated"},{value:"UserRoleAssigned",label:"User Role Assigned"},{value:"UserRoleRevoked",label:"User Role Revoked"},{value:"UserBranchScopeAssigned",label:"User Branch Scope Assigned"},{value:"UserBranchScopeRevoked",label:"User Branch Scope Revoked"},{value:"EmployeeCreated",label:"Employee Created"},{value:"EmployeeUpdated",label:"Employee Updated"},{value:"EmployeeDeleted",label:"Employee Deleted"},{value:"EmployeeActivated",label:"Employee Activated"},{value:"EmployeeDeactivated",label:"Employee Deactivated"},{value:"ShiftCreated",label:"Shift Created"},{value:"ShiftUpdated",label:"Shift Updated"},{value:"ShiftDeleted",label:"Shift Deleted"},{value:"ShiftAssignmentCreated",label:"Shift Assignment Created"},{value:"ShiftAssignmentUpdated",label:"Shift Assignment Updated"},{value:"ShiftAssignmentDeleted",label:"Shift Assignment Deleted"},{value:"ShiftAssignmentActivated",label:"Shift Assignment Activated"},{value:"ShiftAssignmentDeactivated",label:"Shift Assignment Deactivated"},{value:"VacationTypeCreated",label:"Vacation Type Created"},{value:"VacationTypeUpdated",label:"Vacation Type Updated"},{value:"VacationTypeDeleted",label:"Vacation Type Deleted"},{value:"VacationRequestCreated",label:"Vacation Request Created"},{value:"VacationRequestUpdated",label:"Vacation Request Updated"},{value:"VacationRequestApproved",label:"Vacation Request Approved"},{value:"VacationRequestRejected",label:"Vacation Request Rejected"},{value:"VacationRequestCancelled",label:"Vacation Request Cancelled"},{value:"SystemStartup",label:"System Startup"},{value:"SystemShutdown",label:"System Shutdown"},{value:"DatabaseMigration",label:"Database Migration"},{value:"Created",label:"Created"},{value:"Updated",label:"Updated"},{value:"Deleted",label:"Deleted"},{value:"Viewed",label:"Viewed"}]}static \u0275fac=function(t){return new(t||n)};static \u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"})};function J(n,e){if(n&1&&(s(0,"div",2)(1,"h6",3),p(2),o(),s(3,"div",7)(4,"div",8)(5,"pre",9)(6,"code"),p(7),o()()()()()),n&2){let t=v();i(2),b(t.i18n.t("audit_logs.payload")),i(5),b(t.formattedPayload())}}var C=class n{i18n=c(D);auditLog=w.required();show=w.required();showChange=P();basicInfo=d(()=>{let e=this.auditLog();return[{label:this.i18n.t("audit_logs.action"),value:e.actionDisplayName},{label:this.i18n.t("audit_logs.entity"),value:`${e.entityName} (ID: ${e.entityId})`},{label:this.i18n.t("audit_logs.timestamp"),value:this.formatDateTime(e.createdAtUtc)}]});actorInfo=d(()=>{let e=this.auditLog();return e.actorUserId?[{label:this.i18n.t("audit_logs.actor_id"),value:e.actorUserId?.toString()||"-"},{label:this.i18n.t("audit_logs.actor_username"),value:e.actorUsername||"-"},{label:this.i18n.t("audit_logs.actor_email"),value:e.actorEmail||"-"}]:[{label:this.i18n.t("audit_logs.actor"),value:"System"}]});technicalInfo=d(()=>{let e=this.auditLog();return[{label:this.i18n.t("audit_logs.ip_address"),value:e.ipAddress||"-"},{label:this.i18n.t("audit_logs.user_agent"),value:e.userAgent||"-"},{label:this.i18n.t("audit_logs.created_by"),value:e.createdBy}]});hasPayload=d(()=>{let e=this.auditLog();return!!e.payloadJson&&e.payloadJson.trim()!==""});formattedPayload=d(()=>{let e=this.auditLog();if(!e.payloadJson)return"";try{let t=JSON.parse(e.payloadJson);return JSON.stringify(t,null,2)}catch{return e.payloadJson}});onClose(){this.showChange.emit(!1)}formatDateTime(e){return e?new Date(e).toLocaleString():"-"}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=f({type:n,selectors:[["app-audit-log-detail-modal"]],inputs:{auditLog:[1,"auditLog"],show:[1,"show"]},outputs:{showChange:"showChange"},decls:18,vars:17,consts:[[3,"close","show","title","size"],[1,"modal-body"],[1,"mb-4"],[1,"text-uppercase","text-muted","mb-3"],[3,"items","labelWidth","valueWidth"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"card","bg-light"],[1,"card-body"],[1,"mb-0",2,"max-height","300px","overflow-y","auto"]],template:function(t,a){t&1&&(s(0,"app-modal-wrapper",0),m("close",function(){return a.onClose()}),s(1,"div",1)(2,"div",2)(3,"h6",3),p(4),o(),h(5,"app-definition-list",4),o(),s(6,"div",2)(7,"h6",3),p(8),o(),h(9,"app-definition-list",4),o(),s(10,"div",2)(11,"h6",3),p(12),o(),h(13,"app-definition-list",4),o(),y(14,J,8,2,"div",2),o(),s(15,"div",5)(16,"button",6),m("click",function(){return a.onClose()}),p(17),o()()()),t&2&&(r("show",a.show())("title",a.i18n.t("audit_logs.detail_title"))("size","lg"),i(4),b(a.i18n.t("audit_logs.basic_information")),i(),r("items",a.basicInfo())("labelWidth","4")("valueWidth","8"),i(3),b(a.i18n.t("audit_logs.actor_information")),i(),r("items",a.actorInfo())("labelWidth","4")("valueWidth","8"),i(3),b(a.i18n.t("audit_logs.technical_information")),i(),r("items",a.technicalInfo())("labelWidth","4")("valueWidth","8"),i(),_(a.hasPayload()?14:-1),i(3),M(" ",a.i18n.t("common.close")," "))},dependencies:[B,x],styles:["pre[_ngcontent-%COMP%]{white-space:pre-wrap;word-wrap:break-word}code[_ngcontent-%COMP%]{color:#333;font-size:.875rem}"]})};function $(n,e){if(n&1){let t=T();s(0,"app-audit-log-detail-modal",5),m("showChange",function(){I(t);let u=v();return N(u.onCloseDetailModal())}),o()}if(n&2){let t=v();r("auditLog",t.selectedAuditLog())("show",t.showDetailModal())}}var W=class n{auditLogsService=c(A);notificationService=c(V);i18n=c(D);auditLogs=l([]);loading=l(!1);error=l(null);currentPage=l(1);pageSize=l(20);totalItems=l(0);totalPages=l(0);filters=l({});searchTerm=l("");sortBy=l("createdAtUtc");sortDirection=l("desc");selectedAuditLog=l(null);showDetailModal=l(!1);tableColumns=d(()=>[{key:"actorInfo",label:this.i18n.t("audit_logs.actor"),sortable:!1,width:"18%",priority:"high",renderHtml:!0},{key:"actionDisplayName",label:this.i18n.t("audit_logs.action"),sortable:!0,width:"15%",priority:"high"},{key:"entityInfo",label:this.i18n.t("audit_logs.entity"),sortable:!1,width:"15%",priority:"medium",renderHtml:!0},{key:"ipAddress",label:this.i18n.t("audit_logs.ip_address"),sortable:!0,width:"12%",priority:"medium"},{key:"timestamp",label:this.i18n.t("audit_logs.timestamp"),sortable:!0,width:"15%",priority:"high"}]);tableActions=d(()=>[{key:"view",label:this.i18n.t("common.view_details"),icon:"fa-eye",color:"primary"}]);tableData=d(()=>{let e=this.auditLogs();return Array.isArray(e)?e.map(t=>L(S({},t),{actorInfo:this.formatActor(t),entityInfo:this.formatEntity(t),timestamp:this.formatDateTime(t.createdAtUtc)})):[]});ngOnInit(){this.loadAuditLogs()}loadAuditLogs(){this.loading.set(!0),this.error.set(null);let e=L(S({},this.filters()),{searchTerm:this.searchTerm()||void 0,pageNumber:this.currentPage(),pageSize:this.pageSize(),sortBy:this.sortBy(),sortDirection:this.sortDirection()});this.auditLogsService.getAuditLogs(e).subscribe({next:t=>{this.auditLogs.set(t.auditLogs),this.totalItems.set(t.totalCount),this.totalPages.set(t.totalPages),this.loading.set(!1)},error:t=>{console.error("Failed to load audit logs:",t),this.error.set(this.i18n.t("audit_logs.errors.load_failed")),this.notificationService.error(this.i18n.t("audit_logs.errors.load_failed")),this.loading.set(!1)}})}onSearchChange(e){this.searchTerm.set(e),this.currentPage.set(1),this.loadAuditLogs()}onFiltersChange(e){let t={};e.startDate&&(t.startDate=e.startDate),e.endDate&&(t.endDate=e.endDate),e.actions&&e.actions.length>0&&(t.actions=e.actions),e.entityName&&(t.entityName=e.entityName),e.actorUserId&&(t.actorUserId=e.actorUserId),this.filters.set(t),this.currentPage.set(1),this.loadAuditLogs()}onPageChange(e){this.currentPage.set(e),this.loadAuditLogs()}onPageSizeChange(e){this.pageSize.set(e),this.currentPage.set(1),this.loadAuditLogs()}onSortChange(e){this.sortBy.set(e.column),this.sortDirection.set(e.direction),this.loadAuditLogs()}onActionClick(e){let{action:t,item:a}=e;switch(t){case"view":this.onViewDetails(a);break;default:console.warn("Unknown action:",t)}}onViewDetails(e){this.selectedAuditLog.set(e),this.showDetailModal.set(!0)}onCloseDetailModal(){this.showDetailModal.set(!1),this.selectedAuditLog.set(null)}onRefresh(){this.loadAuditLogs()}formatActor(e){if(!e.actorUserId)return'<div class="text-muted"><i class="fas fa-robot me-1"></i>System</div>';let t=e.actorUsername||"Unknown User",a=e.actorEmail||"";return`
      <div>
        <div class="fw-medium">${t}</div>
        ${a?`<small class="text-muted">${a}</small>`:""}
      </div>
    `}formatEntity(e){return`
      <div>
        <div class="fw-medium">${e.entityName}</div>
        <small class="text-muted font-monospace">${e.entityId}</small>
      </div>
    `}formatDateTime(e){return e?new Date(e).toLocaleString():"-"}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=f({type:n,selectors:[["app-audit-logs"]],decls:5,vars:14,consts:[[1,"app-list-page"],[3,"title"],[3,"searchChange","refresh","searchPlaceholder","showAddButton","showRefreshButton"],[3,"pageChange","pageSizeChange","sortChange","actionClick","columns","data","actions","loading","currentPage","pageSize","totalItems","totalPages","showPagination"],[3,"auditLog","show"],[3,"showChange","auditLog","show"]],template:function(t,a){t&1&&(s(0,"div",0),h(1,"app-page-header",1),s(2,"app-unified-filter",2),m("searchChange",function(g){return a.onSearchChange(g)})("refresh",function(){return a.onRefresh()}),o(),s(3,"app-data-table",3),m("pageChange",function(g){return a.onPageChange(g)})("pageSizeChange",function(g){return a.onPageSizeChange(g)})("sortChange",function(g){return a.onSortChange(g)})("actionClick",function(g){return a.onActionClick(g)}),o(),y(4,$,1,2,"app-audit-log-detail-modal",4),o()),t&2&&(i(),r("title",a.i18n.t("audit_logs.title")),i(),r("searchPlaceholder",a.i18n.t("audit_logs.search_placeholder"))("showAddButton",!1)("showRefreshButton",!0),i(),r("columns",a.tableColumns())("data",a.tableData())("actions",a.tableActions())("loading",a.loading())("currentPage",a.currentPage())("pageSize",a.pageSize())("totalItems",a.totalItems())("totalPages",a.totalPages())("showPagination",!0),i(),_(a.selectedAuditLog()?4:-1))},dependencies:[z,F,q,C],styles:[".app-list-page[_ngcontent-%COMP%]{padding:1.5rem}"]})};export{W as AuditLogsComponent};
