{
  "version": 3,
  "sources": ["src/app/pages/users/users.service.ts"],
  "sourcesContent": ["import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable, map } from 'rxjs';\r\nimport { environment } from '../../../environments/environment';\r\nimport {\r\n  UserDto,\r\n  CreateUserRequest,\r\n  UpdateUserRequest,\r\n  AssignRoleRequest,\r\n  AssignBranchRequest,\r\n  PagedResult\r\n} from '../../shared/models/user.model';\r\nimport { EmployeeDto } from '../../shared/models/employee.model';\r\n\r\nexport interface UsersFilter {\r\n  page?: number;\r\n  pageSize?: number;\r\n  search?: string;\r\n  branchId?: number;\r\n  roleId?: number;\r\n  isActive?: boolean;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class UsersService {\r\n  private readonly baseUrl = `${environment.apiUrl}/api/v1/users`;\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  getUsers(filter: UsersFilter = {}): Observable<PagedResult<UserDto>> {\r\n    let params = new HttpParams();\r\n    \r\n    if (filter.page) params = params.set('page', filter.page.toString());\r\n    if (filter.pageSize) params = params.set('pageSize', filter.pageSize.toString());\r\n    if (filter.search) params = params.set('search', filter.search);\r\n    if (filter.branchId) params = params.set('branchId', filter.branchId.toString());\r\n    if (filter.roleId) params = params.set('roleId', filter.roleId.toString());\r\n    if (filter.isActive !== undefined) params = params.set('isActive', filter.isActive.toString());\r\n\r\n    return this.http.get<PagedResult<UserDto>>(this.baseUrl, { params });\r\n  }\r\n\r\n  getUserById(id: number): Observable<UserDto> {\r\n    return this.http.get<UserDto>(`${this.baseUrl}/${id}`);\r\n  }\r\n\r\n  createUser(request: CreateUserRequest): Observable<{ id: number }> {\r\n    return this.http.post<{ id: number }>(this.baseUrl, request);\r\n  }\r\n\r\n  updateUser(id: number, request: UpdateUserRequest): Observable<void> {\r\n    return this.http.put<void>(`${this.baseUrl}/${id}`, request);\r\n  }\r\n\r\n  deleteUser(id: number): Observable<void> {\r\n    return this.http.delete<void>(`${this.baseUrl}/${id}`);\r\n  }\r\n\r\n  assignRole(userId: number, request: AssignRoleRequest): Observable<void> {\r\n    return this.http.post<void>(`${this.baseUrl}/${userId}/roles`, request);\r\n  }\r\n\r\n  removeRole(userId: number, roleId: number): Observable<void> {\r\n    return this.http.delete<void>(`${this.baseUrl}/${userId}/roles/${roleId}`);\r\n  }\r\n\r\n  assignBranch(userId: number, request: AssignBranchRequest): Observable<void> {\r\n    return this.http.post<void>(`${this.baseUrl}/${userId}/branches`, request);\r\n  }\r\n\r\n  getRoles(): Observable<any[]> {\r\n    return this.http.get<any[]>(`${environment.apiUrl}/api/v1/roles`).pipe(\r\n      map((response: any) => {\r\n        console.log('Roles API response:', response);\r\n        // Handle different response structures\r\n        if (Array.isArray(response)) {\r\n          return response;\r\n        }\r\n        // If it's wrapped in a Result object, extract the value\r\n        if (response && response.value && Array.isArray(response.value)) {\r\n          return response.value;\r\n        }\r\n        // If it has an items property (paginated), use that\r\n        if (response && response.items && Array.isArray(response.items)) {\r\n          return response.items;\r\n        }\r\n        console.warn('Unexpected roles response format:', response);\r\n        return [];\r\n      })\r\n    );\r\n  }\r\n\r\n  getBranches(): Observable<any[]> {\r\n    // Get all branches with a large page size and only active branches\r\n    const params = new HttpParams()\r\n      .set('pageSize', '1000')\r\n      .set('isActive', 'true');\r\n\r\n    return this.http.get<PagedResult<any>>(`${environment.apiUrl}/api/v1/branches`, { params })\r\n      .pipe(\r\n        map((result: PagedResult<any>) => result.items || [])\r\n      );\r\n  }\r\n\r\n  getAvailableEmployees(): Observable<EmployeeDto[]> {\r\n    // Get all employees - in the future, this should filter out employees with existing user accounts\r\n    const params = new HttpParams()\r\n      .set('page', '1')\r\n      .set('pageSize', '1000');\r\n\r\n    return this.http.get<PagedResult<EmployeeDto>>(`${environment.apiUrl}/api/v1/employees`, { params })\r\n      .pipe(\r\n        map((result: PagedResult<EmployeeDto>) => result.items || [])\r\n      );\r\n  }\r\n}"],
  "mappings": "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",
  "names": []
}
