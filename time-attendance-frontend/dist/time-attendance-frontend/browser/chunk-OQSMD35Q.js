import{a as q}from"./chunk-QFSH7W2P.js";import{a as L}from"./chunk-ZQD6QADI.js";import{a as B}from"./chunk-YYUGT7VW.js";import"./chunk-GRQ6RO47.js";import"./chunk-L5NKFYWR.js";import"./chunk-HUSARQNL.js";import"./chunk-QXVLGI72.js";import{a as V}from"./chunk-H5EPUHY6.js";import{a as z}from"./chunk-MPEAAPTS.js";import{a as o}from"./chunk-Y62N6K5S.js";import"./chunk-EYAJMHM7.js";import{a as F}from"./chunk-UBCI4X5Q.js";import{a as U}from"./chunk-HHXRLUSQ.js";import"./chunk-TZ2XIVGW.js";import"./chunk-VRETN7JA.js";import{b as N}from"./chunk-RCBJJ7UY.js";import{g as j}from"./chunk-TWXUAMJ4.js";import{Ab as R,Bb as _,Db as y,Ea as M,Ia as D,Pb as P,R as d,Sb as T,Tb as I,Ub as f,W as l,X as m,Xa as v,Ya as C,Yb as A,Zb as w,bb as g,cb as p,da as r,db as u,eb as b,lb as O,nb as S,pb as x,ta as a,uc as k,wc as $}from"./chunk-JSQL33QG.js";import{a as E}from"./chunk-DGAILPFQ.js";var X=()=>[],Q=()=>[10,25,50,100];function W(i,e){if(i&1&&_(0),i&2){let n=e.$implicit,t=x();y(" ",t.formatDuration(n.durationHours)," ")}}function G(i,e){if(i&1&&(p(0,"span",9),_(1),u()),i&2){let n=e.$implicit;g("title",n.reason),a(),y(" ",n.reason," ")}}function J(i,e){if(i&1&&b(0,"i",10),i&2){let n=x().$implicit;g("title",n.policyViolationReason)}}function K(i,e){if(i&1&&(p(0,"span"),_(1),u(),v(2,J,1,1,"i",10)),i&2){let n=e.$implicit,t=x();R(t.getStatusClass(n.status)),a(),y(" ",t.formatStatus(n.status)," "),a(),C(!n.isWithinPolicy&&n.policyViolationReason?2:-1)}}function Y(i,e){if(i&1&&(_(0),T(1,"date")),i&2){let n=e.$implicit,t=e.column;y(" ",I(1,1,t==="excuseDate"?n.excuseDate:n.submissionDate,"short")," ")}}function Z(i,e){if(i&1&&(p(0,"div",8),b(1,"i",11),_(2),u()),i&2){let n=x();a(2),y(" ",n.error()," ")}}var H=class i{employeeExcusesService=d(q);notificationService=d(U);confirmationService=d(V);router=d(j);i18n=d(N);permissionService=d(z);PERMISSIONS={EXCUSE_CREATE:`excuse.${o.CREATE}`,EXCUSE_READ:`excuse.${o.READ}`,EXCUSE_UPDATE:`excuse.${o.UPDATE}`,EXCUSE_DELETE:`excuse.${o.DELETE}`};loading=r(!1);currentPage=r(1);pageSize=r(10);selectedEmployeeId=r(void 0);selectedDepartmentId=r(void 0);selectedBranchId=r(void 0);selectedStatus=r(void 0);fromDate=r(void 0);toDate=r(void 0);searchTerm=r(void 0);employeeExcuses=this.employeeExcusesService.employeeExcuses;pagedResult=this.employeeExcusesService.pagedResult;statistics=this.employeeExcusesService.statistics;error=this.employeeExcusesService.error;tableColumns=[{key:"employeeName",label:this.i18n.t("employee_excuses.employee"),sortable:!0,width:"15%"},{key:"employeeNumber",label:this.i18n.t("employee_excuses.employee_number"),sortable:!0,width:"10%"},{key:"departmentName",label:this.i18n.t("employee_excuses.department"),sortable:!0,width:"12%"},{key:"excuseDate",label:this.i18n.t("employee_excuses.excuse_date"),sortable:!0,width:"10%"},{key:"durationHours",label:this.i18n.t("employee_excuses.duration"),sortable:!1,width:"8%"},{key:"reason",label:this.i18n.t("employee_excuses.reason"),sortable:!1,width:"15%"},{key:"status",label:this.i18n.t("employee_excuses.status"),sortable:!0,width:"10%"},{key:"submissionDate",label:this.i18n.t("employee_excuses.submitted_date"),sortable:!0,width:"10%"}];tableActions=[{key:"view",label:this.i18n.t("common.view"),icon:"fa-eye",color:"primary",condition:e=>this.permissionService.has(`excuse.${o.READ}`)||this.permissionService.hasRole("SystemAdmin")},{key:"edit",label:this.i18n.t("common.edit"),icon:"fa-edit",color:"secondary",condition:e=>{let n=this.permissionService.has(`excuse.${o.UPDATE}`)||this.permissionService.hasRole("SystemAdmin"),t=this.canEditExcuse(e);return n&&t}},{key:"approve",label:this.i18n.t("employee_excuses.approve"),icon:"fa-check",color:"success",condition:e=>{let n=e.status==="Pending",t=this.permissionService.has(`excuse.${o.APPROVE}`)||this.permissionService.hasRole("SystemAdmin"),s=this.canReviewExcuse(e);return n&&t&&s}},{key:"reject",label:this.i18n.t("employee_excuses.reject"),icon:"fa-times",color:"danger",condition:e=>{let n=e.status==="Pending",t=this.permissionService.has(`excuse.${o.APPROVE}`)||this.permissionService.hasRole("SystemAdmin"),s=this.canReviewExcuse(e);return n&&t&&s}},{key:"cancel",label:this.i18n.t("employee_excuses.cancel"),icon:"fa-ban",color:"warning",condition:e=>{let n=e.status==="Pending",t=this.permissionService.has(`excuse.${o.DELETE}`)||this.permissionService.hasRole("SystemAdmin"),s=this.canCancelExcuse(e);return n&&t&&s}},{key:"reopen",label:this.i18n.t("employee_excuses.reopen"),icon:"fa-undo",color:"warning",condition:e=>{let n=e.status==="Approved"||e.status==="Rejected",t=this.permissionService.hasRole("SystemAdmin");return n&&t}},{key:"delete",label:this.i18n.t("common.delete"),icon:"fa-trash",color:"danger",condition:e=>{let n=this.permissionService.hasRole("SystemAdmin"),t=this.permissionService.has(`excuse.${o.DELETE}`);return n?!0:e.status==="Pending"&&t&&this.canCancelExcuse(e)}},{key:"download",label:this.i18n.t("employee_excuses.download_attachment"),icon:"fa-download",color:"info",condition:e=>{let n=!!e.attachmentUrl,t=this.permissionService.has(`excuse.${o.READ}`)||this.permissionService.hasRole("SystemAdmin");return n&&t}}];currentFilter=A(()=>({employeeId:this.selectedEmployeeId(),departmentId:this.selectedDepartmentId(),branchId:this.selectedBranchId(),status:this.selectedStatus(),fromDate:this.fromDate(),toDate:this.toDate(),searchTerm:this.searchTerm()}));constructor(){w(()=>{let e=this.currentFilter(),n=this.currentPage(),t=this.pageSize();this.loadEmployeeExcuses(E({page:n,pageSize:t},e))}),w(()=>{this.loading.set(this.employeeExcusesService.loading())})}ngOnInit(){this.loadEmployeeExcuses()}loadEmployeeExcuses(e={}){let n=E(E({page:this.currentPage(),pageSize:this.pageSize()},this.currentFilter()),e);this.employeeExcusesService.getEmployeeExcuses(n).subscribe({next:()=>{this.calculateAggregateStatistics()},error:t=>{this.notificationService.error(this.i18n.t("employee_excuses.load_error"))}})}loadStatistics(){this.calculateAggregateStatistics()}calculateAggregateStatistics(){let e=this.employeeExcusesService.employeeExcuses()||[],n={totalRequests:e.length,pendingRequests:e.filter(t=>t.status==="Pending").length,approvedRequests:e.filter(t=>t.status==="Approved").length,rejectedRequests:e.filter(t=>t.status==="Rejected").length,currentMonthHours:0,remainingMonthlyHours:0,monthlyLimit:0};this.employeeExcusesService.statistics.set(n)}navigateToCreate(){this.router.navigate(["/employee-excuses/create"])}viewExcuse(e){this.router.navigate(["/employee-excuses",e.id,"view"])}editExcuse(e){this.router.navigate(["/employee-excuses",e.id,"edit"])}approveExcuse(e){let n=this.i18n.t("employee_excuses.confirm_approve");this.confirmationService.confirm({title:this.i18n.t("employee_excuses.approve_title"),message:n,confirmText:this.i18n.t("employee_excuses.approve")}).then(t=>{t.confirmed&&this.employeeExcusesService.reviewEmployeeExcuse(e.id,{status:"Approved",reviewerComments:t.comments}).subscribe({next:()=>{this.notificationService.success(this.i18n.t("employee_excuses.approve_success"))},error:()=>{this.notificationService.error(this.i18n.t("employee_excuses.approve_error"))}})})}rejectExcuse(e){let n=this.i18n.t("employee_excuses.confirm_reject");this.confirmationService.confirm({title:this.i18n.t("employee_excuses.reject_title"),message:n,confirmText:this.i18n.t("employee_excuses.reject"),requireComments:!0}).then(t=>{t.confirmed&&this.employeeExcusesService.reviewEmployeeExcuse(e.id,{status:"Rejected",reviewerComments:t.comments}).subscribe({next:()=>{this.notificationService.success(this.i18n.t("employee_excuses.reject_success"))},error:()=>{this.notificationService.error(this.i18n.t("employee_excuses.reject_error"))}})})}cancelExcuse(e){let n=this.i18n.t("employee_excuses.confirm_cancel");this.confirmationService.confirm({title:this.i18n.t("employee_excuses.cancel_title"),message:n,confirmText:this.i18n.t("employee_excuses.cancel")}).then(t=>{t.confirmed&&this.employeeExcusesService.cancelEmployeeExcuse(e.id).subscribe({next:()=>{this.notificationService.success(this.i18n.t("employee_excuses.cancel_success"))},error:()=>{this.notificationService.error(this.i18n.t("employee_excuses.cancel_error"))}})})}downloadAttachment(e){this.employeeExcusesService.downloadAttachment(e.id).subscribe({next:n=>{let t=window.URL.createObjectURL(n),s=document.createElement("a");s.href=t,s.download=`excuse_${e.id}_attachment`,s.click(),window.URL.revokeObjectURL(t)},error:()=>{this.notificationService.error(this.i18n.t("employee_excuses.download_error"))}})}reopenExcuse(e){let n=this.i18n.t("employee_excuses.confirm_reopen");this.confirmationService.confirm({title:this.i18n.t("employee_excuses.reopen_title"),message:n,confirmText:this.i18n.t("employee_excuses.reopen")}).then(t=>{t.confirmed&&(this.editExcuse(e),this.notificationService.info(this.i18n.t("employee_excuses.reopen_info")))})}deleteExcuse(e){let n=this.i18n.t("employee_excuses.confirm_delete");this.confirmationService.confirm({title:this.i18n.t("employee_excuses.delete_title"),message:n,confirmText:this.i18n.t("common.delete"),requireComments:!1}).then(t=>{t.confirmed&&this.employeeExcusesService.cancelEmployeeExcuse(e.id).subscribe({next:()=>{this.notificationService.success(this.i18n.t("employee_excuses.delete_success"))},error:()=>{this.notificationService.error(this.i18n.t("employee_excuses.delete_error"))}})})}onFilterChange(e){this.selectedEmployeeId.set(e.employeeId),this.selectedDepartmentId.set(e.departmentId),this.selectedBranchId.set(e.branchId),this.selectedStatus.set(e.status),this.fromDate.set(e.fromDate),this.toDate.set(e.toDate),this.searchTerm.set(e.searchTerm),this.currentPage.set(1)}clearFilters(){this.selectedEmployeeId.set(void 0),this.selectedDepartmentId.set(void 0),this.selectedBranchId.set(void 0),this.selectedStatus.set(void 0),this.fromDate.set(void 0),this.toDate.set(void 0),this.searchTerm.set(void 0),this.currentPage.set(1)}onPageChange(e){this.currentPage.set(e)}onPageSizeChange(e){this.pageSize.set(e),this.currentPage.set(1)}onTableAction(e){let{action:n,item:t}=e;switch(n){case"view":this.viewExcuse(t);break;case"edit":this.editExcuse(t);break;case"approve":this.approveExcuse(t);break;case"reject":this.rejectExcuse(t);break;case"cancel":this.cancelExcuse(t);break;case"reopen":this.reopenExcuse(t);break;case"delete":this.deleteExcuse(t);break;case"download":this.downloadAttachment(t);break;default:console.warn("Unknown action:",n)}}canCreate(){return this.permissionService.has(`excuse.${o.CREATE}`)}canEditExcuse(e){let n=this.permissionService.getCurrentUser();return this.permissionService.hasRole("Admin")||this.permissionService.hasRole("SystemAdmin")||n?.employeeId===e.employeeId}canReviewExcuse(e){let n=this.permissionService.getCurrentUser();return(this.permissionService.hasRole("Admin")||this.permissionService.hasRole("SystemAdmin")||this.permissionService.hasRole("Manager"))&&n?.employeeId!==e.employeeId}canCancelExcuse(e){let n=this.permissionService.getCurrentUser();return this.permissionService.hasRole("Admin")||this.permissionService.hasRole("SystemAdmin")||n?.employeeId===e.employeeId}formatDuration(e){return e<1?`${Math.round(e*60)} ${this.i18n.t("common.minutes")}`:`${e} ${this.i18n.t("common.hours")}`}formatStatus(e){return e?this.i18n.t(`employee_excuses.status_${e.toLowerCase()}`):this.i18n.t("employee_excuses.status_pending")}getStatusClass(e){switch(e){case"Pending":return"badge bg-warning";case"Approved":return"badge bg-success";case"Rejected":return"badge bg-danger";case"Cancelled":return"badge bg-secondary";default:return"badge bg-light"}}onSearchChange(e){this.searchTerm.set(e),this.currentPage.set(1)}onFiltersChange(e){this.selectedEmployeeId.set(e.employeeId?+e.employeeId:void 0),this.selectedDepartmentId.set(e.departmentId?+e.departmentId:void 0),this.selectedBranchId.set(e.branchId?+e.branchId:void 0),this.selectedStatus.set(e.status||void 0),this.currentPage.set(1)}onAddExcuse(){this.router.navigate(["/employee-excuses/create"])}onRefreshData(){this.clearFilters(),this.loadEmployeeExcuses()}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=M({type:i,selectors:[["app-employee-excuses"]],decls:13,vars:15,consts:[["durationTemplate",""],["reasonTemplate",""],["statusTemplate",""],["dateTemplate",""],[1,"employee-excuses-page"],[3,"title"],["moduleName","employee-excuses",3,"searchChange","filtersChange","add","refresh","refreshing"],[3,"pageChange","pageSizeChange","actionClick","data","columns","actions","loading","totalItems","currentPage","pageSize","pageSizeOptions","emptyMessage","emptyTitle"],["role","alert",1,"alert","alert-danger","mt-3"],[1,"text-truncate","d-inline-block",2,"max-width","200px",3,"title"],["data-bs-toggle","tooltip",1,"fas","fa-exclamation-triangle","text-warning","ms-1",3,"title"],[1,"fas","fa-exclamation-triangle","me-2"]],template:function(n,t){if(n&1){let s=O();p(0,"div",4),b(1,"app-page-header",5),p(2,"app-unified-filter",6),S("searchChange",function(c){return l(s),m(t.onSearchChange(c))})("filtersChange",function(c){return l(s),m(t.onFiltersChange(c))})("add",function(){return l(s),m(t.onAddExcuse())})("refresh",function(){return l(s),m(t.onRefreshData())}),u(),p(3,"app-data-table",7),S("pageChange",function(c){return l(s),m(t.onPageChange(c))})("pageSizeChange",function(c){return l(s),m(t.onPageSizeChange(c))})("actionClick",function(c){return l(s),m(t.onTableAction(c))}),D(4,W,1,1,"ng-template",null,0,f)(6,G,2,2,"ng-template",null,1,f)(8,K,3,4,"ng-template",null,2,f)(10,Y,2,4,"ng-template",null,3,f),u(),v(12,Z,3,1,"div",8),u()}if(n&2){let s;a(),g("title",t.i18n.t("employee_excuses.management_title")),a(),g("refreshing",t.loading()),a(),g("data",t.employeeExcuses()||P(13,X))("columns",t.tableColumns)("actions",t.tableActions)("loading",t.loading)("totalItems",((s=t.pagedResult())==null?null:s.totalCount)||0)("currentPage",t.currentPage())("pageSize",t.pageSize())("pageSizeOptions",P(14,Q))("emptyMessage",t.i18n.t("employee_excuses.no_requests_message"))("emptyTitle",t.i18n.t("employee_excuses.no_requests_found")),a(9),C(t.error()?12:-1)}},dependencies:[$,L,F,B,k],styles:[".employee-excuses-page[_ngcontent-%COMP%]{padding:1rem}.card[_ngcontent-%COMP%]{border:none;box-shadow:0 .125rem .25rem #00000013;transition:box-shadow .15s ease-in-out}.card[_ngcontent-%COMP%]:hover{box-shadow:0 .5rem 1rem #00000026}.card-body[_ngcontent-%COMP%]{padding:1.5rem}.fa-2x[_ngcontent-%COMP%]{font-size:2em}.badge[_ngcontent-%COMP%]{font-size:.875rem;padding:.375rem .75rem}.bg-warning[_ngcontent-%COMP%]{background-color:#ffc107!important;color:#000!important}.bg-success[_ngcontent-%COMP%]{background-color:#198754!important}.bg-danger[_ngcontent-%COMP%]{background-color:#dc3545!important}.bg-secondary[_ngcontent-%COMP%]{background-color:#6c757d!important}.bg-light[_ngcontent-%COMP%]{background-color:#f8f9fa!important;color:#212529!important}.text-truncate[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.btn[_ngcontent-%COMP%]{border-radius:.375rem;font-weight:500}.btn-primary[_ngcontent-%COMP%]{background-color:var(--bs-primary);border-color:var(--bs-primary)}.btn-primary[_ngcontent-%COMP%]:hover{background-color:var(--bs-primary);border-color:var(--bs-primary);opacity:.9}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:.25rem}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}@media (max-width: 768px){.employee-excuses-page[_ngcontent-%COMP%]{padding:.5rem}.card-body[_ngcontent-%COMP%]{padding:1rem}.d-flex.justify-content-between[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.d-flex.justify-content-between[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}.alert[_ngcontent-%COMP%]{border:none;border-radius:.5rem}.alert-danger[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}.fa-exclamation-triangle.text-warning[_ngcontent-%COMP%]{cursor:help}.row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{height:100%;cursor:default}.row[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}.text-primary[_ngcontent-%COMP%]{color:var(--bs-primary)!important}.text-warning[_ngcontent-%COMP%]{color:#ffc107!important}.text-success[_ngcontent-%COMP%]{color:#198754!important}.text-info[_ngcontent-%COMP%]{color:#0dcaf0!important}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f8f9fa;border-top:none;font-weight:600;color:#495057}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.card.mb-4[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #dee2e6}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:0}.badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem}.duration-display[_ngcontent-%COMP%]{font-weight:500;color:#495057}.attachment-indicator[_ngcontent-%COMP%]{color:#0dcaf0;margin-left:.25rem}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem 1rem;color:#6c757d}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.filter-tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem}.filter-tag[_ngcontent-%COMP%]{background-color:#e9ecef;color:#495057;padding:.25rem .75rem;border-radius:1rem;font-size:.875rem;display:flex;align-items:center;gap:.25rem}.filter-tag[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]{font-size:.75rem;opacity:.7}.filter-tag[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]:hover{opacity:1}"]})};export{H as EmployeeExcusesComponent};
