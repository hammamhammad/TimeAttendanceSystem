{
  "version": 3,
  "sources": ["src/app/core/auth/permission.service.ts"],
  "sourcesContent": ["import { Injectable, computed } from '@angular/core';\nimport { AuthService } from './auth.service';\nimport { PermissionUtils, PermissionResources, PermissionActions } from '../../shared/utils/permission.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PermissionService {\n  private userPermissions = computed(() => {\n    const user = this.authService.currentUser();\n    return user?.permissions || [];\n  });\n\n  constructor(private authService: AuthService) {}\n\n  has(permission: string): boolean {\n    const permissions = this.userPermissions();\n    return permissions.includes(permission) || permissions.includes('*');\n  }\n\n  hasAny(permissions: string[]): boolean {\n    return permissions.some(permission => this.has(permission));\n  }\n\n  hasAll(permissions: string[]): boolean {\n    return permissions.every(permission => this.has(permission));\n  }\n\n  hasRole(role: string): boolean {\n    const user = this.authService.currentUser();\n    return user?.roles?.includes(role) || false;\n  }\n\n  isAdmin(): boolean {\n    return this.hasRole('Admin');\n  }\n\n  isSuperAdmin(): boolean {\n    return this.hasRole('SuperAdmin');\n  }\n\n  canAccessBranch(branchId: number): boolean {\n    const user = this.authService.currentUser();\n    if (!user?.branchIds || user.branchIds.length === 0) {\n      return true; // No branch restriction\n    }\n    return user.branchIds.includes(branchId);\n  }\n\n  // Enhanced permission checking methods using PermissionUtils\n  canRead(resource: string): boolean {\n    return this.has(PermissionUtils.buildPermissionKey(resource, PermissionActions.READ));\n  }\n\n  canCreate(resource: string): boolean {\n    return this.has(PermissionUtils.buildPermissionKey(resource, PermissionActions.CREATE));\n  }\n\n  canUpdate(resource: string): boolean {\n    return this.has(PermissionUtils.buildPermissionKey(resource, PermissionActions.UPDATE));\n  }\n\n  canDelete(resource: string): boolean {\n    return this.has(PermissionUtils.buildPermissionKey(resource, PermissionActions.DELETE));\n  }\n\n  canExport(resource: string): boolean {\n    return this.has(PermissionUtils.buildPermissionKey(resource, PermissionActions.EXPORT));\n  }\n\n  canImport(resource: string): boolean {\n    return this.has(PermissionUtils.buildPermissionKey(resource, PermissionActions.IMPORT));\n  }\n\n  canManage(resource: string): boolean {\n    return this.has(PermissionUtils.buildPermissionKey(resource, PermissionActions.MANAGE));\n  }\n\n  // Resource-specific helper methods\n  canManageUsers(): boolean {\n    return this.hasAny([\n      PermissionUtils.buildPermissionKey(PermissionResources.USER, PermissionActions.CREATE),\n      PermissionUtils.buildPermissionKey(PermissionResources.USER, PermissionActions.UPDATE),\n      PermissionUtils.buildPermissionKey(PermissionResources.USER, PermissionActions.DELETE),\n      PermissionUtils.buildPermissionKey(PermissionResources.USER, PermissionActions.MANAGE)\n    ]);\n  }\n\n  canManageRoles(): boolean {\n    return this.hasAny([\n      PermissionUtils.buildPermissionKey(PermissionResources.ROLE, PermissionActions.CREATE),\n      PermissionUtils.buildPermissionKey(PermissionResources.ROLE, PermissionActions.UPDATE),\n      PermissionUtils.buildPermissionKey(PermissionResources.ROLE, PermissionActions.DELETE),\n      PermissionUtils.buildPermissionKey(PermissionResources.ROLE, PermissionActions.MANAGE)\n    ]);\n  }\n\n  canManageEmployees(): boolean {\n    return this.hasAny([\n      PermissionUtils.buildPermissionKey(PermissionResources.EMPLOYEE, PermissionActions.CREATE),\n      PermissionUtils.buildPermissionKey(PermissionResources.EMPLOYEE, PermissionActions.UPDATE),\n      PermissionUtils.buildPermissionKey(PermissionResources.EMPLOYEE, PermissionActions.DELETE),\n      PermissionUtils.buildPermissionKey(PermissionResources.EMPLOYEE, PermissionActions.MANAGE)\n    ]);\n  }\n\n  canAccessShifts(): boolean {\n    return this.hasAny([\n      'shift.read',\n      'shift.create',\n      'shift.update',\n      'shift.delete',\n      'shift.assign',\n      'shift.unassign',\n      'shift.export',\n      'shift.import'\n    ]);\n  }\n\n\n  // ==== POLICY-BASED AUTHORIZATION METHODS (Mirroring Backend Policies) ====\n\n  // Employee Management Policies\n  canReadEmployees(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.isManager() ||\n           this.has('employee.read');\n  }\n\n  canManageEmployeesPolicy(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.hasAny([\n             'employee.create',\n             'employee.update',\n             'employee.delete',\n             'employee.manage'\n           ]);\n  }\n\n  canAssignEmployeeShifts(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.isManager() ||\n           this.has('employee.assign');\n  }\n\n  // User Management Policies\n  canReadUsers(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.has('user.read');\n  }\n\n  canManageUsersPolicy(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.hasAny([\n             'user.create',\n             'user.update',\n             'user.delete',\n             'user.manage'\n           ]);\n  }\n\n  canAssignUserRoles(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.hasAny([\n             'user.assignRole',\n             'user.removeRole'\n           ]);\n  }\n\n  canManageUserSessions(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.has('user.session.manage');\n  }\n\n  // Shift Management Policies\n  canReadShifts(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.isManager() ||\n           this.has('shift.read');\n  }\n\n  canManageShiftsPolicy(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.hasAny([\n             'shift.create',\n             'shift.update',\n             'shift.delete',\n             'shift.manage'\n           ]);\n  }\n\n  // Branch Management Policies\n  canReadBranches(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.isManager() ||\n           this.has('branch.read');\n  }\n\n  canManageBranches(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.hasAny([\n             'branch.create',\n             'branch.update',\n             'branch.delete',\n             'branch.manage'\n           ]);\n  }\n\n  // Department Management Policies\n  canReadDepartments(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.isManager() ||\n           this.has('department.read');\n  }\n\n  canManageDepartments(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.hasAny([\n             'department.create',\n             'department.update',\n             'department.delete',\n             'department.manage'\n           ]);\n  }\n\n  // Role and Permission Management Policies\n  canReadRoles(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.has('role.read');\n  }\n\n  canManageRolesPolicy(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.hasAny([\n             'role.create',\n             'role.update',\n             'role.delete',\n             'role.manage'\n           ]);\n  }\n\n  canManagePermissions(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.hasAny([\n             'permission.assign',\n             'permission.remove',\n             'permission.manage'\n           ]);\n  }\n\n  // Attendance Management Policies\n  canReadAttendance(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.isManager() ||\n           this.has('attendance.read');\n  }\n\n  canManageAttendance(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.hasAny([\n             'attendance.create',\n             'attendance.update',\n             'attendance.delete',\n             'attendance.manage'\n           ]);\n  }\n\n  // Settings Management Policies\n  canReadSettings(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.has('settings.read');\n  }\n\n  canManageSettings(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.hasAny([\n             'settings.create',\n             'settings.update',\n             'settings.delete',\n             'settings.manage'\n           ]);\n  }\n\n  // Report Access Policies\n  canAccessReports(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.isManager() ||\n           this.hasAny([\n             'report.read',\n             'report.view',\n             'report.access'\n           ]);\n  }\n\n  // Security and Audit Policies\n  canAccessSecurityAudit(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.hasAny([\n             'audit.read',\n             'audit.view',\n             'security.audit'\n           ]);\n  }\n\n  canSystemAdministration(): boolean {\n    return this.isSystemAdmin() ||\n           this.hasAny([\n             'system.admin',\n             'system.configure',\n             'system.manage'\n           ]);\n  }\n\n  // Public Holidays Management Policies\n  canReadPublicHolidays(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.has('publicHoliday.read');\n  }\n\n  canManagePublicHolidays(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.hasAny([\n             'publicHoliday.create',\n             'publicHoliday.update',\n             'publicHoliday.delete',\n             'publicHoliday.manage'\n           ]);\n  }\n\n  canExportPublicHolidays(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.has('publicHoliday.export');\n  }\n\n  canImportPublicHolidays(): boolean {\n    return this.isSystemAdmin() ||\n           this.isAdmin() ||\n           this.has('publicHoliday.import');\n  }\n\n\n  // Role-based Helper Methods\n  private isSystemAdmin(): boolean {\n    return this.hasRole('SystemAdmin');\n  }\n\n  private isManager(): boolean {\n    return this.hasRole('Manager');\n  }\n\n  private isEmployee(): boolean {\n    return this.hasRole('Employee');\n  }\n\n  /**\n   * Get current user\n   */\n  getCurrentUser() {\n    return this.authService.currentUser();\n  }\n\n  /**\n   * Get current employee (alias for getCurrentUser)\n   */\n  getCurrentEmployee() {\n    return this.authService.currentUser();\n  }\n}"],
  "mappings": "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",
  "names": []
}
