import{a as ne}from"./chunk-NYAEJKNV.js";import{a as te}from"./chunk-LK2JNJQF.js";import{a as L}from"./chunk-24B36L4T.js";import{b as J,d as K,g as Q,m as X,n as Y,o as Z,s as ee}from"./chunk-RH4QBYEM.js";import{h as G}from"./chunk-4DYU65FO.js";import{b as N}from"./chunk-CQWUHIOF.js";import{$a as r,Ca as O,Eb as V,Ia as B,Lb as q,Q as w,Ta as u,Ua as g,V as f,W as M,Wa as k,Xa as U,Ya as S,Za as E,_a as a,ab as v,bb as C,ca as x,cb as p,db as I,eb as y,ec as A,fb as $,gb as h,hb as R,ib as d,nb as P,pb as j,qb as l,ra as i,rb as s,sb as _,vb as H,xb as T,yb as F,zb as D}from"./chunk-LHYYCVNR.js";import{d as W}from"./chunk-DGAILPFQ.js";var se=(t,n)=>n.id;function de(t,n){if(t&1&&(C(0,"div",8),I(1,"i",26),l(2),p()),t&2){let e=d(2);i(2),_(" ",e.error()," ")}}function ce(t,n){if(t&1&&(C(0,"span",27),l(1),p()),t&2){let e=n.$implicit;i(),s(e)}}function me(t,n){if(t&1&&(C(0,"div",17),U(1,ce,2,1,"span",27,k),p()),t&2){let e=d(2);i(),S(e.user.roles)}}function pe(t,n){if(t&1&&(C(0,"p",14),l(1),p()),t&2){let e=d(2);i(),s(e.t("users.no_roles"))}}function _e(t,n){if(t&1&&(C(0,"div",20)(1,"div",28)(2,"span",29),l(3),p()(),C(4,"p",30),l(5),p()()),t&2){let e=d(2);i(3),s(e.t("common.loading")),i(2),s(e.t("users.updating_roles"))}}function ue(t,n){if(t&1&&(C(0,"p",38),l(1),p()),t&2){let e=d().$implicit,o=d(3);i(),_(" ",o.getRoleDescription(e)," ")}}function ge(t,n){if(t&1){let e=y();C(0,"div",32)(1,"div",33)(2,"input",34),R("change",function(){let c=f(e).$implicit,m=d(3);return M(m.onToggleRole(c))}),p(),C(3,"div",35)(4,"label",36)(5,"span",37),l(6),p()(),u(7,ue,2,1,"p",38),p()()()}if(t&2){let e=n.$implicit,o=d(3);P("loading",o.loading()),i(2),$("id","role-"+e.id)("checked",o.isRoleAssigned(e.id))("disabled",o.loading()),i(2),$("htmlFor","role-"+e.id),i(),j(o.getRoleBadgeClass(e)),i(),_(" ",e.name," "),i(),g(o.getRoleDescription(e)?7:-1)}}function Ce(t,n){if(t&1&&(C(0,"div",21),U(1,ge,8,10,"div",31,se),p()),t&2){let e=d(2);i(),S(e.availableRoles())}}function be(t,n){if(t&1){let e=y();C(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h5",4),I(5,"i",5),l(6),p(),C(7,"button",6),R("click",function(){f(e);let c=d();return M(c.closeModal())}),p()(),C(8,"div",7),u(9,de,3,1,"div",8),C(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12),l(14),p()(),C(15,"div")(16,"h6",13),l(17),p(),C(18,"p",14),l(19),p()()()(),C(20,"div",15)(21,"h6",16),l(22),p(),u(23,me,3,0,"div",17)(24,pe,2,1,"p",14),p(),C(25,"div",18)(26,"h6",19),l(27),p(),u(28,_e,6,2,"div",20)(29,Ce,3,0,"div",21),p(),C(30,"div",22),I(31,"i",23),C(32,"small"),l(33),p()()(),C(34,"div",24)(35,"button",25),R("click",function(){f(e);let c=d();return M(c.closeModal())}),l(36),p()()()()()}if(t&2){let e=d();i(6),_(" ",e.t("users.manage_roles")," "),i(3),g(e.error()?9:-1),i(5),_(" ",e.user.username.charAt(0).toUpperCase()," "),i(3),s(e.user.username),i(2),s(e.user.email),i(3),s(e.t("users.current_roles")),i(),g(e.user.roles.length>0?23:24),i(4),s(e.t("users.available_roles")),i(),g(e.loading()?28:29),i(5),s(e.t("users.role_management_help")),i(3),_(" ",e.t("common.close")," ")}}var z=class t{user=null;show=!1;showChange=new B;rolesUpdated=new B;usersService=w(L);i18n=w(N);loading=x(!1);error=x("");availableRoles=x([{id:1,name:"SystemAdmin",description:"Full system access with all permissions"},{id:2,name:"Admin",description:"Administrative access to employee and role management"},{id:3,name:"HROperation",description:"HR operations with employee management access"},{id:4,name:"User",description:"Basic user access with read-only permissions"}]);userRoleIds=q(()=>this.user?this.user.roles.map(n=>this.availableRoles().find(o=>o.name===n)?.id||0).filter(n=>n>0):[]);ngOnInit(){}t(n){return this.i18n.t(n)}isRoleAssigned(n){return this.userRoleIds().includes(n)}onToggleRole(n){if(!this.user)return;this.loading.set(!0),this.error.set(""),this.isRoleAssigned(n.id)?this.removeRole(n.id):this.assignRole(n.id)}assignRole(n){if(!this.user)return;let e={roleId:n};this.usersService.assignRole(this.user.id,e).subscribe({next:()=>{this.refreshUserData()},error:o=>{this.loading.set(!1),this.error.set(this.getErrorMessage(o))}})}removeRole(n){this.user&&this.usersService.removeRole(this.user.id,n).subscribe({next:()=>{this.refreshUserData()},error:e=>{this.loading.set(!1),this.error.set(this.getErrorMessage(e))}})}refreshUserData(){this.user&&this.usersService.getUserById(this.user.id).subscribe({next:n=>{this.loading.set(!1),this.rolesUpdated.emit(n)},error:n=>{this.loading.set(!1),this.error.set(this.getErrorMessage(n))}})}closeModal(){this.show=!1,this.showChange.emit(!1),this.error.set("")}getErrorMessage(n){return n?.error?.error?n.error.error:this.t("errors.unknown")}getRoleDescription(n){return n.description||""}getRoleBadgeClass(n){return{SystemAdmin:"bg-danger",Admin:"bg-warning",HROperation:"bg-info",User:"bg-secondary"}[n.name]||"bg-primary"}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=O({type:t,selectors:[["app-role-management"]],inputs:{user:"user",show:"show"},outputs:{showChange:"showChange",rolesUpdated:"rolesUpdated"},decls:1,vars:1,consts:[["tabindex","-1",1,"modal","fade","show","d-block",2,"background-color","rgba(0,0,0,0.5)"],[1,"modal-dialog","modal-md"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"fa-solid","fa-user-tag","me-2"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["role","alert",1,"alert","alert-danger"],[1,"user-info","mb-4"],[1,"d-flex","align-items-center"],[1,"avatar-md","me-3"],[1,"avatar-title","bg-primary-subtle","text-primary","rounded-circle"],[1,"mb-1"],[1,"text-muted","mb-0"],[1,"current-roles","mb-4"],[1,"mb-2"],[1,"d-flex","flex-wrap","gap-2"],[1,"available-roles"],[1,"mb-3"],[1,"text-center","py-3"],[1,"roles-list"],["role","alert",1,"alert","alert-info","mt-3"],[1,"fa-solid","fa-info-circle","me-2"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fa-solid","fa-exclamation-triangle","me-2"],[1,"badge","bg-primary"],["role","status",1,"spinner-border","spinner-border-sm","text-primary"],[1,"visually-hidden"],[1,"text-muted","mt-2","mb-0"],[1,"role-item",3,"loading"],[1,"role-item"],[1,"form-check","d-flex","align-items-start"],["type","checkbox",1,"form-check-input","mt-1",3,"change","id","checked","disabled"],[1,"form-check-content","ms-2","flex-grow-1"],[1,"form-check-label","fw-medium",3,"for"],[1,"badge","me-2"],[1,"text-muted","small","mb-0"]],template:function(e,o){e&1&&u(0,be,37,11,"div",0),e&2&&g(o.show&&o.user?0:-1)},dependencies:[A],styles:[".modal.show[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .15s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.modal-content[_ngcontent-%COMP%]{border:none;box-shadow:0 .5rem 1rem #00000026;border-radius:.5rem}.modal-header[_ngcontent-%COMP%]{background-color:var(--bs-light);border-bottom:1px solid var(--bs-border-color);border-radius:.5rem .5rem 0 0}.modal-title[_ngcontent-%COMP%]{font-weight:600;color:var(--bs-dark)}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-footer[_ngcontent-%COMP%]{background-color:var(--bs-light);border-top:1px solid var(--bs-border-color);border-radius:0 0 .5rem .5rem}.avatar-md[_ngcontent-%COMP%]{width:48px;height:48px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.avatar-title[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.25rem;font-weight:600}.user-info[_ngcontent-%COMP%]{padding:1rem;background-color:var(--bs-light);border-radius:.5rem;border:1px solid var(--bs-border-color)}.current-roles[_ngcontent-%COMP%]{padding:1rem;background-color:var(--bs-primary-bg-subtle);border-radius:.5rem;border:1px solid var(--bs-primary-border-subtle)}.roles-list[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.role-item[_ngcontent-%COMP%]{padding:1rem;border:1px solid var(--bs-border-color);border-radius:.5rem;margin-bottom:.5rem;background-color:var(--bs-white);transition:all .2s ease}.role-item[_ngcontent-%COMP%]:hover{background-color:var(--bs-light);border-color:var(--bs-primary-border-subtle)}.role-item.loading[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.form-check[_ngcontent-%COMP%]{margin-bottom:0}.form-check-input[_ngcontent-%COMP%]{margin-top:.125rem}.form-check-input[_ngcontent-%COMP%]:checked{background-color:var(--bs-primary);border-color:var(--bs-primary)}.form-check-content[_ngcontent-%COMP%]{min-width:0}.form-check-label[_ngcontent-%COMP%]{margin-bottom:.25rem;cursor:pointer;line-height:1.2}.badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.375rem .75rem}.alert[_ngcontent-%COMP%]{border:none;border-radius:.5rem}.alert-danger[_ngcontent-%COMP%]{background-color:var(--bs-danger-bg-subtle);color:var(--bs-danger-text);border-left:4px solid var(--bs-danger)}.alert-info[_ngcontent-%COMP%]{background-color:var(--bs-info-bg-subtle);color:var(--bs-info-text);border-left:4px solid var(--bs-info)}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}h6[_ngcontent-%COMP%]{font-weight:600;color:var(--bs-dark)}.text-muted[_ngcontent-%COMP%]{color:var(--bs-secondary)!important}.small[_ngcontent-%COMP%]{font-size:.875rem}.bg-danger[_ngcontent-%COMP%]{background-color:var(--bs-danger)!important}.bg-warning[_ngcontent-%COMP%]{background-color:var(--bs-warning)!important;color:var(--bs-dark)!important}.bg-info[_ngcontent-%COMP%]{background-color:var(--bs-info)!important}.bg-secondary[_ngcontent-%COMP%]{background-color:var(--bs-secondary)!important}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--bs-light);border-radius:3px}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--bs-secondary);border-radius:3px}.roles-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--bs-dark)}[dir=rtl][_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{margin-left:0;margin-right:-1.5em}[dir=rtl][_ngcontent-%COMP%]   .form-check-content[_ngcontent-%COMP%]{margin-right:.5rem;margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .avatar-md[_ngcontent-%COMP%]{margin-right:0;margin-left:.75rem}@media (max-width: 768px){.modal-dialog[_ngcontent-%COMP%]{margin:1rem;max-width:none}.modal-body[_ngcontent-%COMP%]{padding:1rem}.user-info[_ngcontent-%COMP%], .current-roles[_ngcontent-%COMP%], .role-item[_ngcontent-%COMP%]{padding:.75rem}.avatar-md[_ngcontent-%COMP%]{width:40px;height:40px}.avatar-title[_ngcontent-%COMP%]{font-size:1rem}}.form-check-input[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem rgba(var(--bs-primary-rgb),.25)}@keyframes _ngcontent-%COMP%_pulse{0%{opacity:1}50%{opacity:.5}to{opacity:1}}.loading[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s ease-in-out infinite}"]})};var xe=t=>["/users",t,"view"],oe=t=>["/users",t,"edit"],re=(t,n)=>n.id;function ve(t,n){if(t&1&&(a(0,"option",18),l(1),r()),t&2){let e=n.$implicit;E("value",e.id),i(),s(e.name)}}function he(t,n){if(t&1&&(a(0,"div",23)(1,"div",26)(2,"span",27),l(3),r()(),a(4,"p",28),l(5),r()()),t&2){let e=d();i(3),s(e.t("common.loading")),i(2),s(e.t("common.loading"))}}function fe(t,n){if(t&1){let e=y();a(0,"button",32),h("click",function(){f(e);let c=d(2);return M(c.onClearFilters())}),l(1),r()}if(t&2){let e=d(2);i(),_(" ",e.t("common.clear_filters")," ")}}function Me(t,n){if(t&1&&(a(0,"div",23),v(1,"i",29),a(2,"p",30),l(3),r(),u(4,fe,2,1,"button",31),r()),t&2){let e=d();i(3),s(e.t("users.no_users_found")),i(),g(e.hasActiveFilters()?4:-1)}}function Ee(t,n){if(t&1&&v(0,"i",42),t&2){let e=d(3);E("title",e.t("users.system_protected"))}}function Ue(t,n){if(t&1&&(a(0,"small",43),v(1,"i",57),l(2),r()),t&2){let e=d(3);i(2),_(" ",e.t("users.must_change_password")," ")}}function Se(t,n){if(t&1&&(a(0,"span",58),l(1),r()),t&2){let e=n.$implicit;i(),s(e)}}function ye(t,n){if(t&1&&(a(0,"div",44),U(1,Se,2,1,"span",58,k),r()),t&2){let e=d().$implicit;i(),S(e.roles)}}function Pe(t,n){t&1&&(a(0,"span",30),l(1,"-"),r())}function we(t,n){if(t&1&&(a(0,"span",59),l(1),r()),t&2){let e=n.$implicit;i(),s(e)}}function ke(t,n){if(t&1&&(a(0,"div",44),U(1,we,2,1,"span",59,k),r()),t&2){let e=d().$implicit;i(),S(e.branches)}}function Oe(t,n){if(t&1&&(a(0,"span",30),l(1),r()),t&2){let e=d(3);i(),s(e.t("users.all_branches"))}}function Ie(t,n){if(t&1&&(a(0,"span",45),l(1),r()),t&2){let e=d(3);i(),s(e.t("users.locked"))}}function Re(t,n){if(t&1&&(a(0,"span",46),l(1),r()),t&2){let e=d(3);i(),s(e.t("common.active"))}}function Te(t,n){if(t&1&&(a(0,"span",47),l(1),r()),t&2){let e=d(3);i(),s(e.t("common.inactive"))}}function Fe(t,n){if(t&1){let e=y();a(0,"tr")(1,"td")(2,"div",38)(3,"div",39)(4,"div",40),l(5),r()(),a(6,"div")(7,"div",41),l(8),u(9,Ee,1,1,"i",42),r(),u(10,Ue,3,1,"small",43),r()()(),a(11,"td"),l(12),r(),a(13,"td"),l(14),r(),a(15,"td"),u(16,ye,3,0,"div",44)(17,Pe,2,0,"span",30),r(),a(18,"td"),u(19,ke,3,0,"div",44)(20,Oe,2,1,"span",30),r(),a(21,"td"),u(22,Ie,2,1,"span",45)(23,Re,2,1,"span",46)(24,Te,2,1,"span",47),r(),a(25,"td"),l(26),r(),a(27,"td")(28,"div",48)(29,"button",49),v(30,"i",50),r(),a(31,"div")(32,"button",51),v(33,"i",52),r()(),a(34,"div")(35,"button",53),h("click",function(){let c=f(e).$implicit,m=d(2);return M(m.onManageRoles(c))}),v(36,"i",54),r()(),a(37,"div")(38,"button",55),h("click",function(){let c=f(e).$implicit,m=d(2);return M(m.onDeleteUser(c))}),v(39,"i",56),r()()()()()}if(t&2){let e=n.$implicit,o=d(2);i(5),_(" ",e.username.charAt(0).toUpperCase()," "),i(3),_(" ",e.username," "),i(),g(o.isSystemAdmin(e)?9:-1),i(),g(e.mustChangePassword?10:-1),i(2),s(e.email),i(2),s(e.phone||"-"),i(2),g(e.roles.length>0?16:17),i(3),g(e.branches.length>0?19:20),i(3),g(e.lockoutEndUtc&&o.isUserLocked(e.lockoutEndUtc)?22:e.isActive?23:24),i(4),s(o.formatDate(e.createdAtUtc)),i(3),E("title",o.t("users.view_details"))("routerLink",V(25,xe,e.id)),i(3),P("disabled",!o.canEditUser(e)),E("title",o.t("users.edit"))("disabled",!o.canEditUser(e))("routerLink",o.canEditUser(e)?V(27,oe,e.id):null),i(3),P("disabled",!o.canEditUser(e)),E("title",o.t("users.manage_roles"))("disabled",!o.canEditUser(e)),i(3),P("disabled",!o.canDeleteUser(e)),E("title",o.t("common.delete"))("disabled",!o.canDeleteUser(e))}}function De(t,n){if(t&1){let e=y();a(0,"li",62)(1,"button",67),h("click",function(){let c=f(e).$implicit,m=d(3);return M(m.onPageChange(c))}),l(2),r()()}if(t&2){let e=n.$implicit,o=d(3);P("active",e===o.currentPage()),i(2),s(e)}}function Ve(t,n){if(t&1){let e=y();a(0,"nav",37)(1,"div",60)(2,"div",30),l(3),r(),a(4,"ul",61)(5,"li",62)(6,"button",63),h("click",function(){f(e);let c=d(2);return M(c.onPageChange(c.currentPage()-1))}),v(7,"i",64),r()(),U(8,De,3,3,"li",65,k),a(10,"li",62)(11,"button",63),h("click",function(){f(e);let c=d(2);return M(c.onPageChange(c.currentPage()+1))}),v(12,"i",66),r()()()()()}if(t&2){let e,o,c,m,b=d(2);i(3),H(" ",b.t("common.showing")," ",(b.pagedResult().currentPage-1)*b.pagedResult().pageSize+1," - ",b.Math.min(b.pagedResult().currentPage*b.pagedResult().pageSize,b.pagedResult().totalItems)," ",b.t("common.of")," ",b.pagedResult().totalItems," "),i(2),P("disabled",!((e=b.pagedResult())!=null&&e.hasPreviousPage)),i(),E("disabled",!((o=b.pagedResult())!=null&&o.hasPreviousPage)),i(2),S(b.getPageNumbers()),i(2),P("disabled",!((c=b.pagedResult())!=null&&c.hasNextPage)),i(),E("disabled",!((m=b.pagedResult())!=null&&m.hasNextPage))}}function Ae(t,n){if(t&1&&(a(0,"div",33)(1,"table",34)(2,"thead",35)(3,"tr")(4,"th"),l(5),r(),a(6,"th"),l(7),r(),a(8,"th"),l(9),r(),a(10,"th"),l(11),r(),a(12,"th"),l(13),r(),a(14,"th"),l(15),r(),a(16,"th"),l(17),r(),a(18,"th",36),l(19),r()()(),a(20,"tbody"),U(21,Fe,40,29,"tr",null,re),r()()(),u(23,Ve,13,11,"nav",37)),t&2){let e,o=d();i(5),s(o.t("users.username")),i(2),s(o.t("users.email")),i(2),s(o.t("users.phone")),i(2),s(o.t("users.roles")),i(2),s(o.t("users.branches")),i(2),s(o.t("common.status")),i(2),s(o.t("users.created_at")),i(2),s(o.t("common.actions")),i(2),S(o.users()),i(2),g((e=o.pagedResult())!=null&&e.totalPages&&o.pagedResult().totalPages>1?23:-1)}}function Ne(t,n){if(t&1&&(a(0,"span",46),l(1),r()),t&2){let e=d(3);i(),s(e.t("common.active"))}}function Le(t,n){if(t&1&&(a(0,"span",47),l(1),r()),t&2){let e=d(3);i(),s(e.t("common.inactive"))}}function ze(t,n){if(t&1&&(a(0,"span",46),l(1),r()),t&2){let e=d(3);i(),s(e.t("common.enabled"))}}function Be(t,n){if(t&1&&(a(0,"span",47),l(1),r()),t&2){let e=d(3);i(),s(e.t("common.disabled"))}}function $e(t,n){if(t&1&&(a(0,"span",82),l(1),r()),t&2){let e=n.$implicit;i(),s(e)}}function We(t,n){if(t&1&&(a(0,"div",81),U(1,$e,2,1,"span",82,k),r()),t&2){let e=d(3);i(),S(e.selectedUser().roles)}}function je(t,n){if(t&1&&(a(0,"p",30),l(1),r()),t&2){let e=d(3);i(),s(e.t("users.no_roles"))}}function He(t,n){if(t&1&&(a(0,"span",47),l(1),r()),t&2){let e=n.$implicit;i(),s(e)}}function qe(t,n){if(t&1&&(a(0,"div",81),U(1,He,2,1,"span",47,k),r()),t&2){let e=d(3);i(),S(e.selectedUser().branches)}}function Ge(t,n){if(t&1&&(a(0,"p",30),l(1),r()),t&2){let e=d(3);i(),s(e.t("users.all_branches"))}}function Je(t,n){if(t&1&&(a(0,"div",76)(1,"div",77)(2,"dl",76)(3,"dt",78),l(4),r(),a(5,"dd",79),l(6),r(),a(7,"dt",78),l(8),r(),a(9,"dd",79),l(10),r(),a(11,"dt",78),l(12),r(),a(13,"dd",79),l(14),r(),a(15,"dt",78),l(16),r(),a(17,"dd",79),l(18),r()()(),a(19,"div",77)(20,"dl",76)(21,"dt",78),l(22),r(),a(23,"dd",79),u(24,Ne,2,1,"span",46)(25,Le,2,1,"span",47),r(),a(26,"dt",78),l(27),r(),a(28,"dd",79),l(29),r(),a(30,"dt",78),l(31),r(),a(32,"dd",79),u(33,ze,2,1,"span",46)(34,Be,2,1,"span",47),r()()()(),a(35,"div",80)(36,"div",77)(37,"h6"),l(38),r(),u(39,We,3,0,"div",81)(40,je,2,1,"p",30),r(),a(41,"div",77)(42,"h6"),l(43),r(),u(44,qe,3,0,"div",81)(45,Ge,2,1,"p",30),r()()),t&2){let e=d(2);i(4),_("",e.t("users.username"),":"),i(2),s(e.selectedUser().username),i(2),_("",e.t("users.email"),":"),i(2),s(e.selectedUser().email),i(2),_("",e.t("users.phone"),":"),i(2),s(e.selectedUser().phone||"-"),i(2),_("",e.t("users.language"),":"),i(2),s(e.selectedUser().preferredLanguage),i(4),_("",e.t("common.status"),":"),i(2),g(e.selectedUser().isActive?24:25),i(3),_("",e.t("users.created_at"),":"),i(2),s(e.formatDate(e.selectedUser().createdAtUtc)),i(2),_("",e.t("users.two_factor"),":"),i(2),g(e.selectedUser().twoFactorEnabled?33:34),i(5),s(e.t("users.roles")),i(),g(e.selectedUser().roles.length>0?39:40),i(4),s(e.t("users.branches")),i(),g(e.selectedUser().branches.length>0?44:45)}}function Ke(t,n){if(t&1&&(a(0,"div")(1,"button",83),v(2,"i",84),l(3),r()()),t&2){let e=d(2);i(),E("routerLink",V(2,oe,e.selectedUser().id)),i(2),_(" ",e.t("users.edit")," ")}}function Qe(t,n){if(t&1){let e=y();a(0,"div",24)(1,"div",68)(2,"div",69)(3,"div",70)(4,"h5",71),l(5),r(),a(6,"button",72),h("click",function(){f(e);let c=d();return M(c.closeModal())}),r()(),a(7,"div",73),u(8,Je,46,18),r(),a(9,"div",74)(10,"button",75),h("click",function(){f(e);let c=d();return M(c.closeModal())}),l(11),r(),u(12,Ke,4,4,"div"),r()()()()}if(t&2){let e=d();i(5),s(e.t("users.user_details")),i(3),g(e.selectedUser()?8:-1),i(3),_(" ",e.t("common.close")," "),i(),g(e.canEditUser(e.selectedUser())?12:-1)}}var ie=class t{usersService=w(L);notificationService=w(te);confirmationService=w(ne);i18n=w(N);loading=x(!1);users=x([]);pagedResult=x(null);currentPage=x(1);pageSize=x(10);searchTerm="";statusFilter="";roleFilter="";showUserModal=x(!1);showUserForm=x(!1);showRoleManagement=x(!1);selectedUser=x(null);editingUser=x(null);availableRoles=x([{id:1,name:"SystemAdmin"},{id:2,name:"Admin"},{id:3,name:"HROperation"},{id:4,name:"User"}]);Math=Math;isSystemAdmin(n){return n.username.toLowerCase()==="systemadmin"}canEditUser(n){return!this.isSystemAdmin(n)}canDeleteUser(n){return!this.isSystemAdmin(n)}ngOnInit(){this.loadUsers()}t(n){return this.i18n.t(n)}loadUsers(){this.loading.set(!0);let n={page:this.currentPage(),pageSize:this.pageSize(),search:this.searchTerm||void 0,isActive:this.statusFilter?this.statusFilter==="true":void 0,roleId:this.roleFilter?parseInt(this.roleFilter):void 0};this.usersService.getUsers(n).subscribe({next:e=>{this.pagedResult.set(e),this.users.set(e.items),this.loading.set(!1)},error:e=>{console.error("Failed to load users:",e),this.loading.set(!1),this.notificationService.error(this.t("errors.server"),this.t("errors.network"))}})}onSearchChange(){this.currentPage.set(1),setTimeout(()=>this.loadUsers(),300)}onFilterChange(){this.currentPage.set(1),this.loadUsers()}onClearFilters(){this.searchTerm="",this.statusFilter="",this.roleFilter="",this.currentPage.set(1),this.loadUsers()}hasActiveFilters(){return!!(this.searchTerm||this.statusFilter||this.roleFilter)}onPageChange(n){n>=1&&n<=(this.pagedResult()?.totalPages||1)&&(this.currentPage.set(n),this.loadUsers())}getPageNumbers(){let n=this.pagedResult()?.totalPages||1,e=this.currentPage(),o=[],c=Math.max(1,e-2),m=Math.min(n,c+4);for(let b=c;b<=m;b++)o.push(b);return o}formatDate(n){return new Date(n).toLocaleDateString(this.i18n.getCurrentLocale(),{year:"numeric",month:"short",day:"numeric"})}isUserLocked(n){return new Date(n)>new Date}onCreateUser(){this.editingUser.set(null),this.showUserForm.set(!0)}onViewUser(n){this.selectedUser.set(n),this.showUserModal.set(!0)}onEditUser(n){this.canEditUser(n)&&(this.closeModal(),this.editingUser.set(n),this.showUserForm.set(!0))}onDeleteUser(n){return W(this,null,function*(){if(!this.canDeleteUser(n))return;let e=this.t("users.confirm_delete_user").replace("{{username}}",n.username);(yield this.confirmationService.confirm({title:this.t("users.delete_user"),message:e,confirmText:this.t("common.delete"),cancelText:this.t("common.cancel"),confirmButtonClass:"btn-danger",icon:"fa-trash",iconClass:"text-danger"})).confirmed&&this.usersService.deleteUser(n.id).subscribe({next:()=>{this.loadUsers(),this.notificationService.success(this.t("app.success"),this.t("users.user_deleted"))},error:c=>{console.error("Failed to delete user:",c),this.notificationService.error(this.t("app.error"),this.t("errors.server"))}})})}onManageRoles(n){this.canEditUser(n)&&(this.selectedUser.set(n),this.showRoleManagement.set(!0))}closeModal(){this.showUserModal.set(!1),this.selectedUser.set(null)}onUserCreated(n){this.loadUsers(),this.notificationService.success(this.t("app.success"),this.t("users.user_added"))}onUserSaved(n){this.loadUsers(),this.notificationService.success(this.t("app.success"),this.t("users.user_updated"))}onRolesUpdated(n){this.loadUsers(),this.notificationService.success(this.t("app.success"),"User roles updated successfully")}onShowUserFormChange(n){this.showUserForm.set(n),n||this.editingUser.set(null)}onShowRoleManagementChange(n){this.showRoleManagement.set(n),n||this.selectedUser.set(null)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=O({type:t,selectors:[["app-users"]],decls:47,vars:18,consts:[[1,"users-page"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],["routerLink","/users/create",1,"btn","btn-primary"],[1,"fa-solid","fa-plus","me-2"],[1,"card","mb-4"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-4"],[1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"fa-solid","fa-search"],["type","text",1,"form-control",3,"ngModelChange","input","placeholder","ngModel"],[1,"col-md-3"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],["value","true"],["value","false"],[3,"value"],[1,"col-md-2","d-flex","align-items-end"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fa-solid","fa-filter-circle-xmark","me-1"],[1,"card"],[1,"text-center","py-4"],["tabindex","-1",1,"modal","fade","show","d-block",2,"background-color","rgba(0,0,0,0.5)"],[3,"showChange","rolesUpdated","user","show"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2","text-muted"],[1,"fa-solid","fa-users","fa-3x","text-muted","mb-3"],[1,"text-muted"],[1,"btn","btn-outline-primary"],[1,"btn","btn-outline-primary",3,"click"],[1,"table-responsive"],[1,"table","table-hover"],[1,"table-light"],["width","120"],["aria-label","Users pagination",1,"mt-3"],[1,"d-flex","align-items-center"],[1,"avatar-sm","me-2"],[1,"avatar-title","bg-primary-subtle","text-primary","rounded-circle"],[1,"fw-medium"],[1,"fa-solid","fa-shield-alt","text-primary","ms-1",3,"title"],[1,"text-warning"],[1,"d-flex","flex-wrap","gap-1"],[1,"badge","bg-danger"],[1,"badge","bg-success"],[1,"badge","bg-secondary"],["role","group",1,"btn-group"],[1,"btn","btn-sm","btn-outline-primary",3,"title","routerLink"],[1,"fa-solid","fa-eye"],[1,"btn","btn-sm","btn-outline-secondary",3,"title","disabled","routerLink"],[1,"fa-solid","fa-edit"],[1,"btn","btn-sm","btn-outline-info",3,"click","title","disabled"],[1,"fa-solid","fa-user-tag"],[1,"btn","btn-sm","btn-outline-danger",3,"click","title","disabled"],[1,"fa-solid","fa-trash"],[1,"fa-solid","fa-exclamation-triangle","me-1"],[1,"badge","bg-info-subtle","text-info"],[1,"badge","bg-secondary-subtle","text-secondary"],[1,"d-flex","justify-content-between","align-items-center"],[1,"pagination","pagination-sm","mb-0"],[1,"page-item"],[1,"page-link",3,"click","disabled"],[1,"fa-solid","fa-chevron-left"],[1,"page-item",3,"active"],[1,"fa-solid","fa-chevron-right"],[1,"page-link",3,"click"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"row"],[1,"col-md-6"],[1,"col-sm-4"],[1,"col-sm-8"],[1,"row","mt-3"],[1,"d-flex","flex-wrap","gap-2"],[1,"badge","bg-info"],["type","button",1,"btn","btn-primary",3,"routerLink"],[1,"fa-solid","fa-edit","me-2"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1)(2,"h2"),l(3),r(),a(4,"div")(5,"button",2),v(6,"i",3),l(7),r()()(),a(8,"div",4)(9,"div",5)(10,"div",6)(11,"div",7)(12,"label",8),l(13),r(),a(14,"div",9)(15,"span",10),v(16,"i",11),r(),a(17,"input",12),D("ngModelChange",function(m){return F(o.searchTerm,m)||(o.searchTerm=m),m}),h("input",function(){return o.onSearchChange()}),r()()(),a(18,"div",13)(19,"label",8),l(20),r(),a(21,"select",14),D("ngModelChange",function(m){return F(o.statusFilter,m)||(o.statusFilter=m),m}),h("change",function(){return o.onFilterChange()}),a(22,"option",15),l(23),r(),a(24,"option",16),l(25),r(),a(26,"option",17),l(27),r()()(),a(28,"div",13)(29,"label",8),l(30),r(),a(31,"select",14),D("ngModelChange",function(m){return F(o.roleFilter,m)||(o.roleFilter=m),m}),h("change",function(){return o.onFilterChange()}),a(32,"option",15),l(33),r(),U(34,ve,2,2,"option",18,re),r()(),a(36,"div",19)(37,"button",20),h("click",function(){return o.onClearFilters()}),v(38,"i",21),l(39),r()()()()(),a(40,"div",22)(41,"div",5),u(42,he,6,2,"div",23)(43,Me,5,2,"div",23)(44,Ae,24,9),r()()(),u(45,Qe,13,4,"div",24),a(46,"app-role-management",25),h("showChange",function(m){return o.onShowRoleManagementChange(m)})("rolesUpdated",function(m){return o.onRolesUpdated(m)}),r()),e&2&&(i(3),s(o.t("users.title")),i(4),_(" ",o.t("users.create_user")," "),i(6),s(o.t("common.search")),i(4),E("placeholder",o.t("users.search_placeholder")),T("ngModel",o.searchTerm),i(3),s(o.t("common.status")),i(),T("ngModel",o.statusFilter),i(2),s(o.t("common.all")),i(2),s(o.t("common.active")),i(2),s(o.t("common.inactive")),i(3),s(o.t("common.role")),i(),T("ngModel",o.roleFilter),i(2),s(o.t("common.all")),i(),S(o.availableRoles()),i(5),_(" ",o.t("common.clear")," "),i(3),g(o.loading()?42:o.users().length===0?43:44),i(3),g(o.showUserModal()?45:-1),i(),E("user",o.selectedUser())("show",o.showRoleManagement()))},dependencies:[A,ee,Y,Z,J,X,K,Q,G,z],styles:[".users-page[_ngcontent-%COMP%]{padding:0}.avatar-sm[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.avatar-title[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:600}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.badge[_ngcontent-%COMP%]{font-size:.75rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:.25rem!important;margin-right:2px}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}.modal.show[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .15s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.table-responsive[_ngcontent-%COMP%]{border-radius:.375rem}.pagination[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{color:var(--bs-primary);border-color:var(--bs-border-color)}.pagination[_ngcontent-%COMP%]   .page-item.active[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{background-color:var(--bs-primary);border-color:var(--bs-primary)}.form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.input-group-text[_ngcontent-%COMP%]{background-color:var(--bs-light);border-color:var(--bs-border-color)}.card[_ngcontent-%COMP%]{box-shadow:0 .125rem .25rem #00000013;border:1px solid var(--bs-border-color)}.card-body[_ngcontent-%COMP%]{padding:1.5rem}.spinner-border[_ngcontent-%COMP%]{width:2rem;height:2rem}[dir=rtl][_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:0;margin-left:2px}[dir=rtl][_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-left:0}[dir=rtl][_ngcontent-%COMP%]   .avatar-sm[_ngcontent-%COMP%]{margin-right:0;margin-left:.5rem}@media (max-width: 768px){.btn-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:0;width:100%}.table-responsive[_ngcontent-%COMP%]{font-size:.875rem}.badge[_ngcontent-%COMP%]{font-size:.7rem}}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar{height:8px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--bs-light);border-radius:4px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--bs-secondary);border-radius:4px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--bs-dark)}"]})};export{ie as UsersComponent};
