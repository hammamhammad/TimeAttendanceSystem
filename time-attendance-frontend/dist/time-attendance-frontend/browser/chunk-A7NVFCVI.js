import"./chunk-IOKJIQ6J.js";import{c as w,d as q,e as N,f as k,i as V,m as z,n as L,o as A,p as G,r as $,w as j,x as U,y as Y}from"./chunk-VRETN7JA.js";import{a as Q}from"./chunk-23PGFYQZ.js";import{a as J}from"./chunk-UBCI4X5Q.js";import{a as K}from"./chunk-EYAJMHM7.js";import{a as B}from"./chunk-HHXRLUSQ.js";import{b as H}from"./chunk-RUY4WPQA.js";import{d as T,g as R}from"./chunk-TWXUAMJ4.js";import{$a as P,Bb as s,Cb as c,Db as b,Ea as S,Eb as O,R as f,W as F,X as y,Xa as g,Ya as _,ab as I,bb as p,cb as a,da as h,db as l,eb as m,lb as E,nb as x,pb as u,ta as t,wc as D,yb as M}from"./chunk-JSQL33QG.js";import"./chunk-DGAILPFQ.js";var X=(o,n)=>n.value;function Z(o,n){if(o&1&&m(0,"app-loading-spinner",4),o&2){let e=u();p("message",e.i18n.t("common.loading"))}}function ee(o,n){if(o&1&&(a(0,"option",16),s(1),l()),o&2){let e=n.$implicit;p("value",e.value),t(),c(e.label)}}function te(o,n){if(o&1&&(a(0,"div",17),s(1),l()),o&2){let e=u(2);t(),c(e.getFieldError("requestType"))}}function ie(o,n){if(o&1&&(a(0,"div",18),s(1),l()),o&2){let e=u(2);t(),c(e.i18n.t("portal.request_type_cannot_be_changed"))}}function ne(o,n){if(o&1&&(a(0,"div",17),s(1),l()),o&2){let e=u(2);t(),c(e.getFieldError("issueDescription"))}}function re(o,n){if(o&1&&(m(0,"i",35),s(1)),o&2){let e=u(2);t(),b(" ",e.i18n.t("common.saving")," ")}}function oe(o,n){if(o&1&&(m(0,"i",36),s(1)),o&2){let e=u(2);t(),b(" ",e.isEditMode()?e.i18n.t("common.update"):e.i18n.t("common.submit")," ")}}function ae(o,n){if(o&1){let e=E();a(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"h5",9),m(5,"i",10),s(6),l()(),a(7,"div",11)(8,"form",12),x("ngSubmit",function(){F(e);let d=u();return y(d.submitForm())}),a(9,"div",13)(10,"label",14),s(11),l(),a(12,"select",15),P(13,ee,2,2,"option",16,X),l(),g(15,te,2,1,"div",17),g(16,ie,2,1,"div",18),l(),a(17,"div",13)(18,"label",14),s(19),l(),m(20,"textarea",19),g(21,ne,2,1,"div",17),a(22,"div",18),s(23),l()(),a(24,"div",13)(25,"label",20),s(26),l(),m(27,"input",21),a(28,"div",18),s(29),l()(),a(30,"div",22)(31,"div",23)(32,"label",20),s(33),l(),m(34,"input",24),a(35,"div",18),s(36),l()(),a(37,"div",23)(38,"label",20),s(39),l(),m(40,"input",25),a(41,"div",18),s(42),l()()(),a(43,"div",26)(44,"button",27),x("click",function(){F(e);let d=u();return y(d.cancel())}),m(45,"i",28),s(46),l(),a(47,"button",29),g(48,re,2,1)(49,oe,2,1),l()()()()(),a(50,"div",30)(51,"div",11)(52,"div",31),m(53,"i",32),a(54,"div")(55,"h6",33),s(56),l(),a(57,"ul",34)(58,"li"),s(59),l(),a(60,"li"),s(61),l(),a(62,"li"),s(63),l(),a(64,"li"),s(65),l()()()()()()()()}if(o&2){let e,r,d,v,C,i=u();t(6),b(" ",i.isEditMode()?i.i18n.t("portal.edit_request"):i.i18n.t("portal.create_request")," "),t(2),p("formGroup",i.requestForm),t(3),c(i.i18n.t("portal.request_type")),t(),M("is-invalid",((e=i.requestForm.get("requestType"))==null?null:e.invalid)&&((e=i.requestForm.get("requestType"))==null?null:e.touched)),p("disabled",i.isEditMode()),t(),I(i.requestTypes),t(2),_((r=i.requestForm.get("requestType"))!=null&&r.invalid&&((r=i.requestForm.get("requestType"))!=null&&r.touched)?15:-1),t(),_(i.isEditMode()?16:-1),t(3),c(i.i18n.t("portal.issue_description")),t(),M("is-invalid",((d=i.requestForm.get("issueDescription"))==null?null:d.invalid)&&((d=i.requestForm.get("issueDescription"))==null?null:d.touched)),p("placeholder",i.i18n.t("portal.describe_issue_placeholder")),t(),_((v=i.requestForm.get("issueDescription"))!=null&&v.invalid&&((v=i.requestForm.get("issueDescription"))!=null&&v.touched)?21:-1),t(2),O(" ",i.i18n.t("portal.min_10_characters")," (",((C=i.requestForm.get("issueDescription"))==null||C.value==null?null:C.value.length)||0,"/500) "),t(3),c(i.i18n.t("portal.affected_fingers")),t(),p("placeholder",i.i18n.t("portal.affected_fingers_placeholder")),t(2),c(i.i18n.t("portal.optional_field")),t(4),c(i.i18n.t("portal.preferred_date")),t(3),c(i.i18n.t("portal.when_you_available")),t(3),c(i.i18n.t("portal.preferred_time")),t(3),c(i.i18n.t("portal.optional_field")),t(2),p("disabled",i.submitting()),t(2),b(" ",i.i18n.t("common.cancel")," "),t(),p("disabled",i.submitting()||i.requestForm.invalid),t(),_(i.submitting()?48:49),t(8),c(i.i18n.t("portal.request_help_title")),t(3),c(i.i18n.t("portal.request_help_1")),t(2),c(i.i18n.t("portal.request_help_2")),t(2),c(i.i18n.t("portal.request_help_3")),t(2),c(i.i18n.t("portal.request_help_4"))}}var W=class o{portalService=f(Q);router=f(R);route=f(T);fb=f(j);notificationService=f(B);i18n=f(H);requestId=h(null);isEditMode=h(!1);loading=h(!1);submitting=h(!1);requestForm;requestTypes=[{value:"NewEnrollment",label:"New Enrollment"},{value:"Update",label:"Update Existing"},{value:"Issue",label:"Issue/Problem"},{value:"AdditionalFingers",label:"Additional Fingers"},{value:"LocationChange",label:"Location Change"}];ngOnInit(){this.initializeForm(),this.checkRouteParams()}initializeForm(){this.requestForm=this.fb.group({requestType:["Issue",[q.required]],issueDescription:["",[q.required,q.minLength(10),q.maxLength(500)]],affectedFingers:[""],preferredDate:[""],preferredTime:[""]})}checkRouteParams(){let n=this.route.snapshot.paramMap.get("id");n&&n!=="new"&&(this.requestId.set(parseInt(n,10)),this.isEditMode.set(!0),this.loadRequest(this.requestId()))}loadRequest(n){this.loading.set(!0),this.portalService.loadFingerprintRequests().subscribe({next:()=>{let r=this.portalService.fingerprintRequests().find(d=>d.id===n);r?this.requestForm.patchValue({requestType:r.requestType,issueDescription:r.issueDescription,affectedFingers:r.affectedFingers||"",preferredDate:r.preferredDate?this.formatDateForInput(r.preferredDate):"",preferredTime:r.preferredTime||""}):(this.notificationService.error(this.i18n.t("portal.request_not_found")),this.router.navigate(["/portal/fingerprint-requests"])),this.loading.set(!1)},error:e=>{console.error("Failed to load request:",e),this.notificationService.error(this.i18n.t("portal.failed_to_load_request")),this.loading.set(!1)}})}submitForm(){if(this.requestForm.valid){this.submitting.set(!0);let n=this.requestForm.value,e={requestType:n.requestType,issueDescription:n.issueDescription,affectedFingers:n.affectedFingers||void 0,preferredDate:n.preferredDate?new Date(n.preferredDate):void 0,preferredTime:n.preferredTime||void 0};if(this.isEditMode()&&this.requestId()){let r={issueDescription:e.issueDescription,affectedFingers:e.affectedFingers,preferredDate:e.preferredDate,preferredTime:e.preferredTime};this.portalService.updateFingerprintRequest(this.requestId(),r).subscribe({next:()=>{this.notificationService.success(this.i18n.t("portal.request_updated_successfully")),this.router.navigate(["/portal/fingerprint-requests",this.requestId()]),this.submitting.set(!1)},error:d=>{console.error("Failed to update request:",d),this.notificationService.error(this.i18n.t("portal.failed_to_update_request")),this.submitting.set(!1)}})}else{let r=e;this.portalService.createFingerprintRequest(r).subscribe({next:d=>{this.notificationService.success(this.i18n.t("portal.request_created_successfully")),this.router.navigate(["/portal/fingerprint-requests",d]),this.submitting.set(!1)},error:d=>{console.error("Failed to create request:",d),this.notificationService.error(this.i18n.t("portal.failed_to_create_request")),this.submitting.set(!1)}})}}else Object.keys(this.requestForm.controls).forEach(n=>{this.requestForm.get(n)?.markAsTouched()})}cancel(){this.isEditMode()&&this.requestId()?this.router.navigate(["/portal/fingerprint-requests",this.requestId()]):this.router.navigate(["/portal/fingerprint-requests"])}getFieldError(n){let e=this.requestForm.get(n);if(e?.hasError("required"))return this.i18n.t("validation.required");if(e?.hasError("minlength")){let r=e.errors?.minlength?.requiredLength;return this.i18n.t("validation.min_length",{length:r})}if(e?.hasError("maxlength")){let r=e.errors?.maxlength?.requiredLength;return this.i18n.t("validation.max_length",{length:r})}return""}formatDateForInput(n){let e=typeof n=="string"?new Date(n):n,r=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),v=String(e.getDate()).padStart(2,"0");return`${r}-${d}-${v}`}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=S({type:o,selectors:[["app-fingerprint-request-form"]],decls:7,vars:5,consts:[[3,"title"],["header-actions",""],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"fa-solid","fa-arrow-left","me-1"],[3,"message"],[1,"row","justify-content-center"],[1,"col-lg-8"],[1,"card"],[1,"card-header","bg-white"],[1,"card-title","mb-0"],[1,"fa-solid","fa-fingerprint","me-2"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label","required"],["formControlName","requestType",1,"form-select",3,"disabled"],[3,"value"],[1,"invalid-feedback"],[1,"form-text"],["formControlName","issueDescription","rows","4",1,"form-control",3,"placeholder"],[1,"form-label"],["type","text","formControlName","affectedFingers",1,"form-control",3,"placeholder"],[1,"row"],[1,"col-md-6","mb-3"],["type","date","formControlName","preferredDate",1,"form-control"],["type","time","formControlName","preferredTime",1,"form-control"],[1,"d-flex","justify-content-end","gap-2","mt-4","pt-3","border-top"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"fa-solid","fa-times","me-1"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"card","mt-3"],[1,"d-flex","align-items-start"],[1,"fa-solid","fa-info-circle","text-info","me-3","mt-1",2,"font-size","1.5rem"],[1,"mb-2"],[1,"text-muted","mb-0","small","ps-3"],[1,"fa-solid","fa-spinner","fa-spin","me-1"],[1,"fa-solid","fa-save","me-1"]],template:function(e,r){e&1&&(a(0,"app-page-header",0)(1,"div",1)(2,"button",2),x("click",function(){return r.cancel()}),m(3,"i",3),s(4),l()()(),g(5,Z,1,1,"app-loading-spinner",4),g(6,ae,66,31,"div",5)),e&2&&(p("title",r.isEditMode()?r.i18n.t("portal.edit_fingerprint_request"):r.i18n.t("portal.new_fingerprint_request")),t(2),p("disabled",r.submitting()),t(2),b(" ",r.i18n.t("common.back")," "),t(),_(r.loading()?5:-1),t(),_(r.loading()?-1:6))},dependencies:[D,U,V,G,$,w,A,N,k,Y,z,L,J,K],styles:['.card[_ngcontent-%COMP%]{box-shadow:0 .125rem .25rem #00000013;border:1px solid var(--bs-border-color)}.card-header[_ngcontent-%COMP%]{border-bottom:1px solid var(--bs-border-color)}.card-body[_ngcontent-%COMP%]{padding:2rem}.form-label[_ngcontent-%COMP%]{font-weight:600;font-size:.875rem;color:var(--bs-secondary);margin-bottom:.5rem}.form-label.required[_ngcontent-%COMP%]:after{content:" *";color:var(--bs-danger)}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:.375rem;border:1px solid var(--bs-border-color);padding:.625rem .875rem;font-size:.9rem}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:var(--bs-primary);box-shadow:0 0 0 .25rem #0d6efd40}.form-control[_ngcontent-%COMP%]:disabled, .form-select[_ngcontent-%COMP%]:disabled{background-color:var(--bs-light);cursor:not-allowed}.form-text[_ngcontent-%COMP%]{font-size:.8rem;color:var(--bs-secondary);margin-top:.25rem}.invalid-feedback[_ngcontent-%COMP%]{font-size:.8rem;color:var(--bs-danger);margin-top:.25rem}textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:100px}.card[_ngcontent-%COMP%]   .fa-info-circle[_ngcontent-%COMP%]{flex-shrink:0}.card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-bottom:0}.card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.5rem}.card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-bottom:0}.btn[_ngcontent-%COMP%]{font-weight:500;padding:.625rem 1.25rem;border-radius:.375rem}.btn-primary[_ngcontent-%COMP%]{background-color:var(--bs-primary);border-color:var(--bs-primary)}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#0b5ed7;border-color:#0a58ca}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.65;cursor:not-allowed}.btn-outline-secondary[_ngcontent-%COMP%]{color:var(--bs-secondary);border-color:var(--bs-border-color)}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background-color:var(--bs-secondary);border-color:var(--bs-secondary);color:#fff}@media (max-width: 768px){.card-body[_ngcontent-%COMP%]{padding:1.5rem}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{font-size:.875rem;padding:.5rem .75rem}.btn[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.875rem}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}']})};export{W as FingerprintRequestFormComponent};
